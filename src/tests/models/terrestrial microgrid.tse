version = 4.2

//
// Saved by sw version: 2022.1 DEV
// Save timestamp: 06-Jan-2022 @ 02:30:55 PM
//

model "terrestrial microgrid" {
    configuration {
        hil_device = "HIL602+"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 4e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "medium"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
    }

    component Subsystem Root {
        component src_scada_input c_option {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 7840, 8560
            rotation = right
        ]

        component src_scada_input op_mode {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 7880, 8512
            rotation = right
        ]

        component Subsystem Wind {
            layout = dynamic
            component src_scada_input wind_speed {
                def_value = "6"
                execution_rate = "Ts"
                max = "25"
                min = "0"
                unit = "m/s"
            }
            [
                position = 7928, 8016
            ]

            component gen_bus_join "Bus Join4" {
                inputs = "6"
            }
            [
                position = 8072, 8248
                rotation = right
                hide_name = True
            ]

            component src_scada_input Connect {
                addr = "1427111948"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 7928
            ]

            component src_scada_input Enable {
                addr = "1427111948"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7424, 7952
            ]

            component src_scada_input V_ref {
                def_value = "480.0"
                execution_rate = "Ts"
                max = "2.0*480.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 7992, 8056
            ]

            component src_scada_input Q_mode {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 8104
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts"
                unit = "kVAr"
            }
            [
                position = 7992, 8152
            ]

            component gen_probe Out {
            }
            [
                position = 8448, 8272
            ]

            component "core/Wind Power Plant (Switching)" "Wind Power Plant (Switching)" {
                C = "270.84e-6"
                L = "10.2876e-6"
                L0 = "798.05e-6"
                Rres = "0.06455"
                Sn = "500e3"
                Ts = "Ts"
                eff_A = "448"
            }
            [
                position = 8224, 8456
                size = 353, 239
            ]

            component Subsystem interface {
                layout = dynamic
                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    input_terminals = "real enable_in;inherit force_off;"
                    input_terminals_dimensions = "inherit;inherit"
                    input_terminals_feedthrough = "[\'\']"
                    input_terminals_show_labels = "False;False;"
                    output_fnc = "/*Begin code section*/
if(force_off){
    enable = 0;
}
else{
    enable = enable_in;
}
/*End code section*/"
                    output_terminals = "real enable;"
                    output_terminals_dimensions = "inherit"
                    output_terminals_feedthrough = "[\'\']"
                }
                [
                    position = 8336, 8280
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 8232, 8288
                    hide_name = True
                    size = 32, 32
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8408, 8280
                ]

                connect "Bus Split1.in" fromPMS as Connection880
                connect "Rate Transition1.in" "Bus Split1.out4" as Connection873
                connect SM.enable Enable as Connection881
                connect SM.enable_in Enable_in as Connection879
                connect SM.force_off "Rate Transition1.out" as Connection878
                connect Termination1.in "Bus Split1.out" as Connection874
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect Termination4.in "Bus Split1.out3" as Connection877
            }
            [
                position = 7568, 7984
                size = 112, 96
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8448, 8360
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8448, 8456
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8448, 8552
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7424, 8016
            ]

            tag Goto2 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7712, 7984
                hide_name = True
            ]

            tag From1 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7984, 7984
                hide_name = True
            ]

            connect "Bus Join4.out" "Wind Power Plant (Switching).Inputs" as Connection866
            connect Connect.out "Bus Join4.in" as Connection867
            connect Enable.out interface.Enable_in as Connection872
            connect From1 "Bus Join4.in1" as Connection875
            connect Goto2 interface.Enable as Connection874
            connect Out.in "Wind Power Plant (Switching).Outputs" as Connection864
            connect Q_mode.out "Bus Join4.in4" as Connection862
            connect Q_ref.out "Bus Join4.in5" as Connection861
            connect V_ref.out "Bus Join4.in3" as Connection863
            connect "Wind Power Plant (Switching).A" A as Connection869
            connect "Wind Power Plant (Switching).B" B as Connection870
            connect "Wind Power Plant (Switching).C" C as Connection871
            connect from_PMS interface.fromPMS as Connection873
            connect wind_speed.out "Bus Join4.in2" as Connection868

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Wind Power Plant.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'wind_power_plant.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7928, 9216
            rotation = left
            size = 160, 160
        ]

        component Subsystem Trafo4 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "3e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8192, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7824, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7824, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7824, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8344, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8344, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8344, 7992
                scale = -1, 1
            ]

            connect Tr7.sec_1 a as Connection7
            connect Tr7.sec_2 b as Connection8
            connect Tr7.sec_3 c as Connection1
            connect A Tr7.prm_1 as Connection9
            connect B Tr7.prm_2 as Connection10
            connect C Tr7.prm_3 as Connection11
        }
        [
            position = 8616, 9048
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Trafo3 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "0.375e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8192, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 7976, 7896
                size = 12, 256
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7856, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7856, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7856, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8344, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8344, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8344, 7992
                scale = -1, 1
            ]

            connect "Core Coupling 1.a_in" A as Connection14
            connect "Core Coupling 1.b_in" B as Connection12
            connect "Core Coupling 1.c_in" C as Connection10
            connect Tr7.prm_3 "Core Coupling 1.c_out" as Connection9
            connect Tr7.prm_2 "Core Coupling 1.b_out" as Connection11
            connect Tr7.prm_1 "Core Coupling 1.a_out" as Connection13
            connect Tr7.sec_1 a as Connection7
            connect Tr7.sec_2 b as Connection8
            connect Tr7.sec_3 c as Connection1
        }
        [
            position = 8264, 9048
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Trafo2 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "0.75e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8192, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8048, 7896
                size = 12, 256
            ]

            component Subsystem "RC Snubber" {
                layout = dynamic
                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8264, 8240
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8120, 8240
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "R"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8192, 8240
                    rotation = right
                ]

                component pas_resistor R3 {
                    resistance = "R"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "R"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port N {
                    position = bottom:2
                    kind = pe
                }
                [
                    position = 8192, 8320
                    rotation = left
                ]

                junction Junction1 pe
                [
                    position = 8192, 8288
                ]

                junction Junction2 pe
                [
                    position = 8192, 8288
                ]

                connect C1.n_node Junction2 as Connection21
                connect C1.p_node R1.n_node as Connection10
                connect C1.p_node R1.n_node as Connection11
                connect C1.p_node R1.n_node as Connection9
                connect C2.n_node Junction1 as Connection18
                connect C2.p_node R2.n_node as Connection24
                connect C3.n_node Junction2 as Connection23
                connect Junction1 N as Connection19
                connect Junction2 Junction1 as Connection22
                connect R1.p_node A as Connection13
                connect R2.p_node B as Connection15
                connect R3.p_node C as Connection16
                connect R3.n_node C3.p_node as Connection25

                C = "7.41e-3"
                R = "1345"

                mask {
                    R {
                        label = "R"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "ohms"
                        group = "General"
                    }

                    C {
                        label = "C"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "F"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7936, 8064
                size = 64, 48
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7864, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7864, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7864, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8344, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8344, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8344, 7992
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 7920, 7800
            ]

            junction Junction2 pe
            [
                position = 7936, 7896
            ]

            junction Junction3 pe
            [
                position = 7952, 7992
            ]

            connect "Core Coupling 1.a_in" Junction1 as Connection15
            connect "Core Coupling 1.b_in" Junction2 as Connection18
            connect "Core Coupling 1.c_in" Junction3 as Connection21
            connect Junction1 A as Connection16
            connect Junction2 B as Connection19
            connect Junction3 C as Connection22
            connect "RC Snubber.A" Junction1 as Connection17
            connect "RC Snubber.B" Junction2 as Connection20
            connect "RC Snubber.C" Junction3 as Connection23
            connect Tr7.prm_3 "Core Coupling 1.c_out" as Connection9
            connect Tr7.prm_2 "Core Coupling 1.b_out" as Connection11
            connect Tr7.prm_1 "Core Coupling 1.a_out" as Connection13
            connect Tr7.sec_1 a as Connection7
            connect Tr7.sec_2 b as Connection8
            connect Tr7.sec_3 c as Connection1
        }
        [
            position = 7928, 9048
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Trafo1 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6/2"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "2.4e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 7992, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8152, 7896
                scale = -1, 1
                size = 12, 256
            ]

            component Subsystem "RC Snubber" {
                layout = dynamic
                component pas_resistor R2 {
                    resistance = "R"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8264, 8240
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8120, 8240
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "R"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R3 {
                    resistance = "R"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8192, 8240
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port N {
                    position = bottom:2
                    kind = pe
                }
                [
                    position = 8192, 8320
                    rotation = left
                ]

                junction Junction1 pe
                [
                    position = 8192, 8288
                ]

                junction Junction2 pe
                [
                    position = 8192, 8288
                ]

                connect C1.n_node Junction2 as Connection21
                connect C1.p_node R1.n_node as Connection10
                connect C1.p_node R1.n_node as Connection11
                connect C1.p_node R1.n_node as Connection9
                connect C2.n_node Junction1 as Connection18
                connect C2.p_node R2.n_node as Connection24
                connect C3.n_node Junction2 as Connection23
                connect Junction1 N as Connection19
                connect Junction2 Junction1 as Connection22
                connect R1.p_node A as Connection13
                connect R2.p_node B as Connection15
                connect R3.p_node C as Connection16
                connect R3.n_node C3.p_node as Connection25

                C = "50e-6"
                R = "0.2"

                mask {
                    R {
                        label = "R"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "ohms"
                        group = "General"
                    }

                    C {
                        label = "C"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "F"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8272, 8072
                size = 64, 48
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7760, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7760, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7760, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8376, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8376, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8376, 7992
                scale = -1, 1
            ]

            junction Junction3 pe
            [
                position = 8288, 7992
            ]

            junction Junction2 pe
            [
                position = 8272, 7896
            ]

            junction Junction1 pe
            [
                position = 8256, 7800
            ]

            connect Tr7.prm_1 A as Connection9
            connect Tr7.prm_3 C as Connection11
            connect B Tr7.prm_2 as Connection10
            connect Junction3 c as Connection25
            connect Junction1 a as Connection19
            connect "RC Snubber.B" Junction2 as Connection23
            connect "Core Coupling 1.a_in" Junction1 as Connection18
            connect b Junction2 as Connection21
            connect "RC Snubber.A" Junction1 as Connection20
            connect "Core Coupling 1.c_in" Junction3 as Connection24
            connect Junction2 "Core Coupling 1.b_in" as Connection22
            connect "RC Snubber.C" Junction3 as Connection26
            connect Tr7.sec_3 "Core Coupling 1.c_out" as Connection16
            connect Tr7.sec_1 "Core Coupling 1.a_out" as Connection12
            connect "Core Coupling 1.b_out" Tr7.sec_2 as Connection15
        }
        [
            position = 7584, 9056
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Trafo5 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "2.9e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8192, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7776, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7776, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7776, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8736, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8736, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8736, 7992
                scale = -1, 1
            ]

            connect Tr7.sec_1 a as Connection6
            connect Tr7.sec_3 c as Connection8
            connect b Tr7.sec_2 as Connection7
            connect A Tr7.prm_1 as Connection9
            connect B Tr7.prm_2 as Connection10
            connect C Tr7.prm_3 as Connection11
        }
        [
            position = 8896, 8936
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem "Interruptible load" {
            layout = dynamic
            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8192, 8120
                rotation = right
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8288, 8216
                rotation = right
            ]

            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8096, 8120
                rotation = right
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8096, 8216
                rotation = right
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8192, 8216
                rotation = right
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8288, 8120
                rotation = right
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
            }
            [
                position = 8192, 8000
                rotation = right
                size = 64, 256
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8096, 7896
                rotation = right
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8288, 7896
                rotation = right
            ]

            junction Junction1 pe
            [
                position = 8192, 8272
            ]

            connect A S1.c_in as Connection11
            connect B S1.b_in as Connection13
            connect C S1.a_in as Connection12
            connect Junction1 L3.n_node as Connection6
            connect L1.n_node Junction1 as Connection5
            connect L2.n_node Junction1 as Connection7
            connect R1.n_node L1.p_node as Connection1
            connect R2.n_node L2.p_node as Connection2
            connect R3.n_node L3.p_node as Connection3
            connect S1.c_out R1.p_node as Connection9
            connect S1.b_out R2.p_node as Connection8
            connect S1.a_out R3.p_node as Connection10

            Sb = "480e3"
            Vb = "480"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 9120, 9208
            size = 160, 160
        ]

        component Subsystem Grid {
            layout = dynamic
            component "core/Three Phase Voltage Source" Vs1 {
            }
            [
                position = 8080, 8144
                size = 62, 256
            ]

            component "core/RL Section" "RL Section1" {
                L_value = "2.7996177881216925e-05"
                R_value = "1.5444546895887732"
                frequency = "60"
                inductance_per_l = "0.0006213711922373339"
                length = "1.609344"
                model_def = "S-U"
                power = "10e3"
                resistance_per_l = "0.621371192237334"
                unit_sys = "metric"
                voltage = "12.47"
            }
            [
                position = 8304, 8144
                size = 256, 56
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8536, 8048
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8536, 8144
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8536, 8248
                rotation = down
            ]

            port N {
                position = left:1
                kind = pe
            }
            [
                position = 8000, 8144
            ]

            connect "RL Section1.P1" A as Connection95
            connect "RL Section1.P3" B as Connection94
            connect "RL Section1.P5" C as Connection93
            connect "RL Section1.P6" Vs1.c_node as Connection89
            [
                breakpoints = 8160, 8160; 8160, 8240
            ]
            connect Vs1.n_node N as Connection92
            connect Vs1.b_node "RL Section1.P4" as Connection90
            connect Vs1.a_node "RL Section1.P2" as Connection91
        }
        [
            position = 8400, 8480
            rotation = right
            scale = -1, 1
            size = 56, 152
        ]

        component Subsystem DG {
            layout = dynamic
            component src_scada_input Qref {
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7352, 8232
            ]

            component src_scada_input Vref {
                addr = "1427111940"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = "pu"
            }
            [
                position = 7352, 8040
            ]

            component src_scada_input Gen_Control_Mode {
                addr = "1427111944"
                execution_rate = "Ts"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 8096
            ]

            component gen_probe Out {
            }
            [
                position = 8392, 8256
                rotation = left
            ]

            component src_scada_input Load_share_on {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7976, 8160
            ]

            component gen_bus_join "Bus Join3" {
                inputs = "9"
            }
            [
                position = 8088, 8288
                rotation = right
                hide_name = True
            ]

            component src_scada_input wref {
                addr = "1427111952"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = ""
            }
            [
                position = 7352, 8104
            ]

            component src_scada_input Load_share {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7912, 8208
            ]

            component src_scada_input Gen_On {
                addr = "1427111952"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 7872
            ]

            component src_scada_input Pref {
                addr = "1427111936"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = ""
            }
            [
                position = 7352, 8168
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_probe PFref {
                }
                [
                    position = 8432, 8392
                ]

                component gen_probe w {
                }
                [
                    position = 8400, 8144
                    rotation = left
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 7808, 8040
                    hide_name = True
                ]

                component gen_c_function getPF {
                    global_variables = "real x;"
                    input_terminals = "real P;inherit Q;"
                    input_terminals_dimensions = "inherit;inherit"
                    input_terminals_feedthrough = "[\'\']"
                    input_terminals_show_labels = "False;False;"
                    output_fnc = "/*Begin code section*/
if(fabs(P)>0.1){
    x = P*P+Q*Q;
    if(Q>=0){
        pf = P/sqrt(x);
    }
    else{
        pf = -P/sqrt(x);
    }
}
else{
    pf = 1;
}
/*End code section*/"
                    output_terminals = "real pf;"
                    output_terminals_dimensions = "inherit"
                    output_terminals_feedthrough = "[\'\']"
                }
                [
                    position = 8368, 8344
                    rotation = right
                    size = 48, 48
                ]

                component gen_gain Gain1 {
                    gain = "1/Sb"
                }
                [
                    position = 7960, 8160
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 7872, 8120
                    rotation = right
                    hide_name = True
                ]

                component gen_probe gridForm {
                }
                [
                    position = 8320, 7952
                    rotation = left
                ]

                component gen_probe P_ref {
                }
                [
                    position = 8512, 8264
                ]

                component gen_gain Gain3 {
                    gain = "1/Sb"
                }
                [
                    position = 7912, 8160
                    rotation = right
                    hide_name = True
                ]

                component gen_c_function SM {
                    input_terminals = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;"
                    input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    input_terminals_feedthrough = "[\'\']"
                    input_terminals_show_labels = "False;False;False;False;False;False;False;False;False;False;"
                    output_fnc = "/*Begin code section*/
if(DERoption > 0){
    if(formGrid > 0){
        gridForm = 2;
        V = Vref + dV;
        w = wref + dw;
        P = 0;
        Q = 0;
    }
    else{
        gridForm = 1;
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    gridForm = 1;
    V = Vref;
    w = wref;
    P = Pref + Ppms;
    Q = Qref + Qpms;
}
/*End code section*/"
                    output_terminals = "inherit gridForm;inherit V;inherit w;inherit P;inherit Q;"
                    output_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    output_terminals_feedthrough = "[\'\']"
                    output_terminals_show_labels = "False;False;False;False;False;"
                }
                [
                    position = 8256, 8232
                    size = 48, 176
                ]

                component gen_probe V {
                }
                [
                    position = 8368, 8048
                    rotation = left
                ]

                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7976, 8304
                    rotation = left
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 7728, 8040
                    hide_name = True
                    size = 32, 32
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7664, 8040
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7864, 8368
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8320
                    rotation = right
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8168, 8376
                    rotation = left
                ]

                port pf {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8368, 8448
                    rotation = right
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8192, 8344
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8088
                ]

                port w_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8192
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8104, 8440
                    rotation = left
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8408
                    rotation = left
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8000
                ]

                junction Junction4 sp
                [
                    position = 8448, 8264
                ]

                junction Junction5 sp
                [
                    position = 8376, 8264
                ]

                junction Junction6 sp
                [
                    position = 8368, 8392
                ]

                junction Junction7 sp
                [
                    position = 8320, 8000
                ]

                junction Junction8 sp
                [
                    position = 8368, 8088
                ]

                junction Junction9 sp
                [
                    position = 8400, 8192
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in per unit</p></body></html> ENDCOMMENT 
                [
                    position = 8080, 8096
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in per unit</p></body></html> ENDCOMMENT 
                [
                    position = 8512, 8136
                ]

                connect "Bus Split1.out3" Gain3.in as Connection999
                connect "Bus Split1.out1" SM.formGrid as Connection1001
                connect "Bus Split1.out" SM.DERoption as Connection1002
                connect "Bus Split2.out1" SM.dV as Connection937
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain1.in "Bus Split1.out2" as Connection1000
                connect Gain1.out SM.Ppms as Connection939
                connect Gain3.out SM.Qpms as Connection940
                connect Junction4 Junction5 as Connection930
                connect Junction5 SM.P as Connection931
                connect Junction6 pf as Connection934
                connect Junction7 SM.gridForm as Connection944
                connect Junction8 SM.V as Connection947
                connect Junction9 w.in as Connection951
                connect P Junction4 as Connection925
                connect PFref.in Junction6 as Connection933
                connect P_ref.in Junction4 as Connection923
                connect Qref SM.Qref as Connection953
                connect "Rate Transition1.out" "Bus Split1.in" as Connection998
                connect "Rate Transition1.in" fromPMS as Connection893
                connect SM.dw "Bus Split2.out" as Connection936
                connect SM.w Junction9 as Connection950
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect SM.wref wref as Connection956
                connect Termination1.in "Bus Split1.out4" as Connection997
                connect V.in Junction8 as Connection946
                connect V_ref Junction8 as Connection948
                connect getPF.P Junction5 as Connection932
                connect getPF.pf Junction6 as Connection935
                connect getPF.Q SM.Q as Connection929
                connect gridForm.in Junction7 as Connection943
                connect opMode Junction7 as Connection945
                connect w_ref Junction9 as Connection952

                Ts = "Ts"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS with Diesel genset</p></body></html>"

                    Sb {
                        label = "Diesel genset nominal power"
                        widget = edit
                        type = generic
                        default_value = "2.2e6"
                        unit = "VA"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7496, 8072
                size = 128, 368
            ]

            component "core/Diesel Genset" Diesel_Gen {
                Ts = "Ts"
                phaseOff = "-0.06"
            }
            [
                position = 8240, 8496
                size = 354, 240
            ]

            component Subsystem split {
                layout = dynamic
                component gen_terminator T1 {
                }
                [
                    position = 8360, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T7 {
                }
                [
                    position = 8384, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T6 {
                }
                [
                    position = 8336, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T9 {
                }
                [
                    position = 8464, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T8 {
                }
                [
                    position = 8424, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T5 {
                }
                [
                    position = 8552, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T4 {
                }
                [
                    position = 8504, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T2 {
                }
                [
                    position = 8456, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T {
                }
                [
                    position = 8312, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "14"
                }
                [
                    position = 8192, 8192
                    hide_name = True
                ]

                component gen_terminator T10 {
                }
                [
                    position = 8504, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T3 {
                }
                [
                    position = 8408, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 8264, 8040
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T11 {
                }
                [
                    position = 8264, 8352
                    rotation = right
                    hide_name = True
                ]

                port ON {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8264, 7968
                    rotation = left
                ]

                port In {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8120, 8192
                ]

                connect "Bus Split1.in" In as Connection1
                connect "Bus Split1.out1" "Logical operator1.in1" as Connection11
                connect "Bus Split1.out5" T9.in as Connection16
                connect "Logical operator1.in" "Bus Split1.out" as Connection10
                connect ON "Logical operator1.out" as Connection12
                connect T.in "Bus Split1.out12" as Connection4
                connect T1.in "Bus Split1.out11" as Connection5
                connect T10.in "Bus Split1.out6" as Connection17
                connect T11.in "Bus Split1.out13" as Connection18
                connect T2.in "Bus Split1.out9" as Connection7
                connect T3.in "Bus Split1.out10" as Connection6
                connect T4.in "Bus Split1.out8" as Connection8
                connect T5.in "Bus Split1.out7" as Connection9
                connect T6.in "Bus Split1.out2" as Connection13
                connect T7.in "Bus Split1.out3" as Connection14
                connect T8.in "Bus Split1.out4" as Connection15
            }
            [
                position = 8488, 8320
                size = 48, 48
            ]

            port A {
                position = right:1
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8400
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8496
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8592
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7352, 7912
            ]

            port from_PCC {
                position = top:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7352, 7976
            ]

            port toPCC {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8592, 8320
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7992
                hide_name = True
            ]

            tag From2 {
                value = "pf_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 8024
                hide_name = True
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8152
                hide_name = True
            ]

            tag Goto3 {
                value = "wref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8072
                hide_name = True
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7928
                hide_name = True
            ]

            tag From4 {
                value = "wref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7960
                hide_name = True
            ]

            tag From3 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7992
                hide_name = True
            ]

            tag From1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 8056
                hide_name = True
            ]

            tag Goto1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7912
                hide_name = True
            ]

            tag Goto5 {
                value = "pf_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8232
                hide_name = True
            ]

            junction Junction1 sp
            [
                position = 8392, 8320
            ]

            connect "Bus Join3.out" Diesel_Gen.Inputs as Connection859
            connect "Bus Join3.in1" From5 as Connection914
            connect Diesel_Gen.A A as Connection862
            connect Diesel_Gen.B B as Connection863
            connect Diesel_Gen.C C as Connection861
            connect From2 "Bus Join3.in4" as Connection911
            connect From3 "Bus Join3.in3" as Connection912
            connect From4 "Bus Join3.in2" as Connection913
            connect Gen_On.out "Bus Join3.in" as Connection230
            connect Goto1 Interface.opMode as Connection905
            connect Goto2 Interface.V_ref as Connection909
            connect Goto3 Interface.w_ref as Connection908
            connect Goto4 Interface.P as Connection907
            connect Goto5 Interface.pf as Connection906
            connect Junction1 Diesel_Gen.Outputs as Connection916
            connect Load_share.out "Bus Join3.in8" as Connection826
            connect Load_share_on.out "Bus Join3.in7" as Connection825
            connect Out.in Junction1 as Connection915
            connect Pref.out Interface.Pref as Connection898
            connect Qref.out Interface.Qref as Connection899
            connect Vref.out Interface.Vref as Connection904
            connect from_PCC Interface.fromPCC as Connection894
            connect from_PMS Interface.fromPMS as Connection895
            connect split.In Junction1 as Connection917
            connect toPCC split.ON as Connection178
            connect wref.out Interface.wref as Connection903
            connect From1 "Bus Join3.in5" as Connection927
            connect Gen_Control_Mode.out "Bus Join3.in6" as Connection928

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Diesel Genset.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'diesel_genset.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8616, 9216
            rotation = left
            size = 160, 160
        ]

        component Subsystem PV {
            layout = dynamic
            component src_scada_input Q_mode {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7952, 8096
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts"
                unit = "kVAr"
            }
            [
                position = 8016, 8144
            ]

            component src_scada_input Irradiation {
                def_value = "1000"
                execution_rate = "Ts"
                max = "4500"
                min = "0"
                unit = "W/m^2"
            }
            [
                position = 7952, 8016
            ]

            component src_scada_input Connect {
                addr = "1427111948"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7952, 7920
            ]

            component src_scada_input V_ref {
                def_value = "480.0"
                execution_rate = "Ts"
                max = "2.0*480.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 8016, 8048
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 8088, 8240
                rotation = right
                hide_name = True
            ]

            component src_scada_input Enable {
                addr = "1427111948"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7488, 7944
            ]

            component gen_probe Out {
            }
            [
                position = 8432, 8272
            ]

            component "core/PV Plant (Switching)" PV_Plant {
                C = "135.4e-6"
                L = "20.575e-6"
                L0 = "1.596e-3"
                PV_area = "625"
                R0 = "1e-5"
                Rres = "0.1291"
                Sn = "250e3"
                Ts = "Ts"
            }
            [
                position = 8240, 8464
                size = 353, 239
            ]

            component Subsystem interface {
                layout = dynamic
                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    input_terminals = "real enable_in;inherit force_off;"
                    input_terminals_dimensions = "inherit;inherit"
                    input_terminals_feedthrough = "[\'\']"
                    input_terminals_show_labels = "False;False;"
                    output_fnc = "/*Begin code section*/
if(force_off){
    enable = 0;
}
else{
    enable = enable_in;
}
/*End code section*/"
                    output_terminals = "real enable;"
                    output_terminals_dimensions = "inherit"
                    output_terminals_feedthrough = "[\'\']"
                }
                [
                    position = 8336, 8280
                ]

                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 8232, 8288
                    hide_name = True
                    size = 32, 32
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8408, 8280
                ]

                connect "Bus Split1.in" fromPMS as Connection880
                connect "Rate Transition1.in" "Bus Split1.out4" as Connection873
                connect SM.enable Enable as Connection881
                connect SM.enable_in Enable_in as Connection879
                connect SM.force_off "Rate Transition1.out" as Connection878
                connect Termination1.in "Bus Split1.out" as Connection874
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect Termination4.in "Bus Split1.out3" as Connection877
            }
            [
                position = 7632, 7976
                size = 112, 96
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8464, 8368
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8464, 8464
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8464, 8560
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7488, 8008
            ]

            tag Goto2 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7776, 7976
                hide_name = True
            ]

            tag From1 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8024, 7968
                hide_name = True
            ]

            connect "Bus Join1.out" PV_Plant.Inputs as Connection21
            connect Connect.out "Bus Join1.in" as Connection7
            connect Enable.out interface.Enable_in as Connection876
            connect From1 "Bus Join1.in1" as Connection877
            connect Goto2 interface.Enable as Connection874
            connect Irradiation.out "Bus Join1.in2" as Connection9
            connect Out.in PV_Plant.Outputs as Connection22
            connect PV_Plant.A A as Connection25
            connect PV_Plant.B B as Connection24
            connect PV_Plant.C C as Connection23
            connect Q_mode.out "Bus Join1.in4" as Connection17
            connect Q_ref.out "Bus Join1.in5" as Connection16
            connect V_ref.out "Bus Join1.in3" as Connection15
            connect from_PMS interface.fromPMS as Connection875

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PV plant.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'pv_plant.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8264, 9216
            rotation = left
            size = 160, 160
        ]

        component Subsystem PCC_monitor {
            layout = dynamic
            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7600, 7968
                hide_name = True
            ]

            component gen_terminator Termination4 {
            }
            [
                position = 7840, 7992
                hide_name = True
            ]

            component gen_sr_ff "SR Flip Flop4" {
            }
            [
                position = 7752, 7976
                hide_name = True
            ]

            component gen_bus_join "Bus Join1" {
            }
            [
                position = 8720, 7864
                rotation = left
                hide_name = True
            ]

            component gen_probe S {
            }
            [
                position = 8784, 8048
            ]

            component gen_probe Q {
            }
            [
                position = 8784, 7984
            ]

            component gen_probe P {
            }
            [
                position = 8784, 7920
            ]

            component gen_probe pf {
            }
            [
                position = 8784, 8112
            ]

            component "core/Current Measurement" Ib {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8304
                size = 64, 32
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7504, 7968
                hide_name = True
                size = 32, 32
            ]

            component Subsystem Snubber {
                layout = dynamic
                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect A R21.p_node as Connection758
                connect B R20.p_node as Connection759
                connect G Junction1517 as Connection764
                connect Junction1516 Junction1517 as Connection762
                connect Junction1516 R21.n_node as Connection755
                connect Junction1517 R22.n_node as Connection763
                connect R20.n_node Junction1516 as Connection698
                connect R22.p_node C as Connection760
            }
            [
                position = 7776, 8512
                size = 88, 80
            ]

            component "core/Voltage Measurement" Va {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8768, 8448
                rotation = right
                size = 64, 32
            ]

            component Subsystem Snubber1 {
                layout = dynamic
                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect A R21.p_node as Connection758
                connect B R20.p_node as Connection759
                connect G Junction1517 as Connection764
                connect Junction1516 Junction1517 as Connection762
                connect Junction1516 R21.n_node as Connection755
                connect Junction1517 R22.n_node as Connection763
                connect R20.n_node Junction1516 as Connection698
                connect R22.p_node C as Connection760
            }
            [
                position = 8616, 8496
                size = 88, 80
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 8280, 8304
                size = 64, 256
            ]

            component "core/Current Measurement" Ia {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8208
                size = 64, 32
            ]

            component "core/Current Measurement" Ic {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8400
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vc {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8896, 8560
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8832, 8504
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" VB {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7992, 8520
                rotation = right
                size = 64, 32
            ]

            component Subsystem Synch_check {
                layout = dynamic
                component gen_logic_op "Logical operator2" {
                }
                [
                    position = 7736, 8720
                    hide_name = True
                ]

                component gen_digital_probe ABC_nom {
                }
                [
                    position = 7808, 8776
                    rotation = left
                    scale = -1, -1
                ]

                component gen_bus_join "Bus Join" {
                }
                [
                    position = 8400, 8504
                    rotation = right
                    hide_name = True
                ]

                component gen_logic_op and2 {
                    inputs = "4"
                }
                [
                    position = 7824, 8520
                    rotation = left
                    hide_name = True
                ]

                component gen_digital_probe Phase_match {
                }
                [
                    position = 7376, 8760
                    rotation = right
                ]

                component gen_logic_op not1 {
                    operator = "NOT"
                }
                [
                    position = 7736, 8656
                    hide_name = True
                ]

                component gen_logic_op not {
                    operator = "NOT"
                }
                [
                    position = 7736, 8576
                    hide_name = True
                ]

                component gen_probe dV {
                }
                [
                    position = 7312, 8056
                    rotation = left
                ]

                component gen_probe dw_f {
                }
                [
                    position = 7344, 8288
                    rotation = left
                ]

                component gen_digital_probe abc_dead {
                }
                [
                    position = 7360, 8232
                    rotation = right
                ]

                component gen_digital_probe V_match {
                }
                [
                    position = 7432, 8088
                    rotation = left
                ]

                component gen_digital_probe synch_check_ON {
                }
                [
                    position = 7904, 8392
                ]

                component gen_digital_probe VABC_nom {
                }
                [
                    position = 7424, 8256
                    rotation = left
                    scale = -1, -1
                ]

                component gen_probe dw_synch {
                }
                [
                    position = 7960, 8128
                    rotation = left
                ]

                component gen_digital_probe f_ABC_nom {
                }
                [
                    position = 7344, 8456
                    rotation = left
                    scale = -1, -1
                ]

                component gen_digital_probe Check_phase_ON {
                }
                [
                    position = 7296, 8520
                ]

                component gen_probe dw_phase {
                }
                [
                    position = 7384, 8560
                    rotation = left
                ]

                component gen_logic_op and1 {
                }
                [
                    position = 7168, 8520
                ]

                component gen_digital_probe f_match {
                }
                [
                    position = 7488, 8320
                    rotation = left
                ]

                component Subsystem check_f_diff {
                    layout = dynamic
                    component gen_probe f_diff {
                    }
                    [
                        position = 8248, 8088
                    ]

                    component gen_gain toPU {
                        gain = "[1.0/(2.0*f)]"
                    }
                    [
                        position = 8216, 8152
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8152
                    ]

                    component gen_z_domain_transfer LPF_dwf {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8128, 8152
                    ]

                    component gen_c_function interval_check {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if((in>=f*(1-fn_thresh/100.0)) && in<=f*(1+fn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                        parameters = "real fn_thresh;real f;"
                    }
                    [
                        position = 7952, 8416
                        size = 48, 48
                    ]

                    component gen_probe f_ABC_nom {
                    }
                    [
                        position = 8160, 8480
                        rotation = right
                    ]

                    component gen_gain Freq_diff {
                        gain = "delta_f/100.0"
                    }
                    [
                        position = 8208, 8304
                    ]

                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8280, 8256
                        hide_name = True
                        scale = 1, -1
                    ]

                    component src_constant Constant1 {
                        execution_rate = "Ts"
                        value = "f"
                    }
                    [
                        position = 8120, 8304
                        hide_name = True
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7856, 8416
                        hide_name = True
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8208, 8248
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8216
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Ki {
                            gain = "f_Ki"
                        }
                        [
                            position = 7968, 8216
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "f_lowLim"
                            upper_limit = "f_upLim"
                        }
                        [
                            position = 8408, 8216
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "[\'-inf\']"
                            limit_upper = "[\'inf\']"
                        }
                        [
                            position = 8216, 8224
                        ]

                        component gen_gain Kp {
                            gain = "f_Kp"
                        }
                        [
                            position = 7968, 8136
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8216
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8216
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8216
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8184
                        ]

                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 In as Connection58
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Ki.out Sum7.in as Connection55
                        connect Kp.in Junction4 as Connection57
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8304, 8152
                        size = 64, 48
                    ]

                    port dw_f {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8152
                    ]

                    port f_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8256
                    ]

                    port f_ABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7752, 8144
                    ]

                    port f_abc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7968, 8160
                    ]

                    port "f_ABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8248, 8416
                    ]

                    junction Junction1 sp
                    [
                        position = 8168, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 7808, 8144
                    ]

                    junction Junction13 sp
                    [
                        position = 8160, 8416
                    ]

                    connect Abs3.in Junction1 as Connection7
                    connect Abs4.in Junction12 as Connection278
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect Comparator1.out f_match as Connection59
                    connect Constant1.out Freq_diff.in as Connection14
                    connect Freq_diff.out Comparator1.in1 as Connection17
                    connect Junction1 LPF_dwf.out as Connection61
                    connect Junction12 f_ABC as Connection277
                    connect Junction13 f_ABC_nom.in as Connection282
                    connect LPF_dwf.in Sum1.out as Connection62
                    connect PI.Out dw_f as Connection64
                    connect Sum1.in Junction12 as Connection276
                    connect Sum1.in1 f_abc as Connection60
                    connect "f_ABC nom" Junction13 as Connection281
                    connect f_diff.in Junction1 as Connection56
                    connect interval_check.in Abs4.out as Connection280
                    connect interval_check.out Junction13 as Connection283
                    connect toPU.in Junction1 as Connection40
                    connect toPU.out PI.In as Connection63
                }
                [
                    position = 7216, 8368
                    size = 144, 120
                ]

                component Subsystem Contactor_Control {
                    layout = dynamic
                    component gen_terminator Termination12 {
                    }
                    [
                        position = 7760, 8392
                        rotation = right
                        hide_name = True
                    ]

                    component gen_digital_probe set_CB {
                    }
                    [
                        position = 7632, 8224
                        rotation = left
                    ]

                    component gen_logic_op "Logical operator1" {
                        inputs = "3"
                    }
                    [
                        position = 7448, 8488
                        rotation = left
                        hide_name = True
                    ]

                    component gen_sr_ff "SR Flip Flop1" {
                    }
                    [
                        position = 7712, 8336
                        hide_name = True
                    ]

                    component gen_digital_probe reset_CB {
                    }
                    [
                        position = 7640, 8432
                        rotation = right
                    ]

                    component gen_digital_probe CB_cmd {
                    }
                    [
                        position = 7760, 8280
                        rotation = left
                    ]

                    component gen_c_function CB_SM {
                        init_fnc = "/*Begin code section*/
close_CB = 0;
open_CB = 1;
/*End code section*/"
                        input_terminals = "inherit Close_cmd;inherit Open_cmd;inherit ABC_nom;inherit abc_dead;inherit Matched;"
                        input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                        input_terminals_feedthrough = "[\'\']"
                        input_terminals_show_labels = "False;False;False;False;False;"
                        output_fnc = "/*Begin code section*/
if((Open_cmd>0.0) || (!ABC_nom)){
    close_CB = 0;
    open_CB = 1;
}
else{
    if(Close_cmd>0.0){
        if((abc_dead) || (Matched)){
            close_CB = 1;
            open_CB = 0;
        }
        else{
            close_CB = 0;
        }
    }
    else{
        close_CB = 0;
    }
}
/*End code section*/"
                        output_terminals = "real close_CB;inherit open_CB;"
                        output_terminals_dimensions = "inherit;inherit"
                        output_terminals_feedthrough = "[\'\']"
                        output_terminals_show_labels = "False;False;"
                    }
                    [
                        position = 7576, 8336
                        size = 48, 96
                    ]

                    port phase_match {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8576
                    ]

                    port f_match {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8536
                    ]

                    port V_match {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8600
                    ]

                    port "Close Breaker" {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7488, 8224
                        rotation = right
                    ]

                    port "Open Breaker" {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7320, 8224
                        rotation = right
                    ]

                    port abc_dead {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8432
                        rotation = left
                    ]

                    port CB {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8320
                    ]

                    port ABC_nom {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8336
                    ]

                    junction Junction32 sp
                    [
                        position = 7760, 8320
                    ]

                    junction Junction33 sp
                    [
                        position = 7632, 8304
                    ]

                    junction Junction34 sp
                    [
                        position = 7640, 8368
                    ]

                    comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This state machine reads the</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">breaker commands and take</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">respective actions. It also</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">checks the grid (ABC) status</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">and force the breaker open</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if the grid is not in nominal </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">conditions.</p></body></html> ENDCOMMENT 
                    [
                        position = 7488, 8504
                    ]

                    connect ABC_nom CB_SM.ABC_nom as Connection594
                    connect CB_SM.close_CB Junction33 as Connection595
                    connect CB_SM.open_CB Junction34 as Connection598
                    connect CB_cmd.in Junction32 as Connection528
                    connect "Close Breaker" CB_SM.Close_cmd as Connection574
                    connect Junction32 CB as Connection529
                    connect Junction33 "SR Flip Flop1.s_in" as Connection596
                    connect Junction34 "SR Flip Flop1.r_in" as Connection599
                    connect "Logical operator1.out" CB_SM.Matched as Connection580
                    connect "Logical operator1.in2" V_match as Connection571
                    connect "Logical operator1.in" f_match as Connection569
                    connect "Open Breaker" CB_SM.Open_cmd as Connection591
                    connect "SR Flip Flop1.out" Junction32 as Connection530
                    connect Termination12.in "SR Flip Flop1.out_n" as Connection55
                    connect abc_dead CB_SM.abc_dead as Connection579
                    connect phase_match "Logical operator1.in1" as Connection570
                    connect reset_CB.in Junction34 as Connection600
                    connect set_CB.in Junction33 as Connection597
                }
                [
                    position = 8368, 8200
                    size = 168, 248
                ]

                component Subsystem Calculate_dw_synch {
                    layout = dynamic
                    component sys_signal_switch "Signal switch1" {
                        threshold = "0.5"
                    }
                    [
                        position = 8328, 8112
                        hide_name = True
                    ]

                    component gen_sum Sum4 {
                    }
                    [
                        position = 8096, 8096
                        hide_name = True
                    ]

                    component gen_z_domain_transfer LPF_dw {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8184, 8096
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8272, 8008
                        hide_name = True
                    ]

                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8256, 8128
                        hide_name = True
                    ]

                    port dw_f {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8040
                    ]

                    port dw_phase {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8104
                    ]

                    port dw_synch {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8112
                    ]

                    port Activate {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8200, 8008
                    ]

                    connect LPF_dw.out "Signal switch1.in" as Connection241
                    connect Sum4.out LPF_dw.in as Connection240
                    connect Sum4.in1 dw_phase as Connection231
                    connect "Unit Delay1.in" Activate as Connection180
                    connect "Unit Delay1.out" "Signal switch1.in2" as Connection181
                    connect dw_f Sum4.in as Connection239
                    connect dw_synch "Signal switch1.out" as Connection177
                    connect zero.out "Signal switch1.in1" as Connection179
                }
                [
                    position = 7864, 8176
                    size = 128, 208
                ]

                component Subsystem PLLs {
                    layout = dynamic
                    component gen_terminator Termination4 {
                    }
                    [
                        position = 8288, 8160
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 8248, 7776
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe wt_ABC {
                    }
                    [
                        position = 8592, 8016
                    ]

                    component gen_probe wt_abc {
                    }
                    [
                        position = 8592, 8152
                    ]

                    component gen_probe VABC {
                    }
                    [
                        position = 8328, 7888
                        rotation = left
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8592, 8088
                        hide_name = True
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 8256, 8112
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8280, 7824
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe Vabc {
                    }
                    [
                        position = 8336, 8224
                        rotation = left
                    ]

                    component Subsystem PLL1 {
                        layout = dynamic
                        component gen_c_function integrator {
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            output_terminals = "inherit out;"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                        }
                        [
                            position = 8352, 8136
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            connect "abc to alpha beta.A" A as Connection2685
                            connect "abc to alpha beta.B" B as Connection2686
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect "alpha beta to dq.wt" wt as Connection2690
                            connect d "alpha beta to dq.d" as Connection2692
                            connect q "alpha beta to dq.q" as Connection2693
                            connect z "abc to alpha beta.gamma" as Connection2691
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                input_terminals = "real d;inherit q;"
                                input_terminals_dimensions = "inherit;inherit"
                                input_terminals_feedthrough = "[u\'\']"
                                input_terminals_show_labels = "False;False;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                output_terminals = "real t;inherit q_pu;"
                                output_terminals_dimensions = "inherit;inherit"
                                output_terminals_feedthrough = "[u\'\']"
                                output_terminals_show_labels = "False;False;"
                            }
                            [
                                position = 8192, 8192
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            connect V_terminal.t Vt as Connection8
                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                            connect q_pu V_terminal.q_pu as Connection9
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Gain1.in Sum8.out as Connection61
                            connect In Junction6 as Connection74
                            connect Integrator2.in Junction8 as Connection86
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction7 Junction6 as Connection82
                            connect Junction8 Gain1.out as Connection87
                            connect Kb.in Sum6.out as Connection50
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Ki.in Junction7 as Connection81
                            connect Ki.out Sum7.in as Connection75
                            connect Kp.in Junction6 as Connection73
                            connect Kp.out Sum5.in as Connection69
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Sum5.out Junction2 as Connection44
                            connect Sum5.in1 Junction8 as Connection88
                            connect Sum6.in Junction2 as Connection46
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.A A as Connection277
                        connect ABC_dqz.B B as Connection276
                        connect ABC_dqz.C C as Connection275
                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect Gain1.in LPF_q1.out as Connection265
                        connect Junction14 Normalize.d as Connection253
                        connect Junction14 d as Connection262
                        connect Junction15 q as Connection261
                        connect Junction16 integrator.in as Connection269
                        connect Junction6 integrator.out as Connection195
                        connect LPF_d.out Junction14 as Connection254
                        connect LPF_q.out Junction15 as Connection257
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect PID.In Normalize.q_pu as Connection267
                        connect "Rate Limiter1.in" Junction16 as Connection268
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect f Gain1.out as Connection264
                        connect wt Junction6 as Connection196

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 8264
                        size = 88, 240
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component gen_c_function integrator {
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            output_terminals = "inherit out;"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                        }
                        [
                            position = 8352, 8136
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Gain1.in Sum8.out as Connection61
                            connect In Junction6 as Connection74
                            connect Integrator2.in Junction8 as Connection86
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction7 Junction6 as Connection82
                            connect Junction8 Gain1.out as Connection87
                            connect Kb.in Sum6.out as Connection50
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Ki.in Junction7 as Connection81
                            connect Ki.out Sum7.in as Connection75
                            connect Kp.in Junction6 as Connection73
                            connect Kp.out Sum5.in as Connection69
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Sum5.out Junction2 as Connection44
                            connect Sum5.in1 Junction8 as Connection88
                            connect Sum6.in Junction2 as Connection46
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                input_terminals = "real d;inherit q;"
                                input_terminals_dimensions = "inherit;inherit"
                                input_terminals_feedthrough = "[u\'\']"
                                input_terminals_show_labels = "False;False;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                output_terminals = "real t;inherit q_pu;"
                                output_terminals_dimensions = "inherit;inherit"
                                output_terminals_feedthrough = "[u\'\']"
                                output_terminals_show_labels = "False;False;"
                            }
                            [
                                position = 8192, 8192
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            connect V_terminal.t Vt as Connection8
                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                            connect q_pu V_terminal.q_pu as Connection9
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            connect "abc to alpha beta.A" A as Connection2685
                            connect "abc to alpha beta.B" B as Connection2686
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect "alpha beta to dq.wt" wt as Connection2690
                            connect d "alpha beta to dq.d" as Connection2692
                            connect q "alpha beta to dq.q" as Connection2693
                            connect z "abc to alpha beta.gamma" as Connection2691
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.A A as Connection277
                        connect ABC_dqz.B B as Connection276
                        connect ABC_dqz.C C as Connection275
                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect Gain1.in LPF_q1.out as Connection265
                        connect Junction14 Normalize.d as Connection253
                        connect Junction14 d as Connection262
                        connect Junction15 q as Connection261
                        connect Junction16 integrator.in as Connection269
                        connect Junction6 integrator.out as Connection195
                        connect LPF_d.out Junction14 as Connection254
                        connect LPF_q.out Junction15 as Connection257
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect PID.In Normalize.q_pu as Connection267
                        connect "Rate Limiter1.in" Junction16 as Connection268
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect f Gain1.out as Connection264
                        connect wt Junction6 as Connection196

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 7928
                        size = 88, 240
                    ]

                    port "Phase diff" {
                        position = right:5
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8744, 8088
                    ]

                    port f_ABC {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7976
                    ]

                    port V_ABC {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 7928
                    ]

                    port f_abc {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 8312
                    ]

                    port V_abc {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 8264
                    ]

                    port VA {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7832
                    ]

                    port VB {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7928
                    ]

                    port VC {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8024
                    ]

                    port Va {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8168
                    ]

                    port Vb {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8264
                    ]

                    port Vc {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8360
                    ]

                    tag From3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8096
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8288, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8408, 8080
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8296, 8360
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction14 sp
                    [
                        position = 8528, 8096
                    ]

                    junction Junction15 sp
                    [
                        position = 8528, 8080
                    ]

                    junction Junction19 sp
                    [
                        position = 8328, 7928
                    ]

                    junction Junction20 sp
                    [
                        position = 8336, 8264
                    ]

                    connect From2 Junction15 as Connection270
                    connect From3 Junction14 as Connection267
                    connect Goto2 PLL.wt as Connection752
                    connect Goto3 PLL1.wt as Connection760
                    connect Junction14 Sum1.in1 as Connection268
                    connect Junction15 Sum1.in as Connection271
                    connect Junction19 V_ABC as Connection749
                    connect Junction20 V_abc as Connection762
                    connect PLL.Vt Junction19 as Connection750
                    connect PLL.A VA as Connection767
                    connect PLL1.Vt Junction20 as Connection763
                    connect "Phase diff" Sum1.out as Connection336
                    connect Termination1.in PLL.d as Connection753
                    connect Termination2.in PLL.q as Connection754
                    connect Termination3.in PLL1.d as Connection756
                    connect Termination4.in PLL1.q as Connection757
                    connect VABC.in Junction19 as Connection748
                    connect VB PLL.B as Connection746
                    connect VC PLL.C as Connection747
                    connect Va PLL1.A as Connection764
                    connect Vabc.in Junction20 as Connection761
                    connect Vb PLL1.B as Connection766
                    connect Vc PLL1.C as Connection765
                    connect f_ABC PLL.f as Connection758
                    connect f_abc PLL1.f as Connection759
                    connect wt_ABC.in Junction15 as Connection272
                    connect wt_abc.in Junction14 as Connection269
                }
                [
                    position = 6744, 8328
                    size = 104, 368
                ]

                component Subsystem check_V_diff {
                    layout = dynamic
                    component gen_abs Abs5 {
                    }
                    [
                        position = 8008, 8344
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        threshold = "0.5"
                    }
                    [
                        position = 8432, 8160
                        hide_name = True
                    ]

                    component gen_gain Volt_diff {
                        gain = "delta_V/100.0"
                    }
                    [
                        position = 8264, 8256
                    ]

                    component gen_probe V_diff {
                    }
                    [
                        position = 8200, 8096
                    ]

                    component gen_c_function interval_check {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if((in>=(1-Vn_thresh/100.0)) && in<=(1+Vn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                        parameters = "real Vn_thresh;"
                    }
                    [
                        position = 7952, 8488
                        size = 48, 48
                    ]

                    component gen_c_function less_eq {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if(in<=0.001){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                    }
                    [
                        position = 8080, 8344
                        size = 48, 48
                    ]

                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8360, 8176
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8144, 8064
                        hide_name = True
                    ]

                    component src_constant one {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8200, 8256
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7872, 8488
                        hide_name = True
                    ]

                    component gen_probe Vabc_dead {
                    }
                    [
                        position = 8128, 8408
                        rotation = right
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8144
                        hide_name = True
                    ]

                    component gen_gain pu1 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7760, 8120
                        hide_name = True
                    ]

                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8336, 8224
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_probe VABC_nom {
                    }
                    [
                        position = 8184, 8552
                        rotation = right
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8264, 8216
                        hide_name = True
                    ]

                    component gen_gain pu2 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7944, 8152
                        hide_name = True
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "V_lowLim"
                            upper_limit = "V_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Ki {
                            gain = "V_Ki"
                        }
                        [
                            position = 7976, 8216
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "-1"
                            limit_upper = "1"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_gain Kp {
                            gain = "V_Kp"
                        }
                        [
                            position = 8024, 8168
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7888, 8168
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7944, 8168
                        ]

                        connect In Junction4 as Connection58
                        connect Integrator1.reset Reset as Connection2
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 Kp.in as Connection59
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection60
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.out Sum5.in as Connection55
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8272, 8144
                        size = 64, 48
                    ]

                    port dV {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8496, 8160
                    ]

                    port Activate {
                        position = top:auto
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8064, 8064
                    ]

                    port V_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8224
                    ]

                    port VABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7696, 8120
                    ]

                    port Vabc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8152
                    ]

                    port "Vabc dead" {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8264, 8344
                    ]

                    port "VABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8272, 8488
                    ]

                    junction Junction3 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction4 sp
                    [
                        position = 8272, 8064
                    ]

                    junction Junction5 sp
                    [
                        position = 7808, 8120
                    ]

                    junction Junction9 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction10 sp
                    [
                        position = 7976, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 8128, 8344
                    ]

                    junction Junction13 sp
                    [
                        position = 8184, 8488
                    ]

                    connect Abs4.in Junction5 as Connection227
                    connect Abs5.in Junction10 as Connection256
                    connect Abs5.out less_eq.in as Connection289
                    connect Activate "Unit Delay1.in" as Connection208
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect Junction10 pu2.out as Connection255
                    connect Junction12 Vabc_dead.in as Connection287
                    connect Junction13 "VABC nom" as Connection293
                    connect Junction3 Junction9 as Connection251
                    connect Junction4 "Unit Delay1.out" as Connection219
                    connect Junction5 pu1.out as Connection246
                    connect Junction9 Abs3.in as Connection252
                    connect PI.In Junction3 as Connection217
                    connect PI.Reset Junction4 as Connection220
                    connect PI.Out "Signal switch1.in" as Connection214
                    connect "Signal switch1.in2" Junction4 as Connection218
                    connect Sum1.in1 Junction10 as Connection254
                    connect Sum1.in Junction5 as Connection225
                    connect Sum1.out Junction9 as Connection253
                    connect VABC_nom.in Junction13 as Connection292
                    connect V_diff.in Junction3 as Connection215
                    connect V_match Comparator1.out as Connection187
                    connect "Vabc dead" Junction12 as Connection286
                    connect Volt_diff.out Comparator1.in1 as Connection17
                    connect dV "Signal switch1.out" as Connection181
                    connect interval_check.in Abs4.out as Connection291
                    connect interval_check.out Junction13 as Connection294
                    connect less_eq.out Junction12 as Connection288
                    connect one.out Volt_diff.in as Connection14
                    connect pu1.in VABC as Connection247
                    connect pu2.in Vabc as Connection249
                    connect zero.out "Signal switch1.in1" as Connection179
                }
                [
                    position = 7216, 8152
                    size = 144, 136
                ]

                component Subsystem check_phase_diff {
                    layout = dynamic
                    component gen_c_function confine_phase {
                        init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                        input_terminals = "real dtheta;"
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[u\'\']"
                        output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
}
/*End code section*/"
                        output_terminals = "real dtheta_confined;"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[u\'\']"
                    }
                    [
                        position = 7920, 7976
                    ]

                    component gen_gain Phase_diff {
                        gain = "delta_phi*np.pi/180.0"
                    }
                    [
                        position = 8088, 8216
                    ]

                    component gen_z_domain_transfer LPF {
                        a_coeff = "[1.0/(2*np.pi*0.5),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8032, 7976
                    ]

                    component gen_probe phase_diff {
                    }
                    [
                        position = 8040, 7904
                    ]

                    component gen_product Product1 {
                    }
                    [
                        position = 8384, 7968
                        hide_name = True
                    ]

                    component gen_probe phase_filter {
                    }
                    [
                        position = 8112, 8040
                    ]

                    component gen_abs Abs2 {
                    }
                    [
                        position = 8064, 8112
                        rotation = right
                    ]

                    component gen_gain to_pu {
                        gain = "1.0/(2*np.pi)"
                    }
                    [
                        position = 8128, 7976
                    ]

                    component src_constant One {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8000, 8216
                    ]

                    component gen_comparator Comparator2 {
                    }
                    [
                        position = 8160, 8168
                        hide_name = True
                        scale = 1, -1
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_integrator Integrator1 {
                            limit_lower = "phase_lowLim"
                            limit_upper = "phase_upLim"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_gain Ki {
                            gain = "phase_Ki"
                        }
                        [
                            position = 7952, 8216
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "phase_lowLim"
                            upper_limit = "phase_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        component gen_gain Kp {
                            gain = "phase_Kp"
                        }
                        [
                            position = 7952, 8144
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7856, 8184
                        ]

                        connect Integrator1.reset Reset as Connection2
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 In as Connection58
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.in Junction4 as Connection57
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8240, 7976
                        size = 64, 48
                    ]

                    component Subsystem Counter {
                        layout = dynamic
                        component src_constant Constant3 {
                            execution_rate = "Ts"
                            value = ".1/Ts"
                        }
                        [
                            position = 8256, 8144
                        ]

                        component gen_rel_op less_than {
                            relational_op = "<"
                        }
                        [
                            position = 8336, 8192
                        ]

                        component gen_logic_op not {
                            operator = "NOT"
                        }
                        [
                            position = 8104, 8248
                        ]

                        component "core/Counter" Counter1 {
                        }
                        [
                            position = 8192, 8200
                            size = 48, 48
                        ]

                        port In {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8192
                        ]

                        port Out {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8192
                        ]

                        junction Junction14 sp
                        [
                            position = 8056, 8192
                        ]

                        connect Constant3.out less_than.in as Connection66
                        connect Counter1.en Junction14 as Connection559
                        connect Junction14 In as Connection562
                        connect Junction14 not.in as Connection560
                        connect less_than.in1 Counter1.out as Connection450
                        connect less_than.out Out as Connection561
                        connect not.out Counter1.reset as Connection88
                    }
                    [
                        position = 8256, 8168
                        size = 48, 48
                    ]

                    port phase_Grid {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7832, 7976
                    ]

                    port phase_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8360, 8168
                    ]

                    port Activate {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8240, 7864
                        rotation = left
                        scale = 1, -1
                    ]

                    port dw_phase {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8504, 7968
                    ]

                    junction Junction15 sp
                    [
                        position = 8064, 7976
                    ]

                    junction Junction17 sp
                    [
                        position = 8064, 8040
                    ]

                    junction Junction21 sp
                    [
                        position = 8240, 7912
                    ]

                    junction Junction22 sp
                    [
                        position = 7992, 7976
                    ]

                    connect Abs2.in Junction17 as Connection590
                    connect Activate Junction21 as Connection622
                    connect Comparator2.in2 Abs2.out as Connection712
                    connect Comparator2.out Counter.In as Connection674
                    connect Junction15 LPF.out as Connection582
                    connect Junction17 Junction15 as Connection591
                    connect Junction21 PI.Reset as Connection693
                    connect Junction21 Product1.in as Connection623
                    connect Junction22 phase_diff.in as Connection719
                    connect LPF.in Junction22 as Connection718
                    connect One.out Phase_diff.in as Connection15
                    connect Phase_diff.out Comparator2.in1 as Connection49
                    connect Product1.in1 PI.Out as Connection692
                    connect confine_phase.dtheta_confined Junction22 as Connection720
                    connect confine_phase.dtheta phase_Grid as Connection721
                    connect dw_phase Product1.out as Connection714
                    connect phase_filter.in Junction17 as Connection592
                    connect phase_match Counter.Out as Connection673
                    connect to_pu.in Junction15 as Connection581
                    connect to_pu.out PI.In as Connection713
                }
                [
                    position = 7232, 8648
                    size = 168, 112
                ]

                port "Open Breaker" {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8688
                ]

                port "Close Breaker" {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8632
                ]

                port CB {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8552, 8200
                ]

                port VA {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8168
                ]

                port VB {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8232
                ]

                port VC {
                    position = top:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8296
                ]

                port Va {
                    position = top:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8360
                ]

                port Vb {
                    position = top:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8424
                ]

                port Vc {
                    position = top:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8488
                ]

                port synch_ref {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8560
                ]

                tag Goto43 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8488
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto31 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8456
                    hide_name = True
                    size = 0, 0
                ]

                tag From48 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8048
                    hide_name = True
                    size = 0, 0
                ]

                tag From60 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8104
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto38 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8688
                    hide_name = True
                    size = 0, 0
                ]

                tag From53 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8552
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto45 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag From61 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag From59 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8136
                    hide_name = True
                    size = 0, 0
                ]

                tag From57 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8656
                    hide_name = True
                    size = 0, 0
                ]

                tag From69 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8728
                    hide_name = True
                    size = 0, 0
                ]

                tag From67 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto48 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8680
                    hide_name = True
                    size = 0, 0
                ]

                tag From39 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8704
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto33 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8136
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto20 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8560, 8160
                    hide_name = True
                    size = 0, 0
                ]

                tag From56 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8616
                    hide_name = True
                    size = 0, 0
                ]

                tag From33 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8576
                    hide_name = True
                    size = 60, 20
                ]

                tag From63 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag From65 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8096
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto32 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7368, 8104
                    hide_name = True
                    size = 0, 0
                ]

                tag From47 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8176
                    hide_name = True
                    size = 0, 0
                ]

                tag From30 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8512
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto28 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8032, 8176
                    hide_name = True
                    size = 0, 0
                ]

                tag From68 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto36 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto44 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8168
                    hide_name = True
                    size = 0, 0
                ]

                tag From70 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8264
                    hide_name = True
                    size = 0, 0
                ]

                tag From37 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8168
                    hide_name = True
                    size = 0, 0
                ]

                tag From50 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8232
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto42 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag From42 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8320, 8424
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto41 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag From49 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8320, 8448
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto47 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8616
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto46 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto49 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7920, 8720
                    hide_name = True
                    size = 0, 0
                ]

                tag From58 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8104
                    hide_name = True
                    size = 0, 0
                ]

                tag From62 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag From64 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7080, 8648
                    hide_name = True
                    size = 0, 0
                ]

                tag From66 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8256
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto37 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8632
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto22 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7552, 8368
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto40 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8248
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto39 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8168
                    hide_name = True
                    size = 0, 0
                ]

                junction Junction32 sp
                [
                    position = 7960, 8176
                ]

                junction Junction35 sp
                [
                    position = 7488, 8368
                ]

                junction Junction39 sp
                [
                    position = 7824, 8456
                ]

                junction Junction46 sp
                [
                    position = 7232, 8520
                ]

                junction Junction47 sp
                [
                    position = 7312, 8104
                ]

                junction Junction48 sp
                [
                    position = 7432, 8136
                ]

                junction Junction49 sp
                [
                    position = 7344, 8328
                ]

                junction Junction50 sp
                [
                    position = 7384, 8616
                ]

                junction Junction51 sp
                [
                    position = 7376, 8680
                ]

                junction Junction52 sp
                [
                    position = 7848, 8720
                ]

                junction Junction53 sp
                [
                    position = 8496, 8200
                ]

                junction Junction54 sp
                [
                    position = 7360, 8168
                ]

                junction Junction55 sp
                [
                    position = 7424, 8200
                ]

                junction Junction56 sp
                [
                    position = 7344, 8408
                ]

                junction Junction57 sp
                [
                    position = 7808, 8720
                ]

                connect ABC_nom.in Junction57 as Connection715
                connect "Bus Join.in" From42 as Connection729
                connect "Bus Join.out" synch_ref as Connection728
                connect Check_phase_ON.in Junction46 as Connection622
                connect Contactor_Control.f_match From37 as Connection697
                connect "Contactor_Control.Open Breaker" From59 as Connection695
                connect Contactor_Control.CB Junction53 as Connection703
                connect From39 "Logical operator2.in" as Connection687
                connect From47 Calculate_dw_synch.Activate as Connection556
                connect From48 check_V_diff.Activate as Connection647
                connect From49 "Bus Join.in1" as Connection730
                connect From50 Contactor_Control.V_match as Connection699
                connect From53 and1.in1 as Connection585
                connect From56 and2.in1 as Connection639
                connect From57 not1.in as Connection640
                connect From58 "Contactor_Control.Close Breaker" as Connection694
                connect From60 check_V_diff.VABC as Connection663
                connect From61 check_V_diff.Vabc as Connection664
                connect From62 check_f_diff.f_abc as Connection671
                connect From63 check_f_diff.f_ABC as Connection670
                connect From64 check_phase_diff.phase_Grid as Connection674
                connect From65 Calculate_dw_synch.dw_f as Connection683
                connect From66 Calculate_dw_synch.dw_phase as Connection684
                connect From67 Contactor_Control.phase_match as Connection696
                connect From68 Contactor_Control.abc_dead as Connection698
                connect From70 Contactor_Control.ABC_nom as Connection700
                connect Goto20 Junction53 as Connection701
                connect Goto28 Junction32 as Connection250
                connect Goto31 Junction39 as Connection561
                connect Goto32 Junction47 as Connection650
                connect Goto33 Junction48 as Connection653
                connect Goto36 Junction55 as Connection707
                connect Goto37 "Close Breaker" as Connection637
                connect Goto38 "Open Breaker" as Connection638
                connect Goto39 PLLs.V_ABC as Connection658
                connect Goto40 PLLs.V_abc as Connection657
                connect Goto41 PLLs.f_ABC as Connection659
                connect Goto42 PLLs.f_abc as Connection660
                connect Goto43 "PLLs.Phase diff" as Connection661
                connect Goto44 Junction54 as Connection704
                connect Goto45 Junction49 as Connection668
                connect Goto46 Junction56 as Connection710
                connect Goto47 Junction50 as Connection676
                connect Goto48 Junction51 as Connection680
                connect Goto49 Junction52 as Connection692
                connect Junction32 Calculate_dw_synch.dw_synch as Connection249
                connect Junction35 Goto22 as Connection283
                connect Junction39 and2.out as Connection562
                connect Junction46 and1.out as Connection623
                connect Junction47 dV.in as Connection651
                connect Junction48 V_match.in as Connection654
                connect Junction49 dw_f.in as Connection667
                connect Junction50 check_phase_diff.dw_phase as Connection677
                connect Junction51 check_phase_diff.phase_match as Connection681
                connect Junction52 and2.in3 as Connection691
                connect Junction53 CB as Connection702
                connect Junction54 "check_V_diff.Vabc dead" as Connection705
                connect Junction55 "check_V_diff.VABC nom" as Connection708
                connect Junction56 "check_f_diff.f_ABC nom" as Connection711
                connect Junction57 Junction52 as Connection714
                connect "Logical operator2.in1" From69 as Connection688
                connect "Logical operator2.out" Junction57 as Connection713
                connect PLLs.VA VA as Connection727
                connect PLLs.VC VC as Connection725
                connect Phase_match.in Junction51 as Connection682
                connect VABC_nom.in Junction55 as Connection709
                connect VB PLLs.VB as Connection726
                connect Va PLLs.Va as Connection630
                connect Vb PLLs.Vb as Connection628
                connect Vc PLLs.Vc as Connection629
                connect abc_dead.in Junction54 as Connection706
                connect and1.in From30 as Connection273
                connect and2.in not.out as Connection552
                connect check_V_diff.dV Junction47 as Connection652
                connect check_V_diff.V_match Junction48 as Connection655
                connect check_f_diff.f_match Junction35 as Connection284
                connect check_f_diff.dw_f Junction49 as Connection666
                connect check_phase_diff.Activate Junction46 as Connection624
                connect dw_phase.in Junction50 as Connection678
                connect dw_synch.in Junction32 as Connection248
                connect f_ABC_nom.in Junction56 as Connection712
                connect f_match.in Junction35 as Connection282
                connect not.in From33 as Connection551
                connect not1.out and2.in2 as Connection634
                connect synch_check_ON.in Junction39 as Connection563

                Vn = "12470.0"
                f = "60.0"
                fn_thresh = "5"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "12470"
                        unit = "V (line to line)"
                        group = "General"
                    }

                    f {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    fn_thresh {
                        label = "Grid nominal frequency operation threshold"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    delta_f {
                        label = "Accepted frequency difference"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    f_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "Freq. Match"
                    }

                    f_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Freq. Match"
                    }

                    delta_phi {
                        label = "Accepted phase difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "°"
                        group = "Phase Synch"
                    }

                    phase_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Phase Synch"
                    }

                    phase_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.00012"
                        group = "Phase Synch"
                    }

                    phase_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Phase Synch"
                    }

                    phase_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-0.1"
                        group = "Phase Synch"
                    }

                    Vn_thresh {
                        label = "Grid nominal voltage operation threshold"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    delta_V {
                        label = "Accepted voltage difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    V_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.0071"
                        group = "Voltage Match"
                    }

                    V_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0354"
                        group = "Voltage Match"
                    }

                    V_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Voltage Match"
                    }

                    V_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Voltage Match"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8048, 8000
                rotation = down
                scale = -1, 1
                size = 296, 120
            ]

            component "core/Voltage Measurement" VC {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8056, 8576
                rotation = right
                size = 64, 32
            ]

            component Subsystem "PQ measure" {
                layout = dynamic
                component gen_PQ_transform "PQ Power Meter1" {
                }
                [
                    position = 8096, 8192
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8264, 8232
                    rotation = left
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8264, 8152
                    rotation = left
                    hide_name = True
                    scale = -1, 1
                ]

                port S {
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8208, 8264
                    rotation = right
                    scale = -1, 1
                ]

                port pf {
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8168, 8288
                    rotation = right
                    scale = -1, 1
                ]

                port Q {
                    position = left:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8208, 8120
                    rotation = left
                    scale = -1, 1
                ]

                port P {
                    position = left:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8168, 8088
                    rotation = left
                    scale = -1, 1
                ]

                port Va {
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8088
                    rotation = right
                    scale = -1, 1
                ]

                port Vb {
                    position = right:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7960, 8120
                    rotation = right
                    scale = -1, 1
                ]

                port Vc {
                    position = right:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7912, 8152
                    rotation = right
                    scale = -1, 1
                ]

                port Ia {
                    position = right:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7912, 8224
                    rotation = left
                    scale = -1, 1
                ]

                port Ib {
                    position = right:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7960, 8256
                    rotation = left
                    scale = -1, 1
                ]

                port Ic {
                    position = right:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8288
                    rotation = left
                    scale = -1, 1
                ]

                connect "PQ Power Meter1.ia" Ia as Connection1
                connect "PQ Power Meter1.ib" Ib as Connection2
                connect "PQ Power Meter1.ic" Ic as Connection3
                connect "PQ Power Meter1.Pdc" P as Connection4
                connect "PQ Power Meter1.Qdc" Q as Connection5
                connect S "PQ Power Meter1.apparent" as Connection9
                connect Termination1.in "PQ Power Meter1.Pac" as Connection10
                connect Termination2.in "PQ Power Meter1.Qac" as Connection11
                connect Va "PQ Power Meter1.va" as Connection13
                connect Vb "PQ Power Meter1.vb" as Connection14
                connect Vc "PQ Power Meter1.vc" as Connection15
                connect pf "PQ Power Meter1.k_factor" as Connection12
            }
            [
                position = 8608, 8016
                scale = -1, 1
                size = 72, 232
            ]

            component "core/Voltage Measurement" VA {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7928, 8464
                rotation = right
                size = 64, 32
            ]

            component gen_gain Gain1 {
                gain = "1/1000"
            }
            [
                position = 8864, 7960
                hide_name = True
            ]

            component gen_gain Gain2 {
                gain = "1/1000"
            }
            [
                position = 8864, 8016
                hide_name = True
            ]

            component gen_probe Pkw {
            }
            [
                position = 9000, 7960
            ]

            component gen_probe Qkw {
            }
            [
                position = 8984, 8016
            ]

            port Inputs {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7424, 7968
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 9032, 8208
                rotation = down
            ]

            port b {
                position = right:2
                kind = pe
            }
            [
                position = 9032, 8304
                rotation = down
            ]

            port c {
                position = right:3
                kind = pe
            }
            [
                position = 9032, 8400
                rotation = down
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7504, 8208
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7504, 8304
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7504, 8400
            ]

            port synch_ref {
                position = top:4
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 7960
            ]

            port power_meas {
                position = top:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8720, 7784
                rotation = left
            ]

            port CB_fb {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 8040
            ]

            tag Goto10 {
                value = "VB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8520
                hide_name = True
            ]

            tag Goto17 {
                value = "Ic"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8480, 8360
                hide_name = True
            ]

            tag From10 {
                value = "Ic"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 8096
                hide_name = True
                size = 0, 0
            ]

            tag Goto14 {
                value = "Va"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8448
                hide_name = True
            ]

            tag From6 {
                value = "VC"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8024, 8120
                rotation = left
                hide_name = True
            ]

            tag From15 {
                value = "Vc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 8000
                hide_name = True
                size = 0, 0
            ]

            tag From11 {
                value = "Ib"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 8064
                hide_name = True
                size = 0, 0
            ]

            tag Goto9 {
                value = "VA"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8464
                hide_name = True
            ]

            tag Goto12 {
                value = "Vb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8504
                hide_name = True
            ]

            tag From13 {
                value = "Ia"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 8032
                hide_name = True
                size = 0, 0
            ]

            tag From4 {
                value = "VA"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7928, 8120
                rotation = left
                hide_name = True
            ]

            tag Goto15 {
                value = "Ia"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8480, 8168
                hide_name = True
            ]

            tag From7 {
                value = "Va"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8072, 8120
                rotation = left
                hide_name = True
            ]

            tag From14 {
                value = "Vb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 7968
                hide_name = True
                size = 0, 0
            ]

            tag Goto11 {
                value = "VC"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8576
                hide_name = True
            ]

            tag From12 {
                value = "Va"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8504, 7936
                hide_name = True
                size = 0, 0
            ]

            tag From5 {
                value = "VB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7976, 8120
                rotation = left
                hide_name = True
            ]

            tag Goto16 {
                value = "Ib"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8480, 8264
                hide_name = True
            ]

            tag From9 {
                value = "Vc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8168, 8120
                rotation = left
                hide_name = True
            ]

            tag Goto13 {
                value = "Vc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8560
                hide_name = True
            ]

            tag From8 {
                value = "Vb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8120, 8120
                rotation = left
                hide_name = True
            ]

            junction Junction45 sp
            [
                position = 7704, 7992
            ]

            junction Junction49 pe
            [
                position = 7752, 8208
            ]

            junction Junction50 pe
            [
                position = 7776, 8304
            ]

            junction Junction51 pe
            [
                position = 7800, 8400
            ]

            junction Junction52 pe
            [
                position = 7928, 8208
            ]

            junction Junction53 pe
            [
                position = 7992, 8304
            ]

            junction Junction56 pe
            [
                position = 7928, 8640
            ]

            junction Junction57 pe
            [
                position = 8768, 8632
            ]

            junction Junction59 pe
            [
                position = 8592, 8208
            ]

            junction Junction60 pe
            [
                position = 8616, 8304
            ]

            junction Junction61 pe
            [
                position = 8640, 8400
            ]

            junction Junction62 pe
            [
                position = 8768, 8208
            ]

            junction Junction63 pe
            [
                position = 8832, 8304
            ]

            junction Junction65 pe
            [
                position = 7992, 8640
            ]

            junction Junction66 pe
            [
                position = 8056, 8400
            ]

            junction Junction67 pe
            [
                position = 8832, 8632
            ]

            junction Junction68 pe
            [
                position = 8896, 8400
            ]

            junction Junction69 sp
            [
                position = 8712, 7920
            ]

            junction Junction70 sp
            [
                position = 8728, 7984
            ]

            junction Junction71 sp
            [
                position = 8280, 8040
            ]

            junction Junction72 sp
            [
                position = 8744, 7920
            ]

            junction Junction73 sp
            [
                position = 8744, 7984
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs: <br />0 - Close Breaker command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - Open Breaker command</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - speed bias - sync check</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - voltage bias - sync check</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html> ENDCOMMENT 
            [
                position = 7640, 7704
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The PCC monitor is responsible for monitoring the status of the grid and microgrid. </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">It is also in charge of the microgrid synchronization process with the stiff grid.    </p></body></html> ENDCOMMENT 
            [
                position = 7920, 7752
            ]

            connect A Junction49 as Connection1029
            connect B Junction50 as Connection1032
            connect "Bus Join1.in" Junction69 as Connection1118
            connect "Bus Join1.out" power_meas as Connection1115
            connect C Junction51 as Connection1035
            connect CB_fb Junction71 as Connection1128
            connect From10 "PQ measure.Ic" as Connection719
            connect From11 "PQ measure.Ib" as Connection718
            connect From12 "PQ measure.Va" as Connection714
            connect From13 "PQ measure.Ia" as Connection717
            connect From14 "PQ measure.Vb" as Connection715
            connect From15 "PQ measure.Vc" as Connection716
            connect From4 Synch_check.VA as Connection871
            connect From5 Synch_check.VB as Connection872
            connect From6 Synch_check.VC as Connection873
            connect Goto10 VB.out as Connection813
            connect Goto11 VC.out as Connection814
            connect Goto12 Vb.out as Connection1066
            connect Goto13 Vc.out as Connection1060
            connect Goto14 Va.out as Connection1061
            connect Goto15 Ia.out as Connection1112
            connect Goto16 Ib.out as Connection1113
            connect Goto17 Ic.out as Connection1114
            connect Goto9 VA.out as Connection812
            connect Ia.n_node Junction59 as Connection1107
            connect Ib.n_node Junction60 as Connection1109
            connect Ic.p_node S1.c_out as Connection1111
            connect Inputs "Rate Transition1.in" as Connection1129
            connect Junction45 "Bus Split1.out1" as Connection1015
            connect Junction51 Junction66 as Connection1091
            connect Junction52 Junction49 as Connection1042
            connect Junction53 Junction50 as Connection1045
            connect Junction59 Junction62 as Connection1077
            connect Junction60 Junction63 as Connection1080
            connect Junction61 Ic.n_node as Connection1110
            connect Junction61 Junction68 as Connection1099
            connect Junction62 a as Connection1078
            connect Junction63 b as Connection1081
            connect Junction65 Junction56 as Connection1089
            connect Junction66 S1.c_in as Connection1092
            connect Junction67 Junction57 as Connection1097
            connect Junction68 c as Connection1100
            connect Junction69 "PQ measure.P" as Connection1119
            connect Junction70 "Bus Join1.in1" as Connection1122
            connect Junction71 S1.ctrl_in as Connection1127
            connect "PQ measure.Q" Junction70 as Connection1121
            connect "Rate Transition1.out" "Bus Split1.in" as Connection1130
            connect S.in "PQ measure.S" as Connection1124
            connect S1.a_out Ia.p_node as Connection1106
            connect S1.b_out Ib.p_node as Connection1108
            connect S1.a_in Junction52 as Connection1041
            connect S1.b_in Junction53 as Connection1044
            connect "SR Flip Flop4.s_in" "Bus Split1.out" as Connection1013
            connect "SR Flip Flop4.r_in" Junction45 as Connection1014
            connect "SR Flip Flop4.out" "Synch_check.Close Breaker" as Connection1011
            connect Snubber.A Junction49 as Connection1031
            connect Snubber.B Junction50 as Connection1034
            connect Snubber.C Junction51 as Connection1037
            connect Snubber.G Junction56 as Connection1105
            connect Snubber1.G Junction57 as Connection1064
            connect Snubber1.A Junction59 as Connection1070
            connect Snubber1.B Junction60 as Connection1073
            connect Snubber1.C Junction61 as Connection1076
            connect Synch_check.Va From7 as Connection875
            connect Synch_check.Vb From8 as Connection874
            connect Synch_check.Vc From9 as Connection876
            connect "Synch_check.Open Breaker" Junction45 as Connection1016
            connect Synch_check.CB Junction71 as Connection1126
            connect Synch_check.synch_ref synch_ref as Connection880
            connect Termination4.in "SR Flip Flop4.out_n" as Connection1010
            connect VA.p_node Junction52 as Connection1043
            connect VA.n_node Junction56 as Connection1054
            connect VB.p_node Junction53 as Connection1046
            connect VB.n_node Junction65 as Connection1088
            connect VC.n_node Junction65 as Connection1090
            connect VC.p_node Junction66 as Connection1093
            connect Va.n_node Junction57 as Connection1063
            connect Va.p_node Junction62 as Connection1079
            connect Vb.p_node Junction63 as Connection1082
            connect Vb.n_node Junction67 as Connection1096
            connect Vc.n_node Junction67 as Connection1098
            connect Vc.p_node Junction68 as Connection1101
            connect pf.in "PQ measure.pf" as Connection1125
            connect P.in Junction72 as Connection1131
            connect Junction72 Junction69 as Connection1132
            connect Gain1.in Junction72 as Connection1133
            connect Q.in Junction73 as Connection1134
            connect Junction73 Junction70 as Connection1135
            connect Gain2.in Junction73 as Connection1136
            connect Pkw.in Gain1.out as Connection1137
            connect Qkw.in Gain2.out as Connection1138

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PCC monitor block</p></body></html>"

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts"
                    unit = "s"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8400, 8656
            rotation = left
            scale = 1, -1
            size = 144, 160
        ]

        component Subsystem ESS {
            layout = dynamic
            component src_scada_input On {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8056, 7984
            ]

            component gen_probe Out {
            }
            [
                position = 8376, 8176
                rotation = left
            ]

            component src_scada_input Pref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 7344, 8104
            ]

            component src_scada_input f_ref {
                def_value = "60.0"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7344, 8040
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "6"
            }
            [
                position = 8152, 8240
                rotation = right
                hide_name = True
            ]

            component src_scada_input Vref {
                def_value = "480"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7344, 7976
            ]

            component src_scada_input Qref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 7344, 8168
            ]

            component Subsystem split {
                layout = dynamic
                component gen_terminator T4 {
                }
                [
                    position = 8504, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T8 {
                }
                [
                    position = 8424, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T5 {
                }
                [
                    position = 8552, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T9 {
                }
                [
                    position = 8464, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 8264, 8040
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T10 {
                }
                [
                    position = 8504, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T6 {
                }
                [
                    position = 8336, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T11 {
                }
                [
                    position = 8264, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T2 {
                }
                [
                    position = 8456, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T3 {
                }
                [
                    position = 8408, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "14"
                }
                [
                    position = 8192, 8192
                    hide_name = True
                ]

                component gen_terminator T1 {
                }
                [
                    position = 8360, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T7 {
                }
                [
                    position = 8384, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T {
                }
                [
                    position = 8312, 8352
                    rotation = right
                    hide_name = True
                ]

                port ON {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8264, 7968
                    rotation = left
                ]

                port In {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8120, 8192
                ]

                connect "Bus Split1.in" In as Connection1
                connect "Bus Split1.out1" "Logical operator1.in1" as Connection11
                connect "Bus Split1.out5" T9.in as Connection16
                connect "Logical operator1.in" "Bus Split1.out" as Connection10
                connect ON "Logical operator1.out" as Connection12
                connect T.in "Bus Split1.out12" as Connection4
                connect T1.in "Bus Split1.out11" as Connection5
                connect T10.in "Bus Split1.out6" as Connection17
                connect T11.in "Bus Split1.out13" as Connection18
                connect T2.in "Bus Split1.out9" as Connection7
                connect T3.in "Bus Split1.out10" as Connection6
                connect T4.in "Bus Split1.out8" as Connection8
                connect T5.in "Bus Split1.out7" as Connection9
                connect T6.in "Bus Split1.out2" as Connection13
                connect T7.in "Bus Split1.out3" as Connection14
                connect T8.in "Bus Split1.out4" as Connection15
            }
            [
                position = 8456, 8232
                size = 48, 48
            ]

            component "core/Battery" "Battery 1" {
                Kdisc_I = "20.0"
                Ke_exp = "103.0"
                Ke_full = "116.0"
                Kq_exp = "85.0"
                Kq_nom = "93.5"
                R_series = "0.025000000000000022"
                battery_type = "Lithium-Ion"
                capacity = "1e6/1000.0"
                initial_soc = "80.0"
                nominal_voltage = "1000.0"
            }
            [
                position = 8040, 8416
                rotation = right
                size = 64, 48
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_probe w {
                }
                [
                    position = 8400, 8104
                    rotation = left
                ]

                component gen_c_function SM {
                    input_terminals = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;"
                    input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    input_terminals_feedthrough = "[\'\']"
                    input_terminals_show_labels = "False;False;False;False;False;False;False;False;False;False;"
                    output_fnc = "/*Begin code section*/
if(DERoption == 0){
    if(formGrid > 0){
        gridForm = 0;
        V = Vref + dV;
        w = wref + dw;
        P = 0;
        Q = 0;
    }
    else{
        gridForm = 1;
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    gridForm = 1;
    V = Vref;
    w = wref;
    P = Pref + Ppms;
    Q = Qref + Qpms;
}
/*End code section*/"
                    output_terminals = "inherit gridForm;inherit V;inherit w;inherit P;inherit Q;"
                    output_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    output_terminals_feedthrough = "[\'\']"
                    output_terminals_show_labels = "False;False;False;False;False;"
                }
                [
                    position = 8256, 8232
                    size = 48, 176
                ]

                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7928, 8328
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 7992, 8040
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain5 {
                    gain = "Vb"
                }
                [
                    position = 8008, 8280
                    rotation = left
                    hide_name = True
                ]

                component gen_probe Q_ref {
                }
                [
                    position = 8480, 8408
                    rotation = right
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 7904, 8104
                    rotation = down
                    hide_name = True
                ]

                component gen_gain Gain4 {
                    gain = "fb"
                }
                [
                    position = 7968, 8256
                    rotation = left
                    hide_name = True
                ]

                component gen_probe P_ref {
                }
                [
                    position = 8480, 8208
                    rotation = left
                ]

                component gen_probe V {
                }
                [
                    position = 8368, 8008
                    rotation = left
                ]

                component gen_probe gridForm {
                }
                [
                    position = 8320, 7912
                    rotation = left
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 7920, 7984
                    hide_name = True
                    size = 32, 32
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7856, 7984
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7848, 8328
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8264
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8176, 8400
                    rotation = left
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8200, 8368
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8048
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8112, 8464
                    rotation = left
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8432
                    rotation = left
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 7960
                ]

                port Q {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8344
                ]

                port f_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8152
                ]

                junction Junction7 sp
                [
                    position = 8320, 7960
                ]

                junction Junction11 sp
                [
                    position = 8368, 8048
                ]

                junction Junction12 sp
                [
                    position = 8400, 8152
                ]

                junction Junction13 sp
                [
                    position = 8480, 8264
                ]

                junction Junction14 sp
                [
                    position = 8480, 8344
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8600, 8136
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8160, 8024
                ]

                connect "Bus Split1.out" SM.DERoption as Connection993
                connect "Bus Split1.out2" SM.Ppms as Connection995
                connect "Bus Split2.out1" Gain5.in as Connection982
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain4.in "Bus Split2.out" as Connection981
                connect Gain5.out SM.dV as Connection983
                connect Junction11 SM.V as Connection975
                connect Junction12 w.in as Connection978
                connect Junction13 P as Connection987
                connect Junction14 Q_ref.in as Connection990
                connect Junction7 SM.gridForm as Connection944
                connect P_ref.in Junction13 as Connection986
                connect Q Junction14 as Connection989
                connect Qref SM.Qref as Connection953
                connect "Rate Transition1.out" "Bus Split1.in" as Connection992
                connect "Rate Transition1.in" fromPMS as Connection893
                connect SM.Qpms "Bus Split1.out3" as Connection996
                connect SM.formGrid "Bus Split1.out1" as Connection994
                connect SM.dw Gain4.out as Connection980
                connect SM.w Junction12 as Connection977
                connect SM.P Junction13 as Connection988
                connect SM.Q Junction14 as Connection991
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect SM.wref wref as Connection956
                connect Termination1.in "Bus Split1.out4" as Connection997
                connect V.in Junction11 as Connection974
                connect V_ref Junction11 as Connection976
                connect f_ref Junction12 as Connection979
                connect gridForm.in Junction7 as Connection943
                connect opMode Junction7 as Connection945

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS and Battery inverter</p></body></html>"

                    Vb {
                        label = "Battery inverter nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "General"
                    }

                    fb {
                        label = "Battery inverter nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7504, 8008
                size = 128, 368
            ]

            component "core/Battery inverter" "Battery inverter" {
                Ts = "Ts"
            }
            [
                position = 8264, 8416
                size = 288, 239
            ]

            port A {
                position = right:1
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8320
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8416
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8512
                rotation = down
            ]

            port from_PCC {
                position = top:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7344, 7912
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7344, 7848
            ]

            port toPCC {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8576, 8232
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8088
                hide_name = True
            ]

            tag From2 {
                value = "Qref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8168
                hide_name = True
            ]

            tag From4 {
                value = "fref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8072
                hide_name = True
            ]

            tag From3 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8136
                hide_name = True
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8104
                hide_name = True
            ]

            tag From1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8040
                hide_name = True
            ]

            tag Goto5 {
                value = "Qref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8168
                hide_name = True
            ]

            tag Goto1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 7848
                hide_name = True
            ]

            tag Goto3 {
                value = "fref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8008
                hide_name = True
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 7928
                hide_name = True
            ]

            junction Junction1 sp
            [
                position = 8376, 8232
            ]

            connect "Battery 1.n_node" "Battery inverter.DCneg" as Connection153
            connect "Battery 1.p_node" "Battery inverter.DCpos" as Connection152
            connect "Battery inverter.A" A as Connection156
            connect "Battery inverter.B" B as Connection158
            connect "Battery inverter.C" C as Connection157
            connect "Bus Join2.out" "Battery inverter.Inputs" as Connection154
            connect "Bus Join2.in4" From3 as Connection173
            connect "Bus Join2.in2" From4 as Connection171
            connect From1 "Bus Join2.in1" as Connection170
            connect From2 "Bus Join2.in5" as Connection174
            connect From5 "Bus Join2.in3" as Connection172
            connect Goto1 Interface.opMode as Connection161
            connect Goto2 Interface.V_ref as Connection162
            connect Goto3 Interface.f_ref as Connection163
            connect Goto4 Interface.P as Connection164
            connect Goto5 Interface.Q as Connection165
            connect Interface.fromPCC from_PCC as Connection160
            connect Junction1 "Battery inverter.Outputs" as Connection176
            connect Junction1 split.In as Connection177
            connect On.out "Bus Join2.in" as Connection1
            connect Out.in Junction1 as Connection175
            connect Pref.out Interface.Pref as Connection168
            connect Qref.out Interface.Qref as Connection169
            connect Vref.out Interface.Vref as Connection166
            connect f_ref.out Interface.wref as Connection167
            connect from_PMS Interface.fromPMS as Connection159
            connect toPCC split.ON as Connection178

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Energy Storage System (ESS) inverter.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'images/Battery.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7584, 9216
            rotation = left
            size = 160, 160
        ]

        component Subsystem Microgrid_controller {
            layout = dynamic
            component gen_digital_probe cMode {
            }
            [
                position = 7120, 8128
                rotation = left
            ]

            component gen_bus_join "Bus Join1" {
            }
            [
                position = 7984, 8240
                hide_name = True
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "5"
            }
            [
                position = 7952, 8400
                hide_name = True
            ]

            component gen_digital_probe opMode {
            }
            [
                position = 7120, 8032
                rotation = left
            ]

            component gen_probe Qoff {
            }
            [
                position = 7984, 8840
                rotation = left
            ]

            component gen_logic_op "Logical operator1" {
                operator = "OR"
            }
            [
                position = 7352, 9016
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8624
                hide_name = True
            ]

            component gen_gain Gain2 {
                gain = "Sb"
            }
            [
                position = 7784, 8624
                hide_name = True
            ]

            component sys_signal_switch "Signal switch1" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7504, 8624
                hide_name = True
            ]

            component gen_digital_probe zeroed {
            }
            [
                position = 7392, 8160
                rotation = down
            ]

            component src_constant Constant4 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7424, 8896
                hide_name = True
            ]

            component sys_signal_switch "Signal switch4" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7880, 8896
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7136, 8552
                rotation = right
                hide_name = True
            ]

            component gen_c_function SM2 {
                input_terminals = "real dg_on;inherit batt_on;inherit CB;inherit der_opt_in;"
                input_terminals_dimensions = "inherit;inherit;inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'dg_on\', True), (\'batt_on\', True), (\'CB\', True), (\'der_opt_in\', True)]"
                output_fnc = "/*Begin code section*/
if(dg_on && batt_on){
    der_opt = der_opt_in;
    force_off = 0;
}
else if(dg_on && !batt_on){
    der_opt = 1;
    force_off = 0;
}
else if (!dg_on && batt_on){
    der_opt = 0;
    force_off = 0;
}
else if(!CB){
    der_opt = der_opt_in;
    force_off = 1;
}
else{
    der_opt = der_opt_in;
    force_off = 0;
}
/*End code section*/"
                output_terminals = "real der_opt;inherit force_off;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'der_opt\', True), (\'force_off\', True)]"
            }
            [
                position = 7592, 8408
                size = 128, 80
            ]

            component gen_gain Gain3 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8880
                hide_name = True
            ]

            component src_constant Constant2 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8680
                hide_name = True
            ]

            component gen_gain Gain4 {
                gain = "Sb"
            }
            [
                position = 7784, 8880
                hide_name = True
            ]

            component sys_signal_switch "Signal switch2" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7880, 8640
                hide_name = True
            ]

            component sys_signal_switch "Signal switch3" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7504, 8880
                hide_name = True
            ]

            component gen_c_function SM {
                init_fnc = "/*Begin code section*/
open_cb = 1;
close_cb = 0;
/*End code section*/"
                input_terminals = "real CB;inherit operation;inherit zeroed;inherit ON;"
                input_terminals_dimensions = "inherit;inherit;inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "False;False;False;False;"
                output_fnc = "/*Begin code section*/
if(CB == 0){
    gridform = 1;
    zeropower = 0;
    if(operation == 0){
        close_cb = 1;
        open_cb = 0;
    }
}
else{
    gridform = 0;
    zeropower = 0;
    if(operation != 0){
        gridform = 0;
        if(ON){
            zeropower = 1;
        }
        else{
            zeropower = 0;
        }
        if(zeroed){
            close_cb = 0;
            open_cb = 1;
            zeropower = 0;
        }
    }
}
/*End code section*/"
                output_terminals = "real gridform;inherit zeropower;inherit close_cb;inherit open_cb;"
                output_terminals_dimensions = "inherit;inherit;inherit;inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "False;False;False;False;"
            }
            [
                position = 7584, 8136
                size = 128, 80
            ]

            component gen_probe Poff {
            }
            [
                position = 7984, 8576
                rotation = left
            ]

            component gen_c_function is_zero {
                input_terminals = "real P;inherit Q;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "False;False;"
                output_fnc = "/*Begin code section*/
if((fabs(P)<=p_lim) && (fabs(Q)<=q_lim)){
    zeroed = 1;
}
else{
    zeroed = 0;
}
/*End code section*/"
                output_terminals = "real zeroed;"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "[\'\']"
                parameters = "real p_lim;real q_lim;"
            }
            [
                position = 7256, 8736
                size = 48, 48
            ]

            component src_constant Constant3 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8936
                hide_name = True
            ]

            component src_constant Constant1 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7424, 8640
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7072, 8512
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts"
            }
            [
                position = 7072, 8440
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition4" {
                execution_rate = "Ts"
            }
            [
                position = 7216, 9072
                hide_name = True
                size = 32, 32
            ]

            component Subsystem PI_Q {
                layout = dynamic
                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8408
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8296
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8288
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7856, 8088
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8408
                    scale = -1, 1
                ]

                component sys_signal_switch "Signal switch2" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 7976, 8272
                    hide_name = True
                    scale = 1, -1
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8288
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8216
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7856, 8024
                ]

                component sys_signal_switch "Signal switch1" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 8048, 8040
                    hide_name = True
                ]

                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8280
                    hide_name = True
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8288
                    hide_name = True
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8168
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8288
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8304
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8000, 7904
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8336
                    hide_name = True
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8136, 7952
                    hide_name = True
                ]

                junction Junction2 sp
                [
                    position = 8368, 8288
                ]

                junction Junction3 sp
                [
                    position = 8440, 8288
                ]

                junction Junction4 sp
                [
                    position = 7728, 8168
                ]

                junction Junction5 sp
                [
                    position = 7728, 8088
                ]

                junction Junction6 sp
                [
                    position = 7728, 8216
                ]

                junction Junction11 sp
                [
                    position = 8048, 7952
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction5 Junction4 as Connection70
                connect Junction5 Kp2.in as Connection107
                [
                    breakpoints = 7728, 8088; 7728, 8024
                ]
                connect Junction6 Junction4 as Connection76
                connect Junction6 Ki2.in as Connection110
                [
                    breakpoints = 7728, 8216; 7728, 8288
                ]
                connect Kb.in Sum6.out as Connection50
                connect Ki1.in Junction6 as Connection75
                connect Ki1.out "Signal switch2.in1" as Connection112
                connect Ki2.out "Signal switch2.in" as Connection111
                connect Kp1.in Junction5 as Connection69
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7688, 8880
                size = 64, 112
            ]

            component "core/Rate Transition" "Rate Transition3" {
                execution_rate = "Ts"
            }
            [
                position = 7216, 8960
                hide_name = True
                size = 32, 32
            ]

            component Subsystem PI_P {
                layout = dynamic
                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8376
                    hide_name = True
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7880, 8256
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8384
                    hide_name = True
                ]

                component sys_signal_switch "Signal switch2" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 7976, 8368
                    hide_name = True
                    scale = 1, -1
                ]

                component sys_signal_switch "Signal switch1" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 8064, 8208
                    hide_name = True
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8384
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8504
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8392
                ]

                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8504
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7880, 8192
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8384
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8328
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8280
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8384
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8400
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8096
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8432
                    hide_name = True
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 8144
                    hide_name = True
                ]

                junction Junction2 sp
                [
                    position = 8368, 8384
                ]

                junction Junction3 sp
                [
                    position = 8440, 8384
                ]

                junction Junction4 sp
                [
                    position = 7728, 8280
                ]

                junction Junction11 sp
                [
                    position = 8064, 8144
                ]

                junction Junction12 sp
                [
                    position = 7728, 8256
                ]

                junction Junction13 sp
                [
                    position = 7728, 8328
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction12 Kp2.in as Connection112
                [
                    breakpoints = 7728, 8192
                ]
                connect Junction13 Ki1.in as Connection116
                [
                    breakpoints = 7728, 8328
                ]
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction4 Junction12 as Connection111
                connect Junction4 Junction13 as Connection115
                connect Kb.in Sum6.out as Connection50
                connect Ki1.out "Signal switch2.in1" as Connection106
                connect Ki2.in Junction13 as Connection117
                connect Ki2.out "Signal switch2.in" as Connection105
                connect Kp1.in Junction12 as Connection113
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7704, 8624
                size = 64, 112
            ]

            component gen_c_function "C function1" {
                input_terminals = "real control_op;inherit dg;inherit bi;"
                input_terminals_dimensions = "inherit;inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'control_op\', True), (\'dg\', True), (\'bi\', True)]"
                output_fnc = "/*Begin code section*/
//this C function is protective function of islanding mode when DER is not active
bloc_island = 0;
if (dg ==1 && control_op == 1) ctrl_mode = control_op;
else if (bi == 1 && control_op == 0) ctrl_mode = control_op;
else if (bi == 0 && dg == 1) ctrl_mode = 1;
else if (bi == 1 && dg == 0) ctrl_mode = 0;
else 
    bloc_island = 1;
/*End code section*/"
                output_terminals = "real ctrl_mode;int bloc_island;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'ctrl_mode\', True), (\'bloc_island\', True)]"
            }
            [
                position = 7008, 8176
                hide_name = True
                size = 104, 80
            ]

            component gen_c_function "Protection of isolation" {
                input_terminals = "real op;inherit blck_m;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'op\', True), (\'blck_m\', True)]"
                output_fnc = "/*Begin code section*/
//thic C function is used to block islandig mode in case when DER is not active
if (blck_m == 1)
    out = 0;
else 
    out = op;
/*End code section*/"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'out\', True)]"
            }
            [
                position = 6984, 8080
                hide_name = True
                size = 48, 48
            ]

            port control_option {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6728, 8152
            ]

            port operation_mode {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6848, 8016
            ]

            port PCC_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8104, 8240
            ]

            port DER_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8128, 8400
            ]

            port power_meas {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7000, 8512
            ]

            port CB_status {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7000, 8440
            ]

            port fromESS {
                position = left:5
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7112, 8960
            ]

            port fromDG {
                position = left:6
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7112, 9072
            ]

            tag From20 {
                value = "c_option"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8496
                rotation = left
                hide_name = True
            ]

            tag From24 {
                value = "force_off"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7888, 8488
                rotation = left
                hide_name = True
            ]

            tag From15 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7856, 8488
                rotation = left
                hide_name = True
            ]

            tag Goto15 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7320, 9072
                hide_name = True
            ]

            tag Goto14 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7320, 8960
                hide_name = True
            ]

            tag Goto4 {
                value = "CB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7168, 8440
                hide_name = True
            ]

            tag From9 {
                value = "isZero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8224
                rotation = left
                hide_name = True
            ]

            tag Goto5 {
                value = "operation"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7200, 8080
                hide_name = True
            ]

            tag From10 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7872, 8208
                hide_name = True
            ]

            tag From23 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8296
                rotation = right
                hide_name = True
            ]

            tag From14 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7824, 8488
                rotation = left
                hide_name = True
            ]

            tag From19 {
                value = "ON"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8224
                rotation = left
                hide_name = True
            ]

            tag Goto8 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8640
                hide_name = True
            ]

            tag From22 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8296
                rotation = right
                hide_name = True
            ]

            tag From7 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8040
                rotation = right
                hide_name = True
            ]

            tag Goto2 {
                value = "activate"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7736, 8040
                rotation = left
                hide_name = True
            ]

            tag From2 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8568
                hide_name = True
            ]

            tag From8 {
                value = "operation"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8040
                rotation = right
                hide_name = True
            ]

            tag Goto9 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8896
                hide_name = True
            ]

            tag From4 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8824
                hide_name = True
            ]

            tag Goto13 {
                value = "ON"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 9016
                hide_name = True
            ]

            tag From12 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7888, 8312
                rotation = right
                hide_name = True
            ]

            tag From5 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7448, 8824
                hide_name = True
            ]

            tag From17 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8504
                hide_name = True
            ]

            tag From6 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7456, 8568
                hide_name = True
            ]

            tag Goto16 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7744, 8392
                hide_name = True
            ]

            tag Goto12 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7688, 8224
                rotation = right
                hide_name = True
            ]

            tag From16 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8792
                hide_name = True
            ]

            tag From11 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7872, 8248
                hide_name = True
            ]

            tag Goto7 {
                value = "isZero"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7344, 8736
                hide_name = True
            ]

            tag From18 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8760
                hide_name = True
            ]

            tag Goto11 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7736, 8224
                rotation = right
                hide_name = True
            ]

            tag Goto6 {
                value = "c_option"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7208, 8160
                hide_name = True
            ]

            tag From13 {
                value = "gridform"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7856, 8312
                rotation = right
                hide_name = True
            ]

            tag Goto17 {
                value = "force_off"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7744, 8424
                hide_name = True
            ]

            tag From1 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8536
                hide_name = True
            ]

            tag From21 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8496
                rotation = left
                hide_name = True
            ]

            tag Goto10 {
                value = "gridform"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7688, 8040
                rotation = left
                hide_name = True
            ]

            tag From25 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6872, 8176
                hide_name = True
            ]

            tag From26 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6872, 8200
                hide_name = True
            ]

            tag Goto18 {
                value = "block_mode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7136, 8192
                hide_name = True
            ]

            tag From27 {
                value = "block_mode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6808, 8088
                hide_name = True
            ]

            junction Junction1 sp
            [
                position = 7200, 8608
            ]

            junction Junction2 sp
            [
                position = 7200, 8864
            ]

            junction Junction3 sp
            [
                position = 7984, 8640
            ]

            junction Junction4 sp
            [
                position = 7984, 8896
            ]

            junction Junction8 sp
            [
                position = 7440, 8160
            ]

            junction Junction9 sp
            [
                position = 7248, 8960
            ]

            junction Junction10 sp
            [
                position = 7248, 9072
            ]

            junction Junction11 sp
            [
                position = 7120, 8160
            ]

            junction Junction12 sp
            [
                position = 7120, 8080
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off</p></body></html> ENDCOMMENT 
            [
                position = 8056, 8456
            ]

            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">operation_mode:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    grid tie</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    island</p></body></html> ENDCOMMENT 
            [
                position = 6680, 7920
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">control_option:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    battery inverter forms the grid</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    diesel genset forms the grid</p></body></html> ENDCOMMENT 
            [
                position = 6664, 8232
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PCC_control</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - close command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - open command</p></body></html> ENDCOMMENT 
            [
                position = 8032, 8136
            ]

            comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">power_meas:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - active power</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - reactive power</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html> ENDCOMMENT 
            [
                position = 6952, 8576
            ]

            comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The microgrid controller is responsible for managing the monitoring of the microgrid. </p></body></html> ENDCOMMENT 
            [
                position = 6976, 7864
            ]

            connect "Bus Join1.out" PCC_control as Connection65
            connect "Bus Split1.out" Junction1 as Connection36
            connect "Bus Split1.out1" Junction2 as Connection39
            connect "Bus Split1.in" "Rate Transition1.out" as Connection15
            connect Constant1.out "Signal switch1.in1" as Connection10
            connect Constant2.out "Signal switch2.in1" as Connection13
            connect Constant3.out "Signal switch4.in1" as Connection21
            connect Constant4.out "Signal switch3.in1" as Connection22
            connect DER_control "Bus Join2.out" as Connection70
            connect From10 "Bus Join1.in" as Connection63
            connect From11 "Bus Join1.in1" as Connection64
            connect From12 "Bus Join2.in" as Connection66
            connect From13 "Bus Join2.in1" as Connection67
            connect From14 "Bus Join2.in2" as Connection68
            connect From15 "Bus Join2.in3" as Connection69
            connect From16 PI_Q.reset as Connection83
            connect From17 PI_P.changeK as Connection89
            connect From18 PI_Q.changeK as Connection90
            connect From2 "Signal switch2.in2" as Connection9
            connect From20 SM2.der_opt_in as Connection107
            connect From21 SM2.CB as Connection108
            connect From22 SM2.dg_on as Connection109
            connect From24 "Bus Join2.in4" as Connection112
            connect From4 "Signal switch4.in2" as Connection17
            connect From5 "Signal switch3.in2" as Connection25
            connect From6 "Signal switch1.in2" as Connection28
            connect From7 SM.CB as Connection32
            connect From8 SM.operation as Connection35
            connect From9 Junction8 as Connection98
            connect Goto10 SM.gridform as Connection60
            connect Goto11 SM.close_cb as Connection61
            connect Goto12 SM.open_cb as Connection62
            connect Goto13 "Logical operator1.out" as Connection95
            connect Goto14 Junction9 as Connection103
            connect Goto15 Junction10 as Connection106
            connect Goto16 SM2.der_opt as Connection111
            connect Goto17 SM2.force_off as Connection113
            connect Goto2 SM.zeropower as Connection29
            connect Goto4 "Rate Transition2.out" as Connection30
            connect Goto7 is_zero.zeroed as Connection42
            connect Goto8 Junction3 as Connection56
            connect Goto9 Junction4 as Connection59
            connect Junction1 "Signal switch1.in" as Connection37
            connect Junction10 "Rate Transition4.out" as Connection105
            connect Junction2 "Signal switch3.in" as Connection40
            connect Junction3 "Signal switch2.out" as Connection55
            connect Junction4 "Signal switch4.out" as Connection58
            connect Junction8 zeroed.in as Connection99
            connect Junction9 "Rate Transition3.out" as Connection102
            connect "Logical operator1.in1" Junction10 as Connection104
            connect "Logical operator1.in" Junction9 as Connection101
            connect PI_P.reset From1 as Connection88
            connect PI_P.In Gain1.out as Connection87
            connect PI_P.Out Gain2.in as Connection86
            connect PI_Q.In Gain3.out as Connection84
            connect PI_Q.Out Gain4.in as Connection85
            connect Poff.in Junction3 as Connection54
            connect Qoff.in Junction4 as Connection57
            connect "Rate Transition1.in" power_meas as Connection14
            connect "Rate Transition2.in" CB_status as Connection31
            connect "Rate Transition3.in" fromESS as Connection91
            connect "Rate Transition4.in" fromDG as Connection92
            connect SM.ON From19 as Connection96
            connect SM.zeroed Junction8 as Connection100
            connect SM2.batt_on From23 as Connection110
            connect "Signal switch1.out" Gain1.in as Connection4
            connect "Signal switch2.in" Gain2.out as Connection5
            connect "Signal switch3.out" Gain3.in as Connection18
            connect "Signal switch4.in" Gain4.out as Connection19
            connect is_zero.P Junction1 as Connection38
            connect is_zero.Q Junction2 as Connection41
            connect From26 "C function1.bi" as Connection116
            connect From25 "C function1.dg" as Connection117
            connect cMode.in Junction11 as Connection118
            connect Junction11 Goto6 as Connection119
            connect "C function1.ctrl_mode" Junction11 as Connection120
            connect Goto18 "C function1.bloc_island" as Connection121
            connect opMode.in Junction12 as Connection123
            connect Junction12 Goto5 as Connection124
            connect "Protection of isolation.out" Junction12 as Connection125
            connect "Protection of isolation.blck_m" From27 as Connection126
            connect "Protection of isolation.op" operation_mode as Connection127
            connect control_option "C function1.control_op" as Connection136

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power Management System</p></body></html>"

                Sb {
                    label = "Microgrid nominal power"
                    widget = edit
                    type = generic
                    default_value = "4.5e6"
                    unit = "VA"
                    group = "General"
                }

                p_lim {
                    label = "Allowed active power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "W"
                    group = "General"
                }

                q_lim {
                    label = "Allowed reactive power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "VAr"
                    group = "General"
                }

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts2"
                    unit = "s"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8008, 8656
            size = 152, 200
        ]

        component Subsystem VBR_out {
            layout = dynamic
            component gen_bus_split "Bus Split1" {
                outputs = "4"
            }
            [
                position = 8192, 8224
                rotation = right
                hide_name = True
                scale = -1, -1
            ]

            component gen_probe pf {
            }
            [
                position = 8288, 8160
                rotation = left
            ]

            component gen_probe Q {
            }
            [
                position = 8152, 8160
                rotation = left
            ]

            component gen_probe S {
            }
            [
                position = 8224, 8160
                rotation = left
            ]

            component gen_probe P {
            }
            [
                position = 8096, 8160
                rotation = left
            ]

            port In1 {
                position = bottom:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8192, 8296
                rotation = left
            ]

            connect "Bus Split1.out" P.in as Connection12
            connect "Bus Split1.out2" S.in as Connection14
            connect "Bus Split1.out1" Q.in as Connection13
            connect "Bus Split1.out3" pf.in as Connection15
            connect "Bus Split1.in" In1 as Connection16
        }
        [
            position = 9304, 9272
            rotation = right
            scale = -1, 1
            size = 48, 48
        ]

        component "core/VBR Variable Load" "VBR Variable Load1" {
        }
        [
            position = 9472, 9208
            size = 184, 160
        ]

        component Subsystem VBR_in {
            layout = dynamic
            component src_scada_input Pref {
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 8112, 8192
            ]

            component src_scada_input Enable {
                execution_rate = "Ts"
                max = "3"
                min = "0"
                unit = ""
            }
            [
                position = 8112, 8136
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "3"
            }
            [
                position = 8272, 8192
                hide_name = True
            ]

            component src_scada_input Qref {
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 8112, 8248
            ]

            port Out1 {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 8192
            ]

            connect "Bus Join1.out" Out1 as Connection897
            connect Enable.out "Bus Join1.in" as Connection896
            connect Pref.out "Bus Join1.in1" as Connection889
            connect Qref.out "Bus Join1.in2" as Connection26
        }
        [
            position = 9304, 9144
            size = 48, 48
        ]

        component "core/Constant Impedance Load" "Constant Impedance Load1" {
            SAB = "700000.0/3"
            SAn = "700000.0/3"
            SBC = "700000.0/3"
            SBn = "700000.0/3"
            SCA = "700000.0/3"
            SCn = "700000.0/3"
            Sn_3ph = "700e3"
            pfA = "0.95"
            pfB = "0.95"
            pfC = "0.95"
            pf_3ph = "0.95"
            pf_modeA = "Lag"
            pf_modeB = "Lag"
            pf_modeC = "Lag"
            pf_mode_3ph = "Lag"
        }
        [
            position = 8896, 9208
            size = 160, 152
        ]

        tag Goto16 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8248, 8672
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From7 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8248, 8608
            hide_name = True
            size = 60, 20
        ]

        tag Goto17 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8248, 8640
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag Goto15 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8248, 8704
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From14 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7856, 8704
            hide_name = True
            size = 60, 20
        ]

        tag Goto19 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8152, 8736
            hide_name = True
            size = 60, 20
        ]

        tag From15 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7856, 8736
            hide_name = True
            size = 60, 20
        ]

        tag From9 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7856, 8672
            hide_name = True
            size = 60, 20
        ]

        tag From8 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7856, 8640
            hide_name = True
            size = 60, 20
        ]

        tag Goto18 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8152, 8576
            hide_name = True
            size = 60, 20
        ]

        tag From11 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8464, 9216
            hide_name = True
            size = 60, 20
        ]

        tag Goto21 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8464, 9160
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From10 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8464, 9272
            hide_name = True
            size = 60, 20
        ]

        tag Goto20 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7432, 9160
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From12 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7432, 9272
            hide_name = True
            size = 60, 20
        ]

        tag From13 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7432, 9216
            hide_name = True
            size = 60, 20
        ]

        tag From16 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8112, 9216
            hide_name = True
            size = 60, 20
        ]

        tag From17 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7776, 9216
            hide_name = True
            size = 60, 20
        ]

        junction Junction1 pe
        [
            position = 7872, 8808
        ]

        junction Junction2 pe
        [
            position = 7928, 8832
        ]

        junction Junction3 pe
        [
            position = 7984, 8856
        ]

        junction Junction4 pe
        [
            position = 8208, 8808
        ]

        junction Junction5 pe
        [
            position = 8264, 8832
        ]

        junction Junction6 pe
        [
            position = 8320, 8856
        ]

        junction Junction7 pe
        [
            position = 8560, 8808
        ]

        junction Junction8 pe
        [
            position = 8616, 8832
        ]

        junction Junction9 pe
        [
            position = 8672, 8856
        ]

        junction Junction19 pe
        [
            position = 8344, 8808
        ]

        junction Junction20 pe
        [
            position = 8400, 8832
        ]

        junction Junction21 pe
        [
            position = 8456, 8856
        ]

        junction Junction22 pe
        [
            position = 9064, 9000
        ]

        junction Junction23 pe
        [
            position = 9120, 9032
        ]

        junction Junction24 pe
        [
            position = 9176, 9064
        ]

        junction Junction25 pe
        [
            position = 8896, 9032
        ]

        junction Junction26 pe
        [
            position = 8840, 9000
        ]

        junction Junction27 pe
        [
            position = 8952, 9064
        ]

        comment Comment8 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Hardware requirements</span>:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This example can be run on the following HIL devices:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- HIL 602+</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- HIL 604</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- HIL 606  </p></body></html> ENDCOMMENT 
        [
            position = 7368, 8592
        ]

        connect ESS.from_PCC From13 as Connection256
        connect ESS.toPCC Goto20 as Connection258
        connect ESS.A Trafo1.a as Connection259
        connect From10 DG.from_PMS as Connection212
        connect From11 DG.from_PCC as Connection211
        connect From12 ESS.from_PMS as Connection257
        connect From14 Microgrid_controller.fromESS as Connection195
        connect From15 Microgrid_controller.fromDG as Connection196
        connect From17 Wind.from_PMS as Connection220
        connect From8 Microgrid_controller.power_meas as Connection147
        connect From9 Microgrid_controller.CB_status as Connection148
        connect Goto16 PCC_monitor.CB_fb as Connection242
        connect Goto18 Microgrid_controller.PCC_control as Connection145
        connect Goto19 Microgrid_controller.DER_control as Connection197
        connect Goto21 DG.toPCC as Connection210
        connect Grid.B PCC_monitor.B as Connection254
        connect Grid.C PCC_monitor.C as Connection255
        connect Junction1 Junction4 as Connection28
        connect Junction19 Junction4 as Connection245
        connect Junction2 Junction5 as Connection31
        connect Junction20 Junction5 as Connection248
        connect Junction21 Junction6 as Connection251
        connect Junction3 Junction6 as Connection34
        connect Junction7 Junction19 as Connection244
        connect Junction7 Trafo5.A as Connection38
        connect Junction8 Junction20 as Connection247
        connect Junction8 Trafo5.B as Connection41
        connect Junction9 Junction21 as Connection250
        connect Junction9 Trafo5.C as Connection44
        connect PCC_monitor.Inputs From7 as Connection240
        connect PCC_monitor.synch_ref Goto15 as Connection243
        connect PCC_monitor.power_meas Goto17 as Connection241
        connect PCC_monitor.A Grid.A as Connection253
        connect PCC_monitor.a Junction19 as Connection246
        connect PCC_monitor.b Junction20 as Connection249
        connect PCC_monitor.c Junction21 as Connection252
        connect PV.from_PMS From16 as Connection224
        connect Trafo1.b ESS.B as Connection260
        connect Trafo1.c ESS.C as Connection261
        connect Trafo2.A Junction1 as Connection21
        connect Trafo2.B Junction2 as Connection24
        connect Trafo2.C Junction3 as Connection27
        connect Trafo2.a Wind.A as Connection10
        connect Trafo2.b Wind.B as Connection11
        connect Trafo2.c Wind.C as Connection12
        connect Trafo3.A Junction4 as Connection30
        connect Trafo3.B Junction5 as Connection33
        connect Trafo3.C Junction6 as Connection36
        connect Trafo3.a PV.A as Connection221
        connect Trafo3.b PV.B as Connection222
        connect Trafo3.c PV.C as Connection223
        connect Trafo4.a DG.A as Connection213
        connect Trafo4.b DG.B as Connection214
        connect Trafo4.c DG.C as Connection215
        connect Trafo4.A Junction7 as Connection39
        connect Trafo4.B Junction8 as Connection42
        connect Trafo4.C Junction9 as Connection45
        connect c_option.out Microgrid_controller.control_option as Connection142
        connect op_mode.out Microgrid_controller.operation_mode as Connection141
        connect "VBR Variable Load1.Inputs" VBR_in.Out1 as Connection918
        connect VBR_out.In1 "VBR Variable Load1.Output" as Connection919
        connect Junction22 "Interruptible load.A" as Connection921
        connect "VBR Variable Load1.A" Junction22 as Connection922
        connect Junction23 "Interruptible load.B" as Connection924
        connect "VBR Variable Load1.B" Junction23 as Connection925
        connect "Interruptible load.C" Junction24 as Connection926
        connect "VBR Variable Load1.C" Junction24 as Connection928
        connect Trafo5.b Junction25 as Connection932
        connect Junction25 Junction23 as Connection933
        connect "Constant Impedance Load1.B" Junction25 as Connection934
        connect Trafo5.a Junction26 as Connection935
        connect Junction26 Junction22 as Connection936
        connect "Constant Impedance Load1.A" Junction26 as Connection937
        connect Junction24 Junction27 as Connection938
        connect Junction27 Trafo5.c as Connection939
        connect "Constant Impedance Load1.C" Junction27 as Connection940
        connect Junction2 Trafo1.B as Connection951
        [
            breakpoints = 7928, 8832; 7584, 8832
        ]
        connect Trafo1.C Junction3 as Connection950
        [
            breakpoints = 7640, 8856
        ]
        connect Trafo1.A Junction1 as Connection952
        [
            breakpoints = 7528, 8808
        ]
    }

    default {
        gen_PQ_transform {
            filter_order = "first order"
            filter_cutoff_Hz = "30"
            initial_filter_input = "0"
            initial_filter_output = "0"
            enable_inst_ports = "True"
            enable_zero_ports = "False"
            execution_rate = "inherit"
        }

        gen_abc2alpha_beta {
            power_form = "variant - Clarke\'s original"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_alpha_beta2d_q {
            alignment = "-pi/2"
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_rel_op {
            relational_op = "=="
            execution_rate = "inherit"
        }

        gen_sr_ff {
            init_value = "0"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1,1]"
            a_coeff = "[1,1]"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
            param_set = ""
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Battery" {
            sig_output = "False"
            lut = "False"
            battery_type = "Lead-Acid"
            nominal_voltage = "12.0"
            capacity = "1.2"
            initial_soc = "100.0"
            execution_rate = "100e-6"
            Ke_full = "108.0"
            Kdisc_I = "5.0"
            R_series = "0.25"
            Kq_nom = "50.0"
            Kq_exp = "0.9"
            Ke_exp = "102.5"
            preview = "Preview SOC Curve"
        }

        "core/Battery inverter" {
            Sn = "1.6e6"
            Vn = "480.0"
            Vn_dc = "1000.0"
            fn = "60.0"
            fsw = "2500.0"
            Ts = "200e-6"
            L = "100.0e-6"
            R = "1e-5"
            OutputFilterFc = "500.0"
            Resr = "15e-3"
            blowpass = "[  9.82591682e-06,   1.96518336e-05,   9.82591682e-06]"
            alowpass = "[ -1.99111429,  0.9911536 ]"
            V_diff = "5"
            Vmatch_Kp = "0.1"
            Vmatch_Ki = "5.0"
            f_diff = "0.2"
            fmatch_Kp = "0.01"
            fmatch_Ki = "3.0"
            Phase_diff = "1.0"
            Phase_Kp = "0.005"
            Phase_Ki = "0.5"
            ImodeId_Kp = "0.347"
            ImodeId_Ki = "347.22"
            ImodeIq_Kp = "0.347"
            ImodeIq_Ki = "347.22"
            Imode_damp = "-0.272"
            powerRate = "1e5"
            VmodeIdRef_Kp = "10.0"
            VmodeIdRef_Ki = "10.0"
            VmodeId_Kp = "0.8328"
            VmodeId_Ki = "833.33"
            Vmode_ovMod = "1.2"
            Vmode_damp = "-0.0001"
            V_rise = "10e3"
            V_fall = "-10e3"
            f_rise = "10.0"
            f_fall = "-10.0"
            mod_upLim = "1.1546"
            mod_lowLim = "-1.1546"
            k = "0.05"
        }

        "core/Constant Impedance Load" {
            fn = "60"
            conn_type = "Y"
            enable_neutral = "False"
            set_balanced = "True"
            Vn_3ph = "480"
            Sn_3ph = "1.0e6"
            pf_mode_3ph = "Unit"
            pf_3ph = "0.9"
            VAn = "480/(3**0.5)"
            VAB = "480"
            SAn = "1.0e6/3"
            SAB = "1.0e6/3"
            pf_modeA = "Unit"
            pfA = "0.9"
            VBn = "480/(3**0.5)"
            VBC = "480"
            SBn = "1.0e6/3"
            SBC = "1.0e6/3"
            pf_modeB = "Unit"
            pfB = "0.9"
            VCn = "480/(3**0.5)"
            VCA = "480"
            SCn = "1.0e6/3"
            SCA = "1.0e6/3"
            pf_modeC = "Unit"
            pfC = "0.9"
        }

        "core/Counter" {
            ext_reset = "level"
            init_val = "0"
            state_type = "real"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Diesel Genset" {
            Sb = "2.2e6"
            Vn = "480.0"
            f = "60.0"
            load = "5"
            Ts = "200e-6"
            Rs = "9.4035e-4"
            Lls = "1.389e-5"
            Lmd = "6.5282e-4"
            Lmq = "4.778e-4"
            Rf_prime = "2.1574e-4"
            Llfd_prime = "1.4195e-4"
            Rkd = "0.0443938909091"
            Rkq = "0.00399796363636"
            Llkd = "0.00155586168397"
            Llkq = "9.96738215238e-05"
            Ns_Nfd = "0.02512"
            Ns_Nkd = "1.0"
            Ns_Nkq = "1.0"
            pms = "2.0"
            J = "42.9467"
            F = "0.572003113298"
            T1 = "1.0e-4"
            T2 = "1e-6"
            T3 = "0.5001"
            K = "10.0"
            T4 = "25.0e-3"
            T5 = "9.0e-4"
            T6 = "5.74e-3"
            Pm0 = "0.0"
            Tmax = "10"
            Tmin = "-10"
            Td = "24.0e-3"
            Tr = "2.0e-6"
            exc_Kp = "0.025"
            exc_Ki = "0.007"
            Ka = "1.0"
            Ta = "2.0e-3"
            Vrmax = "10.0"
            Vrmin = "-10.0"
            Te = "1.0e-8"
            Ke = "1.0"
            Kf = "0.01"
            Tf = "2.0e-6"
            Vt0 = "0.0"
            Vf0 = "0.0"
            Efmax = "[\'inf\']"
            Efmin = "[\'-inf\']"
            delta_f = "0.5"
            delta_phi = "1.0"
            phase_Kp = "0.01"
            phase_Ki = "0.00012"
            phase_upLim = "0.1"
            phase_lowLim = "-0.1"
            phaseOff = "0"
            dw_K = "1.0"
            V_Kp = "0.0071"
            V_Ki = "0.0354"
            V_upLim = "1"
            V_lowLim = "-1"
            delta_V = "1.0"
            w_sp_Kp = "0.01"
            w_sp_Ki = "0.01"
            w_sp_upLim = "10"
            w_sp_lowLim = "-10"
            P_droop = "2.7"
            P_rise = "10"
            P_fall = "-10"
            w_droop = "0.1"
            w_rise = "10"
            w_fall = "-10"
            gov_Kp = "0.5"
            delta_wn = "0.1"
            inner_w_droop = "0.1"
            inner_w_rise = "10"
            inner_w_fall = "-10"
            pf_Kp = "0.05"
            pf_Ki = "0.075"
            pf_upLim = "10"
            pf_lowLim = "-10"
            pf_rise = "10"
            pf_fall = "-10"
            exc_dwn = "75"
            V_rise = "10"
            V_fall = "-10"
            V_inner_droop = "0.1"
        }

        "core/PV Plant (Switching)" {
            Vn = "480.0"
            Sn = "5.0e6"
            fn = "60.0"
            fsw = "10000.0"
            Vn_dc = "1000.0"
            PV_area = "5556.0"
            PV_eff = "20.0"
            Ts = "200e-6"
            L0 = "79.8e-6"
            R0 = "1e-6"
            L = "9.6e-6"
            Rres = "0.01568"
            C = "2.7085e-3"
            V_Kp = "15.0"
            V_Ki = "3.0"
            V_upLim = "4.0"
            V_lowLim = "-4.0"
            Id_Kp = "3.0"
            Id_Ki = "30.0"
            Id_upLim = "10.0"
            Id_lowLim = "-10.0"
            Iq_Kp = "3.0"
            Iq_Ki = "30.0"
            Iq_upLim = "10.0"
            Iq_lowLim = "-10.0"
            Damp = "0.0"
            mod_upLim = "1.1546"
            mod_lowLim = "-1.1546"
            Delay = "0.125"
            powerRate = "5"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
            embedded_coupling = "False"
            ratio_type = "Automatic"
            ratio = "0.1"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            core_model = "Linear"
            ioc1 = "0.7"
            Poc1 = "460.0"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "None"
            coupling_type = "core"
            ratio_type = "Automatic"
            ratio = "0.1"
            Rshunt = "inf"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/VBR Variable Load" {
            Vn = "480"
            Sn = "640e3"
            fn = "60"
            L = "1e-4"
            execution_rate = "inherit"
            Id_Kp = "0.003"
            Id_Ki = "30"
            Iq_Kp = "0.003"
            Iq_Ki = "30"
            powerRate = "1"
            Rsnub = "1e3"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Wind Power Plant (Switching)" {
            Vn = "480.0"
            Sn = "1.5e6"
            fn = "60.0"
            fsw = "10000.0"
            Vn_dc = "1000.0"
            eff_A = "1345.0"
            WT_eff = "75.0"
            air_dens = "1.225"
            Ts = "200e-6"
            L0 = "266e-6"
            R0 = "1e-5"
            L = "32e-6"
            Rres = "0.0527"
            C = "812.55e-6"
            V_Kp = "15.0"
            V_Ki = "3.0"
            V_upLim = "4.0"
            V_lowLim = "-4.0"
            Id_Kp = "3.0"
            Id_Ki = "30.0"
            Id_upLim = "10.0"
            Id_lowLim = "-10.0"
            Iq_Kp = "3.0"
            Iq_Ki = "30.0"
            Iq_upLim = "10.0"
            Iq_lowLim = "-10.0"
            Damp = "0.0"
            mod_upLim = "1.1546"
            mod_lowLim = "-1.1546"
            Delay = "0.125"
            powerRate = "5"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 200e-6
        Ts2 = 5*Ts
    ENDCODE
}
