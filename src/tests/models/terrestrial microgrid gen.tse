version = 4.2

//
// Saved by sw version: 2022.3 DEV
//

model "terrestrial microgrid gen" {
    configuration {
        hil_device = "HIL404"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 4e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        dss_num_tol = 1e-15
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
    }

    component Subsystem Root {
        component "core/Grid" Grid1 {
            Sb = "60e6"
            Tfast = "Ts1"
            Vb = "12470"
            f = "60"
            pf = "0.85"
            resistance_cont = "10.0"
        }
        [
            position = 8848, 7752
            rotation = down
            size = 144, 136
        ]

        component Subsystem "Grid UI1" {
            layout = dynamic
            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 7968, 8048
            ]

            component gen_probe Connect_fb {
            }
            [
                position = 8096, 7984
            ]

            component gen_bus_split "Bus Split1" {
                outputs = "20"
            }
            [
                position = 7688, 8136
            ]

            component src_scada_input Connect {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8616, 8104
            ]

            component gen_probe Fmeas_Hz {
                streaming_en = "True"
            }
            [
                position = 8032, 8016
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 8000, 8032
            ]

            component gen_probe Smeas_kVA {
                streaming_en = "True"
            }
            [
                position = 7936, 8064
            ]

            component gen_probe Vrms_meas_kV {
                streaming_en = "True"
            }
            [
                position = 8064, 8000
            ]

            component gen_probe PFmeas {
                streaming_en = "True"
            }
            [
                position = 7904, 8080
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "4"
            }
            [
                position = 8896, 8128
            ]

            component src_constant reserved_outs {
                execution_rate = "inherit"
                value = "[0.0]*17"
            }
            [
                position = 8792, 8152
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 7872, 8192
                hide_name = True
            ]

            component gen_bus_join reserved_ins {
                inputs = "13"
            }
            [
                position = 7784, 8192
            ]

            component src_scada_input Grid_Vrms_cmd {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 8664, 8120
            ]

            component src_scada_input Grid_freq_cmd {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 8728, 8136
            ]

            component gen_bus_join "Bus Join2" {
            }
            [
                position = 8024, 7864
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1000"
            }
            [
                position = 8096, 7864
                hide_name = True
            ]

            port ui_out {
                label = "ui_out"
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8976, 8128
            ]

            port ui_in {
                label = "ui_in"
                position = right:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7504, 8136
            ]

            port power_meas {
                position = left:auto
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8240, 7864
            ]

            junction Junction2 sp
            [
                position = 7840, 8048
            ]

            junction Junction3 sp
            [
                position = 7800, 8032
            ]

            connect "Bus Split1.out2" Fmeas_Hz.in as Connection2718
            connect "Bus Split1.out1" Vrms_meas_kV.in as Connection2717
            connect "Bus Split1.out" Connect_fb.in as Connection2719
            connect Connect.out "Bus Join1.in" as Connection2808
            connect "Bus Join1.out" ui_out as Connection2809
            connect reserved_ins.in "Bus Split1.out7" as Connection2811
            connect "Bus Split1.out8" reserved_ins.in1 as Connection2812
            connect reserved_ins.in2 "Bus Split1.out9" as Connection2813
            connect "Bus Split1.out10" reserved_ins.in3 as Connection2814
            connect reserved_ins.in4 "Bus Split1.out11" as Connection2815
            connect "Bus Split1.out12" reserved_ins.in5 as Connection2816
            connect reserved_ins.in6 "Bus Split1.out13" as Connection2817
            connect "Bus Split1.out14" reserved_ins.in7 as Connection2818
            connect reserved_ins.in8 "Bus Split1.out15" as Connection2819
            connect "Bus Split1.out16" reserved_ins.in9 as Connection2820
            connect reserved_ins.in10 "Bus Split1.out17" as Connection2821
            connect "Bus Split1.out18" reserved_ins.in11 as Connection2822
            connect reserved_ins.in12 "Bus Split1.out19" as Connection2823
            connect Termination1.in reserved_ins.out as Connection2824
            connect PFmeas.in "Bus Split1.out6" as Connection2825
            connect ui_in "Bus Split1.in" as Connection2826
            connect Grid_Vrms_cmd.out "Bus Join1.in1" as Connection2827
            connect Grid_freq_cmd.out "Bus Join1.in2" as Connection2828
            connect reserved_outs.out "Bus Join1.in3" as Connection2829
            connect "Bus Join2.out" Gain1.in as Connection2836
            connect Smeas_kVA.in "Bus Split1.out5" as Connection2839
            [
                breakpoints = 7848, 8064
            ]
            connect Qmeas_kVAr.in Junction2 as Connection2840
            [
                breakpoints = 7936, 8048
            ]
            connect "Bus Join2.in1" Junction2 as Connection2842
            connect "Bus Split1.out4" Junction2 as Connection2843
            [
                breakpoints = 7792, 8048; 7792, 8048
            ]
            connect "Bus Split1.out3" Junction3 as Connection2844
            connect Junction3 Pmeas_kW.in as Connection2845
            connect "Bus Join2.in" Junction3 as Connection2846
            connect Gain1.out power_meas as Connection2847

            mask {
                icon = "image(\'grid_generic_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface subsystem intended to be used with \"Grid\" component.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                
                ENDCODE
            }
        }
        [
            position = 8672, 7752
            rotation = down
            scale = -1, 1
            size = 56, 136
        ]

        component "core/Battery ESS (Generic)" "Battery ESS (Generic)1" {
            PFg = "0.85"
            Pnom = "1.6e6"
            Snom = "1.6e6*np.sqrt(2)"
            Tfast = "Ts1"
            Tslow = "Ts2"
            Vnom_LL = "480"
            Vnom_sec_LL = "12470"
            fnom = "60"
            nom_batt_capacity = "500"
            nom_batt_voltage = "1000"
            wL_pu = "0.2"
        }
        [
            position = 7952, 8504
            size = 144, 136
        ]

        component "core/Wind Power Plant (Generic)" "Wind Power Plant (Generic)1" {
            PFg = "0.85"
            Pnom = "500e3"
            Sg_sc_pu = "20"
            Snom = "500e3*np.sqrt(2)"
            Tfast = "Ts1"
            Tslow = "Ts2"
            Vnom_LL = "480"
            Vnom_sec_LL = "12470"
            fnom = "60"
        }
        [
            position = 8376, 8504
            size = 144, 136
        ]

        component "core/PV Power Plant (Generic)" "PV Power Plant (Generic)1" {
            PFg = "0.85"
            Snom = "250e3*np.sqrt(2)"
            Tfast = "Ts1"
            Tslow = "Ts2"
            Vnom_LL = "480"
            Vnom_sec_LL = "12470"
            fnom = "60"
        }
        [
            position = 8848, 8504
            size = 144, 136
        ]

        component "core/Diesel Genset (Generic)" "Diesel Genset (Generic)1" {
            Omega_nom = "1800"
            Pnom = "2.2e6"
            Snom = "2.2e6*np.sqrt(2)"
            Tfast = "Ts1"
            Tslow = "Ts2"
            Vnom_LL = "480"
            Vnom_sec_LL = "12470"
            fnom = "60"
            include_transformer = "True"
            wL_pu = "0.3"
        }
        [
            position = 9328, 8496
            size = 144, 136
        ]

        component Subsystem Trafo5 {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "2.9e6"
                V1 = "12470"
                V2 = "480"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8192, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7776, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7776, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7776, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8736, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8736, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8736, 7992
                scale = -1, 1
            ]

            connect Tr7.sec_1 a as Connection6
            connect Tr7.sec_3 c as Connection8
            connect b Tr7.sec_2 as Connection7
            connect A Tr7.prm_1 as Connection9
            connect B Tr7.prm_2 as Connection10
            connect C Tr7.prm_3 as Connection11
        }
        [
            position = 9640, 8216
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem "Interruptible load" {
            layout = dynamic
            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8192, 8120
                rotation = right
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8288, 8216
                rotation = right
            ]

            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8096, 8120
                rotation = right
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8096, 8216
                rotation = right
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8192, 8216
                rotation = right
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8288, 8120
                rotation = right
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
            }
            [
                position = 8192, 8000
                rotation = right
                size = 64, 256
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8096, 7896
                rotation = right
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8288, 7896
                rotation = right
            ]

            junction Junction1 pe
            [
                position = 8192, 8272
            ]

            connect A S1.c_in as Connection11
            connect B S1.b_in as Connection13
            connect C S1.a_in as Connection12
            connect Junction1 L3.n_node as Connection6
            connect L1.n_node Junction1 as Connection5
            connect L2.n_node Junction1 as Connection7
            connect R1.n_node L1.p_node as Connection1
            connect R2.n_node L2.p_node as Connection2
            connect R3.n_node L3.p_node as Connection3
            connect S1.c_out R1.p_node as Connection9
            connect S1.b_out R2.p_node as Connection8
            connect S1.a_out R3.p_node as Connection10

            Sb = "480e3"
            Vb = "480"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 9864, 8496
            size = 160, 160
        ]

        component "core/Constant Impedance Load" "Constant Impedance Load1" {
            SAB = "700000.0/3"
            SAn = "700000.0/3"
            SBC = "700000.0/3"
            SBn = "700000.0/3"
            SCA = "700000.0/3"
            SCn = "700000.0/3"
            Sn_3ph = "700e3"
            pfA = "0.95"
            pfB = "0.95"
            pfC = "0.95"
            pf_3ph = "0.95"
            pf_modeA = "Lag"
            pf_modeB = "Lag"
            pf_modeC = "Lag"
            pf_mode_3ph = "Lag"
        }
        [
            position = 9640, 8496
            size = 160, 152
        ]

        component "core/Variable Load (Generic)" "Variable Load (Generic)1" {
            PFg = "0.85"
            Pnom = "450e3"
            Snom = "np.sqrt(2)*450e3"
            Tfast = "Ts1"
            Tslow = "Ts2"
            Vnom_LL = "480"
            Vnom_sec_LL = "480"
            fnom = "60"
            resistance_cont = "1.0"
        }
        [
            position = 10296, 8496
            size = 144, 136
        ]

        component Subsystem "Variable Load (Generic) UI1" {
            layout = dynamic
            component gen_probe Enable_fb {
            }
            [
                position = 7952, 8024
            ]

            component gen_probe PFmeas {
                streaming_en = "True"
            }
            [
                position = 7600, 8200
            ]

            component src_scada_input Qref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 8600, 7736
            ]

            component src_scada_input Enable {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8600, 7568
            ]

            component src_scada_input Pref {
                execution_rate = "inherit"
                max = "1e8"
                min = "0"
                unit = "pu"
            }
            [
                position = 8600, 7680
            ]

            component gen_probe Vload_rms_meas_V {
                streaming_en = "True"
            }
            [
                position = 7568, 8216
            ]

            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 7664, 8168
            ]

            component gen_probe Smeas_kVA {
            }
            [
                position = 7632, 8184
            ]

            component gen_probe Pnom_kW {
            }
            [
                position = 7856, 8072
            ]

            component gen_probe Qref_fb_kVAr {
                streaming_en = "True"
            }
            [
                position = 7888, 8056
            ]

            component gen_probe Snom_kVA {
            }
            [
                position = 7792, 8104
            ]

            component gen_probe Fmeas_Hz {
                streaming_en = "True"
            }
            [
                position = 7760, 8120
            ]

            component gen_probe Pref_fb_kW {
                streaming_en = "True"
            }
            [
                position = 7920, 8040
            ]

            component gen_probe Qnom_kVAr {
            }
            [
                position = 7824, 8088
            ]

            component gen_probe Vgrid_rms_meas_kV {
            }
            [
                position = 7728, 8136
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 7696, 8152
            ]

            component gen_probe MCB_status {
            }
            [
                position = 7536, 8232
            ]

            component gen_probe alarm_msg {
            }
            [
                position = 7504, 8248
            ]

            component src_scada_input "Reset alarms" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8600, 7624
            ]

            component src_scada_input "Pref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8600, 7792
            ]

            component src_scada_input "Qref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8600, 7848
            ]

            component src_scada_input "P dependency type" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 8600, 7904
            ]

            component src_scada_input "Q dependency type" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 8600, 7960
            ]

            component src_scada_input "P(V) k1" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = ""
            }
            [
                position = 8600, 8016
            ]

            component src_scada_input "P(V) k2" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = "1/pu"
            }
            [
                position = 8600, 8072
            ]

            component src_scada_input "Q(V) k1" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = ""
            }
            [
                position = 8600, 8248
            ]

            component src_scada_input "Q(V) k2" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = "1/pu"
            }
            [
                position = 8600, 8304
            ]

            component src_scada_input "P(f) k1" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = ""
            }
            [
                position = 8600, 8128
            ]

            component src_scada_input "P(f) k2" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = "1/pu"
            }
            [
                position = 8600, 8192
            ]

            component src_scada_input "Q(f) k1" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = ""
            }
            [
                position = 8600, 8360
            ]

            component src_scada_input "Q(f) k2" {
                def_value = "0.0"
                execution_rate = "inherit"
                max = "100"
                min = "-100"
                unit = "1/pu"
            }
            [
                position = 8600, 8416
            ]

            component "core/DER (Generic) Control Join" "DER (Generic) Control Join" {
                Enable = "True"
                F_alarm_lower_limit = "True"
                F_alarm_upper_limit = "True"
                I_alarm_upper_limit = "True"
                P_V_k1 = "True"
                P_V_k2 = "True"
                P_dependency_type = "True"
                P_f_k1 = "True"
                P_f_k2 = "True"
                Pref = "True"
                Pref_rate_of_change = "True"
                Q_V_k1 = "True"
                Q_V_k2 = "True"
                Q_dependency_type = "True"
                Q_f_k1 = "True"
                Q_f_k2 = "True"
                Qref = "True"
                Qref_rate_of_change = "True"
                Reset_alarms = "True"
                S_alarm_upper_limit = "True"
                V_alarm_lower_limit = "True"
                V_alarm_upper_limit = "True"
                component_select = "Variable Load"
            }
            [
                position = 8952, 8160
                size = 192, 368
            ]

            component "core/DER (Generic) Output Split" "DER (Generic) Output Split" {
                Enable_fb = "True"
                Fmeas_Hz = "True"
                Fref_fb_Hz = "True"
                MCB_status = "True"
                PFmeas = "True"
                Pmeas_kW = "True"
                Pnom_kW = "True"
                Pref_fb_kW = "True"
                Qmeas_kVAr = "True"
                Qnom_kVAr = "True"
                Qref_fb_kVAr = "True"
                Smeas_kVA = "True"
                Snom_kVA = "True"
                Vgrid_rms_meas_kV = "True"
                Vload_rms_meas_V = "True"
                Vrms_ref_fb_V = "True"
                alarm_msg = "True"
                component_select = "Variable Load"
            }
            [
                position = 7312, 8136
                size = 128, 288
            ]

            component "core/DER (Generic) External Join" "DER (Generic) External Join1" {
                component_select = "Variable Load"
            }
            [
                position = 8952, 8936
                size = 192, 64
            ]

            component src_scada_input "V alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8600, 8480
            ]

            component src_scada_input "V alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8600, 8536
            ]

            component src_scada_input "F alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8600, 8592
            ]

            component src_scada_input "F alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8600, 8648
            ]

            component src_scada_input "S alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8600, 8704
            ]

            component src_scada_input "I alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8600, 8760
            ]

            port ui_in {
                label = "ui_in"
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7136, 8136
            ]

            port ui_out {
                label = "ui_out"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9112, 8160
            ]

            port ext {
                label = "ext"
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9128, 8936
            ]

            connect "DER (Generic) Control Join.ui_out" ui_out as Connection2888
            connect Enable.out "DER (Generic) Control Join.Enable" as Connection2889
            connect "Reset alarms.out" "DER (Generic) Control Join.Reset alarms" as Connection2890
            [
                position = 0, 0
                breakpoints = 8832, 7752; 8832, 8008
            ]
            connect Pref.out "DER (Generic) Control Join.Pref" as Connection2891
            [
                position = 0, 0
                breakpoints = 8824, 7808; 8824, 8024
            ]
            connect Qref.out "DER (Generic) Control Join.Qref" as Connection2892
            [
                position = 0, 0
                breakpoints = 8816, 7864; 8816, 8040
            ]
            connect "Pref rate of change.out" "DER (Generic) Control Join.Pref rate of change" as Connection2893
            [
                position = 0, 0
                breakpoints = 8808, 7920; 8808, 8056
            ]
            connect "Qref rate of change.out" "DER (Generic) Control Join.Qref rate of change" as Connection2894
            [
                position = 0, 0
                breakpoints = 8800, 7976; 8800, 8072
            ]
            connect "P dependency type.out" "DER (Generic) Control Join.P dependency type" as Connection2895
            [
                position = 0, 0
                breakpoints = 8792, 8032; 8792, 8088
            ]
            connect "Q dependency type.out" "DER (Generic) Control Join.Q dependency type" as Connection2896
            [
                position = 0, 0
                breakpoints = 8784, 8088; 8784, 8104
            ]
            connect "P(V) k1.out" "DER (Generic) Control Join.P(V) k1" as Connection2897
            [
                position = 0, 0
                breakpoints = 8776, 8040; 8776, 8120
            ]
            connect "P(V) k2.out" "DER (Generic) Control Join.P(V) k2" as Connection2898
            [
                position = 0, 0
                breakpoints = 8768, 8096; 8768, 8136
            ]
            connect "Q(f) k2.out" "DER (Generic) Control Join.Q(f) k2" as Connection2899
            [
                position = 0, 0
                breakpoints = 8792, 8416; 8792, 8232
            ]
            connect "Q(f) k1.out" "DER (Generic) Control Join.Q(f) k1" as Connection2900
            [
                position = 0, 0
                breakpoints = 8784, 8360; 8784, 8216
            ]
            connect "Q(V) k2.out" "DER (Generic) Control Join.Q(V) k2" as Connection2901
            [
                position = 0, 0
                breakpoints = 8776, 8304; 8776, 8200
            ]
            connect "Q(V) k1.out" "DER (Generic) Control Join.Q(V) k1" as Connection2902
            [
                position = 0, 0
                breakpoints = 8768, 8248; 8768, 8184
            ]
            connect "P(f) k2.out" "DER (Generic) Control Join.P(f) k2" as Connection2903
            [
                position = 0, 0
                breakpoints = 8760, 8192; 8760, 8168
            ]
            connect "P(f) k1.out" "DER (Generic) Control Join.P(f) k1" as Connection2904
            [
                position = 0, 0
                breakpoints = 8632, 8128; 8760, 8128; 8760, 8152
            ]
            connect ui_in "DER (Generic) Output Split.ui_in" as Connection2905
            connect Enable_fb.in "DER (Generic) Output Split.Enable_fb" as Connection2906
            connect "DER (Generic) Output Split.Pref_fb_kW" Pref_fb_kW.in as Connection2907
            connect Qref_fb_kVAr.in "DER (Generic) Output Split.Qref_fb_kVAr" as Connection2908
            connect "DER (Generic) Output Split.Pnom_kW" Pnom_kW.in as Connection2911
            connect Qnom_kVAr.in "DER (Generic) Output Split.Qnom_kVAr" as Connection2912
            connect "DER (Generic) Output Split.Snom_kVA" Snom_kVA.in as Connection2913
            connect Fmeas_Hz.in "DER (Generic) Output Split.Fmeas_Hz" as Connection2914
            connect "DER (Generic) Output Split.Vgrid_rms_meas_kV" Vgrid_rms_meas_kV.in as Connection2915
            [
                breakpoints = 7376, 8136; 7392, 8136
            ]
            connect "DER (Generic) Output Split.Pmeas_kW" Pmeas_kW.in as Connection2916
            connect Qmeas_kVAr.in "DER (Generic) Output Split.Qmeas_kVAr" as Connection2917
            connect "DER (Generic) Output Split.Smeas_kVA" Smeas_kVA.in as Connection2918
            connect PFmeas.in "DER (Generic) Output Split.PFmeas" as Connection2919
            connect "DER (Generic) Output Split.Vload_rms_meas_V" Vload_rms_meas_V.in as Connection2920
            connect MCB_status.in "DER (Generic) Output Split.MCB_status" as Connection2921
            connect "DER (Generic) Output Split.alarm_msg" alarm_msg.in as Connection2922
            connect ext "DER (Generic) External Join1.ext" as Connection2923
            connect "V alarm upper limit.out" "DER (Generic) Control Join.V alarm upper limit" as Connection2924
            [
                position = 0, 0
                breakpoints = 8800, 8480; 8800, 8248
            ]
            connect "V alarm lower limit.out" "DER (Generic) Control Join.V alarm lower limit" as Connection2925
            [
                position = 0, 0
                breakpoints = 8808, 8536; 8808, 8264
            ]
            connect "F alarm upper limit.out" "DER (Generic) Control Join.F alarm upper limit" as Connection2926
            [
                position = 0, 0
                breakpoints = 8816, 8592; 8816, 8280
            ]
            connect "F alarm lower limit.out" "DER (Generic) Control Join.F alarm lower limit" as Connection2927
            [
                position = 0, 0
                breakpoints = 8824, 8648; 8824, 8296
            ]
            connect "S alarm upper limit.out" "DER (Generic) Control Join.S alarm upper limit" as Connection2928
            [
                position = 0, 0
                breakpoints = 8832, 8704; 8832, 8312
            ]
            connect "I alarm upper limit.out" "DER (Generic) Control Join.I alarm upper limit" as Connection2929

            mask {
                icon = "image(\'variable_load_generic_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface subsystem intended to be used with \"Load (Generic)\" component.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 10136, 8496
            size = 56, 136
        ]

        component "core/RL Section" "RL Section1" {
            embedded_coupling = "True"
            frequency = "60.0"
            inductance_per_l = "0.0006213711922373339"
            length = "1.609344"
            model_def = "S-U"
            power = "3000"
            ratio = "0.5"
            ratio_type = "Manual"
            resistance_per_l = "0.621371192237334"
            unit_sys = "metric"
            voltage = "12.470"
        }
        [
            position = 8600, 8120
            size = 256, 56
        ]

        component "core/RL Section" "RL Section2" {
            embedded_coupling = "True"
            frequency = "60.0"
            inductance_per_l = "0.0006213711922373339"
            length = "1.609344"
            model_def = "S-U"
            power = "4000"
            ratio = "0.5"
            ratio_type = "Manual"
            resistance_per_l = "0.621371192237334"
            unit_sys = "metric"
            voltage = "12.470"
        }
        [
            position = 9064, 8120
            size = 256, 56
        ]

        component src_scada_input c_option {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 8000, 7704
            rotation = right
        ]

        component src_scada_input op_mode {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 8024, 7664
            rotation = right
        ]

        component Subsystem Microgrid_controller {
            layout = dynamic
            component gen_digital_probe cMode {
            }
            [
                position = 7120, 8128
                rotation = left
            ]

            component gen_bus_join "Bus Join1" {
            }
            [
                position = 7984, 8240
                hide_name = True
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "7"
            }
            [
                position = 8016, 8408
                hide_name = True
            ]

            component gen_digital_probe opMode {
            }
            [
                position = 7120, 8032
                rotation = left
            ]

            component gen_probe Qoff {
            }
            [
                position = 7984, 8840
                rotation = left
            ]

            component gen_logic_op "Logical operator1" {
                operator = "OR"
            }
            [
                position = 7328, 9064
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8624
                hide_name = True
            ]

            component gen_gain Gain2 {
                gain = "Sb"
            }
            [
                position = 7784, 8624
                hide_name = True
            ]

            component sys_signal_switch "Signal switch1" {
                threshold = "0"
            }
            [
                position = 7504, 8624
                hide_name = True
            ]

            component gen_digital_probe zeroed {
            }
            [
                position = 7392, 8160
                rotation = down
            ]

            component src_constant Constant4 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7424, 8896
                hide_name = True
            ]

            component sys_signal_switch "Signal switch4" {
                threshold = "0"
            }
            [
                position = 7880, 8896
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7136, 8552
                rotation = right
                hide_name = True
            ]

            component gen_c_function SM2 {
                input_terminals = "real dg_on;inherit batt_on;inherit CB;inherit der_opt_in;"
                input_terminals_dimensions = "inherit;inherit;inherit;inherit"
                input_terminals_feedthrough = "False;False;False;False"
                input_terminals_show_labels = "True;True;True;True"
                output_fnc = "/*Begin code section*/
if(dg_on && batt_on){
    der_opt = der_opt_in;
    force_off = 0;
}
else if(dg_on && !batt_on){
    der_opt = 1;
    force_off = 0;
}
else if (!dg_on && batt_on){
    der_opt = 0;
    force_off = 0;
}
else if(!CB){
    der_opt = der_opt_in;
    force_off = 1;
}
else{
    der_opt = der_opt_in;
    force_off = 0;
}
/*End code section*/"
                output_terminals = "real der_opt;inherit force_off;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "True;True"
            }
            [
                position = 7592, 8408
                size = 128, 80
            ]

            component gen_gain Gain3 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8880
                hide_name = True
            ]

            component src_constant Constant2 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8680
                hide_name = True
            ]

            component gen_gain Gain4 {
                gain = "Sb"
            }
            [
                position = 7784, 8880
                hide_name = True
            ]

            component sys_signal_switch "Signal switch2" {
                threshold = "0"
            }
            [
                position = 7880, 8640
                hide_name = True
            ]

            component sys_signal_switch "Signal switch3" {
                threshold = "0"
            }
            [
                position = 7504, 8880
                hide_name = True
            ]

            component gen_c_function SM {
                init_fnc = "/*Begin code section*/
open_cb = 1;
close_cb = 0;
/*End code section*/"
                input_terminals = "real CB;inherit operation;inherit zeroed;inherit ON;"
                input_terminals_dimensions = "inherit;inherit;inherit;inherit"
                input_terminals_feedthrough = "False;False;False;False"
                input_terminals_show_labels = "False;False;False;False"
                output_fnc = "/*Begin code section*/
if(CB == 0){
    gridform = 1;
    zeropower = 0;
    if(operation == 0){
        close_cb = 1;
        open_cb = 0;
    }
}
else{
    gridform = 0;
    zeropower = 0;
    if(operation != 0){
        gridform = 0;
        if(ON){
            zeropower = 1;
        }
        else{
            zeropower = 0;
        }
        if(zeroed){
            close_cb = 0;
            open_cb = 1;
            zeropower = 0;
        }
    }
}
/*End code section*/"
                output_terminals = "real gridform;inherit zeropower;inherit close_cb;inherit open_cb;"
                output_terminals_dimensions = "inherit;inherit;inherit;inherit"
                output_terminals_feedthrough = "True;True;True;True"
                output_terminals_show_labels = "False;False;False;False"
            }
            [
                position = 7584, 8136
                size = 128, 80
            ]

            component gen_probe Poff {
            }
            [
                position = 7984, 8576
                rotation = left
            ]

            component gen_c_function is_zero {
                input_terminals = "real P;inherit Q;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "False;False;"
                output_fnc = "/*Begin code section*/
if((fabs(P)<=p_lim) && (fabs(Q)<=q_lim)){
    zeroed = 1;
}
else{
    zeroed = 0;
}
/*End code section*/"
                output_terminals = "real zeroed;"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "[\'\']"
                parameters = "real p_lim;real q_lim;"
            }
            [
                position = 7256, 8736
                size = 48, 48
            ]

            component src_constant Constant3 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8936
                hide_name = True
            ]

            component src_constant Constant1 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7424, 8640
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7072, 8512
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts"
            }
            [
                position = 7072, 8440
                hide_name = True
                size = 32, 32
            ]

            component Subsystem PI_Q {
                layout = dynamic
                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8408
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8296
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8288
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7856, 8088
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8408
                    scale = -1, 1
                ]

                component sys_signal_switch "Signal switch2" {
                    threshold = "0"
                }
                [
                    position = 7976, 8272
                    hide_name = True
                    scale = 1, -1
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8288
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8216
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7856, 8024
                ]

                component sys_signal_switch "Signal switch1" {
                    threshold = "0"
                }
                [
                    position = 8048, 8040
                    hide_name = True
                ]

                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8280
                    hide_name = True
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8288
                    hide_name = True
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8168
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8288
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8304
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8000, 7904
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8336
                    hide_name = True
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8136, 7952
                    hide_name = True
                ]

                junction Junction2 sp
                [
                    position = 8368, 8288
                ]

                junction Junction3 sp
                [
                    position = 8440, 8288
                ]

                junction Junction4 sp
                [
                    position = 7728, 8168
                ]

                junction Junction5 sp
                [
                    position = 7728, 8088
                ]

                junction Junction6 sp
                [
                    position = 7728, 8216
                ]

                junction Junction11 sp
                [
                    position = 8048, 7952
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction5 Junction4 as Connection70
                connect Junction5 Kp2.in as Connection107
                [
                    breakpoints = 7728, 8088; 7728, 8024
                ]
                connect Junction6 Junction4 as Connection76
                connect Junction6 Ki2.in as Connection110
                [
                    breakpoints = 7728, 8216; 7728, 8288
                ]
                connect Kb.in Sum6.out as Connection50
                connect Ki1.in Junction6 as Connection75
                connect Ki1.out "Signal switch2.in1" as Connection112
                connect Ki2.out "Signal switch2.in" as Connection111
                connect Kp1.in Junction5 as Connection69
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7688, 8880
                size = 64, 112
            ]

            component Subsystem PI_P {
                layout = dynamic
                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8376
                    hide_name = True
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7880, 8256
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8384
                    hide_name = True
                ]

                component sys_signal_switch "Signal switch2" {
                    threshold = "0"
                }
                [
                    position = 7976, 8368
                    hide_name = True
                    scale = 1, -1
                ]

                component sys_signal_switch "Signal switch1" {
                    threshold = "0"
                }
                [
                    position = 8064, 8208
                    hide_name = True
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8384
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8504
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8392
                ]

                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8504
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7880, 8192
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8384
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8328
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8280
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8384
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8400
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8096
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8432
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 8144
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction2 sp
                [
                    position = 8368, 8384
                ]

                junction Junction3 sp
                [
                    position = 8440, 8384
                ]

                junction Junction4 sp
                [
                    position = 7728, 8280
                ]

                junction Junction11 sp
                [
                    position = 8064, 8144
                ]

                junction Junction12 sp
                [
                    position = 7728, 8256
                ]

                junction Junction13 sp
                [
                    position = 7728, 8328
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction12 Kp2.in as Connection112
                [
                    breakpoints = 7728, 8192
                ]
                connect Junction13 Ki1.in as Connection116
                [
                    breakpoints = 7728, 8328
                ]
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction4 Junction12 as Connection111
                connect Junction4 Junction13 as Connection115
                connect Kb.in Sum6.out as Connection50
                connect Ki1.out "Signal switch2.in1" as Connection106
                connect Ki2.in Junction13 as Connection117
                connect Ki2.out "Signal switch2.in" as Connection105
                connect Kp1.in Junction12 as Connection113
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7704, 8624
                size = 64, 112
            ]

            component gen_c_function "C function1" {
                input_terminals = "real control_op;inherit dg;inherit bi;"
                input_terminals_dimensions = "inherit;inherit;inherit"
                input_terminals_feedthrough = "False;False;False"
                input_terminals_show_labels = "True;True;True"
                output_fnc = "/*Begin code section*/
//this C function is protective function of islanding mode when DER is not active
bloc_island = 0;
if (dg ==1 && control_op == 1) ctrl_mode = control_op;
else if (bi == 1 && control_op == 0) ctrl_mode = control_op;
else if (bi == 0 && dg == 1) ctrl_mode = 1;
else if (bi == 1 && dg == 0) ctrl_mode = 0;
else 
    bloc_island = 1;
/*End code section*/"
                output_terminals = "real ctrl_mode;int bloc_island;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "True;True"
            }
            [
                position = 7008, 8176
                hide_name = True
                size = 104, 80
            ]

            component gen_c_function "Protection of isolation" {
                input_terminals = "real op;inherit blck_m;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'op\', True), (\'blck_m\', True)]"
                output_fnc = "/*Begin code section*/
//thic C function is used to block islandig mode in case when DER is not active
if (blck_m == 1)
    out = 0;
else 
    out = op;
/*End code section*/"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'out\', True)]"
            }
            [
                position = 6984, 8080
                hide_name = True
                size = 48, 48
            ]

            component gen_probe gridform {
            }
            [
                position = 7648, 7976
                rotation = left
            ]

            component gen_probe force_off {
            }
            [
                position = 7992, 8304
            ]

            port control_option {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6728, 8152
            ]

            port operation_mode {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6808, 8016
            ]

            port PCC_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8104, 8240
            ]

            port DER_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8120, 8408
            ]

            port power_meas {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7000, 8512
            ]

            port CB_status {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7000, 8440
            ]

            port fromESS {
                position = left:5
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7088, 9008
            ]

            port fromDG {
                position = left:6
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7088, 9120
            ]

            port MGCC {
                position = left:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7928, 8456
            ]

            tag From20 {
                value = "c_option"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8496
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From24 {
                value = "force_off"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7864, 8488
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From15 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7832, 8488
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto15 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7296, 9120
                hide_name = True
                size = 60, 20
            ]

            tag Goto14 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7296, 9008
                hide_name = True
                size = 60, 20
            ]

            tag Goto4 {
                value = "CB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7168, 8440
                hide_name = True
                size = 60, 20
            ]

            tag From9 {
                value = "isZero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8224
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto5 {
                value = "operation"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7200, 8080
                hide_name = True
                size = 60, 20
            ]

            tag From10 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7872, 8208
                hide_name = True
                size = 60, 20
            ]

            tag From23 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8296
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag From14 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7800, 8488
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From19 {
                value = "ON"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8224
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto8 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8640
                hide_name = True
                size = 60, 20
            ]

            tag From22 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8296
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag From7 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8040
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag Goto2 {
                value = "activate"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7736, 8040
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From2 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8568
                hide_name = True
                size = 60, 20
            ]

            tag From8 {
                value = "operation"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8040
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag Goto9 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8896
                hide_name = True
                size = 60, 20
            ]

            tag From4 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8824
                hide_name = True
                size = 60, 20
            ]

            tag Goto13 {
                value = "ON"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7448, 9064
                hide_name = True
                size = 60, 20
            ]

            tag From12 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7864, 8312
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag From5 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7448, 8824
                hide_name = True
                size = 60, 20
            ]

            tag From17 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8504
                hide_name = True
                size = 60, 20
            ]

            tag From6 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7456, 8568
                hide_name = True
                size = 60, 20
            ]

            tag Goto16 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7744, 8392
                hide_name = True
                size = 60, 20
            ]

            tag Goto12 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7688, 8224
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag From16 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8792
                hide_name = True
                size = 60, 20
            ]

            tag From11 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7872, 8248
                hide_name = True
                size = 60, 20
            ]

            tag Goto7 {
                value = "isZero"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7344, 8736
                hide_name = True
                size = 60, 20
            ]

            tag From18 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8760
                hide_name = True
                size = 60, 20
            ]

            tag Goto11 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7736, 8224
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag Goto6 {
                value = "c_option"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7208, 8160
                hide_name = True
                size = 60, 20
            ]

            tag From13 {
                value = "gridform"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7832, 8312
                rotation = right
                hide_name = True
                size = 60, 20
            ]

            tag Goto17 {
                value = "force_off"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7744, 8424
                hide_name = True
                size = 60, 20
            ]

            tag From1 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8536
                hide_name = True
                size = 60, 20
            ]

            tag From21 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7440, 8496
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto10 {
                value = "gridform"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7688, 8040
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From25 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6872, 8176
                hide_name = True
                size = 60, 20
            ]

            tag From26 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6872, 8200
                hide_name = True
                size = 60, 20
            ]

            tag Goto18 {
                value = "block_mode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7136, 8192
                hide_name = True
                size = 60, 20
            ]

            tag From27 {
                value = "block_mode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6808, 8088
                hide_name = True
                size = 60, 20
            ]

            tag Goto19 {
                value = "mode_choice"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6960, 8016
                hide_name = True
                size = 85, 20
            ]

            tag From28 {
                value = "mode_choice"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7928, 8504
                hide_name = True
                size = 76, 20
            ]

            junction Junction1 sp
            [
                position = 7200, 8608
            ]

            junction Junction2 sp
            [
                position = 7200, 8864
            ]

            junction Junction3 sp
            [
                position = 7984, 8640
            ]

            junction Junction4 sp
            [
                position = 7984, 8896
            ]

            junction Junction8 sp
            [
                position = 7440, 8160
            ]

            junction Junction11 sp
            [
                position = 7120, 8160
            ]

            junction Junction12 sp
            [
                position = 7120, 8080
            ]

            junction Junction13 sp
            [
                position = 7672, 8112
            ]

            junction Junction14 sp
            [
                position = 7912, 8424
            ]

            junction Junction15 sp
            [
                position = 7224, 9008
            ]

            junction Junction16 sp
            [
                position = 7224, 9120
            ]

            junction Junction17 sp
            [
                position = 6888, 8016
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option (0=BESS, 1=DG)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form (0= following, 1=forming)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">5 - MGCC (0=off, 1=on)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">6 - mode_choice (0=grid-tied, 1=islanded)   </p></body></html> ENDCOMMENT 
            [
                position = 8208, 8472
            ]

            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">operation_mode:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    grid tie</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    island</p></body></html> ENDCOMMENT 
            [
                position = 6568, 7952
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">control_option:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    battery inverter forms the grid</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    diesel genset forms the grid</p></body></html> ENDCOMMENT 
            [
                position = 6480, 8200
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PCC_control</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - close command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - open command</p></body></html> ENDCOMMENT 
            [
                position = 8040, 8136
            ]

            comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">power_meas:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - active power</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - reactive power</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html> ENDCOMMENT 
            [
                position = 6920, 8560
            ]

            comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The microgrid controller is responsible for managing the monitoring of the microgrid. </p></body></html> ENDCOMMENT 
            [
                position = 6976, 7864
            ]

            comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Check if enable_fb from BESS or DG is =1 (on), to allow islanding.</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p></body></html> ENDCOMMENT 
            [
                position = 7032, 9168
            ]

            comment Comment9 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">check if control option is in accordance with availabe DG</p></body></html> ENDCOMMENT 
            [
                position = 6800, 8232
            ]

            connect "Bus Join1.out" PCC_control as Connection65
            connect "Bus Split1.out" Junction1 as Connection36
            connect "Bus Split1.out1" Junction2 as Connection39
            connect "Bus Split1.in" "Rate Transition1.out" as Connection15
            connect Constant1.out "Signal switch1.in1" as Connection10
            connect Constant2.out "Signal switch2.in1" as Connection13
            connect Constant3.out "Signal switch4.in1" as Connection21
            connect Constant4.out "Signal switch3.in1" as Connection22
            connect DER_control "Bus Join2.out" as Connection70
            connect From10 "Bus Join1.in" as Connection63
            connect From11 "Bus Join1.in1" as Connection64
            connect From12 "Bus Join2.in" as Connection66
            connect From13 "Bus Join2.in1" as Connection67
            connect From14 "Bus Join2.in2" as Connection68
            connect From15 "Bus Join2.in3" as Connection69
            connect From16 PI_Q.reset as Connection83
            connect From17 PI_P.changeK as Connection89
            connect From18 PI_Q.changeK as Connection90
            connect From2 "Signal switch2.in2" as Connection9
            connect From20 SM2.der_opt_in as Connection107
            connect From21 SM2.CB as Connection108
            connect From22 SM2.dg_on as Connection109
            connect From4 "Signal switch4.in2" as Connection17
            connect From5 "Signal switch3.in2" as Connection25
            connect From6 "Signal switch1.in2" as Connection28
            connect From7 SM.CB as Connection32
            connect From8 SM.operation as Connection35
            connect From9 Junction8 as Connection98
            connect Goto11 SM.close_cb as Connection61
            connect Goto12 SM.open_cb as Connection62
            connect Goto13 "Logical operator1.out" as Connection95
            connect Goto16 SM2.der_opt as Connection111
            connect Goto17 SM2.force_off as Connection113
            connect Goto2 SM.zeropower as Connection29
            connect Goto4 "Rate Transition2.out" as Connection30
            connect Goto7 is_zero.zeroed as Connection42
            connect Goto8 Junction3 as Connection56
            connect Goto9 Junction4 as Connection59
            connect Junction1 "Signal switch1.in" as Connection37
            connect Junction2 "Signal switch3.in" as Connection40
            connect Junction3 "Signal switch2.out" as Connection55
            connect Junction4 "Signal switch4.out" as Connection58
            connect Junction8 zeroed.in as Connection99
            connect PI_P.reset From1 as Connection88
            connect PI_P.In Gain1.out as Connection87
            connect PI_P.Out Gain2.in as Connection86
            connect PI_Q.In Gain3.out as Connection84
            connect PI_Q.Out Gain4.in as Connection85
            connect Poff.in Junction3 as Connection54
            connect Qoff.in Junction4 as Connection57
            connect "Rate Transition1.in" power_meas as Connection14
            connect "Rate Transition2.in" CB_status as Connection31
            connect SM.ON From19 as Connection96
            connect SM.zeroed Junction8 as Connection100
            connect SM2.batt_on From23 as Connection110
            connect "Signal switch1.out" Gain1.in as Connection4
            connect "Signal switch2.in" Gain2.out as Connection5
            connect "Signal switch3.out" Gain3.in as Connection18
            connect "Signal switch4.in" Gain4.out as Connection19
            connect is_zero.P Junction1 as Connection38
            connect is_zero.Q Junction2 as Connection41
            connect From26 "C function1.bi" as Connection116
            connect From25 "C function1.dg" as Connection117
            connect cMode.in Junction11 as Connection118
            connect Junction11 Goto6 as Connection119
            connect "C function1.ctrl_mode" Junction11 as Connection120
            connect Goto18 "C function1.bloc_island" as Connection121
            connect opMode.in Junction12 as Connection123
            connect Junction12 Goto5 as Connection124
            connect "Protection of isolation.out" Junction12 as Connection125
            connect "Protection of isolation.blck_m" From27 as Connection126
            connect control_option "C function1.control_op" as Connection136
            connect Goto10 Junction13 as Connection137
            connect Junction13 SM.gridform as Connection138
            connect gridform.in Junction13 as Connection139
            connect MGCC "Bus Join2.in5" as Connection140
            [
                breakpoints = 7960, 8456; 7960, 8440
            ]
            connect From24 Junction14 as Connection141
            connect Junction14 "Bus Join2.in4" as Connection142
            connect force_off.in Junction14 as Connection143
            connect "Logical operator1.in" Junction15 as Connection145
            connect Junction15 Goto14 as Connection146
            [
                breakpoints = 7224, 9008
            ]
            connect fromESS Junction15 as Connection147
            connect "Logical operator1.in1" Junction16 as Connection153
            connect Junction16 fromDG as Connection154
            [
                breakpoints = 7224, 9120; 7224, 9120
            ]
            connect Goto15 Junction16 as Connection155
            connect "Protection of isolation.op" Junction17 as Connection156
            [
                breakpoints = 6888, 8072
            ]
            connect Junction17 operation_mode as Connection157
            [
                breakpoints = 6888, 8016
            ]
            connect Goto19 Junction17 as Connection158
            connect From28 "Bus Join2.in6" as Connection159

            p_lim = "3000"
            q_lim = "3000"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power Management System</p></body></html>"

                Sb {
                    label = "Microgrid nominal power"
                    widget = edit
                    type = generic
                    default_value = "4.5e6"
                    unit = "VA"
                    group = "General"
                }

                p_lim {
                    label = "Allowed active power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "W"
                    group = "General"
                }

                q_lim {
                    label = "Allowed reactive power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "VAr"
                    group = "General"
                }

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts2"
                    unit = "s"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8224, 7840
            size = 152, 256
        ]

        component src_scada_input MGCC_ON {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 8000, 7936
        ]

        component Subsystem "Battery ESS (Generic) UI1" {
            layout = dynamic
            component gen_probe Enable_fb {
            }
            [
                position = 8016, 7864
            ]

            component src_scada_input Enable {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 7416
            ]

            component src_scada_input "Reset alarms" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 7528
            ]

            component src_scada_input "Frequency droop offset" {
                execution_rate = "inherit"
                unit = "pu"
            }
            [
                position = 8672, 7696
            ]

            component src_scada_input "Max SOC" {
                def_value = "90"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8672, 7976
            ]

            component src_scada_input "Min SOC" {
                def_value = "10"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8672, 8032
            ]

            component src_scada_input "Voltage droop coeff" {
                def_value = "4"
                execution_rate = "inherit"
                max = "100"
                min = "0.0"
                unit = "%"
            }
            [
                position = 8672, 7808
            ]

            component src_scada_input "Frequency droop coeff" {
                def_value = "2"
                execution_rate = "inherit"
                max = "100"
                min = "0.0"
                unit = "%"
            }
            [
                position = 8672, 7752
            ]

            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 7472, 8136
            ]

            component gen_probe Qa_meas_kVAr {
            }
            [
                position = 7440, 8152
            ]

            component gen_probe PFmeas {
            }
            [
                position = 7312, 8216
            ]

            component gen_probe Smeas_kVA {
            }
            [
                position = 7344, 8200
            ]

            component gen_probe Pa_meas_kW {
            }
            [
                position = 7568, 8088
            ]

            component gen_probe Pc_meas_kW {
            }
            [
                position = 7504, 8120
            ]

            component gen_probe Pnom_kW {
            }
            [
                position = 7888, 7928
            ]

            component gen_probe Qref_fb_kVAr {
                streaming_en = "True"
            }
            [
                position = 7920, 7912
            ]

            component gen_probe Snom_kVA {
            }
            [
                position = 7824, 7960
            ]

            component gen_probe Qb_meas_kVAr {
            }
            [
                position = 7408, 8168
            ]

            component gen_probe Fmeas_Hz {
                streaming_en = "True"
            }
            [
                position = 7632, 8056
            ]

            component gen_probe Pref_fb_kW {
                streaming_en = "True"
            }
            [
                position = 7952, 7896
            ]

            component gen_probe Qnom_kVAr {
            }
            [
                position = 7856, 7944
            ]

            component gen_probe Qc_meas_kVAr {
            }
            [
                position = 7376, 8184
            ]

            component "core/DER (Generic) Control Join" "DER (Generic) Control Join1" {
                Converter_mode = "True"
                Enable = "True"
                F_alarm_lower_limit = "True"
                F_alarm_upper_limit = "True"
                Fref = "True"
                Fref_rate_of_change = "True"
                Frequency_droop_coeff = "True"
                Frequency_droop_offset = "True"
                HzWatt_enable = "True"
                I_alarm_upper_limit = "True"
                LVRT_P_set = "True"
                LVRT_Q_contribution = "True"
                LVRT_enable = "True"
                Max_SOC = "True"
                Min_SOC = "True"
                Pref = "True"
                Pref_rate_of_change = "True"
                Qref = "True"
                Qref_rate_of_change = "True"
                Reset_alarms = "True"
                S_alarm_upper_limit = "True"
                V_alarm_lower_limit = "True"
                V_alarm_upper_limit = "True"
                VoltVAr_enable = "True"
                VoltWatt_enable = "True"
                Voltage_droop_coeff = "True"
                Vrms_ref = "True"
                Vrms_ref_rate_of_change = "True"
            }
            [
                position = 9008, 8120
                size = 192, 464
            ]

            component gen_probe Vgrid_rms_meas_kV {
            }
            [
                position = 7664, 8040
            ]

            component gen_probe Pb_meas_kW {
            }
            [
                position = 7536, 8104
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 7600, 8072
            ]

            component gen_probe Fnom_Hz {
            }
            [
                position = 7760, 7992
            ]

            component gen_probe Vnom_LL_V {
            }
            [
                position = 7792, 7976
            ]

            component gen_probe Converter_mode_fb {
            }
            [
                position = 7984, 7880
            ]

            component gen_probe Fref_fb_Hz {
                streaming_en = "True"
            }
            [
                position = 7696, 8024
            ]

            component gen_probe Vrms_ref_fb_V {
                streaming_en = "True"
            }
            [
                position = 7728, 8008
            ]

            component gen_probe MCB_status {
            }
            [
                position = 7120, 8312
            ]

            component gen_probe SOH {
            }
            [
                position = 7216, 8264
            ]

            component gen_probe alarm_msg {
            }
            [
                position = 7056, 8344
            ]

            component gen_probe state {
            }
            [
                position = 7088, 8328
            ]

            component gen_probe Ibatt_A {
            }
            [
                position = 7152, 8296
            ]

            component gen_probe Vbatt_V {
            }
            [
                position = 7184, 8280
            ]

            component gen_probe SOC {
            }
            [
                position = 7248, 8248
            ]

            component gen_probe Vconv_rms_meas_V {
            }
            [
                position = 7280, 8232
            ]

            component src_scada_input "Vrms_ref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8672, 8200
            ]

            component src_scada_input "Fref rate of change" {
                def_value = "0.02"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8672, 8264
            ]

            component src_scada_input "Initial SOC" {
                def_value = "50"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8672, 9184
            ]

            component src_scada_input "Pref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8672, 8096
            ]

            component src_scada_input "Qref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8672, 8152
            ]

            component src_scada_input "Initial SOH" {
                def_value = "90"
                execution_rate = "inherit"
                max = "100"
                min = "0.1"
                unit = "%"
            }
            [
                position = 8672, 9240
            ]

            component "core/DER (Generic) Output Split" "DER (Generic) Output Split1" {
                Batt_cap_nom_Ah = "True"
                Converter_mode_fb = "True"
                Enable_fb = "True"
                Fmeas_Hz = "True"
                Fnom_Hz = "True"
                Fref_fb_Hz = "True"
                Ibatt_A = "True"
                Lvrt_active_status = "True"
                MCB_status = "True"
                PFmeas = "True"
                Pa_meas_kW = "True"
                Pb_meas_kW = "True"
                Pc_meas_kW = "True"
                Pmeas_kW = "True"
                Pnom_kW = "True"
                Pref_fb_kW = "True"
                Qa_meas_kVAr = "True"
                Qb_meas_kVAr = "True"
                Qc_meas_kVAr = "True"
                Qmeas_kVAr = "True"
                Qnom_kVAr = "True"
                Qref_fb_kVAr = "True"
                SOC = "True"
                SOH = "True"
                Smeas_kVA = "True"
                Snom_kVA = "True"
                Vbatt_V = "True"
                Vconv_rms_meas_V = "True"
                Vgrid_rms_meas_kV = "True"
                Vnom_LL_V = "True"
                Vrms_ref_fb_V = "True"
                alarm_msg = "True"
                state = "True"
            }
            [
                position = 6840, 8120
                size = 128, 544
            ]

            component gen_probe Batt_cap_nom_Ah {
            }
            [
                position = 7024, 8360
            ]

            component src_scada_input "LVRT enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 8320
            ]

            component src_scada_input "LVRT Q contribution" {
                def_value = "2"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8672, 8384
            ]

            component src_scada_input "LVRT P set" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8672, 8448
            ]

            component gen_probe LVRT_active_status {
            }
            [
                position = 6992, 8376
            ]

            component "core/DER (Generic) External Join" "DER (Generic) External Join1" {
                Initial_SOC = "True"
                Initial_SOH = "True"
            }
            [
                position = 8936, 9208
                size = 192, 64
            ]

            component src_scada_input "V alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8672, 8504
            ]

            component src_scada_input "V alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8672, 8560
            ]

            component src_scada_input "F alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8672, 8616
            ]

            component src_scada_input "F alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8672, 8672
            ]

            component src_scada_input "S alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8672, 8728
            ]

            component src_scada_input "I alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8672, 8784
            ]

            component src_scada_input "VoltVAr enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 8840
            ]

            component src_scada_input "HzWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 8896
            ]

            component src_scada_input "VoltWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8672, 8968
            ]

            component src_scada_input Qref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 6968, 9096
            ]

            component src_scada_input Pref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 6968, 9016
            ]

            component src_scada_input Fref {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 6968, 8936
            ]

            component src_scada_input Vrms_ref {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 6968, 8856
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_probe w {
                }
                [
                    position = 8400, 8104
                    rotation = left
                ]

                component gen_c_function SM {
                    input_terminals = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit MGCC;inherit m_choice;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;inherit c_mode;"
                    input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    input_terminals_feedthrough = "False;False;False;False;False;False;False;False;False;False;False;False;False"
                    input_terminals_show_labels = "True;True;True;True;True;True;True;True;True;True;True;True;True"
                    output_fnc = "/*Begin code section*/
if(MGCC==1){
    if(DERoption == 0){
        if(formGrid > 0){
            op_mode =1; // enable droop mode
            V = Vref + dV;
            w = wref + dw;
            P = 0;
            Q = 0;
        }
        if(formGrid > 0 && m_choice==0 ){
            op_mode =2; // enable isochronous mode
            V = Vref + dV;
            w = wref + dw;
            P = 0;
            Q = 0;
        }
        else{
            op_mode = 1; // enable droop mode
            V = Vref;
            w = wref;
            P = Pref + Ppms;
            Q = Qref + Qpms;
        }
    }
    else{
        op_mode = 0; // enable following mode
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    op_mode=c_mode;
    V=Vref;
    w=wref;
    P=Pref;
    Q=Qref;
}
/*End code section*/"
                    output_terminals = "inherit op_mode;inherit V;inherit w;inherit P;inherit Q;"
                    output_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    output_terminals_feedthrough = "True;True;True;True;True"
                    output_terminals_show_labels = "False;False;False;False;False"
                }
                [
                    position = 8256, 8232
                    size = 48, 224
                ]

                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7928, 8328
                    hide_name = True
                ]

                component gen_gain Gain5 {
                    gain = "Vb"
                }
                [
                    position = 8008, 8280
                    rotation = left
                    hide_name = True
                ]

                component gen_probe Q_ref {
                }
                [
                    position = 8480, 8408
                    rotation = right
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8048, 8040
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain4 {
                    gain = "fb"
                }
                [
                    position = 7968, 8256
                    rotation = left
                    hide_name = True
                ]

                component gen_probe P_ref {
                }
                [
                    position = 8480, 8208
                    rotation = left
                ]

                component gen_probe V {
                }
                [
                    position = 8368, 8008
                    rotation = left
                ]

                component gen_probe gridForm {
                }
                [
                    position = 8320, 7912
                    rotation = left
                ]

                component gen_bus_split "Bus Split3" {
                    outputs = "7"
                }
                [
                    position = 7912, 7976
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7768, 7976
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7848, 8328
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8264
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8096, 8472
                    rotation = left
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8120, 8440
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8048
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8032, 8536
                    rotation = left
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8064, 8504
                    rotation = left
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 7960
                ]

                port Q {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8344
                ]

                port f_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8152
                ]

                port c_mode {
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8152, 8408
                    rotation = left
                ]

                junction Junction7 sp
                [
                    position = 8320, 7960
                ]

                junction Junction11 sp
                [
                    position = 8368, 8048
                ]

                junction Junction12 sp
                [
                    position = 8400, 8152
                ]

                junction Junction14 sp
                [
                    position = 8480, 8344
                ]

                junction Junction15 sp
                [
                    position = 8480, 8264
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8600, 8136
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8160, 8024
                ]

                comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option (0=BESS, 1=DG)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form (0= following, 1=forming)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">5 - MGCC (0=off, 1=on)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">6 - mode_choice (0=grid-tied, 1=islanded)   </p></body></html> ENDCOMMENT 
                [
                    position = 7504, 8048
                ]

                connect "Bus Split2.out1" Gain5.in as Connection982
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain4.in "Bus Split2.out" as Connection981
                connect Gain5.out SM.dV as Connection983
                connect Junction11 SM.V as Connection975
                connect Junction12 w.in as Connection978
                connect Junction14 Q_ref.in as Connection990
                connect Junction7 SM.op_mode as Connection944
                connect Q Junction14 as Connection989
                connect Qref SM.Qref as Connection953
                connect SM.dw Gain4.out as Connection980
                connect SM.w Junction12 as Connection977
                connect SM.Q Junction14 as Connection991
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect SM.wref wref as Connection956
                connect V.in Junction11 as Connection974
                connect V_ref Junction11 as Connection976
                connect f_ref Junction12 as Connection979
                connect gridForm.in Junction7 as Connection943
                connect opMode Junction7 as Connection945
                connect P Junction15 as Connection1001
                connect Junction15 P_ref.in as Connection1002
                [
                    breakpoints = 8480, 8264
                ]
                connect SM.P Junction15 as Connection1003
                connect "Bus Split3.out4" Termination1.in as Connection1009
                connect c_mode SM.c_mode as Connection1015
                connect "Bus Split3.out" SM.DERoption as Connection1017
                [
                    breakpoints = 8152, 8144
                ]
                connect "Bus Split3.out1" SM.formGrid as Connection1018
                [
                    breakpoints = 8136, 7952; 8136, 8160
                ]
                connect "Bus Split3.out2" SM.Ppms as Connection1019
                [
                    breakpoints = 8120, 7968; 8120, 8176
                ]
                connect "Bus Split3.out3" SM.Qpms as Connection1020
                [
                    breakpoints = 8096, 7984; 8096, 8192
                ]
                connect fromPMS "Bus Split3.in" as Connection1022
                connect SM.m_choice "Bus Split3.out6" as Connection1023
                [
                    breakpoints = 7984, 8216; 7984, 8024
                ]
                connect SM.MGCC "Bus Split3.out5" as Connection1024
                [
                    breakpoints = 8016, 8200; 8016, 8008
                ]

                Ts = "Ts2"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS and Battery inverter</p></body></html>"

                    Vb {
                        label = "Battery inverter nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "General"
                    }

                    fb {
                        label = "Battery inverter nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7168, 8936
                size = 128, 552
            ]

            component gen_gain Gain2 {
                gain = "1/(60*2*np.pi)"
            }
            [
                position = 7288, 8936
                hide_name = True
            ]

            component gen_gain Gain4 {
                gain = "1/1.6e6"
            }
            [
                position = 7296, 9192
                hide_name = True
            ]

            component gen_probe Pref_probe {
            }
            [
                position = 7488, 9032
            ]

            component gen_probe Qref_probe {
            }
            [
                position = 7504, 9152
            ]

            component gen_gain Gain3 {
                gain = "1/1.6e6"
            }
            [
                position = 7288, 9064
                hide_name = True
            ]

            component gen_gain Gain5 {
                gain = "480"
            }
            [
                position = 7032, 8856
                hide_name = True
            ]

            component gen_gain Gain6 {
                gain = "60*2*np.pi"
            }
            [
                position = 7032, 8936
                hide_name = True
            ]

            component gen_gain Gain7 {
                gain = "1.6e6"
            }
            [
                position = 7040, 9016
                hide_name = True
            ]

            component gen_gain Gain8 {
                gain = "1.6e6"
            }
            [
                position = 7040, 9096
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1/480"
            }
            [
                position = 7288, 8808
                hide_name = True
            ]

            component src_scada_input "Converter mode" {
                execution_rate = "inherit"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 6968, 9176
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts2"
            }
            [
                position = 7048, 8776
                size = 32, 32
            ]

            port ui_in {
                label = "ui_in"
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6648, 8120
            ]

            port ui_out {
                label = "ui_out"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9160, 8120
            ]

            port ext {
                label = "ext"
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9168, 9208
            ]

            port from_PCC {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6960, 8776
            ]

            port from_PMS {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6960, 8696
            ]

            port toPCC {
                position = left:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7208, 7816
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7416, 9064
                hide_name = True
                size = 60, 20
            ]

            tag Goto5 {
                value = "Qref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7400, 9192
                hide_name = True
                size = 60, 20
            ]

            tag Goto6 {
                value = "conv mode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7400, 8680
                hide_name = True
                size = 53, 20
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7400, 8808
                hide_name = True
                size = 60, 20
            ]

            tag Goto7 {
                value = "fref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7376, 8936
                hide_name = True
                size = 60, 20
            ]

            tag From1 {
                value = "conv mode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8672, 7480
                hide_name = True
                size = 60, 20
            ]

            tag From2 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8672, 7600
                hide_name = True
                size = 60, 20
            ]

            tag From3 {
                value = "Qref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8672, 7640
                hide_name = True
                size = 60, 20
            ]

            tag From4 {
                value = "fref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8672, 7936
                hide_name = True
                size = 60, 20
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8672, 7896
                hide_name = True
                size = 60, 20
            ]

            junction Junction4 sp
            [
                position = 7344, 9192
            ]

            junction Junction7 sp
            [
                position = 7360, 9064
            ]

            junction Junction10 sp
            [
                position = 7128, 7864
            ]

            connect Converter_mode_fb.in "DER (Generic) Output Split1.Converter_mode_fb" as Connection2932
            connect "DER (Generic) Output Split1.Pref_fb_kW" Pref_fb_kW.in as Connection2933
            connect Qref_fb_kVAr.in "DER (Generic) Output Split1.Qref_fb_kVAr" as Connection2934
            connect "DER (Generic) Output Split1.Pnom_kW" Pnom_kW.in as Connection2935
            connect Qnom_kVAr.in "DER (Generic) Output Split1.Qnom_kVAr" as Connection2936
            connect "DER (Generic) Output Split1.Snom_kVA" Snom_kVA.in as Connection2937
            connect Vnom_LL_V.in "DER (Generic) Output Split1.Vnom_LL_V" as Connection2938
            connect "DER (Generic) Output Split1.Fnom_Hz" Fnom_Hz.in as Connection2939
            connect Vrms_ref_fb_V.in "DER (Generic) Output Split1.Vrms_ref_fb_V" as Connection2940
            connect "DER (Generic) Output Split1.Fref_fb_Hz" Fref_fb_Hz.in as Connection2941
            connect Vgrid_rms_meas_kV.in "DER (Generic) Output Split1.Vgrid_rms_meas_kV" as Connection2942
            connect "DER (Generic) Output Split1.Fmeas_Hz" Fmeas_Hz.in as Connection2943
            connect "DER (Generic) Output Split1.Pmeas_kW" Pmeas_kW.in as Connection2944
            connect Pa_meas_kW.in "DER (Generic) Output Split1.Pa_meas_kW" as Connection2945
            connect "DER (Generic) Output Split1.Pb_meas_kW" Pb_meas_kW.in as Connection2946
            connect Pc_meas_kW.in "DER (Generic) Output Split1.Pc_meas_kW" as Connection2947
            connect "DER (Generic) Output Split1.Qmeas_kVAr" Qmeas_kVAr.in as Connection2948
            connect "DER (Generic) Output Split1.Qa_meas_kVAr" Qa_meas_kVAr.in as Connection2949
            connect Qb_meas_kVAr.in "DER (Generic) Output Split1.Qb_meas_kVAr" as Connection2950
            connect "DER (Generic) Output Split1.Qc_meas_kVAr" Qc_meas_kVAr.in as Connection2951
            connect Smeas_kVA.in "DER (Generic) Output Split1.Smeas_kVA" as Connection2952
            connect "DER (Generic) Output Split1.PFmeas" PFmeas.in as Connection2953
            connect Vconv_rms_meas_V.in "DER (Generic) Output Split1.Vconv_rms_meas_V" as Connection2954
            connect "DER (Generic) Output Split1.SOC" SOC.in as Connection2955
            connect SOH.in "DER (Generic) Output Split1.SOH" as Connection2956
            connect "DER (Generic) Output Split1.Vbatt_V" Vbatt_V.in as Connection2957
            connect Ibatt_A.in "DER (Generic) Output Split1.Ibatt_A" as Connection2958
            connect "DER (Generic) Output Split1.MCB_status" MCB_status.in as Connection2959
            connect state.in "DER (Generic) Output Split1.state" as Connection2960
            connect "DER (Generic) Output Split1.alarm_msg" alarm_msg.in as Connection2961
            connect ui_in "DER (Generic) Output Split1.ui_in" as Connection2962
            connect Batt_cap_nom_Ah.in "DER (Generic) Output Split1.Batt_cap_nom_Ah" as Connection2980
            connect LVRT_active_status.in "DER (Generic) Output Split1.Lvrt_active_status" as Connection2984
            connect "DER (Generic) External Join1.Initial SOC" "Initial SOC.out" as Connection2985
            connect "DER (Generic) External Join1.Initial SOH" "Initial SOH.out" as Connection2986
            connect ext "DER (Generic) External Join1.ext" as Connection2987
            connect "DER (Generic) Control Join1.ui_out" ui_out as Connection2988
            connect Enable.out "DER (Generic) Control Join1.Enable" as Connection2989
            connect "DER (Generic) Control Join1.Reset alarms" "Reset alarms.out" as Connection2991
            [
                position = 0, 0
                breakpoints = 8864, 7936; 8864, 7528
            ]
            connect "Frequency droop offset.out" "DER (Generic) Control Join1.Frequency droop offset" as Connection2994
            [
                position = 0, 0
                breakpoints = 8816, 7696; 8816, 7984
            ]
            connect "Frequency droop coeff.out" "DER (Generic) Control Join1.Frequency droop coeff" as Connection2995
            [
                position = 0, 0
                breakpoints = 8800, 7752; 8800, 8000
            ]
            connect "DER (Generic) Control Join1.Voltage droop coeff" "Voltage droop coeff.out" as Connection2996
            [
                position = 0, 0
                breakpoints = 8784, 8016; 8784, 7808
            ]
            connect "Max SOC.out" "DER (Generic) Control Join1.Max SOC" as Connection2999
            [
                position = 0, 0
                breakpoints = 8736, 7976; 8736, 8064
            ]
            connect "Min SOC.out" "DER (Generic) Control Join1.Min SOC" as Connection3000
            [
                position = 0, 0
                breakpoints = 8720, 8032; 8720, 8080
            ]
            connect "Pref rate of change.out" "DER (Generic) Control Join1.Pref rate of change" as Connection3001
            connect "DER (Generic) Control Join1.Qref rate of change" "Qref rate of change.out" as Connection3002
            connect "DER (Generic) Control Join1.Vrms_ref rate of change" "Vrms_ref rate of change.out" as Connection3003
            [
                position = 0, 0
                breakpoints = 8720, 8128; 8720, 8200
            ]
            connect "DER (Generic) Control Join1.Fref rate of change" "Fref rate of change.out" as Connection3004
            [
                position = 0, 0
                breakpoints = 8728, 8144; 8728, 8264
            ]
            connect "DER (Generic) Control Join1.LVRT enable" "LVRT enable.out" as Connection3005
            [
                position = 0, 0
                breakpoints = 8736, 8160; 8736, 8320
            ]
            connect "DER (Generic) Control Join1.LVRT Q contribution" "LVRT Q contribution.out" as Connection3006
            [
                position = 0, 0
                breakpoints = 8744, 8176; 8744, 8384
            ]
            connect "LVRT P set.out" "DER (Generic) Control Join1.LVRT P set" as Connection3007
            [
                position = 0, 0
                breakpoints = 8752, 8448; 8752, 8192
            ]
            connect "DER (Generic) Control Join1.V alarm upper limit" "V alarm upper limit.out" as Connection3008
            [
                position = 0, 0
                breakpoints = 8768, 8208; 8768, 8504
            ]
            connect "DER (Generic) Control Join1.V alarm lower limit" "V alarm lower limit.out" as Connection3009
            [
                position = 0, 0
                breakpoints = 8784, 8224; 8784, 8560
            ]
            connect "DER (Generic) Control Join1.F alarm upper limit" "F alarm upper limit.out" as Connection3010
            [
                position = 0, 0
                breakpoints = 8800, 8240; 8800, 8616
            ]
            connect "DER (Generic) Control Join1.F alarm lower limit" "F alarm lower limit.out" as Connection3011
            [
                position = 0, 0
                breakpoints = 8816, 8256; 8816, 8672
            ]
            connect "S alarm upper limit.out" "DER (Generic) Control Join1.S alarm upper limit" as Connection3012
            [
                position = 0, 0
                breakpoints = 8832, 8728; 8832, 8272
            ]
            connect "I alarm upper limit.out" "DER (Generic) Control Join1.I alarm upper limit" as Connection3013
            [
                position = 0, 0
                breakpoints = 8848, 8784; 8848, 8288
            ]
            connect "VoltVAr enable.out" "DER (Generic) Control Join1.VoltVAr enable" as Connection3014
            [
                position = 0, 0
                breakpoints = 8864, 8840; 8864, 8304
            ]
            connect "HzWatt enable.out" "DER (Generic) Control Join1.HzWatt enable" as Connection3015
            [
                position = 0, 0
                breakpoints = 8880, 8896; 8880, 8320
            ]
            connect "VoltWatt enable.out" "DER (Generic) Control Join1.VoltWatt enable" as Connection3017
            [
                position = 0, 0
                breakpoints = 8896, 8968; 8896, 8336
            ]
            connect Gain2.in Interface.f_ref as Connection3025
            connect Gain4.in Interface.Q as Connection3031
            connect Goto5 Junction4 as Connection3032
            connect Junction4 Gain4.out as Connection3033
            connect Qref_probe.in Junction4 as Connection3034
            connect Goto4 Junction7 as Connection3035
            connect Junction7 Pref_probe.in as Connection3036
            [
                breakpoints = 7360, 9032; 7456, 9032
            ]
            connect Interface.P Gain3.in as Connection3037
            connect Gain3.out Junction7 as Connection3038
            connect Vrms_ref.out Gain5.in as Connection3039
            connect Gain5.out Interface.Vref as Connection3040
            connect Fref.out Gain6.in as Connection3041
            connect Gain7.out Interface.Pref as Connection3042
            connect Pref.out Gain7.in as Connection3044
            [
                breakpoints = 7016, 9016
            ]
            connect Gain8.in Qref.out as Connection3045
            [
                breakpoints = 7000, 9096
            ]
            connect Gain2.out Goto7 as Connection3050
            connect Interface.V_ref Gain1.in as Connection3051
            connect Gain1.out Goto2 as Connection3052
            connect Enable_fb.in Junction10 as Connection3059
            connect Junction10 "DER (Generic) Output Split1.Enable_fb" as Connection3060
            [
                breakpoints = 7008, 7864; 7008, 7864
            ]
            connect toPCC Junction10 as Connection3061
            connect Gain6.out Interface.wref as Connection3065
            connect Gain8.out Interface.Qref as Connection3066
            connect From1 "DER (Generic) Control Join1.Converter mode" as Connection3068
            [
                breakpoints = 8880, 7480; 8880, 7920
            ]
            connect From2 "DER (Generic) Control Join1.Pref" as Connection3072
            [
                breakpoints = 8848, 7600; 8848, 7952
            ]
            connect From3 "DER (Generic) Control Join1.Qref" as Connection3073
            [
                breakpoints = 8832, 7640; 8832, 7968
            ]
            connect From4 "DER (Generic) Control Join1.Fref" as Connection3074
            [
                breakpoints = 8752, 7936; 8752, 8048
            ]
            connect From5 "DER (Generic) Control Join1.Vrms_ref" as Connection3075
            [
                breakpoints = 8768, 8032
            ]
            connect "Converter mode.out" Interface.c_mode as Connection3077
            connect Interface.opMode Goto6 as Connection3079
            [
                breakpoints = 7296, 8680
            ]
            connect from_PCC "Rate Transition2.in" as Connection3084
            connect "Rate Transition2.out" Interface.fromPCC as Connection3085
            connect from_PMS Interface.fromPMS as Connection3086

            mask {
                icon = "image(\'battery_ess_generic_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface subsystem intended to be used with the \"Battery ESS (Generic)\" component.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                
                ENDCODE
            }
        }
        [
            position = 7776, 8504
            size = 112, 136
        ]

        component Subsystem "Wind Power Plant (Generic) UI1" {
            layout = dynamic
            component gen_probe Enable_fb {
            }
            [
                position = 8464, 7744
            ]

            component gen_probe Qnom_kVAr {
            }
            [
                position = 8368, 7792
            ]

            component src_scada_input Qref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 8648, 7464
            ]

            component gen_probe Vgrid_rms_meas_kV {
                streaming_en = "True"
            }
            [
                position = 8272, 7840
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 8240, 7856
            ]

            component gen_probe Snom_kVA {
            }
            [
                position = 8336, 7808
            ]

            component gen_probe Pnom_kW {
            }
            [
                position = 8400, 7776
            ]

            component gen_probe Qref_fb_kVAr {
                streaming_en = "True"
            }
            [
                position = 8432, 7760
            ]

            component gen_probe Fmeas_Hz {
                streaming_en = "True"
            }
            [
                position = 8304, 7824
            ]

            component src_scada_input "Pcurtailment rate of change" {
                def_value = "0.2"
                execution_rate = "inherit"
                max = "1e3"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8648, 7520
            ]

            component src_scada_input "Wind speed" {
                def_value = "10"
                execution_rate = "inherit"
                max = "1e3"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8056, 8808
            ]

            component src_scada_input "Qref rate of change" {
                def_value = "0.2"
                execution_rate = "inherit"
                max = "1e3"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8648, 7576
            ]

            component src_scada_input Pcurtailment {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 8648, 7408
            ]

            component src_scada_input "Enable storm control" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 7688
            ]

            component src_scada_input "int1 wind speed max" {
                def_value = "30"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8648, 7744
            ]

            component src_scada_input "int2 wind speed max" {
                def_value = "35"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8648, 7800
            ]

            component src_scada_input "P reduction wind speed (SC)" {
                def_value = "19.0"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8648, 7856
            ]

            component src_scada_input "Average wind speed max (SC)" {
                def_value = "25.0"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8648, 7912
            ]

            component src_scada_input "Cut out wind speed (SC)" {
                def_value = "28.0"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8648, 7968
            ]

            component src_scada_input "time interval 1" {
                def_value = "120"
                execution_rate = "inherit"
                min = "0"
                unit = "s"
            }
            [
                position = 8648, 8024
            ]

            component src_scada_input "time interval 2" {
                def_value = "15"
                execution_rate = "inherit"
                min = "0"
                unit = "s"
            }
            [
                position = 8648, 8080
            ]

            component src_scada_input "Recovery time" {
                def_value = "5"
                execution_rate = "inherit"
                min = "0"
                unit = "s"
            }
            [
                position = 8648, 8136
            ]

            component src_scada_input "time interval (SC)" {
                def_value = "600"
                execution_rate = "inherit"
                min = "0"
                unit = "s"
            }
            [
                position = 8648, 8192
            ]

            component src_scada_input "Reset alarms" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 8248
            ]

            component src_scada_input "MPPT rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8648, 7632
            ]

            component gen_probe Pa_meas_kW {
            }
            [
                position = 8208, 7872
            ]

            component gen_probe Pc_meas_kW {
            }
            [
                position = 8144, 7904
            ]

            component gen_probe Pb_meas_kW {
            }
            [
                position = 8176, 7888
            ]

            component gen_probe Smeas_kVA {
                streaming_en = "True"
            }
            [
                position = 7984, 7984
            ]

            component gen_probe PFmeas {
                streaming_en = "True"
            }
            [
                position = 7952, 8000
            ]

            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 8112, 7920
            ]

            component gen_probe Vconv_rms_meas_V {
                streaming_en = "True"
            }
            [
                position = 7920, 8016
            ]

            component gen_probe rotational_speed_RPM {
                streaming_en = "True"
            }
            [
                position = 7888, 8032
            ]

            component gen_probe wind_speed_m_per_s {
                streaming_en = "True"
            }
            [
                position = 7856, 8048
            ]

            component gen_digital_probe turbine_stalled {
            }
            [
                position = 7824, 8064
            ]

            component gen_probe avg_wind_speed_1 {
            }
            [
                position = 7760, 8096
            ]

            component gen_probe avg_wind_speed_2 {
            }
            [
                position = 7728, 8112
            ]

            component gen_probe avg_wind_speed_sc {
            }
            [
                position = 7696, 8128
            ]

            component gen_probe prot_trip {
            }
            [
                position = 7664, 8144
            ]

            component gen_probe P_red_on {
            }
            [
                position = 7632, 8160
            ]

            component gen_probe P_cut_out {
            }
            [
                position = 7600, 8176
            ]

            component gen_probe state {
            }
            [
                position = 7568, 8192
            ]

            component gen_probe alarm_msg {
            }
            [
                position = 7536, 8208
            ]

            component gen_probe pitch_ctrl_on {
            }
            [
                position = 7792, 8080
            ]

            component gen_probe nom_wind_speed_m_per_s {
            }
            [
                position = 7504, 8224
            ]

            component gen_probe MCB_status {
            }
            [
                position = 7464, 8240
            ]

            component gen_probe Qa_meas_kVAr {
            }
            [
                position = 8080, 7936
            ]

            component gen_probe Qb_meas_kVAr {
            }
            [
                position = 8048, 7952
            ]

            component gen_probe Qc_meas_kVAr {
            }
            [
                position = 8016, 7968
            ]

            component "core/DER (Generic) Output Split" "DER (Generic) Output Split1" {
                Enable_fb = "True"
                Fmeas_Hz = "True"
                Lvrt_active_status = "True"
                MCB_status = "True"
                PFmeas = "True"
                P_cut_out = "True"
                P_red_on = "True"
                Pa_meas_kW = "True"
                Pb_meas_kW = "True"
                Pc_meas_kW = "True"
                Pmeas_kW = "True"
                Pnom_kW = "True"
                Qa_meas_kVAr = "True"
                Qb_meas_kVAr = "True"
                Qc_meas_kVAr = "True"
                Qmeas_kVAr = "True"
                Qnom_kVAr = "True"
                Qref_fb_kVAr = "True"
                Smeas_kVA = "True"
                Snom_kVA = "True"
                Vconv_rms_meas_V = "True"
                Vgrid_rms_meas_kV = "True"
                alarm_msg = "True"
                avg_wind_speed_1 = "True"
                avg_wind_speed_2 = "True"
                avg_wind_speed_sc = "True"
                component_select = "Wind Power Plant"
                nom_wind_speed_m_per_s = "True"
                pitch_ctrl_on = "True"
                prot_trip = "True"
                rotational_speed_RPM = "True"
                state = "True"
                turbine_stalled = "True"
                wind_speed_m_per_s = "True"
            }
            [
                position = 7296, 8000
                size = 128, 544
            ]

            component "core/DER (Generic) Control Join" "DER (Generic) Control Join1" {
                Average_wind_speed_max__SC_ = "True"
                Cut_out_wind_speed__SC_ = "True"
                Enable = "True"
                Enable_storm_control = "True"
                F_alarm_lower_limit = "True"
                F_alarm_upper_limit = "True"
                HzWatt_enable = "True"
                I_alarm_upper_limit = "True"
                LVRT_P_set = "True"
                LVRT_Q_contribution = "True"
                LVRT_enable = "True"
                MPPT_rate_of_change = "True"
                P_reduction_wind_speed__SC_ = "True"
                Pcurtailment = "True"
                Pcurtailment_rate_of_change = "True"
                Qref = "True"
                Qref_rate_of_change = "True"
                Recovery_time = "True"
                Reset_alarms = "True"
                S_alarm_upper_limit = "True"
                V_alarm_lower_limit = "True"
                V_alarm_upper_limit = "True"
                VoltVAr_enable = "True"
                VoltWatt_enable = "True"
                component_select = "Wind Power Plant"
                int1_wind_speed_max = "True"
                int2_wind_speed_max = "True"
                time_interval_1 = "True"
                time_interval_2 = "True"
                time_interval__SC_ = "True"
            }
            [
                position = 8952, 8016
                size = 192, 480
            ]

            component "core/DER (Generic) External Join" "DER (Generic) External Join1" {
                Wind_speed = "True"
                component_select = "Wind Power Plant"
            }
            [
                position = 8296, 8808
                size = 192, 64
            ]

            component src_scada_input "V alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8648, 8304
            ]

            component src_scada_input "V alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8648, 8360
            ]

            component src_scada_input "F alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8648, 8416
            ]

            component src_scada_input "F alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8648, 8472
            ]

            component src_scada_input "S alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8648, 8528
            ]

            component src_scada_input "I alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8648, 8584
            ]

            component src_scada_input "LVRT enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 8640
            ]

            component src_scada_input "LVRT Q contribution" {
                def_value = "2"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8648, 8704
            ]

            component src_scada_input "LVRT P set" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8648, 8760
            ]

            component src_scada_input "VoltVAr enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 8816
            ]

            component src_scada_input "HzWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 8872
            ]

            component src_scada_input "VoltWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8648, 8928
            ]

            component gen_probe LVRT_active_status {
            }
            [
                position = 7424, 8256
            ]

            component Subsystem interface {
                layout = dynamic
                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    input_terminals = "real enable_in;inherit force_off;inherit MGCC;"
                    input_terminals_dimensions = "inherit;inherit;inherit"
                    input_terminals_feedthrough = "True;True;True"
                    input_terminals_show_labels = "False;False;False"
                    output_fnc = "/*Begin code section*/
if(MGCC){    
    if(force_off){
        enable = 0;
    }
    else{
        enable = enable_in;
    }
}
else{
    enable=enable_in;
}
/*End code section*/"
                    output_terminals = "real enable;"
                    output_terminals_dimensions = "inherit"
                    output_terminals_feedthrough = "True"
                    output_terminals_show_labels = "False"
                }
                [
                    position = 8336, 8272
                    size = 48, 64
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    execution_rate = "Ts2"
                    outputs = "7"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component gen_terminator Termination5 {
                }
                [
                    position = 8120, 8336
                    rotation = right
                    hide_name = True
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8416, 8272
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option (0=BESS, 1=DG)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form (0= following, 1=forming)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">5 - MGCC (0=off, 1=on)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">6 - mode_choice (0=grid-tied, 1=islanded)   </p></body></html> ENDCOMMENT 
                [
                    position = 7664, 8320
                ]

                connect "Bus Split1.in" fromPMS as Connection880
                connect SM.enable Enable as Connection881
                connect SM.enable_in Enable_in as Connection879
                connect Termination1.in "Bus Split1.out" as Connection874
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect Termination4.in "Bus Split1.out3" as Connection877
                connect "Bus Split1.out5" SM.MGCC as Connection882
                connect "Bus Split1.out4" SM.force_off as Connection883
                connect "Bus Split1.out6" Termination5.in as Connection884
            }
            [
                position = 7584, 8512
                size = 112, 96
            ]

            component src_scada_input Enable {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7440, 8480
            ]

            port ui_in {
                label = "ui_in"
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7128, 8000
            ]

            port ui_out {
                label = "ui_out"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9120, 8016
            ]

            port ext {
                label = "ext"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8456, 8808
            ]

            port from_PMS {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7440, 8544
            ]

            tag Goto2 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7728, 8512
                hide_name = True
                size = 60, 20
            ]

            tag From1 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8648, 7368
                hide_name = True
                size = 60, 20
            ]

            connect Enable_fb.in "DER (Generic) Output Split1.Enable_fb" as Connection3041
            connect "DER (Generic) Output Split1.Qref_fb_kVAr" Qref_fb_kVAr.in as Connection3042
            connect Pnom_kW.in "DER (Generic) Output Split1.Pnom_kW" as Connection3043
            connect "DER (Generic) Output Split1.Qnom_kVAr" Qnom_kVAr.in as Connection3044
            connect Snom_kVA.in "DER (Generic) Output Split1.Snom_kVA" as Connection3045
            connect "DER (Generic) Output Split1.Fmeas_Hz" Fmeas_Hz.in as Connection3046
            connect Vgrid_rms_meas_kV.in "DER (Generic) Output Split1.Vgrid_rms_meas_kV" as Connection3047
            connect "DER (Generic) Output Split1.Pmeas_kW" Pmeas_kW.in as Connection3048
            connect "DER (Generic) Output Split1.Pa_meas_kW" Pa_meas_kW.in as Connection3049
            connect Pb_meas_kW.in "DER (Generic) Output Split1.Pb_meas_kW" as Connection3050
            connect "DER (Generic) Output Split1.Pc_meas_kW" Pc_meas_kW.in as Connection3051
            connect Qmeas_kVAr.in "DER (Generic) Output Split1.Qmeas_kVAr" as Connection3052
            connect "DER (Generic) Output Split1.Qa_meas_kVAr" Qa_meas_kVAr.in as Connection3053
            connect "DER (Generic) Output Split1.Qb_meas_kVAr" Qb_meas_kVAr.in as Connection3054
            connect Qc_meas_kVAr.in "DER (Generic) Output Split1.Qc_meas_kVAr" as Connection3055
            connect "DER (Generic) Output Split1.Smeas_kVA" Smeas_kVA.in as Connection3056
            connect PFmeas.in "DER (Generic) Output Split1.PFmeas" as Connection3057
            connect "DER (Generic) Output Split1.Vconv_rms_meas_V" Vconv_rms_meas_V.in as Connection3058
            connect rotational_speed_RPM.in "DER (Generic) Output Split1.rotational_speed_RPM" as Connection3059
            connect "DER (Generic) Output Split1.wind_speed_m_per_s" wind_speed_m_per_s.in as Connection3060
            connect turbine_stalled.in "DER (Generic) Output Split1.turbine_stalled" as Connection3061
            connect "DER (Generic) Output Split1.pitch_ctrl_on" pitch_ctrl_on.in as Connection3062
            connect avg_wind_speed_1.in "DER (Generic) Output Split1.avg_wind_speed_1" as Connection3063
            connect "DER (Generic) Output Split1.avg_wind_speed_2" avg_wind_speed_2.in as Connection3064
            connect avg_wind_speed_sc.in "DER (Generic) Output Split1.avg_wind_speed_sc" as Connection3065
            connect "DER (Generic) Output Split1.prot_trip" prot_trip.in as Connection3066
            connect P_red_on.in "DER (Generic) Output Split1.P_red_on" as Connection3067
            connect "DER (Generic) Output Split1.P_cut_out" P_cut_out.in as Connection3068
            connect state.in "DER (Generic) Output Split1.state" as Connection3069
            connect "DER (Generic) Output Split1.alarm_msg" alarm_msg.in as Connection3070
            connect nom_wind_speed_m_per_s.in "DER (Generic) Output Split1.nom_wind_speed_m_per_s" as Connection3071
            connect "DER (Generic) Output Split1.MCB_status" MCB_status.in as Connection3072
            connect ui_in "DER (Generic) Output Split1.ui_in" as Connection3073
            connect Pcurtailment.out "DER (Generic) Control Join1.Pcurtailment" as Connection3075
            connect Qref.out "DER (Generic) Control Join1.Qref" as Connection3076
            connect "Pcurtailment rate of change.out" "DER (Generic) Control Join1.Pcurtailment rate of change" as Connection3077
            connect "Qref rate of change.out" "DER (Generic) Control Join1.Qref rate of change" as Connection3078
            connect "MPPT rate of change.out" "DER (Generic) Control Join1.MPPT rate of change" as Connection3079
            connect "Enable storm control.out" "DER (Generic) Control Join1.Enable storm control" as Connection3080
            connect "int1 wind speed max.out" "DER (Generic) Control Join1.int1 wind speed max" as Connection3081
            connect "int2 wind speed max.out" "DER (Generic) Control Join1.int2 wind speed max" as Connection3082
            connect "P reduction wind speed (SC).out" "DER (Generic) Control Join1.P reduction wind speed (SC)" as Connection3083
            connect "Reset alarms.out" "DER (Generic) Control Join1.Reset alarms" as Connection3084
            connect "time interval (SC).out" "DER (Generic) Control Join1.time interval (SC)" as Connection3085
            connect "Recovery time.out" "DER (Generic) Control Join1.Recovery time" as Connection3086
            connect "time interval 2.out" "DER (Generic) Control Join1.time interval 2" as Connection3087
            connect "time interval 1.out" "DER (Generic) Control Join1.time interval 1" as Connection3088
            connect "Cut out wind speed (SC).out" "DER (Generic) Control Join1.Cut out wind speed (SC)" as Connection3089
            connect "Average wind speed max (SC).out" "DER (Generic) Control Join1.Average wind speed max (SC)" as Connection3090
            connect ui_out "DER (Generic) Control Join1.ui_out" as Connection3091
            connect "DER (Generic) External Join1.Wind speed" "Wind speed.out" as Connection3092
            connect "DER (Generic) External Join1.ext" ext as Connection3093
            connect "V alarm upper limit.out" "DER (Generic) Control Join1.V alarm upper limit" as Connection3094
            connect "V alarm lower limit.out" "DER (Generic) Control Join1.V alarm lower limit" as Connection3095
            connect "F alarm upper limit.out" "DER (Generic) Control Join1.F alarm upper limit" as Connection3096
            connect "F alarm lower limit.out" "DER (Generic) Control Join1.F alarm lower limit" as Connection3097
            connect "S alarm upper limit.out" "DER (Generic) Control Join1.S alarm upper limit" as Connection3098
            connect "I alarm upper limit.out" "DER (Generic) Control Join1.I alarm upper limit" as Connection3099
            connect "LVRT enable.out" "DER (Generic) Control Join1.LVRT enable" as Connection3100
            connect "LVRT Q contribution.out" "DER (Generic) Control Join1.LVRT Q contribution" as Connection3101
            connect "LVRT P set.out" "DER (Generic) Control Join1.LVRT P set" as Connection3102
            connect "VoltVAr enable.out" "DER (Generic) Control Join1.VoltVAr enable" as Connection3103
            connect "HzWatt enable.out" "DER (Generic) Control Join1.HzWatt enable" as Connection3104
            connect "VoltWatt enable.out" "DER (Generic) Control Join1.VoltWatt enable" as Connection3105
            connect LVRT_active_status.in "DER (Generic) Output Split1.Lvrt_active_status" as Connection3106
            connect Goto2 interface.Enable as Connection874
            connect from_PMS interface.fromPMS as Connection873
            connect Enable.out interface.Enable_in as Connection3107
            connect From1 "DER (Generic) Control Join1.Enable" as Connection3108

            mask {
                icon = "image(\'wind_power_plant_generic_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface Subsystem</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                
                ENDCODE
            }
        }
        [
            position = 8192, 8504
            size = 112, 136
        ]

        component Subsystem "PV Power Plant (Generic) UI1" {
            layout = dynamic
            component src_scada_input Pcurtailment {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 8528, 7768
            ]

            component gen_probe PFmeas {
            }
            [
                position = 7688, 8096
            ]

            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 7848, 8016
            ]

            component gen_probe Pnom_kW {
            }
            [
                position = 8136, 7872
            ]

            component gen_probe Qnom_kVAr {
            }
            [
                position = 8104, 7888
            ]

            component gen_probe Enable_fb {
            }
            [
                position = 8232, 7824
            ]

            component gen_probe Qref_fb_kVAr {
                streaming_en = "True"
            }
            [
                position = 8168, 7856
            ]

            component gen_probe Smeas_kVA {
            }
            [
                position = 7720, 8080
            ]

            component gen_probe Snom_kVA {
            }
            [
                position = 8072, 7904
            ]

            component src_scada_input Qref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 8528, 7824
            ]

            component gen_probe Vgrid_rms_meas_kV {
            }
            [
                position = 8040, 7920
            ]

            component gen_probe Pref_fb_kW {
                streaming_en = "True"
            }
            [
                position = 8200, 7840
            ]

            component src_scada_input "Reset alarms" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8528, 7712
            ]

            component gen_probe state {
            }
            [
                position = 7528, 8176
            ]

            component gen_probe Fmeas_Hz {
            }
            [
                position = 8008, 7936
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 7976, 7952
            ]

            component gen_probe Pa_meas_kW {
            }
            [
                position = 7944, 7968
            ]

            component gen_probe Pb_meas_kW {
            }
            [
                position = 7912, 7984
            ]

            component gen_probe Pc_meas_kW {
            }
            [
                position = 7880, 8000
            ]

            component gen_probe Qb_meas_kVAr {
            }
            [
                position = 7784, 8048
            ]

            component gen_probe Qc_meas_kVAr {
            }
            [
                position = 7752, 8064
            ]

            component gen_probe Qa_meas_kVAr {
            }
            [
                position = 7816, 8032
            ]

            component gen_probe alarm_msg {
            }
            [
                position = 7496, 8192
            ]

            component gen_probe Available_Ppv_kW {
            }
            [
                position = 7624, 8128
            ]

            component gen_probe curtailment_status {
            }
            [
                position = 7592, 8144
            ]

            component gen_probe Vconv_rms_meas_V {
            }
            [
                position = 7656, 8112
            ]

            component src_scada_input "Pcurtailment rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8528, 7880
            ]

            component src_scada_input "Qref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8528, 7936
            ]

            component gen_probe MCB_status {
            }
            [
                position = 7568, 8160
            ]

            component src_scada_input Temperature {
                def_value = "25"
                execution_rate = "inherit"
                unit = "°C"
            }
            [
                position = 7984, 8584
            ]

            component src_scada_input Irradiance {
                def_value = "1000"
                execution_rate = "inherit"
                unit = "W/m2"
            }
            [
                position = 7984, 8640
            ]

            component src_scada_input "MPPT rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8528, 7992
            ]

            component "core/DER (Generic) Output Split" "DER (Generic) Output Split1" {
                Available_Ppv_kW = "True"
                Enable_fb = "True"
                Fmeas_Hz = "True"
                Lvrt_active_status = "True"
                MCB_status = "True"
                PFmeas = "True"
                Pa_meas_kW = "True"
                Pb_meas_kW = "True"
                Pc_meas_kW = "True"
                Pmeas_kW = "True"
                Pnom_kW = "True"
                Pref_fb_kW = "True"
                Qa_meas_kVAr = "True"
                Qb_meas_kVAr = "True"
                Qc_meas_kVAr = "True"
                Qmeas_kVAr = "True"
                Qnom_kVAr = "True"
                Qref_fb_kVAr = "True"
                Smeas_kVA = "True"
                Snom_kVA = "True"
                Vconv_rms_meas_V = "True"
                Vgrid_rms_meas_kV = "True"
                alarm_msg = "True"
                component_select = "PV Power Plant"
                curtailment_status = "True"
                state = "True"
            }
            [
                position = 7280, 8016
                size = 128, 416
            ]

            component "core/DER (Generic) Control Join" "DER (Generic) Control Join1" {
                Enable = "True"
                F_alarm_lower_limit = "True"
                F_alarm_upper_limit = "True"
                HzWatt_enable = "True"
                I_alarm_upper_limit = "True"
                LVRT_P_set = "True"
                LVRT_Q_contribution = "True"
                LVRT_enable = "True"
                MPPT_rate_of_change = "True"
                Pcurtailment = "True"
                Pcurtailment_rate_of_change = "True"
                Qref = "True"
                Qref_rate_of_change = "True"
                Reset_alarms = "True"
                S_alarm_upper_limit = "True"
                V_alarm_lower_limit = "True"
                V_alarm_upper_limit = "True"
                VoltVAr_enable = "True"
                VoltWatt_enable = "True"
                component_select = "PV Power Plant"
            }
            [
                position = 8792, 8120
                size = 192, 320
            ]

            component src_scada_input "LVRT enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8528, 8048
            ]

            component src_scada_input "LVRT Q contribution" {
                def_value = "2"
                execution_rate = "inherit"
                max = "100"
                min = "0"
                unit = "%"
            }
            [
                position = 8528, 8112
            ]

            component src_scada_input "LVRT P set" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8528, 8168
            ]

            component gen_probe LVRT_active_status {
            }
            [
                position = 7464, 8208
            ]

            component "core/DER (Generic) External Join" "DER (Generic) External Join1" {
                Irradiance = "True"
                Temperature = "True"
                component_select = "PV Power Plant"
            }
            [
                position = 8208, 8608
                size = 192, 64
            ]

            component src_scada_input "V alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8528, 8224
            ]

            component src_scada_input "V alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8528, 8280
            ]

            component src_scada_input "F alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8528, 8336
            ]

            component src_scada_input "F alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8528, 8392
            ]

            component src_scada_input "S alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8528, 8448
            ]

            component src_scada_input "I alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8528, 8504
            ]

            component src_scada_input "VoltVAr enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8528, 8560
            ]

            component src_scada_input "HzWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8528, 8616
            ]

            component src_scada_input "VoltWatt enable" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8528, 8672
            ]

            component Subsystem interface {
                layout = dynamic
                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    input_terminals = "real enable_in;inherit force_off;inherit MGCC;"
                    input_terminals_dimensions = "inherit;inherit;inherit"
                    input_terminals_feedthrough = "True;True;True"
                    input_terminals_show_labels = "False;False;False"
                    output_fnc = "/*Begin code section*/
if(MGCC){    
    if(force_off){
        enable = 0;
    }
    else{
        enable = enable_in;
    }
}
else{
    enable=enable_in;
}
/*End code section*/"
                    output_terminals = "real enable;"
                    output_terminals_dimensions = "inherit"
                    output_terminals_feedthrough = "True"
                    output_terminals_show_labels = "False"
                }
                [
                    position = 8336, 8272
                    size = 48, 64
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    execution_rate = "Ts2"
                    outputs = "7"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component gen_terminator Termination5 {
                }
                [
                    position = 8128, 8336
                    rotation = right
                    hide_name = True
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8416, 8272
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option (0=BESS, 1=DG)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form (0= following, 1=forming)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">5 - MGCC (0=off, 1=on)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">6 - mode_choice (0=grid-tied, 1=islanded)   </p></body></html> ENDCOMMENT 
                [
                    position = 7656, 8344
                ]

                connect "Bus Split1.in" fromPMS as Connection880
                connect SM.enable Enable as Connection881
                connect SM.enable_in Enable_in as Connection879
                connect Termination1.in "Bus Split1.out" as Connection874
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect Termination4.in "Bus Split1.out3" as Connection877
                connect "Bus Split1.out5" SM.MGCC as Connection882
                connect "Bus Split1.out4" SM.force_off as Connection883
                connect "Bus Split1.out6" Termination5.in as Connection884
            }
            [
                position = 7328, 8456
                size = 112, 96
            ]

            component src_scada_input Enable {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7184, 8424
            ]

            port ui_in {
                label = "ui_in"
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7104, 8016
            ]

            port ui_out {
                label = "ui_out"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8944, 8120
            ]

            port ext {
                label = "ext"
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8384, 8608
            ]

            port from_PMS {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7184, 8488
            ]

            tag From1 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8520, 7648
                size = 60, 20
            ]

            tag Goto2 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8456
                hide_name = True
                size = 60, 20
            ]

            connect ui_in "DER (Generic) Output Split1.ui_in" as Connection2919
            connect "DER (Generic) Output Split1.Enable_fb" Enable_fb.in as Connection2920
            connect Pref_fb_kW.in "DER (Generic) Output Split1.Pref_fb_kW" as Connection2921
            connect "DER (Generic) Output Split1.Qref_fb_kVAr" Qref_fb_kVAr.in as Connection2922
            connect Pnom_kW.in "DER (Generic) Output Split1.Pnom_kW" as Connection2923
            connect "DER (Generic) Output Split1.Qnom_kVAr" Qnom_kVAr.in as Connection2924
            connect "DER (Generic) Output Split1.Snom_kVA" Snom_kVA.in as Connection2925
            connect Vgrid_rms_meas_kV.in "DER (Generic) Output Split1.Vgrid_rms_meas_kV" as Connection2926
            connect "DER (Generic) Output Split1.Fmeas_Hz" Fmeas_Hz.in as Connection2927
            connect "DER (Generic) Output Split1.Pmeas_kW" Pmeas_kW.in as Connection2928
            connect Pa_meas_kW.in "DER (Generic) Output Split1.Pa_meas_kW" as Connection2929
            connect "DER (Generic) Output Split1.Pb_meas_kW" Pb_meas_kW.in as Connection2930
            connect Pc_meas_kW.in "DER (Generic) Output Split1.Pc_meas_kW" as Connection2931
            connect "DER (Generic) Output Split1.Qmeas_kVAr" Qmeas_kVAr.in as Connection2932
            connect Qa_meas_kVAr.in "DER (Generic) Output Split1.Qa_meas_kVAr" as Connection2933
            connect "DER (Generic) Output Split1.Qb_meas_kVAr" Qb_meas_kVAr.in as Connection2934
            connect Qc_meas_kVAr.in "DER (Generic) Output Split1.Qc_meas_kVAr" as Connection2935
            connect "DER (Generic) Output Split1.Smeas_kVA" Smeas_kVA.in as Connection2936
            connect "DER (Generic) Output Split1.PFmeas" PFmeas.in as Connection2937
            connect Vconv_rms_meas_V.in "DER (Generic) Output Split1.Vconv_rms_meas_V" as Connection2938
            connect "DER (Generic) Output Split1.Available_Ppv_kW" Available_Ppv_kW.in as Connection2939
            connect curtailment_status.in "DER (Generic) Output Split1.curtailment_status" as Connection2940
            connect "DER (Generic) Output Split1.MCB_status" MCB_status.in as Connection2941
            connect state.in "DER (Generic) Output Split1.state" as Connection2942
            connect "DER (Generic) Output Split1.alarm_msg" alarm_msg.in as Connection2943
            connect ui_out "DER (Generic) Control Join1.ui_out" as Connection2944
            connect Qref.out "DER (Generic) Control Join1.Qref" as Connection2945
            connect "Reset alarms.out" "DER (Generic) Control Join1.Reset alarms" as Connection2947
            connect Pcurtailment.out "DER (Generic) Control Join1.Pcurtailment" as Connection2948
            connect "Pcurtailment rate of change.out" "DER (Generic) Control Join1.Pcurtailment rate of change" as Connection2949
            connect "Qref rate of change.out" "DER (Generic) Control Join1.Qref rate of change" as Connection2950
            connect "DER (Generic) Control Join1.MPPT rate of change" "MPPT rate of change.out" as Connection2951
            connect "LVRT enable.out" "DER (Generic) Control Join1.LVRT enable" as Connection2952
            connect "LVRT Q contribution.out" "DER (Generic) Control Join1.LVRT Q contribution" as Connection2953
            connect "LVRT P set.out" "DER (Generic) Control Join1.LVRT P set" as Connection2954
            connect LVRT_active_status.in "DER (Generic) Output Split1.Lvrt_active_status" as Connection2955
            connect "DER (Generic) External Join1.ext" ext as Connection2956
            connect Temperature.out "DER (Generic) External Join1.Temperature" as Connection2957
            connect Irradiance.out "DER (Generic) External Join1.Irradiance" as Connection2958
            connect "V alarm upper limit.out" "DER (Generic) Control Join1.V alarm upper limit" as Connection2959
            connect "V alarm lower limit.out" "DER (Generic) Control Join1.V alarm lower limit" as Connection2960
            connect "F alarm upper limit.out" "DER (Generic) Control Join1.F alarm upper limit" as Connection2961
            connect "F alarm lower limit.out" "DER (Generic) Control Join1.F alarm lower limit" as Connection2962
            connect "S alarm upper limit.out" "DER (Generic) Control Join1.S alarm upper limit" as Connection2963
            connect "I alarm upper limit.out" "DER (Generic) Control Join1.I alarm upper limit" as Connection2964
            connect "VoltVAr enable.out" "DER (Generic) Control Join1.VoltVAr enable" as Connection2965
            connect "HzWatt enable.out" "DER (Generic) Control Join1.HzWatt enable" as Connection2966
            connect "VoltWatt enable.out" "DER (Generic) Control Join1.VoltWatt enable" as Connection2967
            connect From1 "DER (Generic) Control Join1.Enable" as Connection2969
            connect Goto2 interface.Enable as Connection874
            connect from_PMS interface.fromPMS as Connection873
            connect Enable.out interface.Enable_in as Connection3107

            mask {
                icon = "image(\'pv_plant_generic_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface subsystem intended to be used with \"PV Power Plant (Generic)\" component.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                
                ENDCODE
            }
        }
        [
            position = 8664, 8504
            size = 104, 136
        ]

        component Subsystem "Diesel Genset (Generic) UI1" {
            layout = dynamic
            component src_scada_input Enable {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8608, 7952
            ]

            component src_scada_input "Frequency droop offset" {
                execution_rate = "inherit"
                unit = "pu"
            }
            [
                position = 8608, 8336
            ]

            component src_scada_input "Voltage droop coeff" {
                def_value = "4"
                execution_rate = "inherit"
                max = "100"
                min = "0.0"
                unit = "%"
            }
            [
                position = 8608, 8448
            ]

            component src_scada_input "Frequency droop coeff" {
                def_value = "2"
                execution_rate = "inherit"
                max = "100"
                min = "0.0"
                unit = "%"
            }
            [
                position = 8608, 8392
            ]

            component src_scada_input "Vrms_ref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8608, 8616
            ]

            component src_scada_input "Fref rate of change" {
                def_value = "0.02"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8608, 8672
            ]

            component src_scada_input "Pref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8608, 8504
            ]

            component src_scada_input "Qref rate of change" {
                def_value = "0.1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu/s"
            }
            [
                position = 8608, 8560
            ]

            component src_scada_input "Reset alarms" {
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8608, 8008
            ]

            component "core/DER (Generic) Control Join" "DER (Generic) Control Join1" {
                Drift_alarm_freq_bound = "True"
                Enable = "True"
                Fref = "True"
                Fref_rate_of_change = "True"
                Frequency_droop_coeff = "True"
                Frequency_droop_offset = "True"
                I_alarm_timeout = "True"
                I_alarm_upper_limit = "True"
                Operation_mode = "True"
                Pref = "True"
                Pref_rate_of_change = "True"
                Qref = "True"
                Qref_rate_of_change = "True"
                Reset_alarms = "True"
                Sync_timeout = "True"
                V_alarm_lower_limit = "True"
                Voltage_droop_coeff = "True"
                Vrms_ref = "True"
                Vrms_ref_rate_of_change = "True"
                component_select = "Diesel Genset"
            }
            [
                position = 8832, 8456
                size = 192, 320
            ]

            component "core/DER (Generic) External Join" "DER (Generic) External Join1" {
                component_select = "Diesel Genset"
            }
            [
                position = 8840, 9120
                size = 192, 64
            ]

            component src_scada_input "I alarm upper limit" {
                def_value = "1.5"
                execution_rate = "inherit"
                min = "1"
                unit = "pu"
            }
            [
                position = 8608, 8728
            ]

            component src_scada_input "I alarm timeout" {
                def_value = "10"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 8608, 8784
            ]

            component src_scada_input "V alarm lower limit" {
                def_value = "0.5"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8608, 8840
            ]

            component src_scada_input "Drift alarm frequency bound" {
                def_value = "0.2"
                execution_rate = "inherit"
                max = "1"
                min = "0"
                unit = "pu"
            }
            [
                position = 8608, 8896
            ]

            component src_scada_input "Sync timeout" {
                def_value = "20"
                execution_rate = "inherit"
                min = "0"
                unit = "s"
            }
            [
                position = 8608, 8952
            ]

            component src_scada_input Qref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 7336, 9032
            ]

            component src_scada_input Pref {
                execution_rate = "inherit"
                max = "1e8"
                min = "-1e8"
                unit = "pu"
            }
            [
                position = 7336, 8960
            ]

            component src_scada_input Fref {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 7336, 8888
            ]

            component src_scada_input Vrms_ref {
                def_value = "1"
                execution_rate = "inherit"
                min = "0"
                unit = "pu"
            }
            [
                position = 7336, 8816
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_probe w {
                }
                [
                    position = 8400, 8104
                    rotation = left
                ]

                component gen_c_function SM {
                    input_terminals = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit MGCC;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;inherit c_mode;"
                    input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    input_terminals_feedthrough = "False;False;False;False;False;False;False;False;False;False;False;False"
                    input_terminals_show_labels = "True;True;True;True;True;True;True;True;True;True;True;True"
                    output_fnc = "/*Begin code section*/
if(MGCC==1){
    if(DERoption == 1){
        if(formGrid > 0){
            op_mode =1; // enable isochronous mode
            V = Vref + dV;
            w = wref + dw;
            P = 0;
            Q = 0;
        }
        else{
            op_mode = 2; // enable grid-following mode
            V = Vref;
            w = wref;
            P = Pref + Ppms;
            Q = Qref + Qpms;
        }
    }
    else{
        op_mode = 2; // enable grid-following mode
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    op_mode=c_mode;
    V=Vref;
    w=wref;
    P=Pref;
    Q=Qref;
}
/*End code section*/"
                    output_terminals = "inherit op_mode;inherit V;inherit w;inherit P;inherit Q;"
                    output_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    output_terminals_feedthrough = "True;True;True;True;True"
                    output_terminals_show_labels = "False;False;False;False;False"
                }
                [
                    position = 8256, 8232
                    size = 48, 208
                ]

                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7928, 8328
                    hide_name = True
                ]

                component gen_gain Gain5 {
                    gain = "Vb"
                }
                [
                    position = 8008, 8280
                    rotation = left
                    hide_name = True
                ]

                component gen_probe Q_ref {
                }
                [
                    position = 8480, 8408
                    rotation = right
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8048, 8040
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain4 {
                    gain = "fb"
                }
                [
                    position = 7968, 8256
                    rotation = left
                    hide_name = True
                ]

                component gen_probe P_ref {
                }
                [
                    position = 8480, 8208
                    rotation = left
                ]

                component gen_probe V {
                }
                [
                    position = 8368, 8008
                    rotation = left
                ]

                component gen_probe gridForm {
                }
                [
                    position = 8320, 7912
                    rotation = left
                ]

                component gen_bus_split "Bus Split3" {
                    outputs = "7"
                }
                [
                    position = 7912, 7984
                ]

                component gen_probe DER_option {
                }
                [
                    position = 8040, 7888
                ]

                component gen_probe forming {
                }
                [
                    position = 8040, 7808
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 7976, 8072
                    rotation = right
                    hide_name = True
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7808, 7984
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7848, 8328
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8264
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8432
                    rotation = left
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8152, 8400
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8048
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8064, 8496
                    rotation = left
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8096, 8464
                    rotation = left
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 7960
                ]

                port Q {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8344
                ]

                port f_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8152
                ]

                port c_mode {
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8184, 8368
                    rotation = left
                ]

                junction Junction7 sp
                [
                    position = 8320, 7960
                ]

                junction Junction11 sp
                [
                    position = 8368, 8048
                ]

                junction Junction12 sp
                [
                    position = 8400, 8152
                ]

                junction Junction14 sp
                [
                    position = 8480, 8344
                ]

                junction Junction15 sp
                [
                    position = 8480, 8264
                ]

                junction Junction16 sp
                [
                    position = 7984, 7936
                ]

                junction Junction17 sp
                [
                    position = 7968, 7952
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8600, 8136
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8160, 8024
                ]

                comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option (0=BESS, 1=DG)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form (0= following, 1=forming)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">5 - MGCC (0=off, 1=on)</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">6 - mode_choice (0=grid-tied, 1=islanded)   </p></body></html> ENDCOMMENT 
                [
                    position = 7480, 8064
                ]

                connect "Bus Split2.out1" Gain5.in as Connection982
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain4.in "Bus Split2.out" as Connection981
                connect Gain5.out SM.dV as Connection983
                connect Junction11 SM.V as Connection975
                connect Junction12 w.in as Connection978
                connect Junction14 Q_ref.in as Connection990
                connect Junction7 SM.op_mode as Connection944
                connect Q Junction14 as Connection989
                connect Qref SM.Qref as Connection953
                connect SM.dw Gain4.out as Connection980
                connect SM.w Junction12 as Connection977
                connect SM.Q Junction14 as Connection991
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect SM.wref wref as Connection956
                connect V.in Junction11 as Connection974
                connect V_ref Junction11 as Connection976
                connect f_ref Junction12 as Connection979
                connect gridForm.in Junction7 as Connection943
                connect opMode Junction7 as Connection945
                connect P Junction15 as Connection1001
                connect Junction15 P_ref.in as Connection1002
                [
                    breakpoints = 8480, 8264
                ]
                connect SM.P Junction15 as Connection1003
                connect "Bus Split3.out4" Termination1.in as Connection1009
                connect c_mode SM.c_mode as Connection1015
                connect "Bus Split3.out5" SM.MGCC as Connection1016
                [
                    breakpoints = 8016, 8016; 8016, 8208
                ]
                connect "Bus Split3.out2" SM.Ppms as Connection1019
                [
                    breakpoints = 8120, 7968; 8120, 8176
                ]
                connect "Bus Split3.out3" SM.Qpms as Connection1020
                [
                    breakpoints = 8096, 7984; 8096, 8192
                ]
                connect "Bus Split3.out" Junction16 as Connection1021
                connect Junction16 SM.DERoption as Connection1022
                [
                    breakpoints = 7984, 7936; 8152, 7936
                ]
                connect DER_option.in Junction16 as Connection1023
                connect "Bus Split3.out1" Junction17 as Connection1024
                connect Junction17 SM.formGrid as Connection1025
                [
                    breakpoints = 8136, 7952; 8136, 8160
                ]
                connect forming.in Junction17 as Connection1026
                connect fromPMS "Bus Split3.in" as Connection1027
                connect "Bus Split3.out6" Termination2.in as Connection1028

                Ts = "Ts2"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS and Battery inverter</p></body></html>"

                    Vb {
                        label = "Battery inverter nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "General"
                    }

                    fb {
                        label = "Battery inverter nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7536, 8888
                size = 128, 472
            ]

            component gen_gain Gain2 {
                gain = "1/(60*2*np.pi)"
            }
            [
                position = 7656, 8888
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts2"
            }
            [
                position = 7400, 8744
                hide_name = True
                size = 32, 32
            ]

            component gen_gain Gain4 {
                gain = "1/2.2e6"
            }
            [
                position = 7664, 9096
                hide_name = True
            ]

            component gen_probe Pref_probe {
            }
            [
                position = 7856, 8960
            ]

            component gen_probe Qref_probe {
            }
            [
                position = 7872, 9056
            ]

            component gen_gain Gain3 {
                gain = "1/2.2e6"
            }
            [
                position = 7656, 8992
                hide_name = True
            ]

            component gen_gain Gain5 {
                gain = "480"
            }
            [
                position = 7400, 8816
                hide_name = True
            ]

            component gen_gain Gain6 {
                gain = "60*2*np.pi"
            }
            [
                position = 7400, 8888
                hide_name = True
            ]

            component gen_gain Gain7 {
                gain = "2.2e6"
            }
            [
                position = 7408, 8960
                hide_name = True
            ]

            component gen_gain Gain8 {
                gain = "2.2e6"
            }
            [
                position = 7408, 9032
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1/480"
            }
            [
                position = 7656, 8784
                hide_name = True
            ]

            component src_scada_input "Operation mode" {
                execution_rate = "inherit"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 7336, 9104
            ]

            component gen_probe Vrms_ref_fb_V {
                streaming_en = "True"
            }
            [
                position = 8008, 8184
            ]

            component gen_probe Enable_fb {
            }
            [
                position = 8104, 8136
            ]

            component gen_probe Smeas_kVA {
                streaming_en = "True"
            }
            [
                position = 7720, 8328
            ]

            component gen_probe Qnom_kVAr {
            }
            [
                position = 7912, 8232
            ]

            component gen_probe PFmeas {
                streaming_en = "True"
            }
            [
                position = 7688, 8344
            ]

            component gen_probe Pref_fb_kW {
                streaming_en = "True"
            }
            [
                position = 8072, 8152
            ]

            component gen_probe Fref_fb_Hz {
                streaming_en = "True"
            }
            [
                position = 7976, 8200
            ]

            component gen_probe Vgrid_rms_meas_kV {
                streaming_en = "True"
            }
            [
                position = 7816, 8280
            ]

            component gen_probe Pmeas_kW {
                streaming_en = "True"
            }
            [
                position = 7784, 8296
            ]

            component gen_probe Snom_kVA {
            }
            [
                position = 7880, 8248
            ]

            component gen_probe Qmeas_kVAr {
                streaming_en = "True"
            }
            [
                position = 7752, 8312
            ]

            component gen_probe Pnom_kW {
            }
            [
                position = 7944, 8216
            ]

            component gen_probe Qref_fb_kVAr {
                streaming_en = "True"
            }
            [
                position = 8040, 8168
            ]

            component gen_probe Fmeas_Hz {
                streaming_en = "True"
            }
            [
                position = 7848, 8264
            ]

            component gen_probe Vgen_rms_meas_V {
                streaming_en = "True"
            }
            [
                position = 7656, 8360
            ]

            component gen_probe Gen_speed_RPM {
                streaming_en = "True"
            }
            [
                position = 7624, 8376
            ]

            component gen_probe MCB_status {
            }
            [
                position = 7592, 8392
            ]

            component gen_probe state {
            }
            [
                position = 7560, 8408
            ]

            component gen_probe alarm_msg {
            }
            [
                position = 7528, 8424
            ]

            component "core/DER (Generic) Output Split" "DER (Generic) Output Split1" {
                Converter_mode_fb = "True"
                Enable_fb = "True"
                Fmeas_Hz = "True"
                Fref_fb_Hz = "True"
                Gen_speed_RPM = "True"
                MCB_status = "True"
                PFmeas = "True"
                Pmeas_kW = "True"
                Pnom_kW = "True"
                Pref_fb_kW = "True"
                Qmeas_kVAr = "True"
                Qnom_kVAr = "True"
                Qref_fb_kVAr = "True"
                Smeas_kVA = "True"
                Snom_kVA = "True"
                Vgen_rms_meas_V = "True"
                Vgrid_rms_meas_kV = "True"
                Vrms_ref_fb_V = "True"
                alarm_msg = "True"
                component_select = "Diesel Genset"
                state = "True"
            }
            [
                position = 7336, 8288
                size = 128, 330
            ]

            component gen_probe Converter_mode_fb {
            }
            [
                position = 7496, 8440
            ]

            port ui_out {
                label = "ui_out"
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9000, 8456
            ]

            port ext {
                label = "ext"
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9000, 9120
            ]

            port from_PCC {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7320, 8744
            ]

            port from_PMS {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7320, 8672
            ]

            port toPCC {
                position = left:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7672, 8064
            ]

            port ui_in {
                label = "ui_in"
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7176, 8288
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7784, 8992
                hide_name = True
                size = 60, 20
            ]

            tag Goto5 {
                value = "Qref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7768, 9096
                hide_name = True
                size = 60, 20
            ]

            tag Goto6 {
                value = "conv mode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7768, 8680
                hide_name = True
                size = 53, 20
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7768, 8784
                hide_name = True
                size = 60, 20
            ]

            tag Goto7 {
                value = "fref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7744, 8888
                hide_name = True
                size = 60, 20
            ]

            tag From1 {
                value = "conv mode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8608, 8168
                hide_name = True
                size = 60, 20
            ]

            tag From2 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8608, 8088
                hide_name = True
                size = 60, 20
            ]

            tag From3 {
                value = "Qref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8608, 8128
                hide_name = True
                size = 60, 20
            ]

            tag From4 {
                value = "fref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8608, 8248
                hide_name = True
                size = 60, 20
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8608, 8208
                hide_name = True
                size = 60, 20
            ]

            junction Junction4 sp
            [
                position = 7712, 9096
            ]

            junction Junction7 sp
            [
                position = 7728, 8992
            ]

            junction Junction12 sp
            [
                position = 7552, 8136
            ]

            connect ui_out "DER (Generic) Control Join1.ui_out" as Connection2994
            connect Enable.out "DER (Generic) Control Join1.Enable" as Connection2995
            [
                position = 0, 0
                breakpoints = 8720, 8056; 8720, 8312
            ]
            connect "Reset alarms.out" "DER (Generic) Control Join1.Reset alarms" as Connection2996
            [
                position = 0, 0
                breakpoints = 8712, 8112; 8712, 8328
            ]
            connect "Frequency droop offset.out" "DER (Generic) Control Join1.Frequency droop offset" as Connection3002
            [
                position = 0, 0
                breakpoints = 8648, 8336; 8648, 8424
            ]
            connect "Frequency droop coeff.out" "DER (Generic) Control Join1.Frequency droop coeff" as Connection3003
            [
                position = 0, 0
                breakpoints = 8640, 8392; 8640, 8440
            ]
            connect "Fref rate of change.out" "DER (Generic) Control Join1.Fref rate of change" as Connection3004
            [
                position = 0, 0
                breakpoints = 8680, 8672; 8680, 8520
            ]
            connect "Vrms_ref rate of change.out" "DER (Generic) Control Join1.Vrms_ref rate of change" as Connection3005
            [
                position = 0, 0
                breakpoints = 8672, 8608; 8672, 8504
            ]
            connect "Qref rate of change.out" "DER (Generic) Control Join1.Qref rate of change" as Connection3006
            [
                position = 0, 0
                breakpoints = 8664, 8560; 8664, 8488
            ]
            connect "Pref rate of change.out" "DER (Generic) Control Join1.Pref rate of change" as Connection3007
            [
                position = 0, 0
                breakpoints = 8656, 8496; 8656, 8472
            ]
            connect "Voltage droop coeff.out" "DER (Generic) Control Join1.Voltage droop coeff" as Connection3008
            [
                position = 0, 0
                breakpoints = 8640, 8456; 8720, 8456
            ]
            connect "DER (Generic) External Join1.ext" ext as Connection3009
            connect "I alarm upper limit.out" "DER (Generic) Control Join1.I alarm upper limit" as Connection3010
            [
                position = 0, 0
                breakpoints = 8688, 8728; 8688, 8536
            ]
            connect "I alarm timeout.out" "DER (Generic) Control Join1.I alarm timeout" as Connection3011
            [
                position = 0, 0
                breakpoints = 8696, 8784; 8696, 8552
            ]
            connect "V alarm lower limit.out" "DER (Generic) Control Join1.V alarm lower limit" as Connection3012
            [
                position = 0, 0
                breakpoints = 8704, 8840; 8704, 8568
            ]
            connect "Drift alarm frequency bound.out" "DER (Generic) Control Join1.Drift alarm freq bound" as Connection3013
            [
                position = 0, 0
                breakpoints = 8712, 8896; 8712, 8584
            ]
            connect "Sync timeout.out" "DER (Generic) Control Join1.Sync timeout" as Connection3014
            connect Gain2.in Interface.f_ref as Connection3025
            connect Interface.fromPCC "Rate Transition2.out" as Connection3029
            connect "Rate Transition2.in" from_PCC as Connection3030
            connect Gain4.in Interface.Q as Connection3031
            connect Goto5 Junction4 as Connection3032
            connect Junction4 Gain4.out as Connection3033
            connect Qref_probe.in Junction4 as Connection3034
            connect Goto4 Junction7 as Connection3035
            connect Junction7 Pref_probe.in as Connection3036
            [
                breakpoints = 7728, 8960; 7824, 8960
            ]
            connect Interface.P Gain3.in as Connection3037
            connect Gain3.out Junction7 as Connection3038
            connect Vrms_ref.out Gain5.in as Connection3039
            connect Gain5.out Interface.Vref as Connection3040
            connect Fref.out Gain6.in as Connection3041
            connect Gain7.out Interface.Pref as Connection3042
            connect Pref.out Gain7.in as Connection3044
            [
                breakpoints = 7384, 8960
            ]
            connect Gain8.in Qref.out as Connection3045
            [
                breakpoints = 7368, 9032
            ]
            connect Gain2.out Goto7 as Connection3050
            connect Interface.V_ref Gain1.in as Connection3051
            connect Gain1.out Goto2 as Connection3052
            connect Gain6.out Interface.wref as Connection3065
            connect Gain8.out Interface.Qref as Connection3066
            connect "Operation mode.out" Interface.c_mode as Connection3067
            connect From2 "DER (Generic) Control Join1.Pref" as Connection3072
            [
                breakpoints = 8704, 8088; 8704, 8344
            ]
            connect From3 "DER (Generic) Control Join1.Qref" as Connection3073
            [
                breakpoints = 8696, 8128; 8696, 8360
            ]
            connect From1 "DER (Generic) Control Join1.Operation mode" as Connection3074
            [
                breakpoints = 8688, 8168; 8688, 8376
            ]
            connect From5 "DER (Generic) Control Join1.Vrms_ref" as Connection3075
            [
                breakpoints = 8680, 8208; 8680, 8392
            ]
            connect From4 "DER (Generic) Control Join1.Fref" as Connection3076
            [
                breakpoints = 8672, 8248; 8672, 8408
            ]
            connect alarm_msg.in "DER (Generic) Output Split1.alarm_msg" as Connection2974
            connect "DER (Generic) Output Split1.state" state.in as Connection2975
            connect MCB_status.in "DER (Generic) Output Split1.MCB_status" as Connection2976
            connect "DER (Generic) Output Split1.Gen_speed_RPM" Gen_speed_RPM.in as Connection2977
            connect Vgen_rms_meas_V.in "DER (Generic) Output Split1.Vgen_rms_meas_V" as Connection2978
            connect "DER (Generic) Output Split1.PFmeas" PFmeas.in as Connection2979
            connect Smeas_kVA.in "DER (Generic) Output Split1.Smeas_kVA" as Connection2980
            connect "DER (Generic) Output Split1.Qmeas_kVAr" Qmeas_kVAr.in as Connection2981
            connect Pmeas_kW.in "DER (Generic) Output Split1.Pmeas_kW" as Connection2982
            connect "DER (Generic) Output Split1.Vgrid_rms_meas_kV" Vgrid_rms_meas_kV.in as Connection2983
            connect Fmeas_Hz.in "DER (Generic) Output Split1.Fmeas_Hz" as Connection2984
            connect "DER (Generic) Output Split1.Snom_kVA" Snom_kVA.in as Connection2985
            connect Qnom_kVAr.in "DER (Generic) Output Split1.Qnom_kVAr" as Connection2986
            connect "DER (Generic) Output Split1.Pnom_kW" Pnom_kW.in as Connection2987
            connect Fref_fb_Hz.in "DER (Generic) Output Split1.Fref_fb_Hz" as Connection2988
            connect "DER (Generic) Output Split1.Vrms_ref_fb_V" Vrms_ref_fb_V.in as Connection2989
            connect Qref_fb_kVAr.in "DER (Generic) Output Split1.Qref_fb_kVAr" as Connection2990
            connect "DER (Generic) Output Split1.Pref_fb_kW" Pref_fb_kW.in as Connection2991
            connect "DER (Generic) Output Split1.ui_in" ui_in as Connection2993
            connect Converter_mode_fb.in "DER (Generic) Output Split1.Converter_mode_fb" as Connection3015
            connect Enable_fb.in Junction12 as Connection3077
            connect Junction12 "DER (Generic) Output Split1.Enable_fb" as Connection3078
            connect toPCC Junction12 as Connection3079
            connect Interface.opMode Goto6 as Connection3080
            [
                breakpoints = 7664, 8680
            ]
            connect from_PMS Interface.fromPMS as Connection3081

            mask {
                icon = "image(\'dg_generic_microgrid_ui.svg\')"
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">User Interface subsystem intended to be used with \"Diesel Genset (Generic)\" component.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 9152, 8496
            size = 96, 136
        ]

        component Subsystem PCC_monitor {
            layout = dynamic
            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7600, 7968
                hide_name = True
            ]

            component gen_terminator Termination4 {
            }
            [
                position = 7840, 7992
                hide_name = True
            ]

            component gen_sr_ff "SR Flip Flop4" {
            }
            [
                position = 7752, 7976
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7504, 7968
                hide_name = True
                size = 32, 32
            ]

            component Subsystem Snubber {
                layout = dynamic
                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect A R21.p_node as Connection758
                connect B R20.p_node as Connection759
                connect G Junction1517 as Connection764
                connect Junction1516 Junction1517 as Connection762
                connect Junction1516 R21.n_node as Connection755
                connect Junction1517 R22.n_node as Connection763
                connect R20.n_node Junction1516 as Connection698
                connect R22.p_node C as Connection760
            }
            [
                position = 7776, 8512
                size = 88, 80
            ]

            component "core/Voltage Measurement" Va {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8768, 8448
                rotation = right
                size = 64, 32
            ]

            component Subsystem Snubber1 {
                layout = dynamic
                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect A R21.p_node as Connection758
                connect B R20.p_node as Connection759
                connect G Junction1517 as Connection764
                connect Junction1516 Junction1517 as Connection762
                connect Junction1516 R21.n_node as Connection755
                connect Junction1517 R22.n_node as Connection763
                connect R20.n_node Junction1516 as Connection698
                connect R22.p_node C as Connection760
            }
            [
                position = 8616, 8496
                size = 88, 80
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 8280, 8304
                size = 64, 256
            ]

            component "core/Voltage Measurement" Vc {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8896, 8560
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8832, 8504
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" VB {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7992, 8520
                rotation = right
                size = 64, 32
            ]

            component Subsystem Synch_check {
                layout = dynamic
                component gen_logic_op "Logical operator2" {
                }
                [
                    position = 7736, 8720
                    hide_name = True
                ]

                component gen_digital_probe ABC_nom {
                }
                [
                    position = 7808, 8776
                    rotation = left
                    scale = -1, -1
                ]

                component gen_bus_join "Bus Join" {
                }
                [
                    position = 8240, 8528
                    rotation = right
                    hide_name = True
                ]

                component gen_logic_op and2 {
                    inputs = "4"
                }
                [
                    position = 7824, 8520
                    rotation = left
                    hide_name = True
                ]

                component gen_digital_probe Phase_match {
                }
                [
                    position = 7376, 8760
                    rotation = right
                ]

                component gen_logic_op not1 {
                    operator = "NOT"
                }
                [
                    position = 7736, 8656
                    hide_name = True
                ]

                component gen_logic_op not {
                    operator = "NOT"
                }
                [
                    position = 7736, 8576
                    hide_name = True
                ]

                component gen_probe dV {
                }
                [
                    position = 7312, 8056
                    rotation = left
                ]

                component gen_probe dw_f {
                }
                [
                    position = 7344, 8288
                    rotation = left
                ]

                component gen_digital_probe abc_dead {
                }
                [
                    position = 7360, 8232
                    rotation = right
                ]

                component gen_digital_probe V_match {
                }
                [
                    position = 7432, 8088
                    rotation = left
                ]

                component gen_digital_probe synch_check_ON {
                }
                [
                    position = 7904, 8392
                ]

                component gen_digital_probe VABC_nom {
                }
                [
                    position = 7424, 8256
                    rotation = left
                    scale = -1, -1
                ]

                component gen_probe dw_synch {
                }
                [
                    position = 7960, 8128
                    rotation = left
                ]

                component gen_digital_probe f_ABC_nom {
                }
                [
                    position = 7344, 8456
                    rotation = left
                    scale = -1, -1
                ]

                component gen_digital_probe Check_phase_ON {
                }
                [
                    position = 7296, 8520
                ]

                component gen_probe dw_phase {
                }
                [
                    position = 7384, 8560
                    rotation = left
                ]

                component gen_logic_op and1 {
                }
                [
                    position = 7168, 8520
                ]

                component gen_digital_probe f_match {
                }
                [
                    position = 7488, 8320
                    rotation = left
                ]

                component Subsystem check_f_diff {
                    layout = dynamic
                    component gen_probe f_diff {
                    }
                    [
                        position = 8248, 8088
                    ]

                    component gen_gain toPU {
                        gain = "[1.0/(2.0*f)]"
                    }
                    [
                        position = 8216, 8152
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8152
                    ]

                    component gen_z_domain_transfer LPF_dwf {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8128, 8152
                    ]

                    component gen_c_function interval_check {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if((in>=f*(1-fn_thresh/100.0)) && in<=f*(1+fn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                        parameters = "real fn_thresh;real f;"
                    }
                    [
                        position = 7952, 8416
                        size = 48, 48
                    ]

                    component gen_probe f_ABC_nom {
                    }
                    [
                        position = 8160, 8480
                        rotation = right
                    ]

                    component gen_gain Freq_diff {
                        gain = "delta_f/100.0"
                    }
                    [
                        position = 8208, 8304
                    ]

                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8280, 8256
                        hide_name = True
                        scale = 1, -1
                    ]

                    component src_constant Constant1 {
                        execution_rate = "Ts"
                        value = "f"
                    }
                    [
                        position = 8120, 8304
                        hide_name = True
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7856, 8416
                        hide_name = True
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8208, 8248
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8216
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Ki {
                            gain = "f_Ki"
                        }
                        [
                            position = 7968, 8216
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "f_lowLim"
                            upper_limit = "f_upLim"
                        }
                        [
                            position = 8408, 8216
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "[\'-inf\']"
                            limit_upper = "[\'inf\']"
                        }
                        [
                            position = 8216, 8224
                        ]

                        component gen_gain Kp {
                            gain = "f_Kp"
                        }
                        [
                            position = 7968, 8136
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8216
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8216
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8216
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8184
                        ]

                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 In as Connection58
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Ki.out Sum7.in as Connection55
                        connect Kp.in Junction4 as Connection57
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8304, 8152
                        size = 64, 48
                    ]

                    port dw_f {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8152
                    ]

                    port f_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8256
                    ]

                    port f_ABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7752, 8144
                    ]

                    port f_abc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7968, 8160
                    ]

                    port "f_ABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8248, 8416
                    ]

                    junction Junction1 sp
                    [
                        position = 8168, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 7808, 8144
                    ]

                    junction Junction13 sp
                    [
                        position = 8160, 8416
                    ]

                    connect Abs3.in Junction1 as Connection7
                    connect Abs4.in Junction12 as Connection278
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect Comparator1.out f_match as Connection59
                    connect Constant1.out Freq_diff.in as Connection14
                    connect Freq_diff.out Comparator1.in1 as Connection17
                    connect Junction1 LPF_dwf.out as Connection61
                    connect Junction12 f_ABC as Connection277
                    connect Junction13 f_ABC_nom.in as Connection282
                    connect LPF_dwf.in Sum1.out as Connection62
                    connect PI.Out dw_f as Connection64
                    connect Sum1.in Junction12 as Connection276
                    connect Sum1.in1 f_abc as Connection60
                    connect "f_ABC nom" Junction13 as Connection281
                    connect f_diff.in Junction1 as Connection56
                    connect interval_check.in Abs4.out as Connection280
                    connect interval_check.out Junction13 as Connection283
                    connect toPU.in Junction1 as Connection40
                    connect toPU.out PI.In as Connection63
                }
                [
                    position = 7216, 8368
                    size = 144, 120
                ]

                component Subsystem Contactor_Control {
                    layout = dynamic
                    component gen_terminator Termination12 {
                    }
                    [
                        position = 7760, 8392
                        rotation = right
                        hide_name = True
                    ]

                    component gen_digital_probe set_CB {
                    }
                    [
                        position = 7632, 8224
                        rotation = left
                    ]

                    component gen_logic_op "Logical operator1" {
                        inputs = "3"
                    }
                    [
                        position = 7448, 8488
                        rotation = left
                        hide_name = True
                    ]

                    component gen_sr_ff "SR Flip Flop1" {
                    }
                    [
                        position = 7712, 8336
                        hide_name = True
                    ]

                    component gen_digital_probe reset_CB {
                    }
                    [
                        position = 7640, 8432
                        rotation = right
                    ]

                    component gen_digital_probe CB_cmd {
                    }
                    [
                        position = 7760, 8280
                        rotation = left
                    ]

                    component gen_c_function CB_SM {
                        init_fnc = "/*Begin code section*/
close_CB = 0;
open_CB = 1;
/*End code section*/"
                        input_terminals = "inherit Close_cmd;inherit Open_cmd;inherit ABC_nom;inherit abc_dead;inherit Matched;"
                        input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit"
                        input_terminals_feedthrough = "[\'\']"
                        input_terminals_show_labels = "False;False;False;False;False;"
                        output_fnc = "/*Begin code section*/
if((Open_cmd>0.0) || (!ABC_nom)){
    close_CB = 0;
    open_CB = 1;
}
else{
    if(Close_cmd>0.0){
        if((abc_dead) || (Matched)){
            close_CB = 1;
            open_CB = 0;
        }
        else{
            close_CB = 0;
        }
    }
    else{
        close_CB = 0;
    }
}
/*End code section*/"
                        output_terminals = "real close_CB;inherit open_CB;"
                        output_terminals_dimensions = "inherit;inherit"
                        output_terminals_feedthrough = "[\'\']"
                        output_terminals_show_labels = "False;False;"
                    }
                    [
                        position = 7576, 8336
                        size = 48, 96
                    ]

                    port phase_match {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8576
                    ]

                    port f_match {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8536
                    ]

                    port V_match {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8600
                    ]

                    port "Close Breaker" {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7488, 8224
                        rotation = right
                    ]

                    port "Open Breaker" {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7320, 8224
                        rotation = right
                    ]

                    port abc_dead {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8432
                        rotation = left
                    ]

                    port CB {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8320
                    ]

                    port ABC_nom {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8336
                    ]

                    junction Junction32 sp
                    [
                        position = 7760, 8320
                    ]

                    junction Junction33 sp
                    [
                        position = 7632, 8304
                    ]

                    junction Junction34 sp
                    [
                        position = 7640, 8368
                    ]

                    comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This state machine reads the</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">breaker commands and take</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">respective actions. It also</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">checks the grid (ABC) status</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">and force the breaker open</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if the grid is not in nominal </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">conditions.</p></body></html> ENDCOMMENT 
                    [
                        position = 7488, 8504
                    ]

                    connect ABC_nom CB_SM.ABC_nom as Connection594
                    connect CB_SM.close_CB Junction33 as Connection595
                    connect CB_SM.open_CB Junction34 as Connection598
                    connect CB_cmd.in Junction32 as Connection528
                    connect "Close Breaker" CB_SM.Close_cmd as Connection574
                    connect Junction32 CB as Connection529
                    connect Junction33 "SR Flip Flop1.s_in" as Connection596
                    connect Junction34 "SR Flip Flop1.r_in" as Connection599
                    connect "Logical operator1.out" CB_SM.Matched as Connection580
                    connect "Logical operator1.in2" V_match as Connection571
                    connect "Logical operator1.in" f_match as Connection569
                    connect "Open Breaker" CB_SM.Open_cmd as Connection591
                    connect "SR Flip Flop1.out" Junction32 as Connection530
                    connect Termination12.in "SR Flip Flop1.out_n" as Connection55
                    connect abc_dead CB_SM.abc_dead as Connection579
                    connect phase_match "Logical operator1.in1" as Connection570
                    connect reset_CB.in Junction34 as Connection600
                    connect set_CB.in Junction33 as Connection597
                }
                [
                    position = 8368, 8200
                    size = 168, 248
                ]

                component Subsystem Calculate_dw_synch {
                    layout = dynamic
                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 8328, 8112
                        hide_name = True
                    ]

                    component gen_sum Sum4 {
                    }
                    [
                        position = 8096, 8096
                        hide_name = True
                    ]

                    component gen_z_domain_transfer LPF_dw {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8184, 8096
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8272, 8008
                        hide_name = True
                    ]

                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8256, 8128
                        hide_name = True
                    ]

                    port dw_f {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8040
                    ]

                    port dw_phase {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8104
                    ]

                    port dw_synch {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8112
                    ]

                    port Activate {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8200, 8008
                    ]

                    connect LPF_dw.out "Signal switch1.in" as Connection241
                    connect Sum4.out LPF_dw.in as Connection240
                    connect Sum4.in1 dw_phase as Connection231
                    connect "Unit Delay1.in" Activate as Connection180
                    connect "Unit Delay1.out" "Signal switch1.in2" as Connection181
                    connect dw_f Sum4.in as Connection239
                    connect dw_synch "Signal switch1.out" as Connection177
                    connect zero.out "Signal switch1.in1" as Connection179
                }
                [
                    position = 7864, 8176
                    size = 128, 208
                ]

                component Subsystem PLLs {
                    layout = dynamic
                    component gen_terminator Termination4 {
                    }
                    [
                        position = 8288, 8160
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 8248, 7776
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe wt_ABC {
                    }
                    [
                        position = 8592, 8016
                    ]

                    component gen_probe wt_abc {
                    }
                    [
                        position = 8592, 8152
                    ]

                    component gen_probe VABC {
                    }
                    [
                        position = 8328, 7888
                        rotation = left
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8592, 8088
                        hide_name = True
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 8256, 8112
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8280, 7824
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe Vabc {
                    }
                    [
                        position = 8336, 8224
                        rotation = left
                    ]

                    component Subsystem PLL1 {
                        layout = dynamic
                        component gen_c_function integrator {
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            output_terminals = "inherit out;"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                        }
                        [
                            position = 8352, 8136
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            connect "abc to alpha beta.A" A as Connection2685
                            connect "abc to alpha beta.B" B as Connection2686
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect "alpha beta to dq.wt" wt as Connection2690
                            connect d "alpha beta to dq.d" as Connection2692
                            connect q "alpha beta to dq.q" as Connection2693
                            connect z "abc to alpha beta.gamma" as Connection2691
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                input_terminals = "real d;inherit q;"
                                input_terminals_dimensions = "inherit;inherit"
                                input_terminals_feedthrough = "[u\'\']"
                                input_terminals_show_labels = "False;False;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                output_terminals = "real t;inherit q_pu;"
                                output_terminals_dimensions = "inherit;inherit"
                                output_terminals_feedthrough = "[u\'\']"
                                output_terminals_show_labels = "False;False;"
                            }
                            [
                                position = 8192, 8192
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            connect V_terminal.t Vt as Connection8
                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                            connect q_pu V_terminal.q_pu as Connection9
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Gain1.in Sum8.out as Connection61
                            connect In Junction6 as Connection74
                            connect Integrator2.in Junction8 as Connection86
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction7 Junction6 as Connection82
                            connect Junction8 Gain1.out as Connection87
                            connect Kb.in Sum6.out as Connection50
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Ki.in Junction7 as Connection81
                            connect Ki.out Sum7.in as Connection75
                            connect Kp.in Junction6 as Connection73
                            connect Kp.out Sum5.in as Connection69
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Sum5.out Junction2 as Connection44
                            connect Sum5.in1 Junction8 as Connection88
                            connect Sum6.in Junction2 as Connection46
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.A A as Connection277
                        connect ABC_dqz.B B as Connection276
                        connect ABC_dqz.C C as Connection275
                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect Gain1.in LPF_q1.out as Connection265
                        connect Junction14 Normalize.d as Connection253
                        connect Junction14 d as Connection262
                        connect Junction15 q as Connection261
                        connect Junction16 integrator.in as Connection269
                        connect Junction6 integrator.out as Connection195
                        connect LPF_d.out Junction14 as Connection254
                        connect LPF_q.out Junction15 as Connection257
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect PID.In Normalize.q_pu as Connection267
                        connect "Rate Limiter1.in" Junction16 as Connection268
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect f Gain1.out as Connection264
                        connect wt Junction6 as Connection196

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 8264
                        size = 88, 240
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component gen_c_function integrator {
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            output_terminals = "inherit out;"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                        }
                        [
                            position = 8352, 8136
                            size = 48, 48
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Gain1.in Sum8.out as Connection61
                            connect In Junction6 as Connection74
                            connect Integrator2.in Junction8 as Connection86
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction7 Junction6 as Connection82
                            connect Junction8 Gain1.out as Connection87
                            connect Kb.in Sum6.out as Connection50
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Ki.in Junction7 as Connection81
                            connect Ki.out Sum7.in as Connection75
                            connect Kp.in Junction6 as Connection73
                            connect Kp.out Sum5.in as Connection69
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Sum5.out Junction2 as Connection44
                            connect Sum5.in1 Junction8 as Connection88
                            connect Sum6.in Junction2 as Connection46
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                input_terminals = "real d;inherit q;"
                                input_terminals_dimensions = "inherit;inherit"
                                input_terminals_feedthrough = "[u\'\']"
                                input_terminals_show_labels = "False;False;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                output_terminals = "real t;inherit q_pu;"
                                output_terminals_dimensions = "inherit;inherit"
                                output_terminals_feedthrough = "[u\'\']"
                                output_terminals_show_labels = "False;False;"
                            }
                            [
                                position = 8192, 8192
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            connect V_terminal.t Vt as Connection8
                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                            connect q_pu V_terminal.q_pu as Connection9
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            connect "abc to alpha beta.A" A as Connection2685
                            connect "abc to alpha beta.B" B as Connection2686
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect "alpha beta to dq.wt" wt as Connection2690
                            connect d "alpha beta to dq.d" as Connection2692
                            connect q "alpha beta to dq.q" as Connection2693
                            connect z "abc to alpha beta.gamma" as Connection2691
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.A A as Connection277
                        connect ABC_dqz.B B as Connection276
                        connect ABC_dqz.C C as Connection275
                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect Gain1.in LPF_q1.out as Connection265
                        connect Junction14 Normalize.d as Connection253
                        connect Junction14 d as Connection262
                        connect Junction15 q as Connection261
                        connect Junction16 integrator.in as Connection269
                        connect Junction6 integrator.out as Connection195
                        connect LPF_d.out Junction14 as Connection254
                        connect LPF_q.out Junction15 as Connection257
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect PID.In Normalize.q_pu as Connection267
                        connect "Rate Limiter1.in" Junction16 as Connection268
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect f Gain1.out as Connection264
                        connect wt Junction6 as Connection196

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 7928
                        size = 88, 240
                    ]

                    port "Phase diff" {
                        position = right:5
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8744, 8088
                    ]

                    port f_ABC {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7976
                    ]

                    port V_ABC {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 7928
                    ]

                    port f_abc {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 8312
                    ]

                    port V_abc {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 8264
                    ]

                    port VA {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7832
                    ]

                    port VB {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7928
                    ]

                    port VC {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8024
                    ]

                    port Va {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8168
                    ]

                    port Vb {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8264
                    ]

                    port Vc {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8360
                    ]

                    tag From3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8096
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8288, 8024
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8408, 8080
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8296, 8360
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction14 sp
                    [
                        position = 8528, 8096
                    ]

                    junction Junction15 sp
                    [
                        position = 8528, 8080
                    ]

                    junction Junction19 sp
                    [
                        position = 8328, 7928
                    ]

                    junction Junction20 sp
                    [
                        position = 8336, 8264
                    ]

                    connect From2 Junction15 as Connection270
                    connect From3 Junction14 as Connection267
                    connect Goto2 PLL.wt as Connection752
                    connect Goto3 PLL1.wt as Connection760
                    connect Junction14 Sum1.in1 as Connection268
                    connect Junction15 Sum1.in as Connection271
                    connect Junction19 V_ABC as Connection749
                    connect Junction20 V_abc as Connection762
                    connect PLL.Vt Junction19 as Connection750
                    connect PLL.A VA as Connection767
                    connect PLL1.Vt Junction20 as Connection763
                    connect "Phase diff" Sum1.out as Connection336
                    connect Termination1.in PLL.d as Connection753
                    connect Termination2.in PLL.q as Connection754
                    connect Termination3.in PLL1.d as Connection756
                    connect Termination4.in PLL1.q as Connection757
                    connect VABC.in Junction19 as Connection748
                    connect VB PLL.B as Connection746
                    connect VC PLL.C as Connection747
                    connect Va PLL1.A as Connection764
                    connect Vabc.in Junction20 as Connection761
                    connect Vb PLL1.B as Connection766
                    connect Vc PLL1.C as Connection765
                    connect f_ABC PLL.f as Connection758
                    connect f_abc PLL1.f as Connection759
                    connect wt_ABC.in Junction15 as Connection272
                    connect wt_abc.in Junction14 as Connection269
                }
                [
                    position = 6744, 8328
                    size = 104, 368
                ]

                component Subsystem check_V_diff {
                    layout = dynamic
                    component gen_abs Abs5 {
                    }
                    [
                        position = 8008, 8344
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 8432, 8160
                        hide_name = True
                    ]

                    component gen_gain Volt_diff {
                        gain = "delta_V/100.0"
                    }
                    [
                        position = 8264, 8256
                    ]

                    component gen_probe V_diff {
                    }
                    [
                        position = 8200, 8096
                    ]

                    component gen_c_function interval_check {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if((in>=(1-Vn_thresh/100.0)) && in<=(1+Vn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                        parameters = "real Vn_thresh;"
                    }
                    [
                        position = 7952, 8488
                        size = 48, 48
                    ]

                    component gen_c_function less_eq {
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[\'\']"
                        output_fnc = "/*Begin code section*/
if(in<=0.001){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[\'\']"
                    }
                    [
                        position = 8080, 8344
                        size = 48, 48
                    ]

                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8360, 8176
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8144, 8064
                        hide_name = True
                    ]

                    component src_constant one {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8200, 8256
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7872, 8488
                        hide_name = True
                    ]

                    component gen_probe Vabc_dead {
                    }
                    [
                        position = 8128, 8408
                        rotation = right
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8144
                        hide_name = True
                    ]

                    component gen_gain pu1 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7760, 8120
                        hide_name = True
                    ]

                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8336, 8224
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_probe VABC_nom {
                    }
                    [
                        position = 8184, 8552
                        rotation = right
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8264, 8216
                        hide_name = True
                    ]

                    component gen_gain pu2 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7944, 8152
                        hide_name = True
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "V_lowLim"
                            upper_limit = "V_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Ki {
                            gain = "V_Ki"
                        }
                        [
                            position = 7976, 8216
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "-1"
                            limit_upper = "1"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_gain Kp {
                            gain = "V_Kp"
                        }
                        [
                            position = 8024, 8168
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7888, 8168
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7944, 8168
                        ]

                        connect In Junction4 as Connection58
                        connect Integrator1.reset Reset as Connection2
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 Kp.in as Connection59
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection60
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.out Sum5.in as Connection55
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8272, 8144
                        size = 64, 48
                    ]

                    port dV {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8496, 8160
                    ]

                    port Activate {
                        position = top:auto
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8064, 8064
                    ]

                    port V_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8224
                    ]

                    port VABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7696, 8120
                    ]

                    port Vabc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8152
                    ]

                    port "Vabc dead" {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8264, 8344
                    ]

                    port "VABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8272, 8488
                    ]

                    junction Junction3 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction4 sp
                    [
                        position = 8272, 8064
                    ]

                    junction Junction5 sp
                    [
                        position = 7808, 8120
                    ]

                    junction Junction9 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction10 sp
                    [
                        position = 7976, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 8128, 8344
                    ]

                    junction Junction13 sp
                    [
                        position = 8184, 8488
                    ]

                    connect Abs4.in Junction5 as Connection227
                    connect Abs5.in Junction10 as Connection256
                    connect Abs5.out less_eq.in as Connection289
                    connect Activate "Unit Delay1.in" as Connection208
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect Junction10 pu2.out as Connection255
                    connect Junction12 Vabc_dead.in as Connection287
                    connect Junction13 "VABC nom" as Connection293
                    connect Junction3 Junction9 as Connection251
                    connect Junction4 "Unit Delay1.out" as Connection219
                    connect Junction5 pu1.out as Connection246
                    connect Junction9 Abs3.in as Connection252
                    connect PI.In Junction3 as Connection217
                    connect PI.Reset Junction4 as Connection220
                    connect PI.Out "Signal switch1.in" as Connection214
                    connect "Signal switch1.in2" Junction4 as Connection218
                    connect Sum1.in1 Junction10 as Connection254
                    connect Sum1.in Junction5 as Connection225
                    connect Sum1.out Junction9 as Connection253
                    connect VABC_nom.in Junction13 as Connection292
                    connect V_diff.in Junction3 as Connection215
                    connect V_match Comparator1.out as Connection187
                    connect "Vabc dead" Junction12 as Connection286
                    connect Volt_diff.out Comparator1.in1 as Connection17
                    connect dV "Signal switch1.out" as Connection181
                    connect interval_check.in Abs4.out as Connection291
                    connect interval_check.out Junction13 as Connection294
                    connect less_eq.out Junction12 as Connection288
                    connect one.out Volt_diff.in as Connection14
                    connect pu1.in VABC as Connection247
                    connect pu2.in Vabc as Connection249
                    connect zero.out "Signal switch1.in1" as Connection179
                }
                [
                    position = 7216, 8152
                    size = 144, 136
                ]

                component Subsystem check_phase_diff {
                    layout = dynamic
                    component gen_c_function confine_phase {
                        init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                        input_terminals = "real dtheta;"
                        input_terminals_dimensions = "inherit"
                        input_terminals_feedthrough = "[u\'\']"
                        output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
}
/*End code section*/"
                        output_terminals = "real dtheta_confined;"
                        output_terminals_dimensions = "inherit"
                        output_terminals_feedthrough = "[u\'\']"
                    }
                    [
                        position = 7920, 7976
                        size = 48, 48
                    ]

                    component gen_gain Phase_diff {
                        gain = "delta_phi*np.pi/180.0"
                    }
                    [
                        position = 8088, 8216
                    ]

                    component gen_z_domain_transfer LPF {
                        a_coeff = "[1.0/(2*np.pi*0.5),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8032, 7976
                    ]

                    component gen_probe phase_diff {
                    }
                    [
                        position = 8040, 7904
                    ]

                    component gen_product Product1 {
                    }
                    [
                        position = 8384, 7968
                        hide_name = True
                    ]

                    component gen_probe phase_filter {
                    }
                    [
                        position = 8112, 8040
                    ]

                    component gen_abs Abs2 {
                    }
                    [
                        position = 8064, 8112
                        rotation = right
                    ]

                    component gen_gain to_pu {
                        gain = "1.0/(2*np.pi)"
                    }
                    [
                        position = 8128, 7976
                    ]

                    component src_constant One {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8000, 8216
                    ]

                    component gen_comparator Comparator2 {
                    }
                    [
                        position = 8160, 8168
                        hide_name = True
                        scale = 1, -1
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_integrator Integrator1 {
                            limit_lower = "phase_lowLim"
                            limit_upper = "phase_upLim"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_gain Ki {
                            gain = "phase_Ki"
                        }
                        [
                            position = 7952, 8216
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "phase_lowLim"
                            upper_limit = "phase_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        component gen_gain Kp {
                            gain = "phase_Kp"
                        }
                        [
                            position = 7952, 8144
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7856, 8184
                        ]

                        connect Integrator1.reset Reset as Connection2
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 In as Connection58
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.in Junction4 as Connection57
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                    }
                    [
                        position = 8240, 7976
                        size = 64, 48
                    ]

                    component Subsystem Counter {
                        layout = dynamic
                        component src_constant Constant3 {
                            execution_rate = "Ts"
                            value = ".1/Ts"
                        }
                        [
                            position = 8256, 8144
                        ]

                        component gen_rel_op less_than {
                            relational_op = "<"
                        }
                        [
                            position = 8336, 8192
                        ]

                        component gen_logic_op not {
                            operator = "NOT"
                        }
                        [
                            position = 8104, 8248
                        ]

                        component "core/Counter" Counter1 {
                        }
                        [
                            position = 8192, 8200
                            size = 48, 48
                        ]

                        port In {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8192
                        ]

                        port Out {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8192
                        ]

                        junction Junction14 sp
                        [
                            position = 8056, 8192
                        ]

                        connect Constant3.out less_than.in as Connection66
                        connect Counter1.en Junction14 as Connection559
                        connect Junction14 In as Connection562
                        connect Junction14 not.in as Connection560
                        connect less_than.in1 Counter1.out as Connection450
                        connect less_than.out Out as Connection561
                        connect not.out Counter1.reset as Connection88
                    }
                    [
                        position = 8256, 8168
                        size = 48, 48
                    ]

                    port phase_Grid {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7832, 7976
                    ]

                    port phase_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8360, 8168
                    ]

                    port Activate {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8240, 7864
                        rotation = left
                        scale = 1, -1
                    ]

                    port dw_phase {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8504, 7968
                    ]

                    junction Junction15 sp
                    [
                        position = 8064, 7976
                    ]

                    junction Junction17 sp
                    [
                        position = 8064, 8040
                    ]

                    junction Junction21 sp
                    [
                        position = 8240, 7912
                    ]

                    junction Junction22 sp
                    [
                        position = 7992, 7976
                    ]

                    connect Abs2.in Junction17 as Connection590
                    connect Activate Junction21 as Connection622
                    connect Comparator2.in2 Abs2.out as Connection712
                    connect Comparator2.out Counter.In as Connection674
                    connect Junction15 LPF.out as Connection582
                    connect Junction17 Junction15 as Connection591
                    connect Junction21 PI.Reset as Connection693
                    connect Junction21 Product1.in as Connection623
                    connect Junction22 phase_diff.in as Connection719
                    connect LPF.in Junction22 as Connection718
                    connect One.out Phase_diff.in as Connection15
                    connect Phase_diff.out Comparator2.in1 as Connection49
                    connect Product1.in1 PI.Out as Connection692
                    connect confine_phase.dtheta_confined Junction22 as Connection720
                    connect confine_phase.dtheta phase_Grid as Connection721
                    connect dw_phase Product1.out as Connection714
                    connect phase_filter.in Junction17 as Connection592
                    connect phase_match Counter.Out as Connection673
                    connect to_pu.in Junction15 as Connection581
                    connect to_pu.out PI.In as Connection713
                }
                [
                    position = 7232, 8648
                    size = 168, 112
                ]

                port "Open Breaker" {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8688
                ]

                port "Close Breaker" {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8632
                ]

                port CB {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8552, 8200
                ]

                port VA {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8168
                ]

                port VB {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8232
                ]

                port VC {
                    position = top:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8296
                ]

                port Va {
                    position = top:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8360
                ]

                port Vb {
                    position = top:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8424
                ]

                port Vc {
                    position = top:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8488
                ]

                port synch_ref {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8432, 8576
                ]

                tag Goto43 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8488
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto31 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8456
                    hide_name = True
                    size = 60, 20
                ]

                tag From48 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8048
                    hide_name = True
                    size = 60, 20
                ]

                tag From60 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8104
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto38 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8688
                    hide_name = True
                    size = 60, 20
                ]

                tag From53 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8552
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto45 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8328
                    hide_name = True
                    size = 60, 20
                ]

                tag From61 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8200
                    hide_name = True
                    size = 60, 20
                ]

                tag From59 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8136
                    hide_name = True
                    size = 60, 20
                ]

                tag From57 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8656
                    hide_name = True
                    size = 60, 20
                ]

                tag From69 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8728
                    hide_name = True
                    size = 60, 20
                ]

                tag From67 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8200
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto48 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8680
                    hide_name = True
                    size = 60, 20
                ]

                tag From39 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8704
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto33 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8136
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto20 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8560, 8160
                    hide_name = True
                    size = 60, 20
                ]

                tag From56 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8616
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8576
                    hide_name = True
                    size = 60, 20
                ]

                tag From63 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8328
                    hide_name = True
                    size = 60, 20
                ]

                tag From65 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8096
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto32 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7368, 8104
                    hide_name = True
                    size = 60, 20
                ]

                tag From47 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8176
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8512
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto28 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8032, 8176
                    hide_name = True
                    size = 60, 20
                ]

                tag From68 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8296
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8200
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto44 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag From70 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8264
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag From50 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8232
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto42 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8408
                    hide_name = True
                    size = 60, 20
                ]

                tag From42 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8160, 8448
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto41 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8328
                    hide_name = True
                    size = 60, 20
                ]

                tag From49 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8160, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto47 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8616
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto46 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8408
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto49 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7920, 8720
                    hide_name = True
                    size = 60, 20
                ]

                tag From58 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8104
                    hide_name = True
                    size = 60, 20
                ]

                tag From62 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8408
                    hide_name = True
                    size = 60, 20
                ]

                tag From64 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7080, 8648
                    hide_name = True
                    size = 60, 20
                ]

                tag From66 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8256
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto37 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8632
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto22 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7552, 8368
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto40 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8248
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto39 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8168
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction32 sp
                [
                    position = 7960, 8176
                ]

                junction Junction35 sp
                [
                    position = 7488, 8368
                ]

                junction Junction39 sp
                [
                    position = 7824, 8456
                ]

                junction Junction46 sp
                [
                    position = 7232, 8520
                ]

                junction Junction47 sp
                [
                    position = 7312, 8104
                ]

                junction Junction48 sp
                [
                    position = 7432, 8136
                ]

                junction Junction49 sp
                [
                    position = 7344, 8328
                ]

                junction Junction50 sp
                [
                    position = 7384, 8616
                ]

                junction Junction51 sp
                [
                    position = 7376, 8680
                ]

                junction Junction52 sp
                [
                    position = 7848, 8720
                ]

                junction Junction53 sp
                [
                    position = 8496, 8200
                ]

                junction Junction54 sp
                [
                    position = 7360, 8168
                ]

                junction Junction55 sp
                [
                    position = 7424, 8200
                ]

                junction Junction56 sp
                [
                    position = 7344, 8408
                ]

                junction Junction57 sp
                [
                    position = 7808, 8720
                ]

                connect ABC_nom.in Junction57 as Connection715
                connect "Bus Join.in" From42 as Connection729
                connect "Bus Join.out" synch_ref as Connection728
                connect Check_phase_ON.in Junction46 as Connection622
                connect Contactor_Control.f_match From37 as Connection697
                connect "Contactor_Control.Open Breaker" From59 as Connection695
                connect Contactor_Control.CB Junction53 as Connection703
                connect From39 "Logical operator2.in" as Connection687
                connect From47 Calculate_dw_synch.Activate as Connection556
                connect From48 check_V_diff.Activate as Connection647
                connect From49 "Bus Join.in1" as Connection730
                connect From50 Contactor_Control.V_match as Connection699
                connect From53 and1.in1 as Connection585
                connect From56 and2.in1 as Connection639
                connect From57 not1.in as Connection640
                connect From58 "Contactor_Control.Close Breaker" as Connection694
                connect From60 check_V_diff.VABC as Connection663
                connect From61 check_V_diff.Vabc as Connection664
                connect From62 check_f_diff.f_abc as Connection671
                connect From63 check_f_diff.f_ABC as Connection670
                connect From64 check_phase_diff.phase_Grid as Connection674
                connect From65 Calculate_dw_synch.dw_f as Connection683
                connect From66 Calculate_dw_synch.dw_phase as Connection684
                connect From67 Contactor_Control.phase_match as Connection696
                connect From68 Contactor_Control.abc_dead as Connection698
                connect From70 Contactor_Control.ABC_nom as Connection700
                connect Goto20 Junction53 as Connection701
                connect Goto28 Junction32 as Connection250
                connect Goto31 Junction39 as Connection561
                connect Goto32 Junction47 as Connection650
                connect Goto33 Junction48 as Connection653
                connect Goto36 Junction55 as Connection707
                connect Goto37 "Close Breaker" as Connection637
                connect Goto38 "Open Breaker" as Connection638
                connect Goto39 PLLs.V_ABC as Connection658
                connect Goto40 PLLs.V_abc as Connection657
                connect Goto41 PLLs.f_ABC as Connection659
                connect Goto42 PLLs.f_abc as Connection660
                connect Goto43 "PLLs.Phase diff" as Connection661
                connect Goto44 Junction54 as Connection704
                connect Goto45 Junction49 as Connection668
                connect Goto46 Junction56 as Connection710
                connect Goto47 Junction50 as Connection676
                connect Goto48 Junction51 as Connection680
                connect Goto49 Junction52 as Connection692
                connect Junction32 Calculate_dw_synch.dw_synch as Connection249
                connect Junction35 Goto22 as Connection283
                connect Junction39 and2.out as Connection562
                connect Junction46 and1.out as Connection623
                connect Junction47 dV.in as Connection651
                connect Junction48 V_match.in as Connection654
                connect Junction49 dw_f.in as Connection667
                connect Junction50 check_phase_diff.dw_phase as Connection677
                connect Junction51 check_phase_diff.phase_match as Connection681
                connect Junction52 and2.in3 as Connection691
                connect Junction53 CB as Connection702
                connect Junction54 "check_V_diff.Vabc dead" as Connection705
                connect Junction55 "check_V_diff.VABC nom" as Connection708
                connect Junction56 "check_f_diff.f_ABC nom" as Connection711
                connect Junction57 Junction52 as Connection714
                connect "Logical operator2.in1" From69 as Connection688
                connect "Logical operator2.out" Junction57 as Connection713
                connect PLLs.VA VA as Connection727
                connect PLLs.VC VC as Connection725
                connect Phase_match.in Junction51 as Connection682
                connect VABC_nom.in Junction55 as Connection709
                connect VB PLLs.VB as Connection726
                connect Va PLLs.Va as Connection630
                connect Vb PLLs.Vb as Connection628
                connect Vc PLLs.Vc as Connection629
                connect abc_dead.in Junction54 as Connection706
                connect and1.in From30 as Connection273
                connect and2.in not.out as Connection552
                connect check_V_diff.dV Junction47 as Connection652
                connect check_V_diff.V_match Junction48 as Connection655
                connect check_f_diff.f_match Junction35 as Connection284
                connect check_f_diff.dw_f Junction49 as Connection666
                connect check_phase_diff.Activate Junction46 as Connection624
                connect dw_phase.in Junction50 as Connection678
                connect dw_synch.in Junction32 as Connection248
                connect f_ABC_nom.in Junction56 as Connection712
                connect f_match.in Junction35 as Connection282
                connect not.in From33 as Connection551
                connect not1.out and2.in2 as Connection634
                connect synch_check_ON.in Junction39 as Connection563

                Vn = "12470.0"
                f = "60.0"
                fn_thresh = "5"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "12470"
                        unit = "V (line to line)"
                        group = "General"
                    }

                    f {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    fn_thresh {
                        label = "Grid nominal frequency operation threshold"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    delta_f {
                        label = "Accepted frequency difference"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    f_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "Freq. Match"
                    }

                    f_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Freq. Match"
                    }

                    delta_phi {
                        label = "Accepted phase difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "°"
                        group = "Phase Synch"
                    }

                    phase_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Phase Synch"
                    }

                    phase_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.00012"
                        group = "Phase Synch"
                    }

                    phase_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Phase Synch"
                    }

                    phase_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-0.1"
                        group = "Phase Synch"
                    }

                    Vn_thresh {
                        label = "Grid nominal voltage operation threshold"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    delta_V {
                        label = "Accepted voltage difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    V_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.0071"
                        group = "Voltage Match"
                    }

                    V_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0354"
                        group = "Voltage Match"
                    }

                    V_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Voltage Match"
                    }

                    V_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Voltage Match"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8048, 8000
                rotation = down
                scale = -1, 1
                size = 296, 120
            ]

            component "core/Voltage Measurement" VC {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8056, 8576
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" VA {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7928, 8464
                rotation = right
                size = 64, 32
            ]

            port Inputs {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7424, 7968
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 9032, 8208
                rotation = down
            ]

            port b {
                position = right:2
                kind = pe
            }
            [
                position = 9032, 8304
                rotation = down
            ]

            port c {
                position = right:3
                kind = pe
            }
            [
                position = 9032, 8400
                rotation = down
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7504, 8208
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7504, 8304
            ]

            port C {
                position = left:4
                kind = pe
            }
            [
                position = 7504, 8400
            ]

            port synch_ref {
                position = top:4
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 7960
            ]

            port CB_fb {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 8040
            ]

            tag Goto10 {
                value = "VB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8520
                hide_name = True
                size = 60, 20
            ]

            tag Goto14 {
                value = "Va"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8448
                hide_name = True
                size = 60, 20
            ]

            tag From6 {
                value = "VC"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8024, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto9 {
                value = "VA"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8464
                hide_name = True
                size = 60, 20
            ]

            tag Goto12 {
                value = "Vb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8504
                hide_name = True
                size = 60, 20
            ]

            tag From4 {
                value = "VA"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7928, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From7 {
                value = "Va"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8072, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto11 {
                value = "VC"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8152, 8576
                hide_name = True
                size = 60, 20
            ]

            tag From5 {
                value = "VB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7976, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag From9 {
                value = "Vc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8168, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            tag Goto13 {
                value = "Vc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8992, 8560
                hide_name = True
                size = 60, 20
            ]

            tag From8 {
                value = "Vb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8120, 8120
                rotation = left
                hide_name = True
                size = 60, 20
            ]

            junction Junction45 sp
            [
                position = 7704, 7992
            ]

            junction Junction49 pe
            [
                position = 7752, 8208
            ]

            junction Junction50 pe
            [
                position = 7776, 8304
            ]

            junction Junction51 pe
            [
                position = 7800, 8400
            ]

            junction Junction52 pe
            [
                position = 7928, 8208
            ]

            junction Junction53 pe
            [
                position = 7992, 8304
            ]

            junction Junction56 pe
            [
                position = 7928, 8640
            ]

            junction Junction57 pe
            [
                position = 8768, 8632
            ]

            junction Junction62 pe
            [
                position = 8768, 8208
            ]

            junction Junction63 pe
            [
                position = 8832, 8304
            ]

            junction Junction65 pe
            [
                position = 7992, 8640
            ]

            junction Junction66 pe
            [
                position = 8056, 8400
            ]

            junction Junction67 pe
            [
                position = 8832, 8632
            ]

            junction Junction68 pe
            [
                position = 8896, 8400
            ]

            junction Junction71 sp
            [
                position = 8280, 8040
            ]

            junction Junction72 pe
            [
                position = 8592, 8208
            ]

            junction Junction73 pe
            [
                position = 8616, 8304
            ]

            junction Junction74 pe
            [
                position = 8640, 8400
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs: <br />0 - Close Breaker command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - Open Breaker command</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - speed bias - sync check</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - voltage bias - sync check</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html> ENDCOMMENT 
            [
                position = 7640, 7704
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The PCC monitor is responsible for monitoring the status of the grid and microgrid. </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">It is also in charge of the microgrid synchronization process with the stiff grid.    </p></body></html> ENDCOMMENT 
            [
                position = 7920, 7752
            ]

            connect A Junction49 as Connection1029
            connect B Junction50 as Connection1032
            connect C Junction51 as Connection1035
            connect CB_fb Junction71 as Connection1128
            connect From4 Synch_check.VA as Connection871
            connect From5 Synch_check.VB as Connection872
            connect From6 Synch_check.VC as Connection873
            connect Inputs "Rate Transition1.in" as Connection1129
            connect Junction45 "Bus Split1.out1" as Connection1015
            connect Junction51 Junction66 as Connection1091
            connect Junction52 Junction49 as Connection1042
            connect Junction53 Junction50 as Connection1045
            connect Junction62 a as Connection1078
            connect Junction63 b as Connection1081
            connect Junction65 Junction56 as Connection1089
            connect Junction66 S1.c_in as Connection1092
            connect Junction67 Junction57 as Connection1097
            connect Junction68 c as Connection1100
            connect Junction71 S1.ctrl_in as Connection1127
            connect "Rate Transition1.out" "Bus Split1.in" as Connection1130
            connect S1.a_in Junction52 as Connection1041
            connect S1.b_in Junction53 as Connection1044
            connect "SR Flip Flop4.s_in" "Bus Split1.out" as Connection1013
            connect "SR Flip Flop4.r_in" Junction45 as Connection1014
            connect "SR Flip Flop4.out" "Synch_check.Close Breaker" as Connection1011
            connect Snubber.A Junction49 as Connection1031
            connect Snubber.B Junction50 as Connection1034
            connect Snubber.C Junction51 as Connection1037
            connect Snubber.G Junction56 as Connection1105
            connect Snubber1.G Junction57 as Connection1064
            connect Synch_check.Va From7 as Connection875
            connect Synch_check.Vb From8 as Connection874
            connect Synch_check.Vc From9 as Connection876
            connect "Synch_check.Open Breaker" Junction45 as Connection1016
            connect Synch_check.CB Junction71 as Connection1126
            connect Synch_check.synch_ref synch_ref as Connection880
            connect Termination4.in "SR Flip Flop4.out_n" as Connection1010
            connect VA.p_node Junction52 as Connection1043
            connect VA.n_node Junction56 as Connection1054
            connect VB.p_node Junction53 as Connection1046
            connect VB.n_node Junction65 as Connection1088
            connect VC.n_node Junction65 as Connection1090
            connect VC.p_node Junction66 as Connection1093
            connect Va.n_node Junction57 as Connection1063
            connect Va.p_node Junction62 as Connection1079
            connect Vb.p_node Junction63 as Connection1082
            connect Vb.n_node Junction67 as Connection1096
            connect Vc.n_node Junction67 as Connection1098
            connect Vc.p_node Junction68 as Connection1101
            connect VA.out Goto9 as Connection1139
            connect VB.out Goto10 as Connection1140
            [
                breakpoints = 8112, 8520
            ]
            connect VC.out Goto11 as Connection1141
            connect Goto14 Va.out as Connection1145
            connect Vb.out Goto12 as Connection1146
            connect Vc.out Goto13 as Connection1147
            connect Snubber1.A Junction72 as Connection1149
            connect Junction72 Junction62 as Connection1150
            [
                breakpoints = 8592, 8208
            ]
            connect Junction72 S1.a_out as Connection1151
            connect Snubber1.B Junction73 as Connection1154
            connect Junction73 Junction63 as Connection1155
            [
                breakpoints = 8616, 8304
            ]
            connect S1.b_out Junction73 as Connection1156
            connect Junction68 Junction74 as Connection1157
            [
                breakpoints = 8896, 8400
            ]
            connect Junction74 Snubber1.C as Connection1158
            [
                breakpoints = 8640, 8400
            ]
            connect S1.c_out Junction74 as Connection1159

            Ts = "Ts1"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PCC monitor block</p></body></html>"

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts"
                    unit = "s"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8832, 7960
            rotation = left
            scale = 1, -1
            size = 128, 112
        ]

        tag From14 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8000, 7872
            hide_name = True
            size = 60, 20
        ]

        tag Goto19 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8376, 7952
            hide_name = True
            size = 60, 20
        ]

        tag From15 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8000, 7904
            hide_name = True
            size = 60, 20
        ]

        tag From9 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8000, 7840
            hide_name = True
            size = 60, 20
        ]

        tag From8 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8000, 7808
            hide_name = True
            size = 60, 20
        ]

        tag Goto18 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8368, 7728
            hide_name = True
            size = 60, 20
        ]

        tag From21 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7656, 8504
            hide_name = True
            size = 60, 20
        ]

        tag From22 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7656, 8552
            hide_name = True
            size = 60, 20
        ]

        tag Goto22 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7656, 8456
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From20 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8072, 8504
            hide_name = True
            size = 60, 20
        ]

        tag From16 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8544, 8504
            hide_name = True
            size = 60, 20
        ]

        tag Goto23 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9008, 8448
            rotation = down
            size = 60, 20
        ]

        tag From23 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9008, 8496
            hide_name = True
            size = 60, 20
        ]

        tag From24 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9008, 8544
            hide_name = True
            size = 60, 20
        ]

        tag Goto16 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8704, 7960
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From7 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8704, 7920
            hide_name = True
            size = 60, 20
        ]

        tag Goto17 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8576, 7752
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag Goto15 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8704, 8000
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        junction Junction25 pe
        [
            position = 9640, 8320
        ]

        junction Junction26 pe
        [
            position = 9584, 8288
        ]

        junction Junction27 pe
        [
            position = 9696, 8352
        ]

        junction Junction83 pe
        [
            position = 9808, 8288
        ]

        junction Junction84 pe
        [
            position = 9864, 8320
        ]

        junction Junction85 pe
        [
            position = 9920, 8352
        ]

        junction Junction86 pe
        [
            position = 8360, 8120
        ]

        junction Junction87 pe
        [
            position = 8392, 8136
        ]

        junction Junction88 pe
        [
            position = 8328, 8104
        ]

        junction Junction92 pe
        [
            position = 8832, 8120
        ]

        junction Junction93 pe
        [
            position = 8864, 8136
        ]

        junction Junction94 pe
        [
            position = 8800, 8104
        ]

        junction Junction95 pe
        [
            position = 9280, 8104
        ]

        junction Junction96 pe
        [
            position = 9312, 8120
        ]

        junction Junction97 pe
        [
            position = 9344, 8136
        ]

        junction Junction98 pe
        [
            position = 8832, 8120
        ]

        junction Junction99 pe
        [
            position = 8864, 8136
        ]

        junction Junction100 pe
        [
            position = 8800, 8104
        ]

        comment Comment8 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Hardware requirements</span>:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This example runs on the following HIL devices:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- HIL 404</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- HIL 606</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">       </p></body></html> ENDCOMMENT 
        [
            position = 9184, 7728
        ]

        connect "Grid UI1.ui_in" Grid1.ui_in as Connection1
        connect Grid1.ui_out "Grid UI1.ui_out" as Connection2
        connect Trafo5.b Junction25 as Connection932
        connect "Constant Impedance Load1.B" Junction25 as Connection934
        connect Trafo5.a Junction26 as Connection935
        connect "Constant Impedance Load1.A" Junction26 as Connection937
        connect Junction27 Trafo5.c as Connection939
        connect "Constant Impedance Load1.C" Junction27 as Connection940
        connect "Variable Load (Generic) UI1.ui_in" "Variable Load (Generic)1.Out1" as Connection1392
        connect "Variable Load (Generic)1.In2" "Variable Load (Generic) UI1.ui_out" as Connection1393
        connect "Variable Load (Generic) UI1.ext" "Variable Load (Generic)1.ext" as Connection1394
        connect "Interruptible load.A" Junction83 as Connection1395
        connect Junction83 Junction26 as Connection1396
        [
            breakpoints = 9808, 8288
        ]
        connect "Variable Load (Generic)1.A" Junction83 as Connection1397
        connect Junction25 Junction84 as Connection1398
        [
            breakpoints = 9640, 8320
        ]
        connect Junction84 "Interruptible load.B" as Connection1399
        [
            breakpoints = 9864, 8320
        ]
        connect "Variable Load (Generic)1.B" Junction84 as Connection1400
        connect "Interruptible load.C" Junction85 as Connection1401
        connect Junction85 Junction27 as Connection1402
        [
            breakpoints = 9920, 8352
        ]
        connect "Variable Load (Generic)1.C" Junction85 as Connection1403
        connect "Battery ESS (Generic)1.B" Junction86 as Connection1461
        [
            breakpoints = 7984, 8120
        ]
        connect Junction86 "Wind Power Plant (Generic)1.B" as Connection1462
        [
            breakpoints = 8360, 8120; 8360, 8120
        ]
        connect "RL Section1.P4" Junction86 as Connection1463
        connect "Battery ESS (Generic)1.C" Junction87 as Connection1464
        connect Junction87 "Wind Power Plant (Generic)1.C" as Connection1465
        [
            breakpoints = 8392, 8136
        ]
        connect "RL Section1.P6" Junction87 as Connection1466
        connect "Wind Power Plant (Generic)1.A" Junction88 as Connection1467
        connect Junction88 "Battery ESS (Generic)1.A" as Connection1468
        [
            breakpoints = 8328, 8104
        ]
        connect "RL Section1.P2" Junction88 as Connection1469
        connect "RL Section1.P3" Junction92 as Connection1479
        connect "RL Section2.P4" Junction92 as Connection1481
        connect "RL Section1.P5" Junction93 as Connection1482
        connect "RL Section2.P6" Junction93 as Connection1484
        connect "RL Section1.P1" Junction94 as Connection1485
        connect "RL Section2.P2" Junction94 as Connection1487
        connect Trafo5.A Junction95 as Connection1488
        connect Junction95 "Diesel Genset (Generic)1.A" as Connection1489
        [
            breakpoints = 9280, 8104
        ]
        connect "RL Section2.P1" Junction95 as Connection1490
        connect Trafo5.B Junction96 as Connection1491
        connect Junction96 "Diesel Genset (Generic)1.B" as Connection1492
        [
            breakpoints = 9312, 8120
        ]
        connect "RL Section2.P3" Junction96 as Connection1493
        connect Trafo5.C Junction97 as Connection1494
        connect Junction97 "Diesel Genset (Generic)1.C" as Connection1495
        [
            breakpoints = 9344, 8136
        ]
        connect "RL Section2.P5" Junction97 as Connection1496
        connect From8 Microgrid_controller.power_meas as Connection147
        connect Goto18 Microgrid_controller.PCC_control as Connection145
        connect Goto19 Microgrid_controller.DER_control as Connection197
        connect c_option.out Microgrid_controller.control_option as Connection142
        connect From9 Microgrid_controller.CB_status as Connection1267
        connect From14 Microgrid_controller.fromESS as Connection1356
        connect MGCC_ON.out Microgrid_controller.MGCC as Connection1368
        connect Microgrid_controller.fromDG From15 as Connection1373
        connect Goto22 "Battery ESS (Generic) UI1.toPCC" as Connection1357
        connect From21 "Battery ESS (Generic) UI1.from_PMS" as Connection1358
        connect From22 "Battery ESS (Generic) UI1.from_PCC" as Connection1359
        connect "Battery ESS (Generic) UI1.ui_in" "Battery ESS (Generic)1.ui_in" as Connection1497
        connect "Battery ESS (Generic)1.ui_out" "Battery ESS (Generic) UI1.ui_out" as Connection1498
        connect "Battery ESS (Generic) UI1.ext" "Battery ESS (Generic)1.ext_inputs" as Connection1499
        connect From20 "Wind Power Plant (Generic) UI1.from_PMS" as Connection1355
        connect "Wind Power Plant (Generic) UI1.ui_out" "Wind Power Plant (Generic)1.In2" as Connection1500
        connect "Wind Power Plant (Generic)1.ext_inputs" "Wind Power Plant (Generic) UI1.ext" as Connection1501
        connect "Wind Power Plant (Generic) UI1.ui_in" "Wind Power Plant (Generic)1.Out1" as Connection1502
        connect From16 "PV Power Plant (Generic) UI1.from_PMS" as Connection1369
        connect "PV Power Plant (Generic) UI1.ui_out" "PV Power Plant (Generic)1.ui_out" as Connection1503
        connect "PV Power Plant (Generic)1.ext_inputs" "PV Power Plant (Generic) UI1.ext" as Connection1504
        connect "PV Power Plant (Generic) UI1.ui_in" "PV Power Plant (Generic)1.ui_in" as Connection1505
        connect Goto23 "Diesel Genset (Generic) UI1.toPCC" as Connection1374
        connect From23 "Diesel Genset (Generic) UI1.from_PMS" as Connection1375
        connect From24 "Diesel Genset (Generic) UI1.from_PCC" as Connection1376
        connect "Diesel Genset (Generic)1.In2" "Diesel Genset (Generic) UI1.ui_out" as Connection1507
        connect "Diesel Genset (Generic) UI1.ext" "Diesel Genset (Generic)1.In3" as Connection1508
        connect Goto16 PCC_monitor.CB_fb as Connection242
        connect PCC_monitor.synch_ref Goto15 as Connection243
        connect "PV Power Plant (Generic)1.B" Junction98 as Connection1512
        connect Junction98 Junction92 as Connection1513
        [
            breakpoints = 8832, 8120; 8832, 8120
        ]
        connect PCC_monitor.b Junction98 as Connection1514
        connect "PV Power Plant (Generic)1.C" Junction99 as Connection1515
        connect Junction99 Junction93 as Connection1516
        [
            breakpoints = 8864, 8136; 8864, 8136
        ]
        connect PCC_monitor.c Junction99 as Connection1517
        [
            breakpoints = 8864, 8032; 8864, 8136
        ]
        connect Junction94 Junction100 as Connection1518
        connect Junction100 "PV Power Plant (Generic)1.A" as Connection1519
        [
            breakpoints = 8800, 8104; 8800, 8104; 8800, 8104
        ]
        connect PCC_monitor.a Junction100 as Connection1520
        [
            breakpoints = 8800, 8032; 8800, 8104
        ]
        connect Grid1.B PCC_monitor.B as Connection1521
        connect Grid1.C PCC_monitor.C as Connection1522
        connect Grid1.A PCC_monitor.A as Connection1523
        connect "Grid UI1.power_meas" Goto17 as Connection1527
        connect "Diesel Genset (Generic) UI1.ui_in" "Diesel Genset (Generic)1.Out1" as Connection1528
        connect op_mode.out Microgrid_controller.operation_mode as Connection1529
        [
            breakpoints = 8072, 7744
        ]
        connect From7 PCC_monitor.Inputs as Connection1530
    }

    default {
        gen_abc2alpha_beta {
            power_form = "variant - Clarke\'s original"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_alpha_beta2d_q {
            alignment = "-pi/2"
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_rel_op {
            relational_op = "=="
            execution_rate = "inherit"
        }

        gen_sr_ff {
            init_value = "0"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1,1]"
            a_coeff = "[1,1]"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
            param_set = ""
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl > threshold"
            threshold = "0.5"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Battery ESS (Generic)" {
            Pnom = "20e3"
            Snom = "40e3"
            Vnom_LL = "400"
            fnom = "50"
            include_transformer = "True"
            Vnom_sec_LL = "2300"
            wL_pu = "0.1"
            Zt_pu = "0.04"
            dc_link_margin = "0.4"
            opc_pu = "0.0"
            Rshunt_pu = "2000"
            Tfast = "100e-6"
            Tslow = "500e-6"
            Sg_sc_pu = "20"
            PFg = "0.1"
            cont_type = "Ideal"
            resistance_cont = "1.0"
            nom_batt_voltage = "200"
            nom_batt_capacity = "120"
            soc_range = "[10, 90]"
            grid_code_fcn = "LVRT"
            lvrt_req = "Germany"
            vs_lvrt = "[0.0, 0.9, 0.901]"
            ts_lvrt = "[0.15, 1.5, 1.501]"
            preview = "Plot LVRT curve"
            voltvar_req = "Custom"
            vs_voltvar = "[0.6, 0.9, 1.1, 1.3]"
            qs_voltvar = "[1.3, 0.0, 0.0, -0.7]"
            preview_voltvar = "Plot VoltVAr curve"
            hzwatt_req = "Custom"
            fs_hzwatt = "[47.5, 47.8, 49.8, 50.2, 51.5]"
            ps_hzwatt = "[2.0, 2.0, 0.0, 0.0, -0.52]"
            preview_hzwatt = "Plot HzWatt curve"
            voltwatt_req = "Custom"
            vs_voltwatt = "[0.8, 1.06, 1.1, 1.3]"
            ps_voltwatt = "[1.0, 1.0, 0.2, 0.2]"
            preview_voltwatt = "Plot VoltWatt curve"
        }

        "core/Constant Impedance Load" {
            fn = "60"
            conn_type = "Y"
            enable_neutral = "False"
            set_balanced = "True"
            Vn_3ph = "480"
            Sn_3ph = "1.0e6"
            pf_mode_3ph = "Unit"
            pf_3ph = "0.9"
            VAn = "480/(3**0.5)"
            VAB = "480"
            SAn = "1.0e6/3"
            SAB = "1.0e6/3"
            pf_modeA = "Unit"
            pfA = "0.9"
            VBn = "480/(3**0.5)"
            VBC = "480"
            SBn = "1.0e6/3"
            SBC = "1.0e6/3"
            pf_modeB = "Unit"
            pfB = "0.9"
            VCn = "480/(3**0.5)"
            VCA = "480"
            SCn = "1.0e6/3"
            SCA = "1.0e6/3"
            pf_modeC = "Unit"
            pfC = "0.9"
        }

        "core/Counter" {
            ext_reset = "level"
            init_val = "0"
            state_type = "real"
            execution_rate = "inherit"
        }

        "core/DER (Generic) Control Join" {
            component_select = "Battery ESS"
            Enable = "False"
            Converter_mode = "False"
            Reset_alarms = "False"
            Pref = "False"
            Qref = "False"
            Frequency_droop_offset = "False"
            Frequency_droop_coeff = "False"
            Voltage_droop_coeff = "False"
            Vrms_ref = "False"
            Fref = "False"
            Max_SOC = "False"
            Min_SOC = "False"
            Pref_rate_of_change = "False"
            Qref_rate_of_change = "False"
            Vrms_ref_rate_of_change = "False"
            Fref_rate_of_change = "False"
            Pcurtailment = "False"
            Pcurtailment_rate_of_change = "False"
            MPPT_rate_of_change = "False"
            Enable_storm_control = "False"
            int1_wind_speed_max = "False"
            int2_wind_speed_max = "False"
            P_reduction_wind_speed__SC_ = "False"
            Average_wind_speed_max__SC_ = "False"
            Cut_out_wind_speed__SC_ = "False"
            time_interval_1 = "False"
            time_interval_2 = "False"
            Recovery_time = "False"
            time_interval__SC_ = "False"
            Operation_mode = "False"
            P_dependency_type = "False"
            Q_dependency_type = "False"
            P_V_k1 = "False"
            P_V_k2 = "False"
            P_f_k1 = "False"
            P_f_k2 = "False"
            Q_V_k1 = "False"
            Q_V_k2 = "False"
            Q_f_k1 = "False"
            Q_f_k2 = "False"
            LVRT_enable = "False"
            LVRT_Q_contribution = "False"
            LVRT_P_set = "False"
            V_alarm_upper_limit = "False"
            V_alarm_lower_limit = "False"
            F_alarm_upper_limit = "False"
            F_alarm_lower_limit = "False"
            S_alarm_upper_limit = "False"
            I_alarm_upper_limit = "False"
            I_alarm_timeout = "False"
            Drift_alarm_freq_bound = "False"
            Sync_timeout = "False"
            VoltVAr_enable = "False"
            HzWatt_enable = "False"
            VoltWatt_enable = "False"
        }

        "core/DER (Generic) External Join" {
            component_select = "Battery ESS"
            Initial_SOC = "False"
            Initial_SOH = "False"
            Temperature = "False"
            Irradiance = "False"
            Wind_speed = "False"
        }

        "core/DER (Generic) Output Split" {
            component_select = "Battery ESS"
            Enable_fb = "False"
            Converter_mode_fb = "False"
            MCB_status = "False"
            state = "False"
            alarm_msg = "False"
            Lvrt_active_status = "False"
            Pnom_kW = "False"
            Qnom_kVAr = "False"
            Snom_kVA = "False"
            Vnom_LL_V = "False"
            Fnom_Hz = "False"
            nom_wind_speed_m_per_s = "False"
            Pref_fb_kW = "False"
            Qref_fb_kVAr = "False"
            Vrms_ref_fb_V = "False"
            Fref_fb_Hz = "False"
            Pmeas_kW = "False"
            Pa_meas_kW = "False"
            Pb_meas_kW = "False"
            Pc_meas_kW = "False"
            Qmeas_kVAr = "False"
            Qa_meas_kVAr = "False"
            Qb_meas_kVAr = "False"
            Qc_meas_kVAr = "False"
            Smeas_kVA = "False"
            PFmeas = "False"
            Vgrid_rms_meas_kV = "False"
            Vconv_rms_meas_V = "False"
            Fmeas_Hz = "False"
            Ibatt_A = "False"
            Vbatt_V = "False"
            SOC = "False"
            SOH = "False"
            Available_Ppv_kW = "False"
            curtailment_status = "False"
            rotational_speed_RPM = "False"
            wind_speed_m_per_s = "False"
            turbine_stalled = "False"
            pitch_ctrl_on = "False"
            avg_wind_speed_1 = "False"
            avg_wind_speed_2 = "False"
            avg_wind_speed_sc = "False"
            prot_trip = "False"
            P_red_on = "False"
            P_cut_out = "False"
            Vgen_rms_meas_V = "False"
            Gen_speed_RPM = "False"
            Batt_cap_nom_Ah = "False"
            Vload_rms_meas_V = "False"
        }

        "core/Diesel Genset (Generic)" {
            Pnom = "1.2e6"
            Snom = "1.3e6"
            Vnom_LL = "400"
            fnom = "50"
            include_transformer = "False"
            Vnom_sec_LL = "400"
            Ls_pu = "0.1"
            wL_pu = "0"
            Zt_pu = "0.04"
            Rshunt_pu = "2000"
            Tfast = "100e-6"
            Tslow = "500e-6"
            Omega_nom = "1500"
        }

        "core/Grid" {
            Vb = "2300"
            f = "50"
            Sb = "20*40e3"
            pf = "0.1"
            Tfast = "100e-6"
            cont_type = "Ideal"
            resistance_cont = "0"
        }

        "core/PV Power Plant (Generic)" {
            Pnom = "250e3"
            Snom = "np.sqrt(2.0)*250e3"
            Vnom_LL = "400"
            fnom = "50"
            include_transformer = "True"
            Vnom_sec_LL = "13.8e3"
            ILR_factor = "1.2"
            wL_pu = "0.1"
            Zt_pu = "0.04"
            dc_link_margin = "0.4"
            opc_pu = "0.0"
            Rshunt_pu = "2000"
            Tfast = "100e-6"
            Tslow = "500e-6"
            Sg_sc_pu = "20"
            PFg = "0.1"
            cont_type = "Ideal"
            resistance_cont = "1.0"
            grid_code_fcn = "LVRT"
            lvrt_req = "Germany"
            vs_lvrt = "[0.0, 0.9, 0.901]"
            ts_lvrt = "[0.15, 1.5, 1.501]"
            preview = "Plot LVRT curve"
            voltvar_req = "Custom"
            vs_voltvar = "[0.6, 0.9, 1.1, 1.3]"
            qs_voltvar = "[1.3, 0.0, 0.0, -0.7]"
            preview_voltvar = "Plot VoltVAr curve"
            hzwatt_req = "Custom"
            fs_hzwatt = "[47.5, 47.8, 49.8, 50.2, 51.5]"
            ps_hzwatt = "[2.0, 2.0, 0.0, 0.0, -0.52]"
            preview_hzwatt = "Plot HzWatt curve"
            voltwatt_req = "Custom"
            vs_voltwatt = "[0.8, 1.06, 1.1, 1.3]"
            ps_voltwatt = "[1.0, 1.0, 0.2, 0.2]"
            preview_voltwatt = "Plot VoltWatt curve"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
            embedded_coupling = "False"
            ratio_type = "Automatic"
            ratio = "0.1"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            core_model = "Linear"
            ioc1 = "0.7"
            Poc1 = "460.0"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "None"
            coupling_type = "core"
            ratio_type = "Automatic"
            ratio = "0.1"
            Rshunt = "inf"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Variable Load (Generic)" {
            Pnom = "10e3"
            Snom = "np.sqrt(2)*10e3"
            Vnom_LL = "400"
            fnom = "50"
            include_transformer = "False"
            Vnom_sec_LL = "400"
            wL_pu = "0.1"
            Zt_pu = "0.04"
            dc_link_margin = "0.4"
            opc_pu = "0.2"
            Rshunt_pu = "2000"
            Sg_sc_pu = "20"
            PFg = "0.1"
            cont_type = "Ideal"
            resistance_cont = "0"
            Tfast = "100e-6"
            Tslow = "500e-6"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Wind Power Plant (Generic)" {
            Pnom = "2e6"
            Snom = "2e6*np.sqrt(2)"
            Vnom_LL = "400"
            fnom = "50"
            include_transformer = "True"
            Vnom_sec_LL = "400"
            v_cut_in = "2"
            v_rated = "13"
            rot_speed = "[6, 18]"
            wL_pu = "0.1"
            Zt_pu = "0.04"
            dc_link_margin = "0.4"
            opc_pu = "0.2"
            Rshunt_pu = "2000"
            Sg_sc_pu = "33"
            PFg = "0.1"
            cont_type = "Ideal"
            resistance_cont = "1.0"
            Tfast = "100e-6"
            Tslow = "500e-6"
            grid_code_fcn = "LVRT"
            lvrt_req = "Germany"
            vs_lvrt = "[0.0, 0.9, 0.901]"
            ts_lvrt = "[0.15, 1.5, 1.501]"
            preview = "Plot LVRT curve"
            voltvar_req = "Custom"
            vs_voltvar = "[0.6, 0.9, 1.1, 1.3]"
            qs_voltvar = "[1.3, 0.0, 0.0, -0.7]"
            preview_voltvar = "Plot VoltVAr curve"
            hzwatt_req = "Custom"
            fs_hzwatt = "[47.5, 47.8, 49.8, 50.2, 51.5]"
            ps_hzwatt = "[2.0, 2.0, 0.0, 0.0, -0.52]"
            preview_hzwatt = "Plot HzWatt curve"
            voltwatt_req = "Custom"
            vs_voltwatt = "[0.8, 1.06, 1.1, 1.3]"
            ps_voltwatt = "[1.0, 1.0, 0.2, 0.2]"
            preview_voltwatt = "Plot VoltWatt curve"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        #faster execution rate
        Ts1 = 200e-6
        
        #slower execution rate
        Ts2 = 1000e-6
        
    ENDCODE
}
