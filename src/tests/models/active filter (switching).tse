version = 4.2

//
// Saved by sw version: 2022.4 DEV
//

model "active filter (switching)" {
    configuration {
        hil_device = "HIL402"
        hil_configuration_id = 4
        simulation_method = exact
        simulation_time_step = 1e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "external memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        dss_num_tol = 1e-15
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
    }

    component Subsystem Root {
        component pas_inductor Li_a {
            inductance = "L_i"
        }
        [
            position = 8416, 7424
        ]

        component pas_inductor Li_b {
            inductance = "L_i"
        }
        [
            position = 8416, 7520
        ]

        component pas_inductor Li_c {
            inductance = "L_i"
        }
        [
            position = 8416, 7616
        ]

        component pas_inductor Lg_a {
            inductance = "L_g"
        }
        [
            position = 8952, 7424
        ]

        component pas_inductor Lg_b {
            inductance = "L_g"
        }
        [
            position = 8952, 7520
        ]

        component pas_inductor Lg_c {
            inductance = "L_g"
        }
        [
            position = 8952, 7616
        ]

        component pas_capacitor Ca {
            capacitance = "C"
        }
        [
            position = 8632, 7720
            rotation = right
        ]

        component pas_capacitor Cb {
            capacitance = "C"
        }
        [
            position = 8720, 7720
            rotation = right
        ]

        component pas_capacitor Cc {
            capacitance = "C"
        }
        [
            position = 8808, 7720
            rotation = right
        ]

        component "core/Current Measurement" Is_a {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
            sig_output = "True"
        }
        [
            position = 9176, 6896
            size = 64, 32
        ]

        component "core/Current Measurement" Ii_a {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "fsw"
            sig_output = "True"
        }
        [
            position = 8520, 7424
            size = 64, 32
        ]

        component "core/Current Measurement" Ii_b {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "fsw"
            sig_output = "True"
        }
        [
            position = 8520, 7520
            size = 64, 32
        ]

        component "core/Three Phase Voltage Source" Vgrid {
            init_rms_value = "230"
        }
        [
            position = 8704, 6992
            size = 62, 256
        ]

        component "core/Voltage Measurement" Van {
            execution_rate = "Ts"
            sig_output = "True"
        }
        [
            position = 9032, 7144
            rotation = right
            size = 64, 32
        ]

        component "core/Voltage Measurement" Vbn {
            execution_rate = "Ts"
            sig_output = "True"
        }
        [
            position = 9104, 7192
            rotation = right
            size = 64, 32
        ]

        component gen_bus_split "Split Vref" {
            outputs = "3"
        }
        [
            position = 8192, 7312
            hide_name = True
            scale = 1, -1
        ]

        component pas_inductor Lb {
            inductance = "Lc"
        }
        [
            position = 9768, 6992
        ]

        component pas_inductor Lc {
            inductance = "Lc"
        }
        [
            position = 9768, 7088
        ]

        component pas_inductor La {
            inductance = "Lc"
        }
        [
            position = 9768, 6896
        ]

        component "core/Three Phase T Type Inverter" "Three Phase T Type Inverter" {
            carrier_freq = "fsw"
            ctrl_src = "Internal modulator"
            d_time = "0"
            fvd_def_method_g1 = "LUT"
            fvd_def_method_g2 = "LUT"
            load_mode = "on either"
            ref_sig_min_max = "[-1, 1]"
        }
        [
            position = 8240, 7520
            size = 127, 256
        ]

        component "core/Voltage Measurement" Vdc {
            execution_rate = "Tslow"
            sig_output = "True"
        }
        [
            position = 7936, 7520
            rotation = left
            scale = 1, -1
            size = 64, 32
        ]

        component pas_resistor Rgrid_a {
            resistance = "Rgrid"
        }
        [
            position = 8848, 6896
            scale = -1, 1
        ]

        component src_ground gnd {
        }
        [
            position = 8640, 7288
            hide_name = True
            scale = -1, 1
        ]

        component "core/Three Phase Core Coupling" "Core Coupling 1" {
        }
        [
            position = 8864, 7520
            hide_name = True
            size = 12, 256
        ]

        component "core/Current Measurement" Il_a {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
            sig_output = "True"
        }
        [
            position = 9608, 6896
            size = 64, 32
        ]

        component "core/Current Measurement" Il_b {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
            sig_output = "True"
        }
        [
            position = 9608, 6992
            size = 64, 32
        ]

        component "core/Current Measurement" Il_c {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
        }
        [
            position = 9608, 7088
            size = 64, 32
        ]

        component "core/Current Measurement" Ig_a {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
            sig_output = "True"
        }
        [
            position = 9056, 7424
            size = 64, 32
        ]

        component "core/Current Measurement" Ig_b {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
            sig_output = "True"
        }
        [
            position = 9056, 7520
            size = 64, 32
        ]

        component "core/THD Measurement" "THD Measurement1" {
            execution_rate = "Tslow"
        }
        [
            position = 9208, 6776
            hide_name = True
            size = 48, 49
        ]

        component gen_probe "THDi source" {
        }
        [
            position = 9376, 6776
        ]

        component gen_gain Gain47 {
            gain = "100"
        }
        [
            position = 9296, 6776
            hide_name = True
        ]

        component "core/THD Measurement" "THD Measurement2" {
            execution_rate = "Tslow"
        }
        [
            position = 9640, 6752
            hide_name = True
            size = 48, 49
        ]

        component gen_probe "THDi load" {
        }
        [
            position = 9776, 6752
        ]

        component gen_gain Gain59 {
            gain = "100"
        }
        [
            position = 9704, 6752
            hide_name = True
        ]

        component pas_inductor Lgrid_b {
            inductance = "Lgrid"
        }
        [
            position = 8952, 6992
            scale = -1, 1
        ]

        component pas_inductor Lgrid_c {
            inductance = "Lgrid"
        }
        [
            position = 8952, 7088
            scale = -1, 1
        ]

        component pas_inductor Lgrid_a {
            inductance = "Lgrid"
        }
        [
            position = 8952, 6896
            scale = -1, 1
        ]

        component pas_capacitor Ctop {
            capacitance = "Cdc"
            initial_voltage = "310"
        }
        [
            position = 8040, 7472
            rotation = right
        ]

        component pas_capacitor Cbot {
            capacitance = "Cdc"
            initial_voltage = "310"
        }
        [
            position = 8040, 7568
            rotation = right
        ]

        component pas_resistor Rgrid_b {
            resistance = "Rgrid"
        }
        [
            position = 8848, 6992
            scale = -1, 1
        ]

        component pas_resistor Rgrid_c {
            resistance = "Rgrid"
        }
        [
            position = 8848, 7088
            scale = -1, 1
        ]

        component "core/Triple Pole Single Throw Contactor" MCB {
            ctrl_src = "Model"
        }
        [
            position = 9296, 7520
            size = 64, 256
        ]

        component "core/Rate Transition" "Rate Transition1" {
            execution_rate = "Tslow"
        }
        [
            position = 9608, 6808
            rotation = left
            hide_name = True
            size = 32, 32
        ]

        component "core/Rate Transition" "Rate Transition2" {
            execution_rate = "Tslow"
        }
        [
            position = 9176, 6832
            rotation = left
            hide_name = True
            size = 32, 32
        ]

        component Subsystem "Filter control" {
            layout = dynamic
            component "core/Three phase PLL" "Three phase PLL1" {
            }
            [
                position = 6504, 7480
                hide_name = True
                size = 64, 128
            ]

            component src_constant Constant2 {
                execution_rate = "Ts"
                value = "0"
            }
            [
                position = 6472, 7592
                hide_name = True
            ]

            component gen_bus_join "Bus Join10" {
                inputs = "3"
            }
            [
                position = 7320, 7840
                hide_name = True
            ]

            component gen_sum Sum47 {
                signs = "--"
            }
            [
                position = 5960, 7512
                hide_name = True
            ]

            component Subsystem "Notch filter slow a" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7168, 7768
                size = 64, 48
            ]

            component Subsystem "Notch filter slow b" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7168, 7840
                size = 64, 48
            ]

            component Subsystem "Notch filter slow c" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7168, 7912
                size = 64, 48
            ]

            component gen_product Product3 {
                signs = "**/"
            }
            [
                position = 9584, 7640
                hide_name = True
            ]

            component src_constant Constant5 {
                execution_rate = "Ts"
                value = "Vdc_ref"
            }
            [
                position = 9488, 7640
                hide_name = True
            ]

            component gen_sum Sum56 {
                signs = "3"
            }
            [
                position = 7792, 8464
                hide_name = True
            ]

            component sys_signal_switch "Signal switch5" {
                criterion = "ctrl >= threshold"
            }
            [
                position = 7448, 8464
                hide_name = True
            ]

            component Subsystem SM {
                layout = dynamic
                component gen_c_function SM {
                    global_variables = "int state;real v1;real Vss_min;real sqrt_3;"
                    init_fnc = "/*Begin code section*/
state = 0;
v1 = 0;
Vss_min = Vdc_ref - dv_ss;
sqrt_3 = 1.732050808;
/*End code section*/"
                    input_terminals = "real Enable;real Vdc;real Vg_d;real tran_flag;"
                    input_terminals_dimensions = "inherit;inherit;inherit;inherit"
                    input_terminals_feedthrough = "False;False;False;False"
                    input_terminals_show_labels = "True;True;True;True"
                    output_fnc = "/*Begin code section*/
/* State codes:
0. Off
1. Precharging
2. DC voltage stabilization
3. Full operation
*/

switch(state) {
    case 0:
        if(Enable > 0.5)
            if(Vdc < v1)
                state = 1;
            else if (Vdc >= v1 && Vdc < Vss_min)
                state = 2;
            else if (Vdc > Vss_min)
                state = 3;
        break;
    case 1:
        if(Enable < 0.5)
            state = 0;
        else if(Vdc > v1)
            state = 2;
        break;
    case 2:
        if(Enable < 0.5)
            state = 0;
        else if(Vdc < 0.8*v1)
            state = 1;
        else if(Vdc > Vss_min)
            state = 3;
        break;
    case 3:
        if(Enable < 0.5)
            state = 0;
        else if(Vdc < 0.8*Vss_min)
            state = 2;
        break;
}

switch(state) {
    case 0:
        MCB = 0;
        v_loop = 0;
        har_comp = 0;
        break;
    case 1:
        MCB = 1;
        v_loop = 0;
        har_comp = 0;
        break;
    case 2:
        MCB = 1;
        v_loop = 1;
        har_comp = 0;
        break;
    case 3:
        MCB = 1;
        v_loop = 1;
        har_comp = 1;
        break;
}
/*End code section*/"
                    output_terminals = "real har_comp;real v_loop;real MCB;"
                    output_terminals_dimensions = "inherit;inherit;inherit"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    parameters = "real Vdc_ref;real dv_ss;"
                    update_fnc = "/*Begin code section*/
v1 = Vg_d * sqrt_3 * 0.9;
/*End code section*/"
                }
                [
                    position = 8192, 8192
                    size = 152, 112
                ]

                port Vg_d {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8208
                ]

                port har_comp {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8456, 8160
                ]

                port V_loop {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8392, 8192
                ]

                port Enable {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7904, 8160
                ]

                port Vdc {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7944, 8176
                ]

                port MCB {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8328, 8224
                ]

                port tran_flag {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8224
                ]

                connect SM.Vg_d Vg_d as Connection1
                connect SM.Vdc Vdc as Connection7
                connect SM.Enable Enable as Connection6
                connect SM.har_comp har_comp as Connection3
                connect SM.v_loop V_loop as Connection4
                connect MCB SM.MCB as Connection9
                connect tran_flag SM.tran_flag as Connection11

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements the finite state machine of the converter. It handles the states of the converter, such as precharging, voltage regulation, etc.</p></body></html>"

                    dv_tol {
                        label = "Delta V tol"
                        widget = edit
                        type = generic
                        default_value = "500"
                        unit = "V"
                    }

                    dv_ss {
                        label = "Delta V ss"
                        widget = edit
                        type = generic
                        default_value = "50"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 6608, 8344
                size = 128, 136
            ]

            component gen_sum Sum60 {
                signs = "+-"
            }
            [
                position = 6504, 7768
                hide_name = True
            ]

            component gen_bus_split "Bus Split2" {
                outputs = "3"
            }
            [
                position = 6600, 7768
                hide_name = True
            ]

            component "core/abc to dq" "abc to dq5" {
            }
            [
                position = 6688, 7776
                hide_name = True
                size = 48, 80
            ]

            component gen_terminator Termination4 {
            }
            [
                position = 6760, 7840
                rotation = right
                hide_name = True
            ]

            component "core/dq to abc" "dq to abc1" {
                execution_rate = "inherit"
            }
            [
                position = 6600, 7920
                hide_name = True
                size = 48, 80
            ]

            component gen_bus_join "Bus Join12" {
                inputs = "3"
            }
            [
                position = 6688, 7920
                hide_name = True
            ]

            component sys_signal_switch "Signal switch6" {
                criterion = "ctrl >= threshold"
            }
            [
                position = 7448, 8344
                hide_name = True
            ]

            component sys_signal_switch "Signal switch7" {
                criterion = "ctrl >= threshold"
            }
            [
                position = 7448, 8224
                hide_name = True
            ]

            component gen_comparator Comparator1 {
            }
            [
                position = 7216, 8440
                hide_name = True
                scale = 1, -1
            ]

            component gen_logic_op "Logical operator1" {
            }
            [
                position = 7288, 8408
                hide_name = True
            ]

            component gen_comparator Comparator2 {
            }
            [
                position = 7216, 8376
                hide_name = True
            ]

            component src_constant Constant7 {
                execution_rate = "Tslow"
                value = "0.5"
            }
            [
                position = 7128, 8408
                hide_name = True
            ]

            component gen_PQ_transform "Power Meter1" {
                enable_inst_ports = "False"
            }
            [
                position = 7312, 7400
                hide_name = True
            ]

            component src_constant Constant9 {
                execution_rate = "inherit"
                value = "Sn/20"
            }
            [
                position = 7584, 7600
                hide_name = True
            ]

            component gen_comparator Comparator4 {
            }
            [
                position = 7648, 7592
                hide_name = True
            ]

            component gen_c_function Averaging {
                global_variables = "real T;real timer;real p_int;real flag;"
                init_fnc = "/*Begin code section*/
flag = p_int = 0;
T = 1/50;
/*End code section*/"
                input_terminals = "real Pinst;real f;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "False;False"
                input_terminals_show_labels = "True;True"
                output_fnc = "/*Begin code section*/
if(flag) {
    Pavg = p_int/T;
    p_int = 0;
}
/*End code section*/"
                output_terminals = "real Pavg;"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/
T = 1/f;

timer += execution_rate;
p_int += Pinst*execution_rate;

if(timer > T) {
    timer = 0;
    flag = 1;
} else
    flag = 0;
/*End code section*/"
            }
            [
                position = 7424, 7584
                size = 80, 56
            ]

            component gen_abs Abs2 {
            }
            [
                position = 7536, 7584
                hide_name = True
            ]

            component Subsystem "Notch filter fast a" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.7"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7672, 7768
                size = 64, 48
            ]

            component Subsystem "Notch filter fast b" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.7"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7672, 7840
                size = 64, 48
            ]

            component Subsystem "Notch filter fast c" {
                layout = dynamic
                component gen_z_domain_transfer "Filter TF" {
                    a_coeff = "[1, 2*ksi*(2*np.pi*f), (2*np.pi*f)**2]"
                    b_coeff = "[1, 0, (2*np.pi*f)**2]"
                    domain = "S-domain"
                }
                [
                    position = 8192, 8192
                ]

                port Out1 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8256, 8192
                    hide_name = True
                ]

                port In2 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect "Filter TF.out" Out1 as Connection1
                connect "Filter TF.in" In2 as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements a notch filter in order to selectively remove the desired harmonic from the input signal.</p></body></html>"

                    f {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "fg"
                        unit = "Hz"
                    }

                    ksi {
                        label = "Damping factor"
                        widget = edit
                        type = generic
                        default_value = "0.7"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7672, 7912
                size = 64, 48
            ]

            component gen_bus_join "Bus Join13" {
                inputs = "3"
            }
            [
                position = 7808, 7840
                hide_name = True
            ]

            component sys_signal_switch "Signal switch8" {
                criterion = "ctrl >= threshold"
            }
            [
                position = 7448, 8104
                hide_name = True
            ]

            component gen_sum Sum61 {
                signs = "--"
            }
            [
                position = 5960, 7864
                hide_name = True
            ]

            component Subsystem "DQ Integrator" {
                layout = dynamic
                component Subsystem "Harmonic compenzator" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7480, 7752
                    size = 160, 144
                ]

                component gen_sum Sum1 {
                    signs = "9"
                }
                [
                    position = 8512, 8120
                    hide_name = True
                ]

                component Subsystem "Harmonic compenzator1" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "5"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7480, 7968
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator2" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "7"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7480, 8176
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator3" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "11"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7480, 8392
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator4" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "13"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7480, 8608
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator5" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "17"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7944, 7752
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator6" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "19"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7944, 7960
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator7" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "23"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7944, 8176
                    size = 160, 144
                ]

                component Subsystem "Harmonic compenzator8" {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7144, 8120
                        size = 48, 80
                    ]

                    component gen_sum Sum12 {
                        signs = "+-"
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                    ]

                    component gen_sum Sum16 {
                        signs = "+-"
                    }
                    [
                        position = 7560, 8256
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch1" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8160
                        hide_name = True
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl >= threshold"
                    }
                    [
                        position = 7720, 8272
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7288, 8144
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 6736, 8384
                        hide_name = True
                    ]

                    component gen_gain scaler {
                        gain = "-5"
                    }
                    [
                        position = 6768, 8320
                    ]

                    component "core/abc to dq" "abc to dq3" {
                    }
                    [
                        position = 7144, 8256
                        size = 48, 80
                    ]

                    component gen_bus_split "Split ref" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8128
                    ]

                    component gen_bus_split "Split g" {
                        outputs = "3"
                    }
                    [
                        position = 6760, 8232
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 7288, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Join Vref" {
                        inputs = "3"
                    }
                    [
                        position = 8344, 8224
                    ]

                    component "core/dq to abc" "dq to abc Vref" {
                        execution_rate = "inherit"
                    }
                    [
                        position = 8264, 8224
                        size = 48, 80
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7880, 8160
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8160
                        hide_name = True
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                    ]

                    component gen_gain Gain2 {
                        gain = "ki_reg"
                    }
                    [
                        position = 7792, 8272
                        hide_name = True
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8056
                    ]

                    port "wt fund" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6696, 8320
                    ]

                    port I_ref {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8128
                    ]

                    port Ig {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6688, 8232
                    ]

                    port V_ref {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8424, 8224
                    ]

                    tag From1 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8144
                        hide_name = True
                    ]

                    tag From2 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8096
                        hide_name = True
                    ]

                    tag From3 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8112
                        hide_name = True
                    ]

                    tag From4 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8128
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8384
                        hide_name = True
                    ]

                    tag Goto8 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8096
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8120
                        hide_name = True
                    ]

                    tag From70 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8176
                        hide_name = True
                    ]

                    tag From71 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8288
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6776, 8056
                        hide_name = True
                    ]

                    tag From73 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8096
                        hide_name = True
                    ]

                    tag Goto34 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8320
                        hide_name = True
                    ]

                    tag Goto14 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8160
                        hide_name = True
                    ]

                    tag Goto15 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7984, 8272
                        hide_name = True
                    ]

                    tag Goto35 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8104
                        hide_name = True
                    ]

                    tag Goto36 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8128
                        hide_name = True
                    ]

                    tag Goto37 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8152
                        hide_name = True
                    ]

                    tag From29 {
                        value = "Enable"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8216
                        hide_name = True
                    ]

                    tag Goto41 {
                        value = "Ig_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8208
                        hide_name = True
                    ]

                    tag Goto42 {
                        value = "Ig_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8232
                        hide_name = True
                    ]

                    tag Goto43 {
                        value = "Ig_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6848, 8256
                        hide_name = True
                    ]

                    tag From60 {
                        value = "Ig_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7456, 8152
                        hide_name = True
                    ]

                    tag From61 {
                        value = "Ig_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7464, 8264
                        hide_name = True
                    ]

                    tag From74 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8280
                        hide_name = True
                    ]

                    tag From75 {
                        value = "Iref_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8232
                        hide_name = True
                    ]

                    tag From76 {
                        value = "Iref_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7056, 8248
                        hide_name = True
                    ]

                    tag From77 {
                        value = "Iref_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6984, 8264
                        hide_name = True
                    ]

                    tag Goto44 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8232
                        hide_name = True
                    ]

                    tag Goto45 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7240, 8256
                        hide_name = True
                    ]

                    tag From78 {
                        value = "Iref_d"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7392, 8136
                        hide_name = True
                    ]

                    tag From79 {
                        value = "Iref_q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7400, 8248
                        hide_name = True
                    ]

                    tag From67 {
                        value = "Vd_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8200
                        hide_name = True
                    ]

                    tag From68 {
                        value = "Vq_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8216
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From80 {
                        value = "zero"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8112, 8232
                        hide_name = True
                    ]

                    tag From81 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8248
                        hide_name = True
                    ]

                    connect "abc to dq1.zero_axis" Termination1.in as Connection1525
                    connect Goto32 Constant2.out as Connection1527
                    connect From70 "Signal switch1.in1" as Connection1528
                    connect From71 "Signal switch2.in1" as Connection1529
                    connect Enable Goto33 as Connection1532
                    connect From73 "Signal switch1.in2" as Connection1533
                    connect "wt fund" scaler.in as Connection1534
                    connect scaler.out Goto34 as Connection1535
                    connect "Split ref.in" I_ref as Connection1545
                    connect "Split ref.out" Goto35 as Connection1546
                    connect Goto36 "Split ref.out1" as Connection1547
                    connect "Split ref.out2" Goto37 as Connection1548
                    connect Ig "Split g.in" as Connection1553
                    connect "Split g.out" Goto41 as Connection1554
                    connect "Split g.out1" Goto42 as Connection1555
                    connect "Split g.out2" Goto43 as Connection1556
                    connect From75 "abc to dq3.va" as Connection1559
                    connect "abc to dq3.vb" From76 as Connection1560
                    connect "abc to dq3.vc" From77 as Connection1561
                    connect From74 "abc to dq3.wt" as Connection1562
                    connect Goto44 "abc to dq3.d_axis" as Connection1563
                    connect "abc to dq3.q_axis" Goto45 as Connection1564
                    connect Termination3.in "abc to dq3.zero_axis" as Connection1565
                    connect V_ref "Join Vref.out" as Connection1574
                    connect From3 "abc to dq1.vb" as Connection283
                    connect From4 "abc to dq1.vc" as Connection284
                    connect "Signal switch1.in" Sum12.out as Connection567
                    connect "Signal switch2.in" Sum16.out as Connection575
                    connect From29 "Signal switch2.in2" as Connection580
                    connect "abc to dq1.q_axis" Goto9 as Connection1500
                    connect From1 "abc to dq1.wt" as Connection1503
                    connect "abc to dq1.va" From2 as Connection1501
                    connect "abc to dq1.d_axis" Goto8 as Connection1502
                    connect From67 "dq to abc Vref.d_input" as Connection1594
                    connect From68 "dq to abc Vref.q_input" as Connection1595
                    connect From80 "dq to abc Vref.zero_input" as Connection1596
                    connect "dq to abc Vref.phase_a" "Join Vref.in" as Connection1598
                    connect "dq to abc Vref.phase_b" "Join Vref.in1" as Connection1599
                    connect "dq to abc Vref.phase_c" "Join Vref.in2" as Connection1600
                    connect Sum16.in1 From61 as Connection1660
                    connect Sum16.in From79 as Connection1662
                    connect "dq to abc Vref.wt" From81 as Connection1671
                    connect From78 Sum12.in as Connection1672
                    connect Sum12.in1 From60 as Connection1673
                    connect Gain1.out Integrator1.in as Connection1676
                    connect "Signal switch1.out" Gain1.in as Connection1677
                    connect Integrator1.out Goto14 as Connection1678
                    connect Gain2.out Integrator2.in as Connection1679
                    connect Gain2.in "Signal switch2.out" as Connection1680
                    connect Integrator2.out Goto15 as Connection1681

                    h = "25"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                        h {
                            label = "Harmonic order"
                            widget = edit
                            type = generic
                            default_value = "1"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE pre_compile
                            # HEADER START
                            h = mdl.get_property_value(mdl.prop(item_handle, "h"))
                            # HEADER STOP
                            comp_handle = mdl.get_sub_level_handle(item_handle)
                            gain_handle = mdl.get_item('scaler', comp_handle, 'component')
                            mdl.set_property_value(mdl.prop(gain_handle, 'gain'), h)
                            for k in range(1, 20):
                                if h == (6*k-1):
                                    mdl.set_property_value(mdl.prop(gain_handle, 'gain'), -h)
                        ENDCODE
                    }
                }
                [
                    position = 7944, 8392
                    size = 160, 144
                ]

                component gen_gain Gain38 {
                }
                [
                    position = 8088, 8392
                ]

                port Vref_I {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8616, 8120
                ]

                port I_ref {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7056, 8080
                ]

                port I_g {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7056, 8128
                ]

                port wt {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7056, 8176
                ]

                port volt_en {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7056, 8032
                ]

                tag Goto72 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7152, 8032
                    hide_name = True
                ]

                tag Goto74 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7152, 8080
                    hide_name = True
                ]

                tag Goto76 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7152, 8128
                    hide_name = True
                ]

                tag Goto77 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7152, 8176
                    hide_name = True
                ]

                tag From67 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 7704
                    hide_name = True
                ]

                tag From75 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 7752
                    hide_name = True
                ]

                tag From76 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 7800
                    hide_name = True
                ]

                tag Goto35 {
                    value = "Vref1"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 7752
                    hide_name = True
                ]

                tag From78 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7432, 7656
                    hide_name = True
                ]

                tag Goto39 {
                    value = "Vref2"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 7968
                    hide_name = True
                ]

                tag Goto40 {
                    value = "Vref3"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 8176
                    hide_name = True
                ]

                tag Goto52 {
                    value = "Vref4"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 8392
                    hide_name = True
                ]

                tag Goto53 {
                    value = "Vref5"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 8608
                    hide_name = True
                ]

                tag Goto54 {
                    value = "Vref6"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8112, 7752
                    hide_name = True
                ]

                tag Goto55 {
                    value = "Vref7"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8112, 7960
                    hide_name = True
                ]

                tag Goto56 {
                    value = "Vref8"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8112, 8176
                    hide_name = True
                ]

                tag Goto57 {
                    value = "Vref9"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8176, 8392
                    hide_name = True
                ]

                tag From221 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 7920
                    hide_name = True
                ]

                tag From223 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 7968
                    hide_name = True
                ]

                tag From224 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8016
                    hide_name = True
                ]

                tag From226 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8128
                    hide_name = True
                ]

                tag From228 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8176
                    hide_name = True
                ]

                tag From229 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8224
                    hide_name = True
                ]

                tag From231 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8344
                    hide_name = True
                ]

                tag From233 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8392
                    hide_name = True
                ]

                tag From234 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8440
                    hide_name = True
                ]

                tag From236 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8560
                    hide_name = True
                ]

                tag From238 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8608
                    hide_name = True
                ]

                tag From239 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7328, 8656
                    hide_name = True
                ]

                tag From241 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 7704
                    hide_name = True
                ]

                tag From243 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 7752
                    hide_name = True
                ]

                tag From244 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 7800
                    hide_name = True
                ]

                tag From246 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 7912
                    hide_name = True
                ]

                tag From248 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 7960
                    hide_name = True
                ]

                tag From249 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8008
                    hide_name = True
                ]

                tag From251 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8128
                    hide_name = True
                ]

                tag From253 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8176
                    hide_name = True
                ]

                tag From254 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8224
                    hide_name = True
                ]

                tag From256 {
                    value = "I_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8344
                    hide_name = True
                ]

                tag From258 {
                    value = "I_g"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8392
                    hide_name = True
                ]

                tag From259 {
                    value = "wt"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7792, 8440
                    hide_name = True
                ]

                tag From380 {
                    value = "Vref1"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 8056
                    hide_name = True
                ]

                tag From381 {
                    value = "Vref2"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8392, 8072
                    hide_name = True
                ]

                tag From382 {
                    value = "Vref3"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 8088
                    hide_name = True
                ]

                tag From383 {
                    value = "Vref4"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8392, 8104
                    hide_name = True
                ]

                tag From384 {
                    value = "Vref5"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 8120
                    hide_name = True
                ]

                tag From385 {
                    value = "Vref6"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8392, 8136
                    hide_name = True
                ]

                tag From386 {
                    value = "Vref7"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 8152
                    hide_name = True
                ]

                tag From390 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7432, 7872
                    hide_name = True
                ]

                tag From391 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7432, 8080
                    hide_name = True
                ]

                tag From392 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7432, 8288
                    hide_name = True
                ]

                tag From393 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7440, 8504
                    hide_name = True
                ]

                tag From394 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7896, 8296
                    hide_name = True
                ]

                tag From395 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7896, 8080
                    hide_name = True
                ]

                tag From396 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7896, 7656
                    hide_name = True
                ]

                tag From397 {
                    value = "volt_en"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7904, 7864
                    hide_name = True
                ]

                tag From387 {
                    value = "Vref8"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8392, 8168
                    hide_name = True
                ]

                tag From388 {
                    value = "Vref9"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 8184
                    hide_name = True
                ]

                connect Goto72 volt_en as Connection4721
                connect I_ref Goto74 as Connection4723
                connect I_g Goto76 as Connection4725
                connect wt Goto77 as Connection4726
                connect Sum1.out Vref_I as Connection4728
                connect From380 Sum1.in as Connection4729
                connect From381 Sum1.in1 as Connection4730
                connect From382 Sum1.in2 as Connection4731
                connect From383 Sum1.in3 as Connection4732
                connect From384 Sum1.in4 as Connection4733
                connect From385 Sum1.in5 as Connection4734
                connect From386 Sum1.in6 as Connection4735
                connect "Harmonic compenzator.wt fund" From76 as Connection1990
                connect From75 "Harmonic compenzator.Ig" as Connection1991
                connect From67 "Harmonic compenzator.I_ref" as Connection1993
                connect From78 "Harmonic compenzator.Enable" as Connection1994
                connect From221 "Harmonic compenzator1.I_ref" as Connection4739
                connect From223 "Harmonic compenzator1.Ig" as Connection4740
                connect From224 "Harmonic compenzator1.wt fund" as Connection4741
                connect From390 "Harmonic compenzator1.Enable" as Connection4742
                connect From396 "Harmonic compenzator5.Enable" as Connection4744
                connect From391 "Harmonic compenzator2.Enable" as Connection4745
                connect From226 "Harmonic compenzator2.I_ref" as Connection4746
                connect From228 "Harmonic compenzator2.Ig" as Connection4747
                connect From229 "Harmonic compenzator2.wt fund" as Connection4748
                connect From392 "Harmonic compenzator3.Enable" as Connection4749
                connect From231 "Harmonic compenzator3.I_ref" as Connection4750
                connect From233 "Harmonic compenzator3.Ig" as Connection4751
                connect From234 "Harmonic compenzator3.wt fund" as Connection4752
                connect "Harmonic compenzator3.V_ref" Goto52 as Connection4753
                connect From393 "Harmonic compenzator4.Enable" as Connection4754
                connect From236 "Harmonic compenzator4.I_ref" as Connection4755
                connect From238 "Harmonic compenzator4.Ig" as Connection4756
                connect From239 "Harmonic compenzator4.wt fund" as Connection4757
                connect "Harmonic compenzator4.V_ref" Goto53 as Connection4758
                connect From241 "Harmonic compenzator5.I_ref" as Connection4759
                connect From243 "Harmonic compenzator5.Ig" as Connection4760
                connect From244 "Harmonic compenzator5.wt fund" as Connection4761
                connect "Harmonic compenzator5.V_ref" Goto54 as Connection4762
                connect Goto35 "Harmonic compenzator.V_ref" as Connection4763
                connect "Harmonic compenzator1.V_ref" Goto39 as Connection4764
                connect "Harmonic compenzator2.V_ref" Goto40 as Connection4765
                connect From246 "Harmonic compenzator6.I_ref" as Connection4766
                connect From397 "Harmonic compenzator6.Enable" as Connection4767
                connect "Harmonic compenzator6.V_ref" Goto55 as Connection4768
                connect From248 "Harmonic compenzator6.Ig" as Connection4769
                connect From249 "Harmonic compenzator6.wt fund" as Connection4770
                connect From395 "Harmonic compenzator7.Enable" as Connection4771
                connect From251 "Harmonic compenzator7.I_ref" as Connection4772
                connect From253 "Harmonic compenzator7.Ig" as Connection4773
                connect From254 "Harmonic compenzator7.wt fund" as Connection4774
                connect "Harmonic compenzator7.V_ref" Goto56 as Connection4775
                connect From394 "Harmonic compenzator8.Enable" as Connection4776
                connect From256 "Harmonic compenzator8.I_ref" as Connection4777
                connect From258 "Harmonic compenzator8.Ig" as Connection4778
                connect From259 "Harmonic compenzator8.wt fund" as Connection4779
                connect From387 Sum1.in7 as Connection4785
                connect From388 Sum1.in8 as Connection4786
                connect "Harmonic compenzator8.V_ref" Gain38.in as Connection4787
                connect Gain38.out Goto57 as Connection4788

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements the integrating regulator of the current control loop. There are multiple integrators in dq domain, one for each of the harmonics of interest.</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8560, 7672
                size = 184, 312
            ]

            component gen_bus_split "Bus Split4" {
                outputs = "3"
            }
            [
                position = 7216, 7480
                rotation = left
                hide_name = True
            ]

            component gen_bus_join "Bus Join15" {
                inputs = "3"
            }
            [
                position = 6040, 7480
                hide_name = True
            ]

            component gen_bus_join "Bus Join16" {
                inputs = "3"
            }
            [
                position = 6040, 7664
                hide_name = True
            ]

            component gen_bus_join "Bus Join17" {
                inputs = "3"
            }
            [
                position = 6040, 7832
                hide_name = True
            ]

            component gen_sum Sum62 {
                signs = "--"
            }
            [
                position = 5960, 7696
                hide_name = True
            ]

            component gen_terminator Termination5 {
            }
            [
                position = 6840, 7840
                rotation = right
                hide_name = True
            ]

            component gen_sum Sum63 {
                signs = "--"
            }
            [
                position = 5960, 8056
                hide_name = True
            ]

            component gen_bus_join "Bus Join18" {
                inputs = "3"
            }
            [
                position = 6040, 8024
                hide_name = True
            ]

            component gen_limiter Limit1 {
                lower_limit = "1"
            }
            [
                position = 5912, 7328
                hide_name = True
            ]

            component gen_terminator Termination6 {
            }
            [
                position = 6584, 7552
                rotation = right
                hide_name = True
            ]

            component gen_terminator Termination7 {
            }
            [
                position = 6728, 7552
                rotation = right
                hide_name = True
            ]

            component gen_terminator Termination8 {
            }
            [
                position = 6768, 7552
                rotation = right
                hide_name = True
            ]

            component gen_limiter Limit2 {
                lower_limit = "1"
            }
            [
                position = 7312, 7592
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition8" {
                execution_rate = "Tslow"
            }
            [
                position = 7160, 7528
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition11" {
                execution_rate = "Tslow"
            }
            [
                position = 7064, 7360
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition12" {
                execution_rate = "Tslow"
            }
            [
                position = 7120, 7376
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition13" {
                execution_rate = "Tslow"
            }
            [
                position = 7176, 7392
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition14" {
                execution_rate = "Tslow"
            }
            [
                position = 7208, 7592
                hide_name = True
                size = 32, 32
            ]

            component gen_terminator Termination9 {
            }
            [
                position = 7376, 7384
                rotation = right
                hide_name = True
            ]

            component gen_terminator Termination10 {
            }
            [
                position = 7416, 7456
                rotation = right
                hide_name = True
            ]

            component gen_terminator Termination11 {
            }
            [
                position = 7376, 7456
                rotation = right
                hide_name = True
            ]

            component src_constant Constant4 {
                execution_rate = "inherit"
                value = "Vdc_ref"
            }
            [
                position = 8904, 7616
                hide_name = True
            ]

            component Subsystem "Voltage control loop" {
                layout = dynamic
                component gen_sum Sum55 {
                    signs = "+-"
                }
                [
                    position = 7872, 8120
                    hide_name = True
                ]

                component gen_product Product4 {
                }
                [
                    position = 7720, 8072
                    hide_name = True
                ]

                component gen_gain Gain62 {
                    gain = "Cdc/4"
                }
                [
                    position = 7792, 8072
                    hide_name = True
                ]

                component gen_pid_controller "P d1" {
                    controller_type = "PI"
                    ki = "Ki_v"
                    kp = "Kp_v"
                }
                [
                    position = 8208, 8144
                ]

                component "core/dq to abc" "dq to abc2" {
                    execution_rate = "inherit"
                }
                [
                    position = 8592, 8248
                    hide_name = True
                    size = 48, 80
                ]

                component gen_bus_join "Bus Join12" {
                    inputs = "3"
                }
                [
                    position = 8672, 8248
                    hide_name = True
                ]

                component gen_product Product5 {
                }
                [
                    position = 7720, 8160
                    hide_name = True
                ]

                component gen_gain Gain63 {
                    gain = "Cdc/4"
                }
                [
                    position = 7792, 8160
                    hide_name = True
                ]

                component sys_signal_switch "Signal switch4" {
                    criterion = "ctrl >= threshold"
                }
                [
                    position = 8016, 8136
                    hide_name = True
                ]

                component gen_gain Gain65 {
                    gain = "-1.5"
                }
                [
                    position = 8248, 8248
                    rotation = left
                    hide_name = True
                ]

                component gen_limiter Limit1 {
                    lower_limit = "10"
                }
                [
                    position = 8208, 8296
                    hide_name = True
                ]

                component src_constant Constant6 {
                    execution_rate = "inherit"
                    value = "0"
                }
                [
                    position = 7840, 8312
                    hide_name = True
                ]

                component gen_product Product6 {
                    signs = "*/"
                }
                [
                    position = 8336, 8152
                    hide_name = True
                ]

                port Vdc_meas {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7616, 8160
                ]

                port Vdc_ref {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7616, 8072
                ]

                port V_loop_en {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8056
                    rotation = right
                ]

                port wt {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8520, 8272
                ]

                port Iref_V {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8792, 8248
                ]

                port Vg_d {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8296
                ]

                tag Goto1 {
                    value = "zero"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7936, 8312
                    hide_name = True
                ]

                tag From308 {
                    value = "zero"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8464, 8240
                    hide_name = True
                ]

                tag From311 {
                    value = "zero"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7936, 8216
                    hide_name = True
                ]

                junction Junction486 sp
                [
                    position = 7664, 8160
                ]

                junction Junction448 sp
                [
                    position = 7664, 8072
                ]

                junction Junction450 sp
                [
                    position = 8528, 8240
                ]

                connect Junction448 Vdc_ref as Connection3984
                connect "dq to abc2.wt" wt as Connection3987
                connect "Signal switch4.in2" V_loop_en as Connection3986
                connect Constant6.out Goto1 as Connection3990
                connect Product5.in1 Junction486 as Connection3994
                connect Junction486 Product5.in as Connection3995
                [
                    breakpoints = 7664, 8152
                ]
                connect Junction486 Vdc_meas as Connection4006
                connect Vg_d Limit1.in as Connection4007
                connect Product4.in Junction448 as Connection3714
                connect Product4.in1 Junction448 as Connection3716
                connect Gain62.in Product4.out as Connection3717
                connect From308 Junction450 as Connection3725
                connect Junction450 "dq to abc2.q_input" as Connection3726
                connect "dq to abc2.zero_input" Junction450 as Connection3727
                connect "Bus Join12.in" "dq to abc2.phase_a" as Connection3729
                connect "Bus Join12.in1" "dq to abc2.phase_b" as Connection3730
                connect "dq to abc2.phase_c" "Bus Join12.in2" as Connection3731
                connect Gain63.in Product5.out as Connection3738
                connect From311 "Signal switch4.in1" as Connection3748
                connect "Signal switch4.in" Sum55.out as Connection3750
                connect Gain65.in Limit1.out as Connection3928
                connect Product6.in1 Gain65.out as Connection4014
                connect "Bus Join12.out" Iref_V as Connection4021
                [
                    breakpoints = 8728, 8248; 8728, 8248
                ]
                connect "Signal switch4.out" "P d1.in" as Connection4023
                [
                    breakpoints = 8104, 8136; 8104, 8136
                ]
                connect "dq to abc2.d_input" Product6.out as Connection4022
                [
                    breakpoints = 8504, 8152
                ]
                connect Product6.in "P d1.out" as Connection4024
                [
                    breakpoints = 8264, 8144
                ]
                connect Gain62.out Sum55.in as Connection4025
                [
                    breakpoints = 7832, 8112
                ]
                connect Gain63.out Sum55.in1 as Connection4026

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements the DC voltage control loop. It operates at a slower execution rate than the current loop.</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 9080, 7664
                size = 120, 144
            ]

            component Subsystem "P regulator" {
                layout = dynamic
                component gen_bus_split "Bus Split1" {
                    outputs = "3"
                }
                [
                    position = 7544, 8008
                    hide_name = True
                ]

                component gen_sum Sum12 {
                    signs = "+-"
                }
                [
                    position = 8032, 7896
                    hide_name = True
                ]

                component gen_sum Sum17 {
                    signs = "++-"
                }
                [
                    position = 8464, 7912
                    hide_name = True
                ]

                component gen_gain Gain14 {
                    gain = "delta"
                }
                [
                    position = 8344, 8024
                    hide_name = True
                ]

                component gen_sum Sum34 {
                    signs = "+-"
                }
                [
                    position = 8264, 8024
                    hide_name = True
                ]

                component gen_sum Sum42 {
                    signs = "+-"
                }
                [
                    position = 8032, 8120
                    hide_name = True
                ]

                component gen_sum Sum43 {
                    signs = "++-"
                }
                [
                    position = 8464, 8136
                    hide_name = True
                ]

                component gen_gain Gain19 {
                    gain = "delta"
                }
                [
                    position = 8344, 8240
                    hide_name = True
                ]

                component gen_sum Sum44 {
                    signs = "+-"
                }
                [
                    position = 8264, 8240
                    hide_name = True
                ]

                component gen_bus_join "Bus Join5" {
                    inputs = "3"
                }
                [
                    position = 8752, 8136
                    hide_name = True
                ]

                component gen_sum Sum48 {
                    signs = "+-"
                }
                [
                    position = 8032, 8360
                    hide_name = True
                ]

                component gen_sum Sum49 {
                    signs = "++-"
                }
                [
                    position = 8464, 8376
                    hide_name = True
                ]

                component gen_gain Gain40 {
                    gain = "delta"
                }
                [
                    position = 8344, 8480
                    hide_name = True
                ]

                component gen_sum Sum50 {
                    signs = "+-"
                }
                [
                    position = 8264, 8480
                    hide_name = True
                ]

                component gen_gain Gain41 {
                    gain = "2/Vdc_ref"
                }
                [
                    position = 8264, 7968
                    hide_name = True
                ]

                component gen_gain Gain42 {
                    gain = "2/Vdc_ref"
                }
                [
                    position = 8264, 8184
                    hide_name = True
                ]

                component gen_gain Gain43 {
                    gain = "2/Vdc_ref"
                }
                [
                    position = 8264, 8424
                    hide_name = True
                ]

                component gen_bus_split "Bus Split2" {
                    outputs = "3"
                }
                [
                    position = 7544, 8128
                    hide_name = True
                ]

                component gen_bus_split "Bus Split3" {
                    outputs = "3"
                }
                [
                    position = 7544, 8248
                    hide_name = True
                ]

                component gen_bus_split "Bus Split4" {
                    outputs = "3"
                }
                [
                    position = 7544, 7904
                    hide_name = True
                ]

                component gen_pid_controller "P a" {
                    controller_type = "P"
                    kp = "kp_reg"
                }
                [
                    position = 8136, 7896
                ]

                component gen_pid_controller "P b" {
                    controller_type = "P"
                    kp = "kp_reg"
                }
                [
                    position = 8144, 8120
                ]

                component gen_pid_controller "P c" {
                    controller_type = "P"
                    kp = "kp_reg"
                }
                [
                    position = 8144, 8360
                ]

                port Vref_P {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8824, 8136
                ]

                port Iref_abc {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7472, 8008
                ]

                port Ig_abc {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7472, 8128
                ]

                port Ii_abc {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7472, 8248
                ]

                port Vg_abc {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7472, 7904
                ]

                tag Goto64 {
                    value = "Ig_a"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 8112
                    hide_name = True
                ]

                tag Goto65 {
                    value = "Ig_b"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7704, 8128
                    hide_name = True
                ]

                tag Goto66 {
                    value = "Ig_c"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 8144
                    hide_name = True
                ]

                tag Goto67 {
                    value = "Ii_a"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 8232
                    hide_name = True
                ]

                tag Goto68 {
                    value = "Ii_b"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7704, 8248
                    hide_name = True
                ]

                tag Goto69 {
                    value = "Ii_c"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 8264
                    hide_name = True
                ]

                tag Goto70 {
                    value = "Vg_a"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 7888
                    hide_name = True
                ]

                tag Goto71 {
                    value = "Vg_b"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7704, 7904
                    hide_name = True
                ]

                tag Goto72 {
                    value = "Vg_c"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 7920
                    hide_name = True
                ]

                tag Goto14 {
                    value = "Va_ref_P"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8576, 7912
                    hide_name = True
                ]

                tag From60 {
                    value = "Ig_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7936, 7904
                    hide_name = True
                ]

                tag From62 {
                    value = "Ii_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8008
                    hide_name = True
                ]

                tag From63 {
                    value = "Ig_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8040
                    hide_name = True
                ]

                tag From100 {
                    value = "Iref_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7872, 7888
                    hide_name = True
                ]

                tag From102 {
                    value = "Vg_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 7968
                    hide_name = True
                ]

                tag Goto46 {
                    value = "Vb_ref_P"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8576, 8136
                    hide_name = True
                ]

                tag From106 {
                    value = "Ig_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7936, 8128
                    hide_name = True
                ]

                tag From107 {
                    value = "Ii_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8224
                    hide_name = True
                ]

                tag From108 {
                    value = "Ig_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8256
                    hide_name = True
                ]

                tag From109 {
                    value = "Iref_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7872, 8112
                    hide_name = True
                ]

                tag From110 {
                    value = "Vg_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8184
                    hide_name = True
                ]

                tag Goto60 {
                    value = "Iref_a"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 7992
                    hide_name = True
                ]

                tag Goto61 {
                    value = "Iref_b"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7704, 8008
                    hide_name = True
                ]

                tag Goto62 {
                    value = "Iref_c"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7640, 8024
                    hide_name = True
                ]

                tag Goto63 {
                    value = "Vc_ref_P"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8576, 8376
                    hide_name = True
                ]

                tag From201 {
                    value = "Ig_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7936, 8368
                    hide_name = True
                ]

                tag From202 {
                    value = "Ii_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8464
                    hide_name = True
                ]

                tag From203 {
                    value = "Ig_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8496
                    hide_name = True
                ]

                tag From204 {
                    value = "Iref_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7872, 8352
                    hide_name = True
                ]

                tag From205 {
                    value = "Vg_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8424
                    hide_name = True
                ]

                tag From206 {
                    value = "Va_ref_P"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8664, 8112
                    hide_name = True
                ]

                tag From207 {
                    value = "Vb_ref_P"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8664, 8136
                    hide_name = True
                ]

                tag From208 {
                    value = "Vc_ref_P"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8664, 8160
                    hide_name = True
                ]

                connect "Bus Split1.in" Iref_abc as Connection4978
                connect "Bus Join5.out" Vref_P as Connection4977
                connect "Bus Split2.in" Ig_abc as Connection4979
                connect Goto65 "Bus Split2.out1" as Connection4980
                connect Goto66 "Bus Split2.out2" as Connection4981
                connect Goto64 "Bus Split2.out" as Connection4982
                connect "Bus Split3.in" Ii_abc as Connection4983
                connect Goto68 "Bus Split3.out1" as Connection4984
                connect Goto69 "Bus Split3.out2" as Connection4985
                connect Goto67 "Bus Split3.out" as Connection4986
                connect "Bus Split4.in" Vg_abc as Connection4987
                connect Goto71 "Bus Split4.out1" as Connection4988
                connect Goto72 "Bus Split4.out2" as Connection4989
                connect Goto70 "Bus Split4.out" as Connection4990
                connect From62 Sum34.in as Connection535
                connect Sum34.in1 From63 as Connection536
                connect Sum34.out Gain14.in as Connection537
                connect From107 Sum44.in as Connection1614
                connect Sum44.in1 From108 as Connection1615
                connect Sum44.out Gain19.in as Connection1616
                connect From109 Sum42.in as Connection2781
                connect From202 Sum50.in as Connection2791
                connect Sum50.in1 From203 as Connection2792
                connect Sum50.out Gain40.in as Connection2793
                connect From204 Sum48.in as Connection2798
                connect "Bus Join5.in" From206 as Connection2808
                connect From207 "Bus Join5.in1" as Connection2809
                connect "Bus Join5.in2" From208 as Connection2810
                connect Gain41.in From102 as Connection2858
                connect Gain41.out Sum17.in1 as Connection2859
                [
                    breakpoints = 8304, 7968; 8304, 7912
                ]
                connect Gain42.in From110 as Connection2860
                connect Gain42.out Sum43.in1 as Connection2861
                [
                    breakpoints = 8312, 8184; 8312, 8136
                ]
                connect Gain43.out Sum49.in1 as Connection2862
                [
                    breakpoints = 8304, 8424; 8304, 8376
                ]
                connect Gain43.in From205 as Connection2863
                connect From100 Sum12.in as Connection2866
                connect From60 Sum12.in1 as Connection2961
                connect Sum42.in1 From106 as Connection2963
                connect Sum48.in1 From201 as Connection2965
                connect Sum43.in2 Gain19.out as Connection4376
                [
                    breakpoints = 8424, 8152; 8424, 8240
                ]
                connect Sum49.in2 Gain40.out as Connection4377
                [
                    breakpoints = 8424, 8392; 8424, 8480
                ]
                connect Sum43.out Goto46 as Connection4879
                connect Sum49.out Goto63 as Connection4880
                connect Goto61 "Bus Split1.out1" as Connection4881
                connect Goto62 "Bus Split1.out2" as Connection4883
                connect Goto60 "Bus Split1.out" as Connection4882
                connect Sum17.out Goto14 as Connection4970
                [
                    breakpoints = 8520, 7912; 8520, 7912
                ]
                connect Gain14.out Sum17.in2 as Connection4969
                [
                    breakpoints = 8408, 8024; 8424, 8024; 8424, 8024; 8424, 8024
                ]
                connect Sum12.out "P a.in" as Connection4971
                connect "P a.out" Sum17.in as Connection4972
                connect Sum42.out "P b.in" as Connection4973
                connect "P b.out" Sum43.in as Connection4974
                connect Sum48.out "P c.in" as Connection4975
                connect "P c.out" Sum49.in as Connection4976

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem implements the P regulator of the current control loop.</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8560, 7968
                size = 184, 152
            ]

            component gen_sum Sum64 {
            }
            [
                position = 9480, 7592
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition16" {
                execution_rate = "Tslow"
            }
            [
                position = 8968, 7680
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition17" {
                execution_rate = "Tslow"
            }
            [
                position = 8968, 7712
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition18" {
                execution_rate = "Ts"
            }
            [
                position = 7416, 8408
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition22" {
                execution_rate = "Tslow"
            }
            [
                position = 6488, 8360
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition23" {
                execution_rate = "Ts"
            }
            [
                position = 7416, 8280
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition24" {
                execution_rate = "Ts"
            }
            [
                position = 8560, 7480
                rotation = right
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition25" {
                execution_rate = "Ts"
            }
            [
                position = 9576, 7760
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition26" {
                execution_rate = "Ts"
            }
            [
                position = 5928, 8192
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition27" {
                execution_rate = "Ts"
            }
            [
                position = 9192, 7664
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition28" {
                execution_rate = "Ts"
            }
            [
                position = 9488, 7680
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition29" {
                execution_rate = "Ts"
            }
            [
                position = 7416, 8040
                hide_name = True
                size = 32, 32
            ]

            component gen_comparator Comparator5 {
            }
            [
                position = 8048, 8272
                hide_name = True
                scale = 1, -1
            ]

            component sys_signal_switch "Signal switch9" {
                criterion = "ctrl >= threshold"
            }
            [
                position = 8352, 8416
                hide_name = True
            ]

            component gen_c_function "C function2" {
                input_terminals = "real imax;real i;"
                input_terminals_dimensions = "1;1"
                input_terminals_feedthrough = "True;True"
                input_terminals_show_labels = "True;True"
                output_fnc = "/*Begin code section*/
if(i != 0)  //division by zero prevention
    out = imax/i;  //output current limitation
else
    out=1;
/*End code section*/"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "False"
            }
            [
                position = 8056, 8376
                hide_name = True
                size = 64, 48
            ]

            component src_constant I_max {
                _tunable = "True"
                execution_rate = "inherit"
                value = "100"
            }
            [
                position = 7952, 8264
            ]

            component gen_digital_probe Imax_FLAG {
            }
            [
                position = 8416, 8344
            ]

            component Subsystem Subsystem1 {
                layout = dynamic
                component gen_product Product5 {
                }
                [
                    position = 8136, 8232
                    hide_name = True
                ]

                component gen_product Product6 {
                }
                [
                    position = 8136, 8304
                    hide_name = True
                ]

                component gen_bus_split "Bus Split2" {
                    outputs = "3"
                }
                [
                    position = 8016, 8240
                    hide_name = True
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 8224, 8232
                    hide_name = True
                ]

                component gen_product Product4 {
                }
                [
                    position = 8136, 8176
                    hide_name = True
                ]

                port In2 {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7936, 8240
                    hide_name = True
                ]

                port In1 {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7936, 8168
                    hide_name = True
                ]

                port Out3 {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8304, 8232
                    hide_name = True
                ]

                junction Junction1 sp
                [
                    position = 8096, 8168
                ]

                junction Junction2 sp
                [
                    position = 8096, 8224
                ]

                connect In2 "Bus Split2.in" as Connection3
                connect "Bus Split2.out" Product4.in1 as Connection6
                [
                    breakpoints = 8080, 8224; 8080, 8184
                ]
                connect "Bus Split2.out2" Product6.in1 as Connection9
                [
                    breakpoints = 8080, 8256; 8080, 8312
                ]
                connect "Bus Split2.out1" Product5.in1 as Connection10
                connect Product5.out "Bus Join1.in1" as Connection11
                connect Product4.out "Bus Join1.in" as Connection12
                connect Product6.out "Bus Join1.in2" as Connection13
                connect Out3 "Bus Join1.out" as Connection14
                connect In1 Junction1 as Connection16
                connect Junction1 Product4.in as Connection17
                connect Product5.in Junction2 as Connection19
                connect Junction2 Junction1 as Connection20
                connect Product6.in Junction2 as Connection21
            }
            [
                position = 8144, 8400
                hide_name = True
                size = 48, 48
            ]

            component gen_bus_split "Bus Split5" {
                outputs = "3"
            }
            [
                position = 7880, 8424
                hide_name = True
            ]

            component gen_rms_value "RMS value3" {
                frequency = "fg"
                op_mode = "Fixed frequency"
            }
            [
                position = 7968, 8392
                hide_name = True
            ]

            component gen_logic_op "Logical operator2" {
            }
            [
                position = 8288, 8336
                hide_name = True
            ]

            component src_constant Limit_output {
                _tunable = "True"
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 8208, 8296
            ]

            component gen_terminator Termination12 {
            }
            [
                position = 8016, 8424
                hide_name = True
            ]

            component gen_terminator Termination13 {
            }
            [
                position = 7968, 8440
                hide_name = True
            ]

            port Ig_b {
                position = left:5
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 7664
            ]

            port Ii_a {
                position = left:6
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5816, 7808
            ]

            port "Q comp enable" {
                position = top:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 8192
            ]

            port Il_a {
                position = left:8
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5816, 8000
            ]

            port Ii_b {
                position = left:7
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 7832
            ]

            port Vg_b {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 7480
            ]

            port Vdc {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5816, 7328
            ]

            port mod {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9656, 7640
            ]

            port Il_b {
                position = left:9
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 8024
            ]

            port Vg_a {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5816, 7456
            ]

            port Ig_a {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5816, 7640
            ]

            port En {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9656, 7760
            ]

            port MCB {
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9656, 7816
            ]

            port "Har comp en" {
                position = top:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 8256
            ]

            port Enable {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 5848, 8312
            ]

            tag Goto3 {
                value = "Ig_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 7712
                hide_name = True
            ]

            tag Goto16 {
                value = "Vg_d"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6624, 7432
                hide_name = True
            ]

            tag Goto34 {
                value = "wt"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6624, 7496
                hide_name = True
            ]

            tag From96 {
                value = "Iref_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7952
                hide_name = True
            ]

            tag Goto45 {
                value = "zero"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6600, 7592
                hide_name = True
            ]

            tag Goto51 {
                value = "Il_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 8072
                hide_name = True
            ]

            tag From117 {
                value = "Il_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7024, 7768
                hide_name = True
            ]

            tag From118 {
                value = "Il_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7024, 7840
                hide_name = True
            ]

            tag From119 {
                value = "Il_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7024, 7912
                hide_name = True
            ]

            tag Goto66 {
                value = "Vg_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6056, 7552
                hide_name = True
            ]

            tag From307 {
                value = "Vdc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9400, 7680
                hide_name = True
            ]

            tag Goto79 {
                value = "I_ref_har_slow"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7440, 7840
                hide_name = True
                size = 83, 20
            ]

            tag From314 {
                value = "I_ref_har_comp"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7352, 8448
                hide_name = True
                size = 82, 20
            ]

            tag From315 {
                value = "comp_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7128, 8448
                hide_name = True
            ]

            tag Goto81 {
                value = "comp_en"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6784, 8296
                hide_name = True
            ]

            tag Goto80 {
                value = "volt_en"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6784, 8344
                hide_name = True
            ]

            tag From316 {
                value = "Vdc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6368, 8328
                hide_name = True
            ]

            tag From317 {
                value = "Vg_d"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6368, 8360
                hide_name = True
            ]

            tag From318 {
                value = "zero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7368, 8480
                hide_name = True
            ]

            tag From345 {
                value = "I_ref_har_comp"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6400, 7784
                hide_name = True
                size = 86, 20
            ]

            tag From347 {
                value = "wt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6600, 7824
                hide_name = True
            ]

            tag Goto90 {
                value = "Is_q_exp"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6792, 7776
                hide_name = True
            ]

            tag From348 {
                value = "Is_q_exp"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6512, 7912
                hide_name = True
            ]

            tag From349 {
                value = "zero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6448, 7896
                hide_name = True
            ]

            tag From350 {
                value = "wt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6512, 7944
                hide_name = True
            ]

            tag Goto91 {
                value = "q_comp_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6784, 7920
                hide_name = True
            ]

            tag From351 {
                value = "refV"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7688, 8448
                hide_name = True
            ]

            tag Goto92 {
                value = "MCB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6784, 8392
                hide_name = True
            ]

            tag From354 {
                value = "I_ref_V"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7368, 8328
                hide_name = True
            ]

            tag From355 {
                value = "zero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7368, 8360
                hide_name = True
            ]

            tag From356 {
                value = "volt_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7336, 8280
                hide_name = True
            ]

            tag From359 {
                value = "zero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7368, 8240
                hide_name = True
            ]

            tag From360 {
                value = "q_comp_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7368, 8208
                hide_name = True
            ]

            tag Goto93 {
                value = "refV"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7536, 8344
                hide_name = True
            ]

            tag Goto95 {
                value = "refHar"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7536, 8464
                hide_name = True
            ]

            tag Goto96 {
                value = "refQ"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7536, 8224
                hide_name = True
            ]

            tag From363 {
                value = "refHar"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8464
                hide_name = True
            ]

            tag From364 {
                value = "refQ"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7688, 8480
                hide_name = True
            ]

            tag From365 {
                value = "Vg_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7032, 7440
                rotation = left
                hide_name = True
            ]

            tag From366 {
                value = "Vg_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7088, 7440
                rotation = left
                hide_name = True
            ]

            tag From367 {
                value = "Vg_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7144, 7440
                rotation = left
                hide_name = True
            ]

            tag Goto97 {
                value = "refFLAG"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7752, 7592
                hide_name = True
            ]

            tag Goto98 {
                value = "f"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6688, 7480
                hide_name = True
            ]

            tag From368 {
                value = "f"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7104, 7592
                hide_name = True
            ]

            tag From369 {
                value = "Il_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7536, 7768
                hide_name = True
            ]

            tag From370 {
                value = "Il_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7536, 7840
                hide_name = True
            ]

            tag From371 {
                value = "Il_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7536, 7912
                hide_name = True
            ]

            tag Goto99 {
                value = "I_ref_har_comp"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7552, 8104
                hide_name = True
                size = 83, 20
            ]

            tag Goto100 {
                value = "I_ref_har_fast"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7928, 7840
                hide_name = True
                size = 83, 20
            ]

            tag From372 {
                value = "refFLAG"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7336, 8040
                hide_name = True
            ]

            tag From373 {
                value = "I_ref_har_slow"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7360, 8120
                hide_name = True
                size = 80, 20
            ]

            tag From374 {
                value = "I_ref_har_fast"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7360, 8088
                hide_name = True
                size = 83, 20
            ]

            tag Goto102 {
                value = "Ii_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 7880
                hide_name = True
            ]

            tag From67 {
                value = "Iref_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7536
                hide_name = True
            ]

            tag From75 {
                value = "Ig_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7672
                hide_name = True
            ]

            tag From76 {
                value = "wt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7808
                hide_name = True
            ]

            tag From78 {
                value = "volt_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8512, 7448
                hide_name = True
            ]

            tag Goto103 {
                value = "Vref_I"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8752, 7672
                hide_name = True
            ]

            tag From380 {
                value = "I_ref_har_comp"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7064, 7528
                hide_name = True
            ]

            tag From381 {
                value = "refFLAG"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6432, 8392
                hide_name = True
            ]

            tag Goto104 {
                value = "Vg_abc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 7480
                hide_name = True
            ]

            tag Goto105 {
                value = "Ig_abc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 7664
                hide_name = True
            ]

            tag Goto106 {
                value = "Ii_abc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 7832
                hide_name = True
            ]

            tag From388 {
                value = "Il_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6416, 7752
                hide_name = True
            ]

            tag Goto107 {
                value = "Il_abc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6128, 8024
                hide_name = True
            ]

            tag From391 {
                value = "Vg_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6400, 7432
                hide_name = True
            ]

            tag From392 {
                value = "Vg_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6400, 7480
                hide_name = True
            ]

            tag From393 {
                value = "Vg_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6400, 7528
                hide_name = True
            ]

            tag Goto109 {
                value = "Vg_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7560
                hide_name = True
            ]

            tag Goto110 {
                value = "Vg_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7584
                hide_name = True
            ]

            tag Goto111 {
                value = "Ig_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7744
                hide_name = True
            ]

            tag Goto112 {
                value = "Ig_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7768
                hide_name = True
            ]

            tag Goto113 {
                value = "Ii_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7912
                hide_name = True
            ]

            tag Goto114 {
                value = "Ii_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 7936
                hide_name = True
            ]

            tag Goto115 {
                value = "Il_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 8104
                hide_name = True
            ]

            tag Goto116 {
                value = "Il_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 5960, 8128
                hide_name = True
            ]

            tag Goto117 {
                value = "Vdc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6016, 7328
                hide_name = True
            ]

            tag From398 {
                value = "volt_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9472, 7760
                hide_name = True
            ]

            tag From399 {
                value = "MCB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9560, 7816
                hide_name = True
            ]

            tag Goto31 {
                value = "I_ref_V"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 9272, 7664
                hide_name = True
            ]

            tag From309 {
                value = "wt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8888, 7712
                hide_name = True
            ]

            tag From331 {
                value = "volt_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9024, 7552
                hide_name = True
            ]

            tag From332 {
                value = "Vg_d"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8888, 7680
                hide_name = True
            ]

            tag From400 {
                value = "Vdc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8888, 7648
                hide_name = True
            ]

            tag Goto118 {
                value = "p_avg_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7416, 7344
                hide_name = True
            ]

            tag From401 {
                value = "p_avg_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7312, 7560
                hide_name = True
            ]

            tag From402 {
                value = "Vg_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7920
                hide_name = True
            ]

            tag From403 {
                value = "Ig_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 7984
                hide_name = True
            ]

            tag From404 {
                value = "Ii_abc"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8392, 8016
                hide_name = True
            ]

            tag Goto119 {
                value = "q_comp_en"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6024, 8192
                hide_name = True
            ]

            tag From405 {
                value = "q_comp_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7400, 8168
                hide_name = True
            ]

            tag Goto120 {
                value = "har_comp_en"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6024, 8256
                hide_name = True
                size = 68, 20
            ]

            tag From406 {
                value = "har_comp_en"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7128, 8368
                hide_name = True
                size = 67, 20
            ]

            tag Goto108 {
                value = "Vref_P"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8768, 7968
                hide_name = True
            ]

            tag From396 {
                value = "Vref_I"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9392, 7608
                hide_name = True
            ]

            tag From397 {
                value = "Vref_P"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 9392, 7576
                hide_name = True
            ]

            tag Goto121 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6024, 8312
                hide_name = True
            ]

            tag From407 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6432, 8296
                hide_name = True
            ]

            tag Goto122 {
                value = "Imax_FLAG"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8136, 8272
                hide_name = True
            ]

            tag From408 {
                value = "Imax_FLAG"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8192, 8344
                hide_name = True
            ]

            tag Goto123 {
                value = "Imax"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8136, 8240
                hide_name = True
            ]

            tag From409 {
                value = "Imax"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7904, 8360
                hide_name = True
            ]

            tag Goto78 {
                value = "Iref_abc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8448, 8416
                hide_name = True
            ]

            tag Goto124 {
                value = "Ig_rms"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8136, 8304
                hide_name = True
            ]

            junction Junction494 sp
            [
                position = 6552, 7896
            ]

            junction Junction579 sp
            [
                position = 5912, 7808
            ]

            junction Junction580 sp
            [
                position = 5896, 7832
            ]

            junction Junction581 sp
            [
                position = 6000, 7864
            ]

            junction Junction583 sp
            [
                position = 5896, 7664
            ]

            junction Junction584 sp
            [
                position = 6000, 7696
            ]

            junction Junction585 sp
            [
                position = 6000, 8056
            ]

            junction Junction586 sp
            [
                position = 5912, 8000
            ]

            junction Junction587 sp
            [
                position = 5896, 8024
            ]

            junction Junction589 sp
            [
                position = 5912, 7640
            ]

            junction Junction590 sp
            [
                position = 5912, 7456
            ]

            junction Junction591 sp
            [
                position = 5896, 7480
            ]

            junction Junction592 sp
            [
                position = 6000, 7512
            ]

            junction Junction597 sp
            [
                position = 7184, 8408
            ]

            junction Junction600 sp
            [
                position = 5896, 7520
            ]

            junction Junction601 sp
            [
                position = 5912, 7504
            ]

            junction Junction602 sp
            [
                position = 5912, 7688
            ]

            junction Junction603 sp
            [
                position = 5896, 7704
            ]

            junction Junction604 sp
            [
                position = 5912, 7856
            ]

            junction Junction605 sp
            [
                position = 5896, 7872
            ]

            junction Junction606 sp
            [
                position = 5912, 8048
            ]

            junction Junction607 sp
            [
                position = 5896, 8064
            ]

            junction Junction628 sp
            [
                position = 8008, 8264
            ]

            junction Junction635 sp
            [
                position = 8104, 8432
            ]

            junction Junction636 sp
            [
                position = 7832, 8464
            ]

            junction Junction637 sp
            [
                position = 8008, 8384
            ]

            junction Junction638 sp
            [
                position = 8008, 8304
            ]

            junction Junction639 sp
            [
                position = 8352, 8344
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Notch filtering in order to eliminate the load current fundamental harmonic </p></body></html> ENDCOMMENT 
            [
                position = 7208, 7704
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Transient reference calculation</p></body></html> ENDCOMMENT 
            [
                position = 7312, 7288
            ]

            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Reactive power compensation reference calculation</p></body></html> ENDCOMMENT 
            [
                position = 6432, 7688
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Finite state machine</p></body></html> ENDCOMMENT 
            [
                position = 6528, 8200
            ]

            comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Current control loops</p></body></html> ENDCOMMENT 
            [
                position = 8472, 7384
            ]

            comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Voltage control loop</p></body></html> ENDCOMMENT 
            [
                position = 9000, 7488
            ]

            comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Reference current calculation</p></body></html> ENDCOMMENT 
            [
                position = 7288, 7984
            ]

            comment Comment8 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Reference current limitation </p></body></html> ENDCOMMENT 
            [
                position = 8016, 8168
            ]

            connect "Notch filter slow b.In2" From118 as Connection3042
            connect "Notch filter slow c.In2" From119 as Connection3046
            connect Junction579 Ii_a as Connection4984
            connect Product3.out mod as Connection4991
            connect Junction587 Il_b as Connection4992
            connect Junction583 Ig_b as Connection4983
            connect Junction589 Ig_a as Connection4995
            connect Junction586 Il_a as Connection4986
            connect Junction580 Ii_b as Connection4987
            connect "Power Meter1.Qdc" Termination9.in as Connection5002
            connect Termination10.in "Power Meter1.apparent" as Connection5003
            connect Termination11.in "Power Meter1.k_factor" as Connection5004
            connect Goto45 Constant2.out as Connection3766
            connect "Signal switch5.in1" From318 as Connection3948
            connect Junction590 Vg_a as Connection5012
            [
                breakpoints = 5912, 7456; 5856, 7456
            ]
            connect Vg_b Junction591 as Connection5013
            [
                breakpoints = 5880, 7480
            ]
            connect Sum47.in1 Junction600 as Connection5014
            connect Junction600 Junction591 as Connection5015
            connect Goto110 Junction600 as Connection5016
            connect Sum47.in Junction601 as Connection5017
            connect Junction601 Junction590 as Connection5018
            connect Goto109 Junction601 as Connection5019
            connect Junction589 Junction602 as Connection5020
            [
                breakpoints = 5912, 7640
            ]
            connect Junction602 Sum62.in as Connection5021
            [
                breakpoints = 5912, 7688
            ]
            connect Goto111 Junction602 as Connection5022
            connect From345 Sum60.in1 as Connection4117
            connect Sum62.in1 Junction603 as Connection5023
            connect "abc to dq5.va" "Bus Split2.out" as Connection4120
            connect Junction603 Junction583 as Connection5024
            connect "Bus Split2.out1" "abc to dq5.vb" as Connection4121
            connect Goto112 Junction603 as Connection5025
            connect "abc to dq5.vc" "Bus Split2.out2" as Connection4122
            connect From347 "abc to dq5.wt" as Connection4123
            connect Goto90 "abc to dq5.q_axis" as Connection4125
            connect Termination4.in "abc to dq5.zero_axis" as Connection4126
            connect Sum61.in Junction604 as Connection5026
            connect From348 "dq to abc1.q_input" as Connection4128
            connect Junction604 Junction579 as Connection5027
            connect From349 Junction494 as Connection4130
            connect Goto113 Junction604 as Connection5028
            connect Junction494 "dq to abc1.d_input" as Connection4131
            connect "dq to abc1.zero_input" Junction494 as Connection4132
            connect Sum61.in1 Junction605 as Connection5029
            connect From350 "dq to abc1.wt" as Connection4133
            connect Junction605 Junction580 as Connection5030
            connect "Bus Join12.in1" "dq to abc1.phase_b" as Connection4134
            connect Goto114 Junction605 as Connection5031
            connect "Bus Join12.in" "dq to abc1.phase_a" as Connection4135
            connect "Bus Join12.in2" "dq to abc1.phase_c" as Connection4136
            connect Goto91 "Bus Join12.out" as Connection4137
            connect Sum63.in Junction606 as Connection5032
            connect Junction606 Junction586 as Connection5033
            connect "Signal switch7.in1" From359 as Connection4183
            connect Goto115 Junction606 as Connection5034
            connect From360 "Signal switch7.in" as Connection4185
            connect Sum63.in1 Junction607 as Connection5035
            connect Comparator1.in1 From315 as Connection4187
            connect Junction607 Junction587 as Connection5036
            connect Goto116 Junction607 as Connection5037
            connect "Logical operator1.in" Comparator2.out as Connection4191
            connect "Logical operator1.in1" Comparator1.out as Connection4192
            connect Goto96 "Signal switch7.out" as Connection4204
            connect From351 Sum56.in as Connection4205
            connect From399 MCB as Connection5042
            connect From363 Sum56.in1 as Connection4206
            connect From364 Sum56.in2 as Connection4207
            connect "Voltage control loop.Vdc_ref" Constant4.out as Connection3993
            connect From331 "Voltage control loop.V_loop_en" as Connection3994
            connect From400 "Voltage control loop.Vdc_meas" as Connection5044
            connect "Signal switch6.in1" From355 as Connection4360
            connect "Power Meter1.Pdc" Goto118 as Connection5048
            connect From401 Averaging.Pinst as Connection5049
            connect "Bus Split4.out" "Power Meter1.ia" as Connection5050
            [
                breakpoints = 7200, 7408; 7264, 7408
            ]
            connect "Bus Split4.out1" "Power Meter1.ib" as Connection5051
            connect From96 "P regulator.Iref_abc" as Connection5053
            connect Goto108 "P regulator.Vref_P" as Connection5052
            connect From402 "P regulator.Vg_abc" as Connection5054
            connect From403 "P regulator.Ig_abc" as Connection5055
            connect "Signal switch6.in" From354 as Connection4433
            connect From404 "P regulator.Ii_abc" as Connection5056
            connect Goto34 "Three phase PLL1.theta" as Connection5057
            connect Goto81 SM.har_comp as Connection5059
            connect Goto80 SM.V_loop as Connection5058
            connect Comparator4.in2 Constant9.out as Connection4542
            connect Comparator4.in1 Abs2.out as Connection4560
            connect "Bus Join13.in1" "Notch filter fast b.Out1" as Connection4566
            connect "Notch filter fast a.Out1" "Bus Join13.in" as Connection4567
            connect "Notch filter fast c.Out1" "Bus Join13.in2" as Connection4568
            connect "Notch filter fast a.In2" From369 as Connection4570
            connect From370 "Notch filter fast b.In2" as Connection4571
            connect From405 "Signal switch7.in2" as Connection5062
            connect "Notch filter fast c.In2" From371 as Connection4572
            connect Goto93 "Signal switch6.out" as Connection5063
            connect From374 "Signal switch8.in" as Connection4574
            connect From373 "Signal switch8.in1" as Connection4575
            connect Goto99 "Signal switch8.out" as Connection4576
            connect From406 Comparator2.in1 as Connection5065
            connect From67 "DQ Integrator.I_ref" as Connection4709
            connect From75 "DQ Integrator.I_g" as Connection4711
            connect From76 "DQ Integrator.wt" as Connection4712
            connect Constant5.out Product3.in1 as Connection4724
            connect "Notch filter slow a.Out1" "Bus Join10.in" as Connection4732
            connect "Notch filter slow c.Out1" "Bus Join10.in2" as Connection4733
            connect "Bus Join10.in1" "Notch filter slow b.Out1" as Connection4734
            connect "Bus Split4.out2" "Power Meter1.ic" as Connection4737
            connect SM.MCB Goto92 as Connection4749
            connect From316 SM.Vdc as Connection4754
            connect From381 SM.tran_flag as Connection4756
            connect "Bus Join15.out" Goto104 as Connection4766
            connect "Bus Join16.out" Goto105 as Connection4780
            connect "Bus Join17.out" Goto106 as Connection4784
            connect Junction579 "Bus Join17.in" as Connection4792
            connect Junction580 "Bus Join17.in1" as Connection4795
            connect Sum61.out Junction581 as Connection4797
            connect Junction581 "Bus Join17.in2" as Connection4798
            connect Goto102 Junction581 as Connection4799
            connect Junction583 "Bus Join16.in1" as Connection4805
            connect Sum62.out Junction584 as Connection4807
            connect Junction584 "Bus Join16.in2" as Connection4808
            connect Goto3 Junction584 as Connection4809
            connect Termination5.in "abc to dq5.d_axis" as Connection4812
            connect Sum60.out "Bus Split2.in" as Connection4813
            connect From388 Sum60.in as Connection4814
            connect "Bus Join18.out" Goto107 as Connection4816
            connect Goto51 Junction585 as Connection4819
            connect Junction585 Sum63.out as Connection4820
            connect "Bus Join18.in2" Junction585 as Connection4821
            connect Junction586 "Bus Join18.in" as Connection4823
            connect Junction587 "Bus Join18.in1" as Connection4826
            connect Junction589 "Bus Join16.in" as Connection4833
            [
                breakpoints = 5912, 7640; 6000, 7640
            ]
            connect "Three phase PLL1.sin_theta" Termination6.in as Connection4852
            connect Termination7.in "Three phase PLL1.zero_axis" as Connection4853
            connect Junction590 "Bus Join15.in" as Connection4860
            [
                breakpoints = 5912, 7456; 6000, 7456
            ]
            connect Junction591 "Bus Join15.in1" as Connection4863
            connect Sum47.out Junction592 as Connection4865
            connect Junction592 "Bus Join15.in2" as Connection4866
            connect Goto66 Junction592 as Connection4867
            connect Termination8.in "Three phase PLL1.q_axis" as Connection4904
            connect Constant7.out Junction597 as Connection4905
            connect Junction597 Comparator2.in2 as Connection4906
            connect Comparator1.in2 Junction597 as Connection4907
            connect From314 "Signal switch5.in" as Connection4908
            connect Goto95 "Signal switch5.out" as Connection4909
            connect "Notch filter slow a.In2" From117 as Connection4910
            connect Limit2.out Averaging.f as Connection4912
            connect Averaging.Pavg Abs2.in as Connection4913
            connect Goto100 "Bus Join13.out" as Connection4914
            connect Goto79 "Bus Join10.out" as Connection4915
            connect Goto98 "Three phase PLL1.freq" as Connection4926
            connect From380 "Rate Transition8.in" as Connection4927
            connect "Rate Transition8.out" "Bus Split4.in" as Connection4928
            connect "Power Meter1.vb" "Rate Transition12.out" as Connection4942
            connect "Rate Transition12.in" From366 as Connection4943
            connect "Rate Transition13.out" "Power Meter1.vc" as Connection4944
            connect "Rate Transition13.in" From367 as Connection4945
            connect "Rate Transition11.out" "Power Meter1.va" as Connection4946
            connect "Rate Transition11.in" From365 as Connection4947
            connect "Rate Transition14.out" Limit2.in as Connection4948
            connect From368 "Rate Transition14.in" as Connection4952
            connect From391 "Three phase PLL1.va" as Connection4953
            connect From392 "Three phase PLL1.vb" as Connection4954
            connect From393 "Three phase PLL1.vc" as Connection4955
            connect "Three phase PLL1.d_axis" Goto16 as Connection4957
            connect "DQ Integrator.Vref_I" Goto103 as Connection4978
            connect From397 Sum64.in as Connection4979
            connect From396 Sum64.in1 as Connection4980
            connect Sum64.out Product3.in as Connection4982
            connect "Voltage control loop.Vg_d" "Rate Transition16.out" as Connection5073
            connect "Rate Transition16.in" From332 as Connection5074
            connect From309 "Rate Transition17.in" as Connection5075
            connect "Rate Transition17.out" "Voltage control loop.wt" as Connection5076
            connect "Logical operator1.out" "Rate Transition18.in" as Connection5077
            connect "Rate Transition18.out" "Signal switch5.in2" as Connection5078
            connect From317 "Rate Transition22.in" as Connection5085
            connect "Rate Transition22.out" SM.Vg_d as Connection5086
            connect Enable Goto121 as Connection5087
            connect "Har comp en" Goto120 as Connection5088
            connect From356 "Rate Transition23.in" as Connection5090
            connect "Rate Transition23.out" "Signal switch6.in2" as Connection5091
            connect From78 "Rate Transition24.in" as Connection5092
            connect "Rate Transition24.out" "DQ Integrator.volt_en" as Connection5093
            connect From398 "Rate Transition25.in" as Connection5094
            connect "Rate Transition25.out" En as Connection5095
            connect "Q comp enable" "Rate Transition26.in" as Connection5096
            connect "Rate Transition26.out" Goto119 as Connection5097
            connect Goto31 "Rate Transition27.out" as Connection5098
            connect "Rate Transition27.in" "Voltage control loop.Iref_V" as Connection5099
            connect From307 "Rate Transition28.in" as Connection5100
            connect "Rate Transition28.out" Product3.in2 as Connection5101
            connect "Signal switch8.in2" "Rate Transition29.out" as Connection5106
            connect "Rate Transition29.in" From372 as Connection5107
            connect From409 "C function2.imax" as Connection5229
            [
                breakpoints = 7952, 8368; 8008, 8368
            ]
            connect Goto97 Comparator4.out as Connection5284
            connect I_max.out Junction628 as Connection5301
            connect Junction628 Comparator5.in2 as Connection5302
            connect Goto123 Junction628 as Connection5303
            connect Goto122 Comparator5.out as Connection5313
            connect Goto78 "Signal switch9.out" as Connection5323
            connect Junction635 Subsystem1.In2 as Connection5335
            connect "Signal switch9.in1" Junction635 as Connection5336
            connect Sum56.out Junction636 as Connection5338
            connect "Bus Split5.in" Junction636 as Connection5340
            connect "RMS value3.in" "Bus Split5.out" as Connection5341
            connect "RMS value3.out" Junction637 as Connection5344
            connect Junction637 "C function2.i" as Connection5345
            connect Junction638 Comparator5.in1 as Connection5347
            [
                breakpoints = 8008, 8304; 8008, 8280
            ]
            connect Junction637 Junction638 as Connection5348
            connect From408 "Logical operator2.in1" as Connection5350
            connect "Signal switch9.in2" Junction639 as Connection5351
            connect Junction639 Imax_FLAG.in as Connection5352
            [
                breakpoints = 8352, 8344
            ]
            connect "Logical operator2.out" Junction639 as Connection5353
            connect Goto124 Junction638 as Connection5358
            connect Limit_output.out "Logical operator2.in" as Connection5360
            connect "Signal switch9.in" Subsystem1.Out3 as Connection5362
            [
                breakpoints = 8192, 8400
            ]
            connect Junction636 Junction635 as Connection5361
            [
                breakpoints = 7848, 8464; 7848, 8464; 7856, 8464
            ]
            connect "C function2.out" Subsystem1.In1 as Connection5363
            [
                breakpoints = 8104, 8392
            ]
            connect SM.Enable From407 as Connection5364
            [
                breakpoints = 6480, 8296
            ]
            connect "Bus Split5.out2" Termination13.in as Connection5365
            connect "Bus Split5.out1" Termination12.in as Connection5366
            connect Goto117 Limit1.out as Connection5367
            connect Limit1.in Vdc as Connection5368

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem contains control algorithm for an Active Harmonic Filter, implemented using Signal Processing library.</p></body></html>"

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 9856, 7576
            size = 272, 472
        ]

        component Subsystem "Electric motor drive" {
            layout = dynamic
            component pas_capacitor C_DC {
                capacitance = "C"
                initial_voltage = "V_dc"
            }
            [
                position = 8160, 8608
            ]

            component gen_product Product1 {
                signs = "**/"
            }
            [
                position = 8264, 8784
                hide_name = True
            ]

            component "core/Three Phase Diode Rectifier" "Three Phase Diode Rectifier" {
            }
            [
                position = 8160, 8352
                rotation = right
                scale = -1, 1
                size = 127, 256
            ]

            component "core/Variable Resistor" Rdc_load {
                initial_current = "Idc_load"
            }
            [
                position = 8160, 8528
                size = 64, 48
            ]

            component "core/Voltage Measurement" Vdc {
                execution_rate = "execution_rate"
                sig_output = "True"
            }
            [
                position = 8160, 8704
                rotation = down
                scale = -1, 1
                size = 64, 32
            ]

            component src_constant "Load power" {
                _tunable = "True"
                execution_rate = "inherit"
                value = "p_load/2"
            }
            [
                position = 8160, 8800
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8160, 8184
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8256, 8184
                rotation = right
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8064, 8184
                rotation = right
            ]

            tag Goto1 {
                value = "R_load"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8368, 8784
                hide_name = True
            ]

            tag From1 {
                value = "R_load"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8208, 8456
                rotation = down
                hide_name = True
            ]

            junction Junction5 pe
            [
                position = 8064, 8608
            ]

            junction Junction11 pe
            [
                position = 8256, 8528
            ]

            junction Junction4 pe
            [
                position = 8256, 8608
            ]

            junction Junction15 sp
            [
                position = 8192, 8768
            ]

            junction Junction17 pe
            [
                position = 8064, 8528
            ]

            connect Junction15 Product1.in as Connection167
            connect From1 Rdc_load.In as Connection105
            connect Rdc_load.n_node Junction11 as Connection101
            connect Vdc.out Junction15 as Connection166
            connect Junction11 Junction4 as Connection100
            connect Vdc.p_node Junction5 as Connection54
            connect Junction5 C_DC.p_node as Connection53
            [
                breakpoints = 8064, 8608; 8064, 8608
            ]
            connect Vdc.n_node Junction4 as Connection51
            connect Product1.in1 Junction15 as Connection168
            connect "Three Phase Diode Rectifier.neg_out" Junction11 as Connection99
            connect C_DC.n_node Junction4 as Connection49
            [
                breakpoints = 8256, 8608
            ]
            connect A "Three Phase Diode Rectifier.a_in" as Connection173
            connect "Three Phase Diode Rectifier.b_in" B as Connection174
            connect C "Three Phase Diode Rectifier.c_in" as Connection175
            connect Rdc_load.p_node Junction17 as Connection177
            connect Junction17 Junction5 as Connection178
            [
                breakpoints = 8064, 8528; 8064, 8528; 8064, 8528
            ]
            connect "Three Phase Diode Rectifier.pos_out" Junction17 as Connection179
            connect Product1.out Goto1 as Connection181
            connect "Load power.out" Product1.in2 as Connection182

            f = "fg"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This subsystem represents a simplified electric motor drive. The motor is model as a variable resistor that is at the DC side of a three-phase diode rectifier.</p></body></html>"

                p_load {
                    label = "Load power "
                    widget = edit
                    type = generic
                    default_value = "300e3"
                    unit = "W"
                }

                vs {
                    label = "Source voltage"
                    widget = edit
                    type = generic
                    default_value = "400"
                    unit = "V"
                }

                f {
                    label = "Grid frequency"
                    widget = edit
                    type = generic
                    default_value = "50"
                    unit = "Hz"
                }

                v_ripple {
                    label = "DC Voltage ripple  "
                    widget = edit
                    type = generic
                    default_value = "20"
                    unit = "%"
                }

                execution_rate {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Tslow"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE

                CODE init
                ENDCODE

                CODE pre_compile
                    # HEADER START
                    p_load = mdl.get_property_value(mdl.prop(item_handle, "p_load"))
                    vs = mdl.get_property_value(mdl.prop(item_handle, "vs"))
                    f = mdl.get_property_value(mdl.prop(item_handle, "f"))
                    v_ripple = mdl.get_property_value(mdl.prop(item_handle, "v_ripple"))
                    execution_rate = mdl.get_property_value(mdl.prop(item_handle, "execution_rate"))
                    # HEADER STOP
                    sys = mdl.get_sub_level_handle(item_handle)     #access to the model under the mask
                    #mdl.info(sys)                                   #output in compilation report
                    
                    # Capacitor and R_load calculation
                    
                    V_dc = np.sqrt(2)*vs
                    
                    V_ripple= v_ripple*V_dc*0.01
                    
                    Idc_load = p_load/V_dc
                    
                    C =Idc_load*1/f/6/V_ripple
                    
                    #R dc load variable
                    I_load = mdl.get_item("Rdc_load",sys, "component")
                    mdl.set_property_value(mdl.prop(I_load, "initial_current"), Idc_load)
                ENDCODE
            }
        }
        [
            position = 9920, 6992
            rotation = left
            scale = 1, -1
            size = 232, 112
        ]

        component "core/Three-phase Meter" "Three-phase Meter1" {
            P_meas = "True"
            Ts = "Tslow"
            remove_snubber = "True"
        }
        [
            position = 9280, 6992
            hide_name = True
            size = 56, 240
        ]

        component src_constant Enable {
            _tunable = "True"
            execution_rate = "Tslow"
        }
        [
            position = 9704, 7280
        ]

        component src_constant "Q comp en" {
            _tunable = "True"
            execution_rate = "Tslow"
        }
        [
            position = 9808, 7280
        ]

        component src_constant "Har comp en" {
            _tunable = "True"
            execution_rate = "Tslow"
        }
        [
            position = 9920, 7280
        ]

        component gen_probe Amp_source {
        }
        [
            position = 9488, 6632
        ]

        component gen_probe Amp_load {
        }
        [
            position = 9904, 6632
        ]

        component "core/Harmonic Analyzer" "Harmonic Analyzer source" {
            execution_rate = "inherit"
            f1 = "fg"
            h = "harmonics_to_observe"
        }
        [
            position = 9272, 6656
            size = 48, 80
        ]

        component "core/Harmonic Analyzer" "Harmonic Analyzer load" {
            execution_rate = "inherit"
            f1 = "fg"
            h = "harmonics_to_observe"
        }
        [
            position = 9696, 6656
            size = 48, 80
        ]

        component gen_terminator Termination1 {
        }
        [
            position = 9800, 6712
            rotation = right
            hide_name = True
        ]

        component gen_terminator Termination2 {
        }
        [
            position = 9376, 6712
            rotation = right
            hide_name = True
        ]

        component gen_terminator Termination3 {
        }
        [
            position = 9408, 6712
            rotation = right
            hide_name = True
        ]

        component gen_terminator Termination4 {
        }
        [
            position = 9440, 6712
            rotation = right
            hide_name = True
        ]

        component gen_terminator Termination5 {
        }
        [
            position = 9832, 6712
            rotation = right
            hide_name = True
        ]

        component gen_terminator Termination6 {
        }
        [
            position = 9864, 6712
            rotation = right
            hide_name = True
        ]

        component "core/Current Measurement" Is_b {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
        }
        [
            position = 9176, 6992
            size = 64, 32
        ]

        component "core/Current Measurement" Is_c {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
        }
        [
            position = 9176, 7088
            size = 64, 32
        ]

        component "core/Current Measurement" Ig_c {
            execution_rate = "Ts"
            feed_forward = "true"
            frequency = "1e4"
        }
        [
            position = 9056, 7616
            size = 64, 32
        ]

        component gen_terminator Termination7 {
        }
        [
            position = 9336, 6840
            hide_name = True
        ]

        component "core/Current RMS" If_rms {
            frequency = "fg"
            op_mode = "Fixed frequency"
        }
        [
            position = 9184, 7424
            size = 64, 32
        ]

        tag Goto1 {
            value = "Ig_a"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9104, 7392
            hide_name = True
            size = 60, 20
        ]

        tag Goto2 {
            value = "Ig_b"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9104, 7488
            hide_name = True
            size = 60, 20
        ]

        tag Goto5 {
            value = "Ii_a"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8576, 7384
            hide_name = True
            size = 60, 20
        ]

        tag Goto6 {
            value = "Ii_b"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8576, 7488
            hide_name = True
            size = 60, 20
        ]

        tag Goto49 {
            value = "Il_a"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9688, 6856
            hide_name = True
            size = 60, 20
        ]

        tag Goto50 {
            value = "Il_b"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9688, 6952
            hide_name = True
            size = 60, 20
        ]

        tag Goto64 {
            value = "Vg_a"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9192, 7144
            hide_name = True
            size = 60, 20
        ]

        tag Goto65 {
            value = "Vg_b"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9192, 7192
            hide_name = True
            size = 60, 20
        ]

        tag Goto76 {
            value = "Vdc"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7848, 7520
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From310 {
            value = "Vdc"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7384
            hide_name = True
            size = 60, 20
        ]

        tag From330 {
            value = "En"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8136, 7368
            hide_name = True
            size = 60, 20
        ]

        tag From352 {
            value = "MCB"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9240, 7360
            hide_name = True
            size = 60, 20
        ]

        tag From383 {
            value = "Ig_a"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7528
            hide_name = True
            size = 60, 20
        ]

        tag From384 {
            value = "Ig_b"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7576
            hide_name = True
            size = 60, 20
        ]

        tag From386 {
            value = "Ii_a"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7624
            hide_name = True
            size = 60, 20
        ]

        tag From387 {
            value = "Ii_b"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7672
            hide_name = True
            size = 60, 20
        ]

        tag From389 {
            value = "Il_a"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7720
            hide_name = True
            size = 60, 20
        ]

        tag From390 {
            value = "Il_b"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7768
            hide_name = True
            size = 60, 20
        ]

        tag From394 {
            value = "Vg_a"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7432
            hide_name = True
            size = 60, 20
        ]

        tag From395 {
            value = "Vg_b"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 9648, 7480
            hide_name = True
            size = 60, 20
        ]

        tag Goto109 {
            value = "mod"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 10072, 7360
            hide_name = True
            size = 60, 20
        ]

        tag From398 {
            value = "mod"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8088, 7312
            hide_name = True
            size = 60, 20
        ]

        tag Goto110 {
            value = "En"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 10072, 7576
            hide_name = True
            size = 60, 20
        ]

        tag Goto111 {
            value = "MCB"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 10072, 7792
            hide_name = True
            size = 60, 20
        ]

        junction Junction232 pe
        [
            position = 8720, 7800
        ]

        junction Junction465 pe
        [
            position = 9032, 7248
        ]

        junction Junction466 pe
        [
            position = 8640, 7248
        ]

        junction Junction507 pe
        [
            position = 8632, 7424
        ]

        junction Junction508 pe
        [
            position = 8720, 7520
        ]

        junction Junction512 pe
        [
            position = 9032, 6896
        ]

        junction Junction534 pe
        [
            position = 8040, 7520
        ]

        junction Junction535 pe
        [
            position = 8040, 7616
        ]

        junction Junction558 pe
        [
            position = 8040, 7424
        ]

        junction Junction570 pe
        [
            position = 8808, 7616
        ]

        junction Junction595 sp
        [
            position = 9608, 6856
        ]

        junction Junction603 pe
        [
            position = 9368, 6896
        ]

        junction Junction604 pe
        [
            position = 9432, 6992
        ]

        junction Junction605 pe
        [
            position = 9496, 7088
        ]

        junction Junction606 pe
        [
            position = 9104, 6992
        ]

        junction Junction607 pe
        [
            position = 9104, 7248
        ]

        junction Junction608 sp
        [
            position = 9176, 6776
        ]

        junction Junction609 sp
        [
            position = 9608, 6752
        ]

        comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; font-weight:600;">Configuration requirements</span><span style=" font-size:10pt;">:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">This model runs on configurations that supports </span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; font-weight:600;">Time varying elements </span><span style=" font-size:10pt;">(ex. HIL 402 device, C4)</span>         </p></body></html> ENDCOMMENT 
        [
            position = 8008, 6936
        ]

        connect Ii_a.p_node Li_a.n_node as Connection259
        connect Li_b.n_node Ii_b.p_node as Connection260
        connect Cb.n_node Junction232 as Connection1762
        connect Cc.n_node Junction232 as Connection1767
        connect Goto50 Il_b.out as Connection3039
        connect Ig_a.p_node Lg_a.n_node as Connection3085
        connect "THDi source.in" Gain47.out as Connection3148
        connect Gain47.in "THD Measurement1.Out" as Connection3149
        connect "THDi load.in" Gain59.out as Connection3606
        connect Gain59.in "THD Measurement2.Out" as Connection3607
        connect Il_a.n_node La.p_node as Connection3673
        connect Lb.p_node Il_b.n_node as Connection3676
        connect Il_c.n_node Lc.p_node as Connection3677
        connect From330 "Three Phase T Type Inverter.En" as Connection3823
        connect Van.n_node Junction465 as Connection3848
        connect Vgrid.n_node Junction466 as Connection3850
        connect Junction466 gnd.node as Connection3851
        connect Junction465 Junction466 as Connection3852
        connect From352 MCB.ctrl_in as Connection4147
        connect Li_c.p_node "Three Phase T Type Inverter.C" as Connection4241
        connect Ca.p_node Junction507 as Connection4258
        connect Junction507 Ii_a.n_node as Connection4259
        [
            breakpoints = 8632, 7424; 8632, 7424; 8632, 7424; 8632, 7424
        ]
        connect Cb.p_node Junction508 as Connection4261
        connect Junction508 Ii_b.n_node as Connection4262
        [
            breakpoints = 8720, 7520; 8720, 7520; 8720, 7520; 8720, 7520; 8632, 7520; 8632, 7520
        ]
        connect "Three Phase T Type Inverter.B" Li_b.p_node as Connection4283
        connect Is_a.p_node Junction512 as Connection4290
        connect Junction512 Van.p_node as Connection4291
        [
            breakpoints = 9032, 6896
        ]
        connect Lgrid_a.p_node Junction512 as Connection4292
        connect Ig_b.n_node MCB.b_in as Connection4383
        connect Ig_b.p_node Lg_b.n_node as Connection4386
        connect Goto2 Ig_b.out as Connection4392
        connect Ctop.n_node Junction534 as Connection4428
        connect Junction534 Cbot.p_node as Connection4429
        connect Junction535 Vdc.n_node as Connection4431
        [
            breakpoints = 8040, 7616
        ]
        connect Cbot.n_node Junction535 as Connection4432
        connect Ctop.p_node Junction558 as Connection4628
        connect Junction558 Vdc.p_node as Connection4629
        connect Lg_a.p_node "Core Coupling 1.a_out" as Connection4631
        connect "Core Coupling 1.a_in" Junction507 as Connection4632
        connect Lg_b.p_node "Core Coupling 1.b_out" as Connection4633
        connect "Core Coupling 1.b_in" Junction508 as Connection4634
        connect Lg_c.p_node "Core Coupling 1.c_out" as Connection4635
        connect Lgrid_b.n_node Rgrid_b.p_node as Connection4640
        connect Rgrid_b.n_node Vgrid.b_node as Connection4641
        connect Lgrid_a.n_node Rgrid_a.p_node as Connection4642
        connect Rgrid_a.n_node Vgrid.a_node as Connection4643
        connect Vgrid.c_node Rgrid_c.n_node as Connection4644
        connect Rgrid_c.p_node Lgrid_c.n_node as Connection4645
        connect Li_a.p_node "Three Phase T Type Inverter.A" as Connection4698
        connect Junction232 Ca.n_node as Connection4697
        [
            breakpoints = 8720, 7800; 8720, 7800; 8632, 7800; 8632, 7800
        ]
        connect "Core Coupling 1.c_in" Junction570 as Connection4704
        connect Junction570 Cc.p_node as Connection4705
        [
            breakpoints = 8808, 7616
        ]
        connect Li_c.n_node Junction570 as Connection4706
        connect Ii_b.out Goto6 as Connection4789
        connect Ii_a.out Goto5 as Connection4811
        connect Il_a.out Junction595 as Connection4891
        connect Junction595 Goto49 as Connection4892
        [
            breakpoints = 9608, 6856
        ]
        connect "Rate Transition1.in" Junction595 as Connection4893
        connect Is_a.out "Rate Transition2.in" as Connection4902
        connect Van.out Goto64 as Connection4934
        connect Vbn.out Goto65 as Connection4935
        connect "Filter control.mod" Goto109 as Connection4985
        connect "Filter control.En" Goto110 as Connection4986
        connect "Filter control.MCB" Goto111 as Connection4987
        connect "Filter control.Vdc" From310 as Connection4988
        connect From394 "Filter control.Vg_a" as Connection4989
        connect From395 "Filter control.Vg_b" as Connection4990
        connect From383 "Filter control.Ig_a" as Connection4991
        connect From384 "Filter control.Ig_b" as Connection4992
        connect From386 "Filter control.Ii_a" as Connection4993
        connect From387 "Filter control.Ii_b" as Connection4994
        connect From389 "Filter control.Il_a" as Connection4995
        connect From390 "Filter control.Il_b" as Connection4996
        connect "Split Vref.out" "Three Phase T Type Inverter.InA" as Connection5000
        connect "Three Phase T Type Inverter.InB" "Split Vref.out1" as Connection5002
        connect "Three Phase T Type Inverter.InC" "Split Vref.out2" as Connection5001
        connect La.n_node "Electric motor drive.A" as Connection5006
        connect Lb.n_node "Electric motor drive.B" as Connection5007
        connect Lc.n_node "Electric motor drive.C" as Connection5008
        connect "Three Phase T Type Inverter.DC-" Junction535 as Connection5011
        connect "Three Phase T Type Inverter.DCn" Junction534 as Connection5009
        connect "Three Phase T Type Inverter.DC+" Junction558 as Connection5010
        connect Is_a.n_node "Three-phase Meter1.A+" as Connection5019
        connect MCB.a_out Junction603 as Connection5020
        connect Junction603 Il_a.p_node as Connection5021
        [
            breakpoints = 9368, 6896
        ]
        connect "Three-phase Meter1.A-" Junction603 as Connection5022
        connect MCB.b_out Junction604 as Connection5023
        connect Junction604 Il_b.p_node as Connection5024
        [
            breakpoints = 9432, 6992; 9432, 6992; 9432, 6992; 9432, 6992
        ]
        connect "Three-phase Meter1.B-" Junction604 as Connection5025
        connect Il_c.p_node Junction605 as Connection5026
        connect Junction605 MCB.c_out as Connection5027
        [
            breakpoints = 9496, 7088
        ]
        connect "Three-phase Meter1.C-" Junction605 as Connection5028
        connect Vbn.p_node Junction606 as Connection5029
        connect Junction606 Lgrid_b.p_node as Connection5030
        [
            breakpoints = 9104, 6992
        ]
        connect Junction465 Junction607 as Connection5033
        connect Junction607 Vbn.n_node as Connection5034
        connect "Three-phase Meter1.GND" Junction607 as Connection5035
        connect Enable.out "Filter control.Enable" as Connection5049
        connect "Q comp en.out" "Filter control.Q comp enable" as Connection5050
        connect "Har comp en.out" "Filter control.Har comp en" as Connection5051
        connect "Harmonic Analyzer source.|u|" Amp_source.in as Connection2894
        connect "Harmonic Analyzer load.|u|" Amp_load.in as Connection2898
        connect Termination1.in "Harmonic Analyzer load.wt" as Connection5053
        connect "Harmonic Analyzer source.wt" Termination2.in as Connection5054
        connect "THD Measurement1.In" Junction608 as Connection5055
        connect Junction608 "Rate Transition2.out" as Connection5056
        [
            breakpoints = 9176, 6776; 9176, 6776
        ]
        connect "Harmonic Analyzer source.In" Junction608 as Connection5057
        connect "THD Measurement2.In" Junction609 as Connection5058
        connect Junction609 "Rate Transition1.out" as Connection5059
        [
            breakpoints = 9608, 6752
        ]
        connect "Harmonic Analyzer load.In" Junction609 as Connection5060
        connect Termination3.in "Harmonic Analyzer source.f" as Connection5061
        connect Termination4.in "Harmonic Analyzer source.∠u" as Connection5062
        connect Termination5.in "Harmonic Analyzer load.f" as Connection5063
        connect Termination6.in "Harmonic Analyzer load.∠u" as Connection5064
        connect "Three-phase Meter1.B+" Is_b.n_node as Connection5065
        connect Is_b.p_node Junction606 as Connection5066
        connect "Three-phase Meter1.C+" Is_c.n_node as Connection5067
        connect Is_c.p_node Lgrid_c.p_node as Connection5068
        connect Lg_c.n_node Ig_c.p_node as Connection5069
        connect Ig_c.n_node MCB.c_in as Connection5070
        connect Termination7.in "Three-phase Meter1.Out" as Connection5071
        connect Ig_a.n_node If_rms.p_node as Connection5072
        connect If_rms.n_node MCB.a_in as Connection5073
        connect Goto1 Ig_a.out as Connection5074
        connect "Split Vref.in" From398 as Connection5075
        connect Vdc.out Goto76 as Connection5076
    }

    default {
        gen_PQ_transform {
            filter_order = "first order"
            filter_cutoff_Hz = "30"
            initial_filter_input = "0"
            initial_filter_output = "0"
            enable_inst_ports = "True"
            enable_zero_ports = "False"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_pid_controller {
            controller_type = "PID"
            kp = "1"
            kp_source = "internal"
            ki = "1"
            ki_source = "internal"
            kd = "0"
            kd_source = "internal"
            filt_coef = "100"
            int_init_value = "0"
            filt_init_value = "0"
            enb_output_limit_out = "False"
            show_reset = "none"
            upper_sat_lim = "1"
            upper_sat_lim_source = "internal"
            lower_sat_lim = "-1"
            lower_sat_lim_source = "internal"
            enb_anti_windup_out = "False"
            signal_out_type = "inherit"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rms_value {
            op_mode = "PLL based"
            frequency = "50"
            period_timeout = "0.5"
            period_deadband = "0"
            filter_en = "False"
            lpf_cutoff = "500"
            frequency_src = "Internal"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1,1]"
            a_coeff = "[1,1]"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
            param_set = ""
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        sys_signal_switch {
            criterion = "ctrl > threshold"
            threshold = "0.5"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Current RMS" {
            op_mode = "PLL based"
            frequency = "50"
            pin_to_system_cpu = "True"
            Tfast = "100e-6"
            Tslow = "200e-6"
            sig_output = "False"
            execution_rate = "inherit"
            feed_forward = "False"
            nd_msr_estimation = "false"
        }

        "core/Harmonic Analyzer" {
            f_src = "Internal"
            f1 = "50"
            h = "[0, 1, 3 ,11]"
            ang_unit = "Degrees"
            execution_rate = "100e-6"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/THD Measurement" {
            f_src = "Internal"
            frequency = "50.0"
            execution_rate = "100e-6"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Diode Rectifier" {
            show_monitoring = "False"
            losses_estimation = "False"
            Import_diode_xml = "not selected"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            vd_table_out = "[1.2, 1.2, 1.2, 1.2, 1.2]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            visualize_luts = "Visualize Lookup Tables"
            PESB_Optimization = "True"
        }

        "core/Three Phase T Type Inverter" {
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            Sa_1 = "1"
            Sa_1_logic = "active high"
            Sa_2 = "2"
            Sa_2_logic = "active high"
            Sa_3 = "3"
            Sa_3_logic = "active high"
            Sa_4 = "4"
            Sa_4_logic = "active high"
            Sb_1 = "5"
            Sb_1_logic = "active high"
            Sb_2 = "6"
            Sb_2_logic = "active high"
            Sb_3 = "7"
            Sb_3_logic = "active high"
            Sb_4 = "8"
            Sb_4_logic = "active high"
            Sc_1 = "9"
            Sc_1_logic = "active high"
            Sc_2 = "10"
            Sc_2_logic = "active high"
            Sc_3 = "11"
            Sc_3_logic = "active high"
            Sc_4 = "12"
            Sc_4_logic = "active high"
            _control_property = "all high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            losses_estimation = "False"
            losses_groups = "Group1"
            fvd_def_method_g1 = "Voltage and Resistance"
            fvd_def_method_g2 = "Voltage and Resistance"
            Import_igbt_xml_g1 = "not selected"
            Import_diode_xml_g1 = "not selected"
            Import_igbt_xml_g2 = "not selected"
            Import_diode_xml_g2 = "not selected"
            Switch_type_g1 = "IGBT"
            Switch_type_g2 = "IGBT"
            Vce_g1 = "1.3"
            Rce_g1 = "0"
            Vd_g1 = "1.2"
            Rd_g1 = "0"
            i_sw_g1 = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw_g1 = "[0.0, 600.0]"
            temp_sw_g1 = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            vce_table_out_g1 = "[1.3, 1.3, 1.3, 1.3, 1.3]"
            vd_table_out_g1 = "[1.2, 1.2, 1.2, 1.2, 1.2]"
            et_on_table_out_g1 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out_g1 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out_g1 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            Vce_g2 = "1.3"
            Rce_g2 = "0"
            Vd_g2 = "1.2"
            Rd_g2 = "0"
            i_sw_g2 = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw_g2 = "[0.0, 600.0]"
            temp_sw_g2 = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            vce_table_out_g2 = "[1.3, 1.3, 1.3, 1.3, 1.3]"
            vd_table_out_g2 = "[1.2, 1.2, 1.2, 1.2, 1.2]"
            et_on_table_out_g2 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out_g2 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out_g2 = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type_g1 = "Foster"
            switch_Rth_g1 = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth_g1 = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth_g1 = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth_g1 = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth_g1 = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth_g1 = "[0.0029, 0.0097, 0.1068, 0.8500]"
            thermal_networks_type_g2 = "Foster"
            switch_Rth_g2 = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth_g2 = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth_g2 = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth_g2 = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth_g2 = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth_g2 = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            visualize_luts = "Visualize Lookup Tables"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
            dtv_flag_en = "True"
            show_monitoring = "False"
            vienna_opt = "False"
            model_complexity = "Full"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Three-phase Meter" {
            R = "1e5"
            n_cycles = "1"
            Ts = "100e-6"
            enable_probes = "True"
            enable_out = "True"
            remove_snubber = "False"
            VAn = "True"
            VBn = "True"
            VCn = "True"
            VAB = "False"
            VBC = "False"
            VCA = "False"
            IA = "True"
            IB = "True"
            IC = "True"
            freq = "False"
            VLn_rms = "False"
            VLL_rms = "False"
            VLn_avg_rms = "False"
            VLL_avg_rms = "False"
            I_rms = "False"
            I_avg_rms = "False"
            P_method = "alpha-beta"
            enable_extra_out = "False"
            P_meas = "False"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Variable Resistor" {
            inductance = "1e-3"
            initial_current = "0.0"
            hide_int_meas = "False"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
            _tunable = "False"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        # The Schematic API is imported as 'mdl'
        # To get the model file path, use 'mdl.get_model_file_path()'
        # To print information to the console, use info()
        
        
        # ----- Grid data -----
        fg = 50
        wg = 2*np.pi*fg
        Vg = 400
        Vgf = Vg/np.sqrt(3)
        
        S3phsc = 500e6  # Three-phase short circuit power
        Lgrid = np.sqrt(3)*Vgf**2/wg/S3phsc
        Rgrid = wg*Lgrid/10
        
        Lc = 1.5e-4  # Commutation inductance of the diode rectifier
        
        # ----- AHF base values -----
        In = 100
        Sn = np.sqrt(3)*Vg*In
        Zb = Vg**2/Sn
        Lb = Zb/wg
        Cb = 1/(wg*Zb)
        Ib = Vg/Zb
        
        fsw = 12.5e3  # Converter switching frequency
        wsw = 2*np.pi*fsw
        
        
        # ----- AHF current control loop -----
        k = 23  # Current control bandwidth, expressed as a harmonic order
        ksi = 0.5  # Damping factor of the current control loop
        alpha_des = 0.45  # Desired bandwidth to resonance ratio
        
        # ----- LCL filter parameters calculation -----
        y = 2*alpha_des/k
        x = y/2
        L_i = L_g = x*Lb
        C=y*Cb
        
        w_res = np.sqrt((L_g+L_i)/L_g/L_i/C)
        f_res = 1/(2*np.pi)*np.sqrt((L_g+L_i)/L_g/L_i/C)
        
        Vdc_ref = 900
        G0_pwm = Vdc_ref/2
        delta = 2*ksi*w_res*L_i/G0_pwm
        #lag_calc = 90+np.arctan2(2*ksi*alpha_des, (1-alpha_des**2))*180/np.pi
        
        Nr = 2  #Number of periods that takes integration to rise up from 10% to 90%
        tr = Nr/fg
        
        w_cross_des = alpha_des*w_res;
        f_cross_des = 1/2/np.pi*w_cross_des
        
        #wI = w_cross_des/10
        #ki_2 = Kp*wI
        
        kp_reg = alpha_des*w_res*(L_i+L_g)/G0_pwm
        ki_reg = kp_reg*2.2/tr
        #w_integr = 1/tr
        #f_integr = w_integr/2/np.pi
        
        
        
        
        
        #----- Voltage control loop -----
        Cdc = 10e-3
        Vdn = Vgf*np.sqrt(2)
        tau_v = 0.1  #2.2/wc_v
        wc_v = 1/tau_v  #w_cross_des/10
        Kp_v = wc_v
        Ki_v = Kp_v*wc_v/100
        
        
        Ts = 40e-6
        Tslow = 4*Ts
        
        #Reading Harmonics for measurement
        harmonics_to_observe = [1, 5, 7, 11, 13, 17, 19, 23, 25]
    ENDCODE
}
