version = 4.2

//
// Saved by sw version: 2021.3 DEV
// Save timestamp: 07-Jul-2021 @ 09:40:33 AM
//

model "wind farm microgrid" {
    configuration {
        hil_device = "HIL402"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 5e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_digital_outputs_on_sim_stop = True
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "external memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "medium"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = True
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
    }

    component Subsystem Root {
        component Subsystem Wind_out {
            layout = dynamic
            component gen_probe Out {
            }
            [
                position = 8128, 8128
                rotation = left
            ]

            port Outputs {
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8128, 8192
                rotation = left
                hide_name = True
            ]

            connect Out.in Outputs as Connection1
        }
        [
            position = 7688, 7896
            rotation = right
            size = 48, 48
        ]

        component "core/Three Phase Voltage Source" Vs1 {
        }
        [
            position = 9896, 8104
            scale = -1, 1
            size = 62, 256
        ]

        component "core/Underground Cable" "Underground Cable2" {
            Cable_diam_m = "31"
            Distance_between_cables_m = "20"
            Frequency = "50.0"
            Length = "0.5"
            Phase_conductor_GMR_m = "5.21208"
            Phase_conductor_diam_m = "15"
            Phase_conductor_resistance_m = "0.206"
            Screen_conductor_GMR_m = "0.633984"
            Screen_conductor_diam_m = "2.5"
            Screen_conductor_resistance_m = "9.241156645192078"
            unit_sys = "metric"
        }
        [
            position = 7992, 8312
            rotation = left
            size = 256, 56
        ]

        component "core/Underground Cable" "Underground Cable3" {
            Cable_diam_m = "31"
            Distance_between_cables_m = "20"
            Frequency = "50.0"
            Length = "0.5"
            Phase_conductor_GMR_m = "5.21208"
            Phase_conductor_diam_m = "15"
            Phase_conductor_resistance_m = "0.206"
            Screen_conductor_GMR_m = "0.633984"
            Screen_conductor_diam_m = "2.5"
            Screen_conductor_resistance_m = "9.241156645192078"
            unit_sys = "metric"
        }
        [
            position = 7992, 8768
            rotation = left
            size = 256, 56
        ]

        component Subsystem Wind_out2 {
            layout = dynamic
            component gen_probe Out {
            }
            [
                position = 8128, 8128
                rotation = left
            ]

            port Outputs {
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8128, 8192
                rotation = left
                hide_name = True
            ]

            connect Out.in Outputs as Connection1
        }
        [
            position = 7704, 8816
            rotation = right
            size = 48, 48
        ]

        component "core/Four Phase Core Coupling" "Core Coupling" {
            C1 = "1e-6"
            R1 = "1e6"
            fixed_snb_i = "true"
        }
        [
            position = 8648, 8152
            scale = -1, 1
            size = 12, 352
        ]

        component src_ground gnd7 {
        }
        [
            position = 9992, 8168
        ]

        component "core/Battery" Battery1 {
            Kdisc_I = "20.0"
            Ke_exp = "103.0"
            Ke_full = "116.0"
            Kq_exp = "85.0"
            Kq_nom = "93.5"
            R_series = "0.025000000000000022"
            battery_type = "Lithium-Ion"
            capacity = "1e3"
            execution_rate = "Ts"
            initial_soc = "98"
            nominal_voltage = "1000"
            sig_output = "True"
        }
        [
            position = 7968, 7752
            rotation = left
            scale = 1, -1
            size = 64, 48
        ]

        component "core/Triple Pole Single Throw Contactor" S1 {
            ctrl_src = "Model"
        }
        [
            position = 9568, 8104
            size = 64, 256
        ]

        component src_ground gnd9 {
        }
        [
            position = 8688, 7888
        ]

        component Subsystem Batt_out {
            layout = dynamic
            component gen_probe Out {
            }
            [
                position = 8192, 8192
                rotation = left
                scale = -1, 1
            ]

            port outputs {
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8192, 8256
                rotation = left
                hide_name = True
            ]

            connect Out.in outputs as Connection1
        }
        [
            position = 8320, 7560
            rotation = right
            size = 48, 48
        ]

        component "core/Battery inverter (Average)" "Battery inverter (Average)" {
            fn = "50"
        }
        [
            position = 8208, 7760
            size = 288, 239
        ]

        component src_ground gnd10 {
        }
        [
            position = 9736, 8256
            hide_name = True
        ]

        component Subsystem Relay {
            layout = dynamic
            component gen_logic_op "Logical operator1" {
                operator = "NOT"
            }
            [
                position = 8296, 8160
            ]

            component "core/(27) Undervoltage" "(27) Undervoltage1" {
                Vn = "110000"
                execution_rate = "Ts"
            }
            [
                position = 8144, 8224
                size = 144, 160
            ]

            component src_scada_input EnRst {
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 8008, 8288
            ]

            port In1 {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8024, 8160
                hide_name = True
            ]

            tag Goto1 {
                value = "Switch"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8408, 8160
            ]

            connect EnRst.out "(27) Undervoltage1.Mem_en_rst" as Connection357
            connect "(27) Undervoltage1.Meas_in" In1 as Connection363
            connect Goto1 "Logical operator1.out" as Connection364
            connect "(27) Undervoltage1.trip_delayed" "Logical operator1.in" as Connection365
        }
        [
            position = 9824, 7816
            size = 48, 96
        ]

        component "core/Underground Cable" "Underground Cable1" {
            Cable_diam_m = "37"
            Distance_between_cables_m = "20"
            Frequency = "50.0"
            Length = "0.5"
            Phase_conductor_GMR_m = "5.21208"
            Phase_conductor_diam_m = "21.5"
            Phase_conductor_resistance_m = "0.1"
            Screen_conductor_GMR_m = "0.633984"
            Screen_conductor_diam_m = "2.75"
            Screen_conductor_resistance_m = "9.241156645192078"
            unit_sys = "metric"
        }
        [
            position = 8208, 8104
            size = 256, 56
        ]

        component src_ground gnd6 {
        }
        [
            position = 8744, 8328
            hide_name = True
        ]

        component src_ground gnd11 {
        }
        [
            position = 9008, 8696
            hide_name = True
        ]

        component src_ground gnd12 {
        }
        [
            position = 9184, 8416
            hide_name = True
        ]

        component Subsystem "Wind Turbine 3" {
            layout = dynamic
            component Subsystem "Wind Power Plant (Average)" {
                layout = static
                component gen_digital_probe Enable {
                }
                [
                    position = 8080, 7744
                    scale = -1, 1
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component "core/Voltage Measurement" Va0 {
                }
                [
                    position = 7720, 8520
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component "core/Voltage Measurement" Vc0 {
                }
                [
                    position = 7816, 8416
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component "core/Voltage Measurement" Vab1 {
                }
                [
                    position = 8632, 8200
                    rotation = right
                    size = 64, 32
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component src_constant Vdc {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7200, 8296
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Enabled {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8296
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From32 "Bus Join1.in13" as Connection15
                    connect From33 "Bus Join1.in12" as Connection14
                    connect From34 "Bus Join1.in9" as Connection11
                    connect "Bus Join1.in" Connected as Connection19
                    connect "Bus Join1.in6" Ia as Connection2
                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect Enabled "Bus Join1.in1" as Connection20
                    connect From29 "Bus Join1.in5" as Connection10
                }
                [
                    position = 8680, 7744
                    rotation = left
                    size = 96, 152
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "wind_speed"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out1" Goto31 as Connection756
                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.in" Inputs as Connection761
                    connect "Bus Split2.out" Goto32 as Connection755
                }
                [
                    position = 7880, 7760
                    size = 72, 72
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem PLL {
                        layout = dynamic
                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            initial_filter_output = "50"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port f {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port wt {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Constant1.out Junction4 as Connection100
                        connect Gain1.out f as Connection27
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect PLL.peak Junction2 as Connection88
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect PLL.d_axis Gain4.in as Connection80
                        connect Junction2 Goto32 as Connection87
                        connect Goto34 Junction5 as Connection112
                        connect Junction4 Junction3 as Connection101
                        connect Gain3.out Vq as Connection54
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect Goto33 Junction1 as Connection82
                        connect From4 "Signal switch3.in2" as Connection115
                        connect "Signal switch1.in" A as Connection89
                        connect Gain5.in Junction2 as Connection86
                        connect From3 "Signal switch2.in2" as Connection113
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect Junction1 Gain1.in as Connection83
                        connect "Signal switch3.in" C as Connection94
                        connect Junction5 Connected as Connection111
                        connect From1 f_meas.in as Connection73
                        connect B "Signal switch2.in" as Connection95
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect PLL.freq Junction1 as Connection84
                        connect PLL.theta wt as Connection85
                        connect Vd Gain4.out as Connection55
                        connect Vt Gain5.out as Connection56
                        connect From2 Vt_meas.in as Connection74
                        connect Gain3.in PLL.q_axis as Connection81
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Ki.in Junction74 as Connection81
                            connect Kp.in Junction74 as Connection79
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Out Junction73 as Connection68
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                            connect Ki.out Sum7.in as Connection78
                            connect Kb.in Sum6.out as Connection50
                        }
                        [
                            position = 8000, 8432
                            size = 64, 48
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_product Product1 {
                            signs = "3"
                        }
                        [
                            position = 8080, 8160
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_c_function S_and_pf {
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    input_terminals = "real P;inherit Q;"
                                    input_terminals_dimensions = "inherit;inherit"
                                    input_terminals_feedthrough = "[u\'\']"
                                    input_terminals_show_labels = "False;False;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                    output_terminals = "inherit S;inherit pf;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[u\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Product4.in1 as Connection24
                                connect Junction4 Vd as Connection50
                                connect Junction5 P as Connection55
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.S S as Connection51
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction2 Iq as Connection52
                                connect Junction1 Id as Connection49
                                connect S_and_pf.pf pf as Connection54
                                connect Sum2.in1 Product3.out as Connection38
                                connect LPF_P.in Sum1.out as Connection39
                                connect Junction6 Q as Connection56
                                connect Junction4 Product1.in as Connection35
                                connect Product2.in1 Junction2 as Connection28
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Product1.in1 Junction1 as Connection25
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.P Junction5 as Connection45
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in Product4.out as Connection37
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction3 Vq as Connection53
                                connect Sum1.in Product1.out as Connection29
                                connect Product3.in Junction4 as Connection36

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 9128, 7720
                            size = 96, 232
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9320, 7752
                            rotation = down
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9320, 7624
                            rotation = down
                            scale = -1, 1
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9320, 7816
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9104, 8520
                            rotation = right
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9320, 7688
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_gain efficiency {
                            gain = "WT_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9104, 7960
                            hide_name = True
                        ]

                        component src_constant three {
                            execution_rate = "Ts"
                            value = "3"
                        }
                        [
                            position = 7832, 8200
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant effective_area {
                            execution_rate = "inherit"
                            value = "eff_A"
                        }
                        [
                            position = 8008, 8080
                            rotation = right
                        ]

                        component src_constant air_density {
                            execution_rate = "inherit"
                            value = "air_dens"
                        }
                        [
                            position = 7952, 8112
                            rotation = right
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Sref;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Sref" Sref as Connection4
                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Qref" Qref as Connection1
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Smax;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;inherit S;"
                                    output_terminals_dimensions = "inherit;inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;False;"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Q" Q as Connection6
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.P" P as Connection5
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163
                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 9216, 8024
                            rotation = right
                            size = 64, 96
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component gen_math_fnc power {
                            mathematical_fn = "power"
                        }
                        [
                            position = 7912, 8176
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Ki.in Junction74 as Connection74
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Sum7.out Integrator1.in as Connection63
                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Junction72 Limit1.in as Connection57
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Junction73 Limit1.out as Connection60
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8088
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8296
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7208, 8472
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6952, 8472
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6864, 8472
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6800, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            connect Junction146 Sum1.in as Connection11
                            connect Sum9.in1 Gain11.out as Connection190
                            connect VDC LPF_dc.in as Connection124
                            connect Junction150 Id_meas as Connection65
                            connect Vd Sum5.in as Connection31
                            connect Product7.in Sum7.out as Connection145
                            connect Junction151 Iq_meas as Connection68
                            connect From26 PI_q.Reset as Connection169
                            connect Junction155 Gain5.out as Connection192
                            connect Product8.out Gain10.in as Connection188
                            connect Vq Sum6.in as Connection32
                            connect Gain1.in Junction145 as Connection5
                            connect Junction155 Product7.in1 as Connection116
                            connect Product8.in1 Junction155 as Connection115
                            connect mq Sum9.out as Connection174
                            connect Gain1.out Product1.in1 as Connection6
                            connect Junction164 Reset as Connection171
                            connect Product8.in Sum3.out as Connection143
                            connect Damp.out Junction165 as Connection182
                            connect Gain10.out Sum8.in as Connection189
                            connect Junction165 Product5.in1 as Connection181
                            connect Sum1.in1 Id_ref as Connection20
                            connect From23 Product1.in as Connection1
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Junction166 Vdc.in as Connection185
                            connect Gain11.in Product7.out as Connection191
                            connect From25 Product2.in as Connection2
                            connect Sum2.in Junction145 as Connection21
                            connect Limit3.out Junction166 as Connection186
                            connect Gain2.in Junction146 as Connection7
                            connect Limit3.in LPF_dc.out as Connection187
                            connect Gain2.out Product2.in1 as Connection8
                            connect PI_d.Reset Junction164 as Connection172
                            connect Sum3.in PI_d.Out as Connection178
                            connect PI_d.In Sum1.out as Connection55
                            connect Gain5.in Junction166 as Connection193
                            connect PI_q.In Sum2.out as Connection165
                            connect Sum5.in1 Product1.out as Connection24
                            connect Product5.in From27 as Connection101
                            connect Goto1 w as Connection34
                            connect Product5.out Sum8.in1 as Connection95
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Product6.in1 From28 as Connection102
                            connect Goto2 Junction164 as Connection170
                            connect Product6.in Junction165 as Connection180
                            connect Sum6.in1 Product2.out as Connection26
                            connect Product6.out Sum9.in as Connection96
                            connect Goto3 Junction150 as Connection66
                            connect Sum7.in PI_q.Out as Connection175
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Junction146 Junction150 as Connection64
                            connect Sum8.out md as Connection173
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain1 {
                            gain = "8.0/27.0"
                        }
                        [
                            position = 8152, 8160
                            hide_name = True
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7616, 8328
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction147 sp
                            [
                                position = 7552, 8216
                            ]

                            junction Junction148 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            connect Product6.in Junction147 as Connection73
                            connect Vq Junction143 as Connection3
                            connect Junction147 Product4.in1 as Connection74
                            connect Product5.in1 Junction142 as Connection33
                            connect Junction142 Vd as Connection12
                            connect Product6.in1 Junction143 as Connection36
                            connect Product2.in Sum4.out as Connection26
                            connect Junction145 Product7.in as Connection64
                            connect Product7.in1 Junction145 as Connection65
                            connect Product4.out Sum3.in1 as Connection31
                            connect Q_ref Junction147 as Connection75
                            connect Product3.out Sum3.in as Connection28
                            connect Limit3.in Product7.out as Connection77
                            connect P_ref Junction146 as Connection72
                            connect Junction143 Product3.in as Connection13
                            connect Ird Product2.out as Connection82
                            connect Product6.out Sum4.in1 as Connection37
                            connect Product5.in Junction146 as Connection70
                            connect Limit3.out Junction148 as Connection80
                            connect Irq Product1.out as Connection81
                            connect Junction146 Product3.in1 as Connection71
                            connect Junction148 Product2.in1 as Connection79
                            connect Product5.out Sum4.in as Connection34
                            connect Vt Junction145 as Connection63
                            connect Product4.in Junction142 as Connection30
                            connect Product1.in Sum3.out as Connection23
                            connect Product1.in1 Junction148 as Connection78
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8000, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7872, 8000
                                size = 48, 80
                            ]

                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8000
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8000
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            connect "abc to dq1.d_axis" Gain1.in as Connection31
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection32
                            connect "abc to dq1.vb" Ib as Connection28
                            connect "abc to dq1.vc" Ic as Connection29
                            connect "abc to dq1.va" Ia as Connection27
                            connect "abc to dq1.zero_axis" Termination1.in as Connection33
                            connect wt "abc to dq1.wt" as Connection30
                            connect Gain1.out Id as Connection24
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_probe wind_speed {
                        }
                        [
                            position = 7816, 8112
                            rotation = right
                            scale = -1, -1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8856, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7920
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7624
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7728
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7936, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From44 {
                            value = "wind_speed"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7720, 8168
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7792
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7816
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9216, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7888
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7664
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7688
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7600
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction183 sp
                        [
                            position = 9104, 8480
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction194 sp
                        [
                            position = 7816, 8168
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction189 sp
                        [
                            position = 9208, 7688
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction190 sp
                        [
                            position = 9208, 7752
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction167 sp
                        [
                            position = 9168, 8480
                        ]

                        junction Junction188 sp
                        [
                            position = 9208, 7624
                        ]

                        junction Junction196 sp
                        [
                            position = 8528, 8176
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction191 sp
                        [
                            position = 9208, 7816
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = (8.0/27.0) * A_eff * air_dens * (wind_sp)    </p></body></html> ENDCOMMENT 
                        [
                            position = 8024, 7992
                        ]

                        connect Gain3.in VDC as Connection298
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect power.in Junction194 as Connection560
                        connect Junction182 Goto3 as Connection481
                        connect Goto21 Junction196 as Connection577
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection591
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect air_density.out Product1.in1 as Connection564
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect Junction177 Sum1.in1 as Connection432
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Power_Meas.Iq From35 as Connection405
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect From31 Power_Meas.Vq as Connection403
                        connect Junction194 wind_speed.in as Connection561
                        connect Gain1.out efficiency.in as Connection565
                        connect md Junction164 as Connection360
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect From45 Gain4.in as Connection531
                        connect Goto34 Junction190 as Connection547
                        connect S.in Junction190 as Connection545
                        connect From47 Junction187 as Connection538
                        connect Product1.in2 power.out as Connection262
                        connect Current_ref.Vq From3 as Connection475
                        connect Junction164 ControlSignal_Calculation.md as Connection359
                        connect Junction173 Junction123 as Connection397
                        connect Junction184 Connected as Connection493
                        connect Junction190 Power_Meas.S as Connection546
                        connect From34 Power_Meas.Id as Connection404
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Uq_c.in Junction165 as Connection362
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect Junction165 ControlSignal_Calculation.mq as Connection363
                        connect Goto35 Junction191 as Connection550
                        connect Current_ref.Vd From4 as Connection474
                        connect iq.in Junction124 as Connection187
                        connect Junction195 Qref.in as Connection575
                        connect From38 "Signal switch3.in2" as Connection422
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect Goto22 Junction173 as Connection398
                        connect wt From1 as Connection392
                        connect From40 "Signal switch2.in2" as Connection471
                        connect three.out power.in1 as Connection259
                        connect effective_area.out Product1.in as Connection563
                        connect Q.in Junction189 as Connection542
                        connect Vd.in Junction181 as Connection478
                        connect Junction176 Enable as Connection426
                        connect efficiency.out to_pu.in as Connection566
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Goto24 Junction176 as Connection425
                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect Junction167 Goto1 as Connection483
                        connect V_d Junction181 as Connection476
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect From44 Junction194 as Connection562
                        connect wt_pll.in Junction183 as Connection486
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect From39 "Logical operator1.in" as Connection439
                        connect From28 Junction177 as Connection431
                        connect Junction124 Junction174 as Connection399
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Junction183 wt_in as Connection485
                        connect Ud_c.in Junction164 as Connection358
                        connect Goto33 Junction189 as Connection544
                        connect "Signal switch1.out" Junction195 as Connection576
                        connect From37 "Logical operator2.in1" as Connection470
                        connect From46 Gain2.in as Connection533
                        connect w Junction192 as Connection553
                        connect Junction167 Junction183 as Connection484
                        connect delay.in Junction184 as Connection506
                        connect mq Junction165 as Connection364
                        connect V_q Junction182 as Connection480
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect Goto23 Junction174 as Connection401
                        connect Junction179 Id_ref.in as Connection464
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Goto32 Junction188 as Connection541
                        connect Goto18 Junction195 as Connection574
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Junction187 Qmode.in as Connection537
                        connect "Signal switch2.out" Junction196 as Connection579
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Vt Junction193 as Connection556
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect Gain1.in Product1.out as Connection264
                        connect Junction180 Iq_ref.in as Connection467
                        connect From30 Limit_PQref.Pref as Connection589
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect w_pu.in Junction192 as Connection555
                        connect Junction192 Goto17 as Connection554
                        connect Junction196 Pref.in as Connection578
                        connect Vq.in Junction182 as Connection482
                        connect From32 Power_Meas.Vd as Connection402
                        connect Junction188 Power_Meas.P as Connection540
                        connect id.in Junction123 as Connection186
                        connect Junction193 Goto19 as Connection557
                        connect pf.in Junction191 as Connection548
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect Junction181 Goto4 as Connection477
                        connect "Logical operator2.in" delay.out as Connection505
                        connect "Signal switch4.in2" From43 as Connection518
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect Goto26 Junction184 as Connection494
                        connect Vt_pu.in Junction193 as Connection558
                        connect P.in Junction188 as Connection539
                        connect From27 Limit_PQref.Qref as Connection588
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection590
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect From42 Current_ref.Vt as Connection487
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8256
                            rotation = left
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7520, 7896
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_gain Gain1 {
                            gain = "0.5"
                        }
                        [
                            position = 7736, 8040
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7432, 7944
                            hide_name = True
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                                value = "1.0/2.0"
                            }
                            [
                                position = 7880, 8080
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            connect Z0.in Junction260 as Connection1484
                            connect Sum5.out Dz_A as Connection1447
                            connect Goto5 Junction260 as Connection1486
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect From7 Sum7.in as Connection1493
                            connect Product1.out Sum3.in2 as Connection1451
                            connect From8 Sum7.in1 as Connection1492
                            connect Goto4 Junction259 as Connection1482
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Sum2.out Product2.in as Connection1435
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Junction258 Junction255 as Connection1478
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Goto1 Limit1.out as Connection1439
                            connect Sum6.out Dz_B as Connection1490
                            connect Da Junction257 as Connection1474
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect From6 Sum6.in1 as Connection1488
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Db Junction258 as Connection1477
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Constant4.out Sum3.in as Connection1452
                            connect From2 Product1.in as Connection1441
                            connect From4 Sum5.in as Connection1487
                            connect Goto3 Junction258 as Connection1479
                            connect Junction259 Junction256 as Connection1481
                            connect Sum7.out Dz_C as Connection1491
                            connect Goto2 Junction257 as Connection1476
                            connect Constant1.out Limit1.in as Connection1425
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect From3 Sum5.in1 as Connection1446
                            connect Dc Junction259 as Connection1480
                            connect Junction260 Sum3.out as Connection1485
                            connect From5 Sum6.in as Connection1489
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect From1 Sum2.in as Connection1440
                            connect Junction257 Junction254 as Connection1475

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8224
                            scale = -1, 1
                            size = 88, 184
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8256
                            rotation = left
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7480, 7896
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8080, 8144
                            hide_name = True
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7432, 7992
                            hide_name = True
                        ]

                        component gen_product Product3 {
                        }
                        [
                            position = 8080, 8288
                            hide_name = True
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7528, 8096
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7480, 8016
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8080, 8216
                            hide_name = True
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7992
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7944
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8144
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 7992
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 8040
                        ]

                        tag From37 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8120
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8192
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8264
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8040
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction14 sp
                        [
                            position = 7664, 8224
                        ]

                        junction Junction15 sp
                        [
                            position = 7664, 8296
                        ]

                        junction Junction9 sp
                        [
                            position = 7856, 8224
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction10 sp
                        [
                            position = 7856, 8296
                        ]

                        junction Junction11 sp
                        [
                            position = 7480, 7944
                        ]

                        junction Junction12 sp
                        [
                            position = 7520, 7992
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8152
                        ]

                        connect From39 Product3.in as Connection2335
                        connect ZSM.Db Junction14 as Connection2353
                        connect Junction12 m_q.in as Connection2348
                        connect "dq to abc1.q_input" Junction12 as Connection2346
                        connect ZSM.Dz_C Junction10 as Connection2337
                        connect md Limit2.in as Connection2359
                        connect Gain1.in VDC as Connection2341
                        connect Limit3.out Junction12 as Connection2329
                        connect "dq to abc1.d_input" Junction11 as Connection2347
                        connect "dq to abc1.phase_a" Junction13 as Connection2352
                        connect Product1.out m_a as Connection2322
                        connect From38 Product2.in as Connection2328
                        connect Junction8 ZSM.Dz_A as Connection2324
                        connect "dq to abc1.phase_b" Junction14 as Connection2355
                        connect m_d.in Junction11 as Connection2326
                        connect Da.in Junction13 as Connection2350
                        connect o_ref.out "dq to abc1.zero_input" as Connection2345
                        connect Product3.in1 Junction10 as Connection2339
                        connect Product2.out m_b as Connection2330
                        connect Product3.out m_c as Connection2336
                        connect Goto1 Gain1.out as Connection2340
                        connect From37 Product1.in as Connection2327
                        connect Dz_A.in Junction8 as Connection2323
                        connect Junction10 Dz_C.in as Connection2338
                        connect wt "dq to abc1.wt" as Connection2361
                        connect Junction11 Limit2.out as Connection2349
                        connect Product1.in1 Junction8 as Connection2325
                        connect Junction9 ZSM.Dz_B as Connection2332
                        connect Dc.in Junction15 as Connection2356
                        connect Junction13 ZSM.Da as Connection2351
                        connect "dq to abc1.phase_c" Junction15 as Connection2358
                        connect Junction14 Db.in as Connection2354
                        connect Junction15 ZSM.Dc as Connection2357
                        connect Dz_B.in Junction9 as Connection2331
                        connect Product2.in1 Junction9 as Connection2333
                        connect mq Limit3.in as Connection2360
                    }
                    [
                        position = 8168, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7368
                        rotation = right
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7688
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7576
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7464
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction2 sp
                    [
                        position = 8024, 7408
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    connect PLL.Vt Goto10 as Connection558
                    connect mc duty_cycle.m_c as Connection549
                    connect From18 Grid_follow.wt_in as Connection485
                    connect Goto14 PLL.f as Connection559
                    connect PLL.A Va as Connection553
                    connect From17 Grid_follow.w as Connection502
                    connect PLL.Vd Goto12 as Connection556
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect ma duty_cycle.m_a as Connection547
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect mb duty_cycle.m_b as Connection548
                    connect Ia Grid_follow.Ia as Connection495
                    connect Ib Grid_follow.Ib as Connection496
                    connect Junction1 Connected as Connection542
                    connect Ic Grid_follow.Ic as Connection497
                    connect PLL.C Vc as Connection555
                    connect From16 Grid_follow.Vt as Connection482
                    connect VDC Junction2 as Connection550
                    connect Goto13 PLL.Vq as Connection557
                    connect From15 Grid_follow.V_q as Connection481
                    connect From14 Grid_follow.V_d as Connection480
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect Goto16 Junction1 as Connection541
                    connect Enable Grid_follow.Enable as Connection532
                    connect PLL.B Vb as Connection554
                    connect Junction2 Grid_follow.VDC as Connection551
                    connect PLL.Connected From19 as Connection561
                    connect PLL.wt Goto15 as Connection560
                    connect duty_cycle.VDC Junction2 as Connection552
                }
                [
                    position = 8184, 7880
                    size = 128, 208
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Signal Controlled Voltage Source" VspC {
                }
                [
                    position = 7656, 8400
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 8944, 8248
                    size = 64, 256
                ]

                component "core/Voltage Measurement" Vbc1 {
                }
                [
                    position = 8632, 8296
                    rotation = right
                    size = 64, 32
                ]

                component "core/Signal Controlled Voltage Source" VspB {
                }
                [
                    position = 7608, 8296
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component "core/Signal Controlled Voltage Source" VspA {
                }
                [
                    position = 7560, 8200
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component gen_probe VDC {
                }
                [
                    position = 7248, 8240
                    rotation = left
                ]

                component "core/Voltage Measurement" Vb0 {
                }
                [
                    position = 7768, 8472
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9040, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9040, 8344
                    rotation = down
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9040, 8152
                    rotation = down
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7880, 7672
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8680, 7648
                    rotation = left
                ]

                tag From39 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7848
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7864
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag From35 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7944
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7824
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8144, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8400
                    hide_name = True
                    size = 0, 0
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8184, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7312, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8224, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From41 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8864, 8088
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction502 pe
                [
                    position = 7720, 8152
                ]

                junction Junction508 pe
                [
                    position = 7608, 8584
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction137 pe
                [
                    position = 8632, 8152
                ]

                junction Junction115 pe
                [
                    position = 8416, 8584
                ]

                junction Junction509 sp
                [
                    position = 7248, 8296
                ]

                junction Junction65 pe
                [
                    position = 8632, 8248
                ]

                junction Junction503 pe
                [
                    position = 7768, 8248
                ]

                junction Junction507 pe
                [
                    position = 7848, 8152
                ]

                junction Junction478 pe
                [
                    position = 7720, 8584
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction510 sp
                [
                    position = 8144, 7744
                ]

                junction Junction116 pe
                [
                    position = 8480, 8584
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction139 pe
                [
                    position = 8632, 8248
                ]

                junction Junction141 pe
                [
                    position = 8632, 8344
                ]

                junction Junction505 pe
                [
                    position = 7816, 8344
                ]

                junction Junction70 pe
                [
                    position = 8328, 8584
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction480 pe
                [
                    position = 7768, 8584
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction477 pe
                [
                    position = 7656, 8584
                ]

                junction Junction78 pe
                [
                    position = 8536, 8584
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction506 pe
                [
                    position = 7848, 8248
                ]

                connect Goto14 Ic.out as Connection670
                connect Junction121 R7.p_node as Connection672
                connect Junction478 Junction477 as Connection2249
                connect From19 Control.Ia as Connection491
                connect Vb.p_node Junction138 as Connection779
                connect From27 Control.Connected as Connection754
                connect L3.p_node Junction505 as Connection2417
                connect R0a.n_node Ia.p_node as Connection664
                connect Junction480 Junction478 as Connection2255
                connect Vc0.n_node Junction480 as Connection2256
                connect From8 Control.Va as Connection485
                connect Junction136 Junction137 as Connection778
                connect Enable.in Junction510 as Connection2449
                connect S1.c_in L4.n_node as Connection697
                connect Junction502 Junction507 as Connection2423
                connect R0a.p_node L1.n_node as Connection611
                connect Vb.n_node Junction78 as Connection363
                connect From20 Control.Ib as Connection492
                connect L3.n_node R0c.p_node as Connection614
                connect Goto17 Control.mb as Connection2433
                connect Junction503 Junction506 as Connection2420
                connect R0b.n_node Ib.p_node as Connection662
                connect From9 Control.Vb as Connection486
                connect From30 Output.Vc as Connection2440
                connect Junction123 R8.p_node as Connection677
                connect Junction137 R0a1.p_node as Connection777
                connect Junction503 Vb0.p_node as Connection2394
                connect Vc0.p_node Junction505 as Connection2415
                connect Vb0.n_node Junction480 as Connection2254
                connect R0b.p_node L2.n_node as Connection613
                connect L5.p_node R0a1.n_node as Connection652
                connect S1.a_in L5.n_node as Connection695
                connect Junction505 VspC.p_node as Connection2424
                connect Goto1 Va.out as Connection367
                connect From25 Junction510 as Connection2447
                connect Goto18 Control.mc as Connection2432
                connect From10 Control.Vc as Connection487
                connect R0c1.p_node Junction141 as Connection786
                connect Junction506 Vab.n_node as Connection2419
                connect L6.p_node R0b1.n_node as Connection650
                connect Vdc.out Junction509 as Connection2444
                connect Junction507 Vab.p_node as Connection2422
                connect Junction138 Junction123 as Connection780
                connect Vbc1.p_node Junction65 as Connection117
                connect Junction125 Ic.n_node as Connection682
                connect Goto12 Ia.out as Connection668
                connect Junction508 VspB.n_node as Connection2427
                connect Output.Connected From29 as Connection2436
                connect Vc.p_node Junction140 as Connection784
                connect From18 Control.VDC as Connection489
                connect Goto13 Ib.out as Connection669
                connect Va0.p_node Junction502 as Connection2390
                connect Output.Va From31 as Connection2438
                connect Junction136 Junction121 as Connection775
                connect Vc.n_node Junction78 as Connection617
                connect Outputs Output.Outputs as Connection2435
                connect B S1.b_out as Connection698
                connect From37 VspB.in as Connection2430
                connect Ib.n_node Junction123 as Connection676
                connect Vab1.p_node Junction137 as Connection776
                connect C S1.c_out as Connection696
                connect From38 VspC.in as Connection2431
                connect Ic.p_node R0c.n_node as Connection667
                connect C1.n_node Junction70 as Connection142
                connect Vab1.n_node Junction65 as Connection119
                connect Inputs Input.Inputs as Connection755
                connect From39 Output.Enabled as Connection2437
                connect C1.p_node R7.n_node as Connection139
                connect Junction115 Junction116 as Connection622
                connect From32 Output.Vb as Connection2439
                connect Junction510 Control.Enable as Connection2448
                connect S1.b_in L6.n_node as Connection699
                connect C2.p_node R8.n_node as Connection144
                connect Goto3 Control.ma as Connection2434
                connect R0c1.n_node L4.p_node as Connection655
                connect VspA.p_node Junction502 as Connection2392
                connect Junction65 Junction139 as Connection781
                connect From33 Output.Ic as Connection2443
                connect R9.n_node C3.p_node as Connection145
                connect Junction477 Junction508 as Connection2426
                connect Goto4 Vb.out as Connection368
                connect Junction115 Junction70 as Connection619
                connect Junction509 Goto19 as Connection2445
                connect VDC.in Junction509 as Connection2446
                connect Junction70 C2.n_node as Connection143
                connect VspA.n_node Junction508 as Connection2428
                connect Junction138 Junction139 as Connection783
                connect From34 Output.Ib as Connection2442
                connect C3.n_node Junction115 as Connection618
                connect Goto5 Vc.out as Connection369
                connect R9.p_node Junction125 as Connection681
                connect Junction78 Junction116 as Connection620
                connect Va.p_node Junction136 as Connection774
                connect Junction139 R0b1.p_node as Connection782
                connect From35 Output.Ia as Connection2441
                connect Junction116 Va.n_node as Connection621
                connect VspB.p_node Junction503 as Connection2395
                connect Junction140 Junction125 as Connection785
                connect Va0.n_node Junction478 as Connection2248
                connect L1.p_node Junction507 as Connection2421
                connect A S1.a_out as Connection694
                connect Junction140 Junction141 as Connection788
                connect From36 VspA.in as Connection2429
                connect Control.Ic From21 as Connection493
                connect Ia.n_node Junction121 as Connection671
                connect Junction141 Vbc1.n_node as Connection787
                connect VspC.n_node Junction477 as Connection2245
                connect L2.p_node Junction506 as Connection2418
                connect From41 S1.ctrl_in as Connection2450

                C = "500e-6"
                L0 = "200e-6"
                Sn = "2e6"
                Ts = "Ts"
                Vn = "690"
                WT_eff = "80"
                eff_A = "7854"
                fn = "50"

                mask {
                    icon = "image(\'wind_power_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Wind power plant average model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Active power output is based on wind speed input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of inputs is 6 and of outputs is 14 and they are configured in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - Connect; 1 - Enable; 2 - wind_speed; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "wind_power_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "1.5e6"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    eff_A {
                        label = "Effective disk area"
                        widget = edit
                        type = generic
                        default_value = "1345.0"
                        unit = "m"
                        group = "1 - General"
                    }

                    WT_eff {
                        label = "Wind turbine efficiency"
                        widget = edit
                        type = generic
                        default_value = "75.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    air_dens {
                        label = "Air density"
                        widget = edit
                        type = generic
                        default_value = "1.225"
                        unit = "kg/m"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "79.8e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "48e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "0.0784"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "541.7e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "wind_power_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7952, 8192
                size = 353, 239
            ]

            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0031817252323677937"
                L2 = "1.5148193831303065e-05"
                Lm = "22.74870341499556"
                R1 = "0.029375"
                R2 = "0.000139854375"
                Rm = "217391.30434782608"
                Sn = "2e6"
                V1 = "10e3"
                V2 = "690"
                current_vals_SI = "[0.3919183588453085, 163.29931618554522]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "50"
                flux_vals_SI = "[31.18787204934705, 39.50463792917293]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8432, 8192
                rotation = down
                scale = 1, -1
                size = 126, 256
            ]

            port In4 {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7800, 8024
                rotation = right
            ]

            port P3 {
                position = right:3
                kind = pe
            }
            [
                position = 8544, 8288
                rotation = down
            ]

            port P2 {
                position = right:2
                kind = pe
            }
            [
                position = 8544, 8192
                rotation = down
            ]

            port Out5 {
                position = top:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8104, 8024
                rotation = left
            ]

            port P1 {
                position = right:1
                kind = pe
            }
            [
                position = 8544, 8096
                rotation = down
            ]

            connect Tr7.prm_2 P2 as Connection9
            connect Tr7.prm_1 P1 as Connection7
            connect Tr7.sec_3 "Wind Power Plant (Average).C" as Connection16
            connect "Wind Power Plant (Average).A" Tr7.sec_1 as Connection14
            connect "Wind Power Plant (Average).Inputs" In4 as Connection8
            connect "Wind Power Plant (Average).Outputs" Out5 as Connection10
            connect Tr7.prm_3 P3 as Connection11
            connect Tr7.sec_2 "Wind Power Plant (Average).B" as Connection15
        }
        [
            position = 7544, 8992
            size = 352, 192
        ]

        component "core/Three-phase Meter" "Wind Power Plant" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 8536, 8104
            size = 48, 128
        ]

        component "core/Three-phase Meter" "Consumption measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 9008, 8392
            rotation = right
            scale = -1, 1
            size = 48, 128
        ]

        component "core/Constant Impedance Load" Consumption {
            SAB = "1300000.0/3"
            SAn = "1300000.0/3"
            SBC = "1300000.0/3"
            SBn = "1300000.0/3"
            SCA = "1300000.0/3"
            SCn = "1300000.0/3"
            Sn_3ph = "1.3e6"
            VAB = "10000"
            VAn = "10000/(3**0.5)"
            VBC = "10000"
            VBn = "10000/(3**0.5)"
            VCA = "10000"
            VCn = "10000/(3**0.5)"
            Vn_3ph = "10000"
            enable_neutral = "True"
            fn = "50"
        }
        [
            position = 9008, 8552
            size = 184, 152
        ]

        component "core/Three-phase Meter" "Grid measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e6"
            Ts = "Ts"
            VAB = "True"
            VBC = "True"
            VCA = "True"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 9736, 8104
            size = 48, 128
        ]

        component "core/Three-phase Meter" "Battery measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 8688, 7760
            size = 48, 128
        ]

        component Subsystem "Money Gain" {
            layout = dynamic
            component gen_integrator Integrator1 {
            }
            [
                position = 8432, 8328
            ]

            component "core/Meter Split" "Meter Split1" {
                power_p = "True"
                van = "False"
                vbn = "False"
                vcn = "False"
            }
            [
                position = 7912, 8224
                size = 96, 80
            ]

            component gen_c_function "C function1" {
                init_fnc = "/*Begin code section*/
Profit = 0;
/*End code section*/"
                input_terminals = "real P;inherit Csell;inherit Cbuy;"
                input_terminals_dimensions = "inherit;inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'P\', True), (\'Csell\', True), (\'Cbuy\', True)]"
                output_fnc = "/*Begin code section*/
if (P>0){
    Profit = Csell*P;
    }
else 
    Profit = Cbuy*P;
/*End code section*/"
                output_terminals = "real Profit;"
                output_terminals_dimensions = "inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'Profit\', True)]"
            }
            [
                position = 8304, 8328
                size = 96, 80
            ]

            component src_constant "Csell $ per kWh" {
                execution_rate = "Ts"
                value = "0.092"
            }
            [
                position = 7936, 8328
            ]

            component src_constant "Cbuy $ per kWh" {
                execution_rate = "Ts"
                value = "0.06"
            }
            [
                position = 7936, 8432
            ]

            component gen_probe Money {
            }
            [
                position = 8544, 8328
            ]

            component gen_gain Gain1 {
                gain = "1/60/60/1000"
            }
            [
                position = 8056, 8328
                hide_name = True
            ]

            component gen_gain Gain2 {
                gain = "1/60/60/1000"
            }
            [
                position = 8056, 8432
                hide_name = True
            ]

            port In1 {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7816, 8224
                hide_name = True
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ws to kWh </p></body></html> ENDCOMMENT 
            [
                position = 8008, 8368
            ]

            connect "Meter Split1.Input" In1 as Connection499
            connect "Meter Split1.POWER_P" "C function1.P" as Connection507
            [
                breakpoints = 8176, 8224; 8176, 8312
            ]
            connect Integrator1.in "C function1.Profit" as Connection508
            connect Money.in Integrator1.out as Connection509
            connect "Csell $ per kWh.out" Gain1.in as Connection510
            connect Gain1.out "C function1.Csell" as Connection511
            connect "Cbuy $ per kWh.out" Gain2.in as Connection512
            connect Gain2.out "C function1.Cbuy" as Connection513
            [
                breakpoints = 8176, 8432; 8176, 8344
            ]
        }
        [
            position = 9824, 7936
            size = 48, 48
        ]

        component "core/Three Phase Two Winding Transformer" "Transformer 10-110 kV" {
            L1 = "0.000795753256840729"
            L2 = "0.09628614407772822"
            Lm = "5.6842968861760035"
            R1 = "0.0018359375"
            R2 = "0.2221484375"
            Rm = "217391.30434782608"
            Sn = "8e6"
            V1 = "10e3"
            V2 = "110e3"
            current_vals_SI = "[1.567673435381234, 653.1972647421809]"
            flux_vals_SI = "[31.18787204934705, 39.50463792917293]"
            ioc1 = "0.44"
            usc1 = "11.5"
        }
        [
            position = 9344, 8104
            size = 126, 256
        ]

        component "core/Three Phase Two Winding Transformer" "Transformer 0,48-10 kV" {
            L1 = "0.000795753256840729"
            L2 = "0.09628614407772822"
            Lm = "5.6842968861760035"
            R1 = "0.0018359375"
            R2 = "0.2221484375"
            Rm = "217391.30434782608"
            Sn = "2e6"
            V1 = "480"
            V2 = "10000"
            current_vals_SI = "[1.567673435381234, 653.1972647421809]"
            flux_vals_SI = "[31.18787204934705, 39.50463792917293]"
        }
        [
            position = 8496, 7760
            size = 126, 256
        ]

        component "core/Three-phase Meter" "Wind Turbine 2 measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 7848, 8544
            size = 48, 128
        ]

        component "core/Three-phase Meter" "Wind Turbine 3 measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 7856, 8992
            size = 48, 128
        ]

        component "core/Three-phase Meter" "Wind Turbine 1 measurement" {
            I_rms = "True"
            P_meas = "True"
            R = "10e3"
            Ts = "Ts"
            VLn_rms = "True"
            freq = "True"
        }
        [
            position = 7840, 8104
            size = 48, 128
        ]

        component gen_terminator Termination1 {
        }
        [
            position = 7848, 8432
            rotation = left
            hide_name = True
        ]

        component gen_terminator Termination2 {
        }
        [
            position = 7856, 8880
            rotation = left
            hide_name = True
        ]

        component gen_terminator Termination3 {
        }
        [
            position = 7840, 7992
            rotation = left
            hide_name = True
        ]

        component gen_terminator Termination4 {
        }
        [
            position = 8688, 7648
            rotation = left
            hide_name = True
        ]

        component gen_terminator Termination5 {
        }
        [
            position = 8536, 7992
            rotation = left
            hide_name = True
        ]

        component gen_terminator Termination6 {
        }
        [
            position = 8880, 8424
            rotation = right
            hide_name = True
        ]

        component src_ground gnd13 {
        }
        [
            position = 9344, 8296
            hide_name = True
        ]

        component src_ground gnd14 {
        }
        [
            position = 8496, 7952
            hide_name = True
        ]

        component src_ground gnd15 {
        }
        [
            position = 8560, 8336
            hide_name = True
        ]

        component src_ground gnd16 {
        }
        [
            position = 8536, 8232
            hide_name = True
        ]

        component Subsystem "Microgrid controller" {
            layout = dynamic
            component gen_c_function "C function1" {
                execution_rate = "Ts"
                input_terminals = "inherit Grid;real SOC;"
                input_terminals_dimensions = "inherit;inherit"
                input_terminals_feedthrough = "[\'\']"
                input_terminals_show_labels = "[(\'Grid\', True), (\'SOC\', True)]"
                output_fnc = "/*Begin code section*/
if (SOC > 99.0)
    Plant = 0;
else
    if ( SOC < 5 || Grid == 1)
        Plant = 1;
    
if (SOC >= 100){
    Battery = 0;
    
        if (Grid == 1){
            Plant = 1;}
        else{
            Plant = 0;
            Battery = 1;}
            
        }
else{
    Battery = 1;
}
/*End code section*/"
                output_terminals = "real Plant;inherit Battery;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "[\'\']"
                output_terminals_show_labels = "[(\'Plant\', True), (\'Battery\', True)]"
            }
            [
                position = 8208, 8192
                scale = 1, -1
                size = 96, 72
            ]

            port SOC1 {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8008, 8176
            ]

            port "Grid Switch" {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7968, 8208
            ]

            port "Battery control" {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8440, 8176
            ]

            port "Plant control" {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8376, 8208
            ]

            connect SOC1 "C function1.SOC" as Connection515
            connect "Grid Switch" "C function1.Grid" as Connection516
            connect "Plant control" "C function1.Plant" as Connection523
            connect "Battery control" "C function1.Battery" as Connection524
        }
        [
            position = 7648, 7600
            scale = 1, -1
            size = 176, 216
        ]

        component Subsystem Batt_in {
            layout = dynamic
            component src_scada_input Qref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 8120, 8240
            ]

            component src_scada_input Vref {
                def_value = "480"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 8120, 8176
            ]

            component src_scada_input f_ref {
                def_value = "60.0"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 8168, 8128
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "6"
            }
            [
                position = 8264, 8336
                rotation = right
                hide_name = True
            ]

            component src_scada_input On {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8160, 7912
            ]

            component src_scada_input Pref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 8168, 8192
            ]

            component gen_logic_op "Logical operator2" {
            }
            [
                position = 8360, 7936
            ]

            port inputs {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8264, 8408
                rotation = right
                hide_name = True
            ]

            port uCtrl {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8064, 7968
            ]

            tag From1 {
                value = "Switch"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8168, 8048
                size = 60, 20
            ]

            connect "Bus Join2.in2" f_ref.out as Connection3
            connect Qref.out "Bus Join2.in5" as Connection6
            connect Vref.out "Bus Join2.in3" as Connection4
            connect "Bus Join2.in4" Pref.out as Connection5
            connect "Bus Join2.out" inputs as Connection7
            connect On.out "Logical operator2.in" as Connection12
            connect "Logical operator2.out" "Bus Join2.in" as Connection13
            connect From1 "Bus Join2.in1" as Connection14
            connect uCtrl "Logical operator2.in1" as Connection15

            Ts = "Ts"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Scada inputs for the battery inverter component from the Microgrid Library.</p></body></html>"

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "200e-6"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8096, 7560
            rotation = right
            size = 48, 48
        ]

        component Subsystem Wind_in {
            layout = dynamic
            component src_scada_input wind_speed {
                def_value = "6"
                execution_rate = "Ts"
                max = "25"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8128, 8120
            ]

            component src_scada_input V_ref {
                def_value = "690"
                execution_rate = "Ts"
                max = "2.0*690.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 8192, 8160
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts"
                unit = "kVAr"
            }
            [
                position = 8184, 8256
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 8256, 8352
                rotation = right
                hide_name = True
            ]

            component src_scada_input Q_mode {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8128, 8208
            ]

            port Inputs {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8256, 8424
                rotation = right
                hide_name = True
            ]

            port uCtrl {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8008, 8008
            ]

            junction Junction1 sp
            [
                position = 8280, 8144
            ]

            connect "Bus Join1.out" Inputs as Connection18
            connect Q_mode.out "Bus Join1.in4" as Connection17
            connect Q_ref.out "Bus Join1.in5" as Connection16
            connect V_ref.out "Bus Join1.in3" as Connection15
            connect wind_speed.out "Bus Join1.in2" as Connection9
            connect "Bus Join1.in1" Junction1 as Connection46
            connect Junction1 "Bus Join1.in" as Connection47
            [
                breakpoints = 8280, 8144; 8280, 8144; 8280, 8144; 8280, 8144; 8288, 8144
            ]
            connect uCtrl Junction1 as Connection48
        }
        [
            position = 7368, 7920
            rotation = right
            size = 48, 48
        ]

        component Subsystem Wind_in2 {
            layout = dynamic
            component src_scada_input wind_speed {
                def_value = "6"
                execution_rate = "Ts"
                max = "25"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8128, 8120
            ]

            component src_scada_input V_ref {
                def_value = "690"
                execution_rate = "Ts"
                max = "2.0*690.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 8192, 8160
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts"
                unit = "kVAr"
            }
            [
                position = 8184, 8256
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 8256, 8352
                rotation = right
                hide_name = True
            ]

            component src_scada_input Q_mode {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8128, 8208
            ]

            port Inputs {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8256, 8424
                rotation = right
                hide_name = True
            ]

            port uCtrl {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8008, 8008
            ]

            junction Junction1 sp
            [
                position = 8280, 8144
            ]

            connect "Bus Join1.out" Inputs as Connection18
            connect Q_mode.out "Bus Join1.in4" as Connection17
            connect Q_ref.out "Bus Join1.in5" as Connection16
            connect V_ref.out "Bus Join1.in3" as Connection15
            connect wind_speed.out "Bus Join1.in2" as Connection9
            connect "Bus Join1.in1" Junction1 as Connection46
            connect Junction1 "Bus Join1.in" as Connection47
            [
                breakpoints = 8280, 8144; 8280, 8144; 8280, 8144; 8280, 8144; 8288, 8144
            ]
            connect uCtrl Junction1 as Connection48
        }
        [
            position = 7384, 8808
            rotation = right
            size = 48, 48
        ]

        component Subsystem Wind_out1 {
            layout = dynamic
            component gen_probe Out {
            }
            [
                position = 8128, 8128
                rotation = left
            ]

            port Outputs {
                position = right:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8128, 8192
                rotation = left
                hide_name = True
            ]

            connect Out.in Outputs as Connection1
        }
        [
            position = 7696, 8336
            rotation = right
            size = 48, 48
        ]

        component Subsystem "Wind Turbine 2" {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0031817252323677937"
                L2 = "1.5148193831303065e-05"
                Lm = "22.74870341499556"
                R1 = "0.029375"
                R2 = "0.000139854375"
                Rm = "217391.30434782608"
                Sn = "2e6"
                V1 = "10e3"
                V2 = "690"
                current_vals_SI = "[0.3919183588453085, 163.29931618554522]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "50"
                flux_vals_SI = "[31.18787204934705, 39.50463792917293]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8432, 8192
                rotation = down
                scale = 1, -1
                size = 126, 256
            ]

            component Subsystem "Wind Power Plant (Average)" {
                layout = static
                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component src_constant Vdc {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7200, 8296
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component gen_probe VDC {
                }
                [
                    position = 7248, 8240
                    rotation = left
                ]

                component gen_digital_probe Enable {
                }
                [
                    position = 8080, 7744
                    scale = -1, 1
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component "core/Voltage Measurement" Va0 {
                }
                [
                    position = 7720, 8520
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "wind_speed"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out1" Goto31 as Connection756
                }
                [
                    position = 7880, 7760
                    size = 72, 72
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc0 {
                }
                [
                    position = 7816, 8416
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab1 {
                }
                [
                    position = 8632, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Signal Controlled Voltage Source" VspA {
                }
                [
                    position = 7560, 8200
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9320, 7752
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component gen_math_fnc power {
                            mathematical_fn = "power"
                        }
                        [
                            position = 7912, 8176
                        ]

                        component src_constant effective_area {
                            execution_rate = "inherit"
                            value = "eff_A"
                        }
                        [
                            position = 8008, 8080
                            rotation = right
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_product Product1 {
                            signs = "3"
                        }
                        [
                            position = 8080, 8160
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7616, 8328
                                hide_name = True
                            ]

                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction147 sp
                            [
                                position = 7552, 8216
                            ]

                            junction Junction148 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            connect P_ref Junction146 as Connection72
                            connect Limit3.out Junction148 as Connection80
                            connect Product1.in1 Junction148 as Connection78
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.out Sum3.in as Connection28
                            connect Product4.in Junction142 as Connection30
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.in1 Junction142 as Connection33
                            connect Ird Product2.out as Connection82
                            connect Product5.in Junction146 as Connection70
                            connect Irq Product1.out as Connection81
                            connect Product5.out Sum4.in as Connection34
                            connect Junction142 Vd as Connection12
                            connect Product6.in1 Junction143 as Connection36
                            connect Junction143 Product3.in as Connection13
                            connect Product6.in Junction147 as Connection73
                            connect Junction145 Product7.in as Connection64
                            connect Product6.out Sum4.in1 as Connection37
                            connect Junction146 Product3.in1 as Connection71
                            connect Product7.in1 Junction145 as Connection65
                            connect Junction147 Product4.in1 as Connection74
                            connect Q_ref Junction147 as Connection75
                            connect Junction148 Product2.in1 as Connection79
                            connect Vq Junction143 as Connection3
                            connect Vt Junction145 as Connection63
                            connect Limit3.in Product7.out as Connection77
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9320, 7624
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe wind_speed {
                        }
                        [
                            position = 7816, 8112
                            rotation = right
                            scale = -1, -1
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component src_constant three {
                            execution_rate = "Ts"
                            value = "3"
                        }
                        [
                            position = 7832, 8200
                        ]

                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_gain efficiency {
                            gain = "WT_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Smax;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;inherit S;"
                                    output_terminals_dimensions = "inherit;inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;False;"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Q" Q as Connection6
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Sref;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Sref" Sref as Connection4
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 9216, 8024
                            rotation = right
                            size = 64, 96
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_c_function S_and_pf {
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    input_terminals = "real P;inherit Q;"
                                    input_terminals_dimensions = "inherit;inherit"
                                    input_terminals_feedthrough = "[u\'\']"
                                    input_terminals_show_labels = "False;False;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                    output_terminals = "inherit S;inherit pf;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[u\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect Junction1 Id as Connection49
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect Junction1 Product4.in1 as Connection24
                                connect S_and_pf.S S as Connection51
                                connect Junction2 Iq as Connection52
                                connect S_and_pf.pf pf as Connection54
                                connect Junction2 Product3.in1 as Connection27
                                connect Sum1.in Product1.out as Connection29
                                connect Junction3 Product2.in as Connection32
                                connect Sum1.in1 Product2.out as Connection30
                                connect Junction3 Vq as Connection53
                                connect Sum2.in1 Product3.out as Connection38
                                connect Junction4 Product1.in as Connection35
                                connect Sum2.in Product4.out as Connection37
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                        }
                        [
                            position = 9128, 7720
                            size = 96, 232
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9320, 7688
                            rotation = down
                            scale = -1, 1
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9104, 7960
                            hide_name = True
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction74 as Connection81
                            connect Ki.out Sum7.in as Connection78
                            connect Kp.in Junction74 as Connection79
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                        }
                        [
                            position = 8000, 8432
                            size = 64, 48
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9104, 8520
                            rotation = right
                        ]

                        component gen_gain Gain1 {
                            gain = "8.0/27.0"
                        }
                        [
                            position = 8152, 8160
                            hide_name = True
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9320, 7816
                            rotation = down
                            scale = -1, 1
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7872, 8000
                                size = 48, 80
                            ]

                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8000
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8000
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            connect "abc to dq1.vb" Ib as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection33
                            connect Gain1.out Id as Connection24
                            connect "abc to dq1.vc" Ic as Connection29
                            connect wt "abc to dq1.wt" as Connection30
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.d_axis" Gain1.in as Connection31
                            connect "abc to dq1.va" Ia as Connection27
                            connect "abc to dq1.q_axis" Gain2.in as Connection32
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8000, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection74
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6952, 8472
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8296
                                hide_name = True
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7208, 8472
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6864, 8472
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6800, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            connect Damp.out Junction165 as Connection182
                            connect From23 Product1.in as Connection1
                            connect From25 Product2.in as Connection2
                            connect From26 PI_q.Reset as Connection169
                            connect Gain1.in Junction145 as Connection5
                            connect Gain1.out Product1.in1 as Connection6
                            connect Gain10.out Sum8.in as Connection189
                            connect Gain11.in Product7.out as Connection191
                            connect Gain2.in Junction146 as Connection7
                            connect Gain2.out Product2.in1 as Connection8
                            connect Gain5.in Junction166 as Connection193
                            connect Goto1 w as Connection34
                            connect Goto2 Junction164 as Connection170
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Junction146 Junction150 as Connection64
                            connect Junction146 Sum1.in as Connection11
                            connect Junction150 Id_meas as Connection65
                            connect Junction151 Iq_meas as Connection68
                            connect Junction155 Gain5.out as Connection192
                            connect Junction155 Product7.in1 as Connection116
                            connect Junction164 Reset as Connection171
                            connect Junction165 Product5.in1 as Connection181
                            connect Junction166 Vdc.in as Connection185
                            connect Limit3.out Junction166 as Connection186
                            connect Limit3.in LPF_dc.out as Connection187
                            connect PI_d.Reset Junction164 as Connection172
                            connect PI_d.In Sum1.out as Connection55
                            connect PI_q.In Sum2.out as Connection165
                            connect Product5.in From27 as Connection101
                            connect Product5.out Sum8.in1 as Connection95
                            connect Product6.in1 From28 as Connection102
                            connect Product6.in Junction165 as Connection180
                            connect Product6.out Sum9.in as Connection96
                            connect Product7.in Sum7.out as Connection145
                            connect Product8.out Gain10.in as Connection188
                            connect Product8.in1 Junction155 as Connection115
                            connect Product8.in Sum3.out as Connection143
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Sum2.in Junction145 as Connection21
                            connect Sum3.in PI_d.Out as Connection178
                            connect Sum5.in1 Product1.out as Connection24
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Sum6.in1 Product2.out as Connection26
                            connect Sum7.in PI_q.Out as Connection175
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Sum8.out md as Connection173
                            connect Sum9.in1 Gain11.out as Connection190
                            connect VDC LPF_dc.in as Connection124
                            connect Vd Sum5.in as Connection31
                            connect Vq Sum6.in as Connection32
                            connect mq Sum9.out as Connection174
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component src_constant air_density {
                            execution_rate = "inherit"
                            value = "air_dens"
                        }
                        [
                            position = 7952, 8112
                            rotation = right
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8856, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7600
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7624
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7936, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7792
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9216, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From44 {
                            value = "wind_speed"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7720, 8168
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7888
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7688
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7816
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7664
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7728
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7920
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction167 sp
                        [
                            position = 9168, 8480
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction183 sp
                        [
                            position = 9104, 8480
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction188 sp
                        [
                            position = 9208, 7624
                        ]

                        junction Junction189 sp
                        [
                            position = 9208, 7688
                        ]

                        junction Junction190 sp
                        [
                            position = 9208, 7752
                        ]

                        junction Junction191 sp
                        [
                            position = 9208, 7816
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction194 sp
                        [
                            position = 7816, 8168
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction196 sp
                        [
                            position = 8528, 8176
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = (8.0/27.0) * A_eff * air_dens * (wind_sp)    </p></body></html> ENDCOMMENT 
                        [
                            position = 8024, 7992
                        ]

                        connect Junction190 Power_Meas.S as Connection546
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Junction192 Goto17 as Connection554
                        connect Junction193 Goto19 as Connection557
                        connect Junction194 wind_speed.in as Connection561
                        connect Junction195 Qref.in as Connection575
                        connect Junction196 Pref.in as Connection578
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Logical operator2.in" delay.out as Connection505
                        connect P.in Junction188 as Connection539
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect Power_Meas.Iq From35 as Connection405
                        connect Product1.in2 power.out as Connection262
                        connect Q.in Junction189 as Connection542
                        connect S.in Junction190 as Connection545
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect "Signal switch1.out" Junction195 as Connection576
                        connect "Signal switch2.out" Junction196 as Connection579
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect "Signal switch4.in2" From43 as Connection518
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Ud_c.in Junction164 as Connection358
                        connect Uq_c.in Junction165 as Connection362
                        connect V_d Junction181 as Connection476
                        connect V_q Junction182 as Connection480
                        connect Vd.in Junction181 as Connection478
                        connect Vq.in Junction182 as Connection482
                        connect Vt Junction193 as Connection556
                        connect Vt_pu.in Junction193 as Connection558
                        connect air_density.out Product1.in1 as Connection564
                        connect Gain1.out efficiency.in as Connection565
                        connect delay.in Junction184 as Connection506
                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect Gain3.in VDC as Connection298
                        connect effective_area.out Product1.in as Connection563
                        connect Goto18 Junction195 as Connection574
                        connect efficiency.out to_pu.in as Connection566
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Goto21 Junction196 as Connection577
                        connect id.in Junction123 as Connection186
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect Goto22 Junction173 as Connection398
                        connect iq.in Junction124 as Connection187
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect Goto23 Junction174 as Connection401
                        connect md Junction164 as Connection360
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect Goto24 Junction176 as Connection425
                        connect mq Junction165 as Connection364
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect pf.in Junction191 as Connection548
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Goto26 Junction184 as Connection494
                        connect power.in Junction194 as Connection560
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Goto32 Junction188 as Connection541
                        connect three.out power.in1 as Connection259
                        connect Current_ref.Vq From3 as Connection475
                        connect Goto33 Junction189 as Connection544
                        connect w Junction192 as Connection553
                        connect Current_ref.Vd From4 as Connection474
                        connect Goto34 Junction190 as Connection547
                        connect w_pu.in Junction192 as Connection555
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Goto35 Junction191 as Connection550
                        connect wt From1 as Connection392
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect wt_pll.in Junction183 as Connection486
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect Junction124 Junction174 as Connection399
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect Junction164 ControlSignal_Calculation.md as Connection359
                        connect Junction165 ControlSignal_Calculation.mq as Connection363
                        connect From28 Junction177 as Connection431
                        connect Junction167 Goto1 as Connection483
                        connect Junction167 Junction183 as Connection484
                        connect From31 Power_Meas.Vq as Connection403
                        connect Junction173 Junction123 as Connection397
                        connect From32 Power_Meas.Vd as Connection402
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect From34 Power_Meas.Id as Connection404
                        connect Junction176 Enable as Connection426
                        connect From37 "Logical operator2.in1" as Connection470
                        connect Junction177 Sum1.in1 as Connection432
                        connect From38 "Signal switch3.in2" as Connection422
                        connect Junction179 Id_ref.in as Connection464
                        connect From39 "Logical operator1.in" as Connection439
                        connect Junction180 Iq_ref.in as Connection467
                        connect From40 "Signal switch2.in2" as Connection471
                        connect Junction181 Goto4 as Connection477
                        connect From42 Current_ref.Vt as Connection487
                        connect Junction182 Goto3 as Connection481
                        connect From44 Junction194 as Connection562
                        connect Junction183 wt_in as Connection485
                        connect From45 Gain4.in as Connection531
                        connect Junction184 Connected as Connection493
                        connect From46 Gain2.in as Connection533
                        connect Junction187 Qmode.in as Connection537
                        connect From47 Junction187 as Connection538
                        connect Junction188 Power_Meas.P as Connection540
                        connect Gain1.in Product1.out as Connection264
                        connect From27 Limit_PQref.Qref as Connection588
                        [
                            breakpoints = 9168, 7920; 9216, 7920
                        ]
                        connect From30 Limit_PQref.Pref as Connection589
                        [
                            breakpoints = 9168, 7888; 9240, 7888
                        ]
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection590
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection591
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            initial_filter_output = "50"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port f {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port wt {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Constant1.out Junction4 as Connection100
                        connect From3 "Signal switch2.in2" as Connection113
                        connect Junction4 Junction3 as Connection101
                        connect From4 "Signal switch3.in2" as Connection115
                        connect Gain3.in PLL.q_axis as Connection81
                        connect Junction2 Goto32 as Connection87
                        connect Junction5 Connected as Connection111
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect B "Signal switch2.in" as Connection95
                        connect PLL.d_axis Gain4.in as Connection80
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect PLL.peak Junction2 as Connection88
                        connect PLL.freq Junction1 as Connection84
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect "Signal switch3.in" C as Connection94
                        connect Vt Gain5.out as Connection56
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect Junction1 Gain1.in as Connection83
                        connect Goto34 Junction5 as Connection112
                        connect From1 f_meas.in as Connection73
                        connect Gain1.out f as Connection27
                        connect Goto33 Junction1 as Connection82
                        connect From2 Vt_meas.in as Connection74
                        connect Gain5.in Junction2 as Connection86
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect "Signal switch1.in" A as Connection89
                        connect Vd Gain4.out as Connection55
                        connect Gain3.out Vq as Connection54
                        connect PLL.theta wt as Connection85
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7480, 7896
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7432, 7992
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "0.5"
                        }
                        [
                            position = 7736, 8040
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7432, 7944
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8080, 8144
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8080, 8216
                            hide_name = True
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7480, 8016
                            hide_name = True
                        ]

                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                                value = "1.0/2.0"
                            }
                            [
                                position = 7880, 8080
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            connect From6 Sum6.in1 as Connection1488
                            connect Product1.in1 Sum1.out as Connection1428
                            connect From7 Sum7.in as Connection1493
                            connect Product1.out Sum3.in2 as Connection1451
                            connect From8 Sum7.in1 as Connection1492
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Goto1 Limit1.out as Connection1439
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Goto2 Junction257 as Connection1476
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Goto3 Junction258 as Connection1479
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Constant1.out Limit1.in as Connection1425
                            connect From5 Sum6.in as Connection1489
                            connect Goto4 Junction259 as Connection1482
                            connect Sum2.out Product2.in as Connection1435
                            connect Sum5.out Dz_A as Connection1447
                            connect Goto5 Junction260 as Connection1486
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Sum6.out Dz_B as Connection1490
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Sum7.out Dz_C as Connection1491
                            connect Constant4.out Sum3.in as Connection1452
                            connect Z0.in Junction260 as Connection1484
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Da Junction257 as Connection1474
                            connect Junction257 Junction254 as Connection1475
                            connect Db Junction258 as Connection1477
                            connect Junction258 Junction255 as Connection1478
                            connect Dc Junction259 as Connection1480
                            connect Junction259 Junction256 as Connection1481
                            connect From1 Sum2.in as Connection1440
                            connect Junction260 Sum3.out as Connection1485
                            connect From2 Product1.in as Connection1441
                            connect From3 Sum5.in1 as Connection1446
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect From4 Sum5.in as Connection1487

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8224
                            scale = -1, 1
                            size = 88, 184
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7520, 7896
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8256
                            rotation = left
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7528, 8096
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_product Product3 {
                        }
                        [
                            position = 8080, 8288
                            hide_name = True
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8256
                            rotation = left
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7944
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8144
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 7992
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 8040
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7992
                        ]

                        tag From37 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8120
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8192
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8264
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8040
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction10 sp
                        [
                            position = 7856, 8296
                        ]

                        junction Junction11 sp
                        [
                            position = 7480, 7944
                        ]

                        junction Junction12 sp
                        [
                            position = 7520, 7992
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8152
                        ]

                        junction Junction14 sp
                        [
                            position = 7664, 8224
                        ]

                        junction Junction15 sp
                        [
                            position = 7664, 8296
                        ]

                        junction Junction9 sp
                        [
                            position = 7856, 8224
                        ]

                        connect Junction13 ZSM.Da as Connection2351
                        connect Da.in Junction13 as Connection2350
                        connect Junction8 ZSM.Dz_A as Connection2324
                        connect ZSM.Db Junction14 as Connection2353
                        connect Junction9 ZSM.Dz_B as Connection2332
                        connect "dq to abc1.phase_a" Junction13 as Connection2352
                        connect Product1.in1 Junction8 as Connection2325
                        connect "dq to abc1.phase_b" Junction14 as Connection2355
                        connect Junction14 Db.in as Connection2354
                        connect Product1.out m_a as Connection2322
                        connect Product2.in1 Junction9 as Connection2333
                        connect Junction10 Dz_C.in as Connection2338
                        connect Product2.out m_b as Connection2330
                        connect Dc.in Junction15 as Connection2356
                        connect "dq to abc1.phase_c" Junction15 as Connection2358
                        connect Product3.in1 Junction10 as Connection2339
                        connect Junction15 ZSM.Dc as Connection2357
                        connect Product3.out m_c as Connection2336
                        connect ZSM.Dz_C Junction10 as Connection2337
                        connect Limit3.out Junction12 as Connection2329
                        connect Dz_A.in Junction8 as Connection2323
                        connect md Limit2.in as Connection2359
                        connect o_ref.out "dq to abc1.zero_input" as Connection2345
                        connect Dz_B.in Junction9 as Connection2331
                        connect mq Limit3.in as Connection2360
                        connect "dq to abc1.q_input" Junction12 as Connection2346
                        connect From37 Product1.in as Connection2327
                        connect wt "dq to abc1.wt" as Connection2361
                        connect "dq to abc1.d_input" Junction11 as Connection2347
                        connect From38 Product2.in as Connection2328
                        connect Junction12 m_q.in as Connection2348
                        connect From39 Product3.in as Connection2335
                        connect m_d.in Junction11 as Connection2326
                        connect Gain1.in VDC as Connection2341
                        connect Junction11 Limit2.out as Connection2349
                        connect Goto1 Gain1.out as Connection2340
                    }
                    [
                        position = 8168, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7368
                        rotation = right
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7464
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7576
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7688
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    junction Junction2 sp
                    [
                        position = 8024, 7408
                    ]

                    connect VDC Junction2 as Connection550
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect duty_cycle.VDC Junction2 as Connection552
                    connect ma duty_cycle.m_a as Connection547
                    connect Enable Grid_follow.Enable as Connection532
                    connect mb duty_cycle.m_b as Connection548
                    connect From14 Grid_follow.V_d as Connection480
                    connect mc duty_cycle.m_c as Connection549
                    connect From15 Grid_follow.V_q as Connection481
                    connect PLL.A Va as Connection553
                    connect From16 Grid_follow.Vt as Connection482
                    connect PLL.B Vb as Connection554
                    connect From17 Grid_follow.w as Connection502
                    connect PLL.C Vc as Connection555
                    connect From18 Grid_follow.wt_in as Connection485
                    connect PLL.Vd Goto12 as Connection556
                    connect Goto16 Junction1 as Connection541
                    connect Goto13 PLL.Vq as Connection557
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect PLL.Vt Goto10 as Connection558
                    connect Ia Grid_follow.Ia as Connection495
                    connect Goto14 PLL.f as Connection559
                    connect Ib Grid_follow.Ib as Connection496
                    connect PLL.wt Goto15 as Connection560
                    connect Ic Grid_follow.Ic as Connection497
                    connect PLL.Connected From19 as Connection561
                    connect Junction1 Connected as Connection542
                    connect Junction2 Grid_follow.VDC as Connection551
                }
                [
                    position = 8184, 7880
                    size = 128, 208
                ]

                component "core/Voltage Measurement" Vbc1 {
                }
                [
                    position = 8632, 8296
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vb0 {
                }
                [
                    position = 7768, 8472
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Enabled {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8296
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect Enabled "Bus Join1.in1" as Connection20
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From32 "Bus Join1.in13" as Connection15
                    connect From33 "Bus Join1.in12" as Connection14
                    connect From34 "Bus Join1.in9" as Connection11
                    connect "Bus Join1.in" Connected as Connection19
                    connect "Bus Join1.in6" Ia as Connection2
                }
                [
                    position = 8680, 7744
                    rotation = left
                    size = 96, 152
                ]

                component "core/Signal Controlled Voltage Source" VspC {
                }
                [
                    position = 7656, 8400
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 8944, 8248
                    size = 64, 256
                ]

                component "core/Signal Controlled Voltage Source" VspB {
                }
                [
                    position = 7608, 8296
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7880, 7672
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8680, 7648
                    rotation = left
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9040, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9040, 8344
                    rotation = down
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9040, 8152
                    rotation = down
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7824
                    hide_name = True
                    size = 60, 20
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8224, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7864
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8144, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag From39 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7848
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7312, 8296
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8296
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8400
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8200
                    hide_name = True
                    size = 60, 20
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7944
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8184, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From41 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8856, 8064
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction65 pe
                [
                    position = 8632, 8248
                ]

                junction Junction70 pe
                [
                    position = 8328, 8584
                ]

                junction Junction78 pe
                [
                    position = 8536, 8584
                ]

                junction Junction115 pe
                [
                    position = 8416, 8584
                ]

                junction Junction116 pe
                [
                    position = 8480, 8584
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction137 pe
                [
                    position = 8632, 8152
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction139 pe
                [
                    position = 8632, 8248
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction141 pe
                [
                    position = 8632, 8344
                ]

                junction Junction477 pe
                [
                    position = 7656, 8584
                ]

                junction Junction478 pe
                [
                    position = 7720, 8584
                ]

                junction Junction480 pe
                [
                    position = 7768, 8584
                ]

                junction Junction502 pe
                [
                    position = 7720, 8152
                ]

                junction Junction503 pe
                [
                    position = 7768, 8248
                ]

                junction Junction505 pe
                [
                    position = 7816, 8344
                ]

                junction Junction506 pe
                [
                    position = 7848, 8248
                ]

                junction Junction507 pe
                [
                    position = 7848, 8152
                ]

                junction Junction508 pe
                [
                    position = 7608, 8584
                ]

                junction Junction509 sp
                [
                    position = 7248, 8296
                ]

                junction Junction510 sp
                [
                    position = 8144, 7744
                ]

                connect A S1.a_out as Connection694
                connect B S1.b_out as Connection698
                connect C S1.c_out as Connection696
                connect C1.n_node Junction70 as Connection142
                connect C1.p_node R7.n_node as Connection139
                connect C2.p_node R8.n_node as Connection144
                connect C3.n_node Junction115 as Connection618
                connect Control.Ic From21 as Connection493
                connect Enable.in Junction510 as Connection2449
                connect From10 Control.Vc as Connection487
                connect From18 Control.VDC as Connection489
                connect From19 Control.Ia as Connection491
                connect From20 Control.Ib as Connection492
                connect From25 Junction510 as Connection2447
                connect From30 Output.Vc as Connection2440
                connect From32 Output.Vb as Connection2439
                connect From33 Output.Ic as Connection2443
                connect From34 Output.Ib as Connection2442
                connect From35 Output.Ia as Connection2441
                connect From36 VspA.in as Connection2429
                connect From37 VspB.in as Connection2430
                connect From38 VspC.in as Connection2431
                connect From39 Output.Enabled as Connection2437
                connect From8 Control.Va as Connection485
                connect From9 Control.Vb as Connection486
                connect Goto1 Va.out as Connection367
                connect Goto12 Ia.out as Connection668
                connect Goto13 Ib.out as Connection669
                connect Goto14 Ic.out as Connection670
                connect Goto17 Control.mb as Connection2433
                connect Goto18 Control.mc as Connection2432
                connect Goto3 Control.ma as Connection2434
                connect Goto4 Vb.out as Connection368
                connect Goto5 Vc.out as Connection369
                connect Ia.n_node Junction121 as Connection671
                connect Ib.n_node Junction123 as Connection676
                connect Ic.p_node R0c.n_node as Connection667
                connect Inputs Input.Inputs as Connection755
                connect Junction115 Junction116 as Connection622
                connect Junction115 Junction70 as Connection619
                connect Junction116 Va.n_node as Connection621
                connect Junction121 R7.p_node as Connection672
                connect Junction123 R8.p_node as Connection677
                connect Junction125 Ic.n_node as Connection682
                connect Junction136 Junction121 as Connection775
                connect Junction136 Junction137 as Connection778
                connect Junction137 R0a1.p_node as Connection777
                connect Junction138 Junction123 as Connection780
                connect Junction138 Junction139 as Connection783
                connect Junction139 R0b1.p_node as Connection782
                connect Junction140 Junction125 as Connection785
                connect Junction140 Junction141 as Connection788
                connect Junction141 Vbc1.n_node as Connection787
                connect Junction477 Junction508 as Connection2426
                connect Junction478 Junction477 as Connection2249
                connect Junction480 Junction478 as Connection2255
                connect Junction502 Junction507 as Connection2423
                connect Junction503 Junction506 as Connection2420
                connect Junction503 Vb0.p_node as Connection2394
                connect Junction505 VspC.p_node as Connection2424
                connect Junction506 Vab.n_node as Connection2419
                connect Junction507 Vab.p_node as Connection2422
                connect Junction508 VspB.n_node as Connection2427
                connect Junction509 Goto19 as Connection2445
                connect Junction510 Control.Enable as Connection2448
                connect Junction65 Junction139 as Connection781
                connect Junction70 C2.n_node as Connection143
                connect Junction78 Junction116 as Connection620
                connect L1.p_node Junction507 as Connection2421
                connect L2.p_node Junction506 as Connection2418
                connect L3.p_node Junction505 as Connection2417
                connect L3.n_node R0c.p_node as Connection614
                connect L5.p_node R0a1.n_node as Connection652
                connect L6.p_node R0b1.n_node as Connection650
                connect Output.Connected From29 as Connection2436
                connect Output.Va From31 as Connection2438
                connect Outputs Output.Outputs as Connection2435
                connect R0a.n_node Ia.p_node as Connection664
                connect R0a.p_node L1.n_node as Connection611
                connect R0b.n_node Ib.p_node as Connection662
                connect R0b.p_node L2.n_node as Connection613
                connect R0c1.p_node Junction141 as Connection786
                connect R0c1.n_node L4.p_node as Connection655
                connect R9.n_node C3.p_node as Connection145
                connect R9.p_node Junction125 as Connection681
                connect S1.c_in L4.n_node as Connection697
                connect S1.a_in L5.n_node as Connection695
                connect S1.b_in L6.n_node as Connection699
                connect VDC.in Junction509 as Connection2446
                connect Va.p_node Junction136 as Connection774
                connect Va0.n_node Junction478 as Connection2248
                connect Va0.p_node Junction502 as Connection2390
                connect Vab1.p_node Junction137 as Connection776
                connect Vab1.n_node Junction65 as Connection119
                connect Vb.p_node Junction138 as Connection779
                connect Vb.n_node Junction78 as Connection363
                connect Vb0.n_node Junction480 as Connection2254
                connect Vbc1.p_node Junction65 as Connection117
                connect Vc.p_node Junction140 as Connection784
                connect Vc.n_node Junction78 as Connection617
                connect Vc0.n_node Junction480 as Connection2256
                connect Vc0.p_node Junction505 as Connection2415
                connect Vdc.out Junction509 as Connection2444
                connect VspA.p_node Junction502 as Connection2392
                connect VspA.n_node Junction508 as Connection2428
                connect VspB.p_node Junction503 as Connection2395
                connect VspC.n_node Junction477 as Connection2245
                connect From27 Control.Connected as Connection754
                connect From41 S1.ctrl_in as Connection2450

                C = "500e-6"
                L0 = "200e-6"
                Sn = "2e6"
                Ts = "Ts"
                Vn = "690"
                WT_eff = "80"
                eff_A = "7854"
                fn = "50"

                mask {
                    icon = "image(\'wind_power_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Wind power plant average model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Active power output is based on wind speed input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of inputs is 6 and of outputs is 14 and they are configured in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - Connect; 1 - Enable; 2 - wind_speed; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "wind_power_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "1.5e6"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    eff_A {
                        label = "Effective disk area"
                        widget = edit
                        type = generic
                        default_value = "1345.0"
                        unit = "m"
                        group = "1 - General"
                    }

                    WT_eff {
                        label = "Wind turbine efficiency"
                        widget = edit
                        type = generic
                        default_value = "75.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    air_dens {
                        label = "Air density"
                        widget = edit
                        type = generic
                        default_value = "1.225"
                        unit = "kg/m"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "79.8e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "48e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "0.0784"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "541.7e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "wind_power_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7952, 8192
                size = 353, 239
            ]

            port P1 {
                position = right:1
                kind = pe
            }
            [
                position = 8544, 8096
                rotation = down
            ]

            port P2 {
                position = right:2
                kind = pe
            }
            [
                position = 8544, 8192
                rotation = down
            ]

            port P3 {
                position = right:3
                kind = pe
            }
            [
                position = 8544, 8288
                rotation = down
            ]

            port In4 {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7800, 8024
                rotation = right
            ]

            port Out5 {
                position = top:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8104, 8024
                rotation = left
            ]

            connect Tr7.prm_3 P3 as Connection11
            connect "Wind Power Plant (Average).Inputs" In4 as Connection8
            connect Tr7.prm_1 P1 as Connection7
            connect "Wind Power Plant (Average).Outputs" Out5 as Connection10
            connect Tr7.prm_2 P2 as Connection9
            connect "Wind Power Plant (Average).A" Tr7.sec_1 as Connection14
            connect Tr7.sec_2 "Wind Power Plant (Average).B" as Connection15
            connect Tr7.sec_3 "Wind Power Plant (Average).C" as Connection16
        }
        [
            position = 7536, 8544
            size = 352, 192
        ]

        component Subsystem Wind_in1 {
            layout = dynamic
            component src_scada_input wind_speed {
                def_value = "6"
                execution_rate = "Ts"
                max = "25"
                min = "0"
                unit = "m/s"
            }
            [
                position = 8128, 8120
            ]

            component src_scada_input V_ref {
                def_value = "690"
                execution_rate = "Ts"
                max = "2.0*690.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 8192, 8160
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts"
                unit = "kVAr"
            }
            [
                position = 8184, 8256
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 8256, 8352
                rotation = right
                hide_name = True
            ]

            component src_scada_input Q_mode {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8128, 8208
            ]

            port Inputs {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8256, 8424
                rotation = right
                hide_name = True
            ]

            port uCtrl {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 8008, 8008
            ]

            junction Junction1 sp
            [
                position = 8280, 8144
            ]

            connect "Bus Join1.out" Inputs as Connection18
            connect Q_mode.out "Bus Join1.in4" as Connection17
            connect Q_ref.out "Bus Join1.in5" as Connection16
            connect V_ref.out "Bus Join1.in3" as Connection15
            connect wind_speed.out "Bus Join1.in2" as Connection9
            connect "Bus Join1.in1" Junction1 as Connection46
            connect Junction1 "Bus Join1.in" as Connection47
            [
                breakpoints = 8280, 8144; 8280, 8144; 8280, 8144; 8280, 8144; 8288, 8144
            ]
            connect uCtrl Junction1 as Connection48
        }
        [
            position = 7376, 8360
            rotation = right
            size = 48, 48
        ]

        component Subsystem "Wind Turbine 1" {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0031817252323677937"
                L2 = "1.5148193831303065e-05"
                Lm = "22.74870341499556"
                R1 = "0.029375"
                R2 = "0.000139854375"
                Rm = "217391.30434782608"
                Sn = "2e6"
                V1 = "10e3"
                V2 = "690"
                current_vals_SI = "[0.3919183588453085, 163.29931618554522]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "50"
                flux_vals_SI = "[31.18787204934705, 39.50463792917293]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8432, 8192
                rotation = down
                scale = 1, -1
                size = 126, 256
            ]

            component Subsystem "Wind Power Plant (Average)" {
                layout = static
                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component src_constant Vdc {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7200, 8296
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component gen_probe VDC {
                }
                [
                    position = 7248, 8240
                    rotation = left
                ]

                component gen_digital_probe Enable {
                }
                [
                    position = 8080, 7744
                    scale = -1, 1
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component "core/Voltage Measurement" Va0 {
                }
                [
                    position = 7720, 8520
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "wind_speed"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out1" Goto31 as Connection756
                }
                [
                    position = 7880, 7760
                    size = 72, 72
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc0 {
                }
                [
                    position = 7816, 8416
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab1 {
                }
                [
                    position = 8632, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Signal Controlled Voltage Source" VspA {
                }
                [
                    position = 7560, 8200
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9320, 7752
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component gen_math_fnc power {
                            mathematical_fn = "power"
                        }
                        [
                            position = 7912, 8176
                        ]

                        component src_constant effective_area {
                            execution_rate = "inherit"
                            value = "eff_A"
                        }
                        [
                            position = 8008, 8080
                            rotation = right
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_product Product1 {
                            signs = "3"
                        }
                        [
                            position = 8080, 8160
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7616, 8328
                                hide_name = True
                            ]

                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction147 sp
                            [
                                position = 7552, 8216
                            ]

                            junction Junction148 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            connect P_ref Junction146 as Connection72
                            connect Limit3.out Junction148 as Connection80
                            connect Product1.in1 Junction148 as Connection78
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.out Sum3.in as Connection28
                            connect Product4.in Junction142 as Connection30
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.in1 Junction142 as Connection33
                            connect Ird Product2.out as Connection82
                            connect Product5.in Junction146 as Connection70
                            connect Irq Product1.out as Connection81
                            connect Product5.out Sum4.in as Connection34
                            connect Junction142 Vd as Connection12
                            connect Product6.in1 Junction143 as Connection36
                            connect Junction143 Product3.in as Connection13
                            connect Product6.in Junction147 as Connection73
                            connect Junction145 Product7.in as Connection64
                            connect Product6.out Sum4.in1 as Connection37
                            connect Junction146 Product3.in1 as Connection71
                            connect Product7.in1 Junction145 as Connection65
                            connect Junction147 Product4.in1 as Connection74
                            connect Q_ref Junction147 as Connection75
                            connect Junction148 Product2.in1 as Connection79
                            connect Vq Junction143 as Connection3
                            connect Vt Junction145 as Connection63
                            connect Limit3.in Product7.out as Connection77
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9320, 7624
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe wind_speed {
                        }
                        [
                            position = 7816, 8112
                            rotation = right
                            scale = -1, -1
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component src_constant three {
                            execution_rate = "Ts"
                            value = "3"
                        }
                        [
                            position = 7832, 8200
                        ]

                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_gain efficiency {
                            gain = "WT_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Smax;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;inherit S;"
                                    output_terminals_dimensions = "inherit;inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;False;"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Q" Q as Connection6
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    input_terminals = "inherit Pref;inherit Qref;inherit Sref;"
                                    input_terminals_dimensions = "inherit;inherit;inherit"
                                    input_terminals_feedthrough = "[\'\']"
                                    input_terminals_show_labels = "False;False;False;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                    output_terminals = "inherit P;inherit Q;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Sref" Sref as Connection4
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 9216, 8024
                            rotation = right
                            size = 64, 96
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            input_terminals_dimensions = "inherit"
                            input_terminals_feedthrough = "[\'\']"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            output_terminals_dimensions = "inherit"
                            output_terminals_feedthrough = "[\'\']"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_c_function S_and_pf {
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    input_terminals = "real P;inherit Q;"
                                    input_terminals_dimensions = "inherit;inherit"
                                    input_terminals_feedthrough = "[u\'\']"
                                    input_terminals_show_labels = "False;False;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                    output_terminals = "inherit S;inherit pf;"
                                    output_terminals_dimensions = "inherit;inherit"
                                    output_terminals_feedthrough = "[u\'\']"
                                    output_terminals_show_labels = "False;False;"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect Junction1 Id as Connection49
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect Junction1 Product4.in1 as Connection24
                                connect S_and_pf.S S as Connection51
                                connect Junction2 Iq as Connection52
                                connect S_and_pf.pf pf as Connection54
                                connect Junction2 Product3.in1 as Connection27
                                connect Sum1.in Product1.out as Connection29
                                connect Junction3 Product2.in as Connection32
                                connect Sum1.in1 Product2.out as Connection30
                                connect Junction3 Vq as Connection53
                                connect Sum2.in1 Product3.out as Connection38
                                connect Junction4 Product1.in as Connection35
                                connect Sum2.in Product4.out as Connection37
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                        }
                        [
                            position = 9128, 7720
                            size = 96, 232
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9320, 7688
                            rotation = down
                            scale = -1, 1
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9104, 7960
                            hide_name = True
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction74 as Connection81
                            connect Ki.out Sum7.in as Connection78
                            connect Kp.in Junction74 as Connection79
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                        }
                        [
                            position = 8000, 8432
                            size = 64, 48
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9104, 8520
                            rotation = right
                        ]

                        component gen_gain Gain1 {
                            gain = "8.0/27.0"
                        }
                        [
                            position = 8152, 8160
                            hide_name = True
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9320, 7816
                            rotation = down
                            scale = -1, 1
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7872, 8000
                                size = 48, 80
                            ]

                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8000
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8000
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            connect "abc to dq1.vb" Ib as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection33
                            connect Gain1.out Id as Connection24
                            connect "abc to dq1.vc" Ic as Connection29
                            connect wt "abc to dq1.wt" as Connection30
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.d_axis" Gain1.in as Connection31
                            connect "abc to dq1.va" Ia as Connection27
                            connect "abc to dq1.q_axis" Gain2.in as Connection32
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8000, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection74
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6952, 8472
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8296
                                hide_name = True
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7208, 8472
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6864, 8472
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6800, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            connect Damp.out Junction165 as Connection182
                            connect From23 Product1.in as Connection1
                            connect From25 Product2.in as Connection2
                            connect From26 PI_q.Reset as Connection169
                            connect Gain1.in Junction145 as Connection5
                            connect Gain1.out Product1.in1 as Connection6
                            connect Gain10.out Sum8.in as Connection189
                            connect Gain11.in Product7.out as Connection191
                            connect Gain2.in Junction146 as Connection7
                            connect Gain2.out Product2.in1 as Connection8
                            connect Gain5.in Junction166 as Connection193
                            connect Goto1 w as Connection34
                            connect Goto2 Junction164 as Connection170
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Junction146 Junction150 as Connection64
                            connect Junction146 Sum1.in as Connection11
                            connect Junction150 Id_meas as Connection65
                            connect Junction151 Iq_meas as Connection68
                            connect Junction155 Gain5.out as Connection192
                            connect Junction155 Product7.in1 as Connection116
                            connect Junction164 Reset as Connection171
                            connect Junction165 Product5.in1 as Connection181
                            connect Junction166 Vdc.in as Connection185
                            connect Limit3.out Junction166 as Connection186
                            connect Limit3.in LPF_dc.out as Connection187
                            connect PI_d.Reset Junction164 as Connection172
                            connect PI_d.In Sum1.out as Connection55
                            connect PI_q.In Sum2.out as Connection165
                            connect Product5.in From27 as Connection101
                            connect Product5.out Sum8.in1 as Connection95
                            connect Product6.in1 From28 as Connection102
                            connect Product6.in Junction165 as Connection180
                            connect Product6.out Sum9.in as Connection96
                            connect Product7.in Sum7.out as Connection145
                            connect Product8.out Gain10.in as Connection188
                            connect Product8.in1 Junction155 as Connection115
                            connect Product8.in Sum3.out as Connection143
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Sum2.in Junction145 as Connection21
                            connect Sum3.in PI_d.Out as Connection178
                            connect Sum5.in1 Product1.out as Connection24
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Sum6.in1 Product2.out as Connection26
                            connect Sum7.in PI_q.Out as Connection175
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Sum8.out md as Connection173
                            connect Sum9.in1 Gain11.out as Connection190
                            connect VDC LPF_dc.in as Connection124
                            connect Vd Sum5.in as Connection31
                            connect Vq Sum6.in as Connection32
                            connect mq Sum9.out as Connection174
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component src_constant air_density {
                            execution_rate = "inherit"
                            value = "air_dens"
                        }
                        [
                            position = 7952, 8112
                            rotation = right
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8856, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7600
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7624
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7936, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7792
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9216, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From44 {
                            value = "wind_speed"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7720, 8168
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7888
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7688
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7816
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7664
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7728
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7920
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction167 sp
                        [
                            position = 9168, 8480
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction183 sp
                        [
                            position = 9104, 8480
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction188 sp
                        [
                            position = 9208, 7624
                        ]

                        junction Junction189 sp
                        [
                            position = 9208, 7688
                        ]

                        junction Junction190 sp
                        [
                            position = 9208, 7752
                        ]

                        junction Junction191 sp
                        [
                            position = 9208, 7816
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction194 sp
                        [
                            position = 7816, 8168
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction196 sp
                        [
                            position = 8528, 8176
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = (8.0/27.0) * A_eff * air_dens * (wind_sp)    </p></body></html> ENDCOMMENT 
                        [
                            position = 8024, 7992
                        ]

                        connect Junction190 Power_Meas.S as Connection546
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Junction192 Goto17 as Connection554
                        connect Junction193 Goto19 as Connection557
                        connect Junction194 wind_speed.in as Connection561
                        connect Junction195 Qref.in as Connection575
                        connect Junction196 Pref.in as Connection578
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Logical operator2.in" delay.out as Connection505
                        connect P.in Junction188 as Connection539
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect Power_Meas.Iq From35 as Connection405
                        connect Product1.in2 power.out as Connection262
                        connect Q.in Junction189 as Connection542
                        connect S.in Junction190 as Connection545
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect "Signal switch1.out" Junction195 as Connection576
                        connect "Signal switch2.out" Junction196 as Connection579
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect "Signal switch4.in2" From43 as Connection518
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Ud_c.in Junction164 as Connection358
                        connect Uq_c.in Junction165 as Connection362
                        connect V_d Junction181 as Connection476
                        connect V_q Junction182 as Connection480
                        connect Vd.in Junction181 as Connection478
                        connect Vq.in Junction182 as Connection482
                        connect Vt Junction193 as Connection556
                        connect Vt_pu.in Junction193 as Connection558
                        connect air_density.out Product1.in1 as Connection564
                        connect Gain1.out efficiency.in as Connection565
                        connect delay.in Junction184 as Connection506
                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect Gain3.in VDC as Connection298
                        connect effective_area.out Product1.in as Connection563
                        connect Goto18 Junction195 as Connection574
                        connect efficiency.out to_pu.in as Connection566
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Goto21 Junction196 as Connection577
                        connect id.in Junction123 as Connection186
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect Goto22 Junction173 as Connection398
                        connect iq.in Junction124 as Connection187
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect Goto23 Junction174 as Connection401
                        connect md Junction164 as Connection360
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect Goto24 Junction176 as Connection425
                        connect mq Junction165 as Connection364
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect pf.in Junction191 as Connection548
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Goto26 Junction184 as Connection494
                        connect power.in Junction194 as Connection560
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Goto32 Junction188 as Connection541
                        connect three.out power.in1 as Connection259
                        connect Current_ref.Vq From3 as Connection475
                        connect Goto33 Junction189 as Connection544
                        connect w Junction192 as Connection553
                        connect Current_ref.Vd From4 as Connection474
                        connect Goto34 Junction190 as Connection547
                        connect w_pu.in Junction192 as Connection555
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Goto35 Junction191 as Connection550
                        connect wt From1 as Connection392
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect wt_pll.in Junction183 as Connection486
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect Junction124 Junction174 as Connection399
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect Junction164 ControlSignal_Calculation.md as Connection359
                        connect Junction165 ControlSignal_Calculation.mq as Connection363
                        connect From28 Junction177 as Connection431
                        connect Junction167 Goto1 as Connection483
                        connect Junction167 Junction183 as Connection484
                        connect From31 Power_Meas.Vq as Connection403
                        connect Junction173 Junction123 as Connection397
                        connect From32 Power_Meas.Vd as Connection402
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect From34 Power_Meas.Id as Connection404
                        connect Junction176 Enable as Connection426
                        connect From37 "Logical operator2.in1" as Connection470
                        connect Junction177 Sum1.in1 as Connection432
                        connect From38 "Signal switch3.in2" as Connection422
                        connect Junction179 Id_ref.in as Connection464
                        connect From39 "Logical operator1.in" as Connection439
                        connect Junction180 Iq_ref.in as Connection467
                        connect From40 "Signal switch2.in2" as Connection471
                        connect Junction181 Goto4 as Connection477
                        connect From42 Current_ref.Vt as Connection487
                        connect Junction182 Goto3 as Connection481
                        connect From44 Junction194 as Connection562
                        connect Junction183 wt_in as Connection485
                        connect From45 Gain4.in as Connection531
                        connect Junction184 Connected as Connection493
                        connect From46 Gain2.in as Connection533
                        connect Junction187 Qmode.in as Connection537
                        connect From47 Junction187 as Connection538
                        connect Junction188 Power_Meas.P as Connection540
                        connect Gain1.in Product1.out as Connection264
                        connect From27 Limit_PQref.Qref as Connection588
                        [
                            breakpoints = 9168, 7920; 9216, 7920
                        ]
                        connect From30 Limit_PQref.Pref as Connection589
                        [
                            breakpoints = 9168, 7888; 9240, 7888
                        ]
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection590
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection591
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            initial_filter_output = "50"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port f {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port wt {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Constant1.out Junction4 as Connection100
                        connect From3 "Signal switch2.in2" as Connection113
                        connect Junction4 Junction3 as Connection101
                        connect From4 "Signal switch3.in2" as Connection115
                        connect Gain3.in PLL.q_axis as Connection81
                        connect Junction2 Goto32 as Connection87
                        connect Junction5 Connected as Connection111
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect B "Signal switch2.in" as Connection95
                        connect PLL.d_axis Gain4.in as Connection80
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect PLL.peak Junction2 as Connection88
                        connect PLL.freq Junction1 as Connection84
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect "Signal switch3.in" C as Connection94
                        connect Vt Gain5.out as Connection56
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect Junction1 Gain1.in as Connection83
                        connect Goto34 Junction5 as Connection112
                        connect From1 f_meas.in as Connection73
                        connect Gain1.out f as Connection27
                        connect Goto33 Junction1 as Connection82
                        connect From2 Vt_meas.in as Connection74
                        connect Gain5.in Junction2 as Connection86
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect "Signal switch1.in" A as Connection89
                        connect Vd Gain4.out as Connection55
                        connect Gain3.out Vq as Connection54
                        connect PLL.theta wt as Connection85
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7480, 7896
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7432, 7992
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "0.5"
                        }
                        [
                            position = 7736, 8040
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7432, 7944
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8080, 8144
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8080, 8216
                            hide_name = True
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7480, 8016
                            hide_name = True
                        ]

                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                                value = "1.0/2.0"
                            }
                            [
                                position = 7880, 8080
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            connect From6 Sum6.in1 as Connection1488
                            connect Product1.in1 Sum1.out as Connection1428
                            connect From7 Sum7.in as Connection1493
                            connect Product1.out Sum3.in2 as Connection1451
                            connect From8 Sum7.in1 as Connection1492
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Goto1 Limit1.out as Connection1439
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Goto2 Junction257 as Connection1476
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Goto3 Junction258 as Connection1479
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Constant1.out Limit1.in as Connection1425
                            connect From5 Sum6.in as Connection1489
                            connect Goto4 Junction259 as Connection1482
                            connect Sum2.out Product2.in as Connection1435
                            connect Sum5.out Dz_A as Connection1447
                            connect Goto5 Junction260 as Connection1486
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Sum6.out Dz_B as Connection1490
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Sum7.out Dz_C as Connection1491
                            connect Constant4.out Sum3.in as Connection1452
                            connect Z0.in Junction260 as Connection1484
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Da Junction257 as Connection1474
                            connect Junction257 Junction254 as Connection1475
                            connect Db Junction258 as Connection1477
                            connect Junction258 Junction255 as Connection1478
                            connect Dc Junction259 as Connection1480
                            connect Junction259 Junction256 as Connection1481
                            connect From1 Sum2.in as Connection1440
                            connect Junction260 Sum3.out as Connection1485
                            connect From2 Product1.in as Connection1441
                            connect From3 Sum5.in1 as Connection1446
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect From4 Sum5.in as Connection1487

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8224
                            scale = -1, 1
                            size = 88, 184
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7520, 7896
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8256
                            rotation = left
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7528, 8096
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_product Product3 {
                        }
                        [
                            position = 8080, 8288
                            hide_name = True
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8256
                            rotation = left
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7944
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8144
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 7992
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 8040
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7992
                        ]

                        tag From37 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8120
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8192
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7984, 8264
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "half_Vdc"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8040
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction10 sp
                        [
                            position = 7856, 8296
                        ]

                        junction Junction11 sp
                        [
                            position = 7480, 7944
                        ]

                        junction Junction12 sp
                        [
                            position = 7520, 7992
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8152
                        ]

                        junction Junction14 sp
                        [
                            position = 7664, 8224
                        ]

                        junction Junction15 sp
                        [
                            position = 7664, 8296
                        ]

                        junction Junction9 sp
                        [
                            position = 7856, 8224
                        ]

                        connect Junction13 ZSM.Da as Connection2351
                        connect Da.in Junction13 as Connection2350
                        connect Junction8 ZSM.Dz_A as Connection2324
                        connect ZSM.Db Junction14 as Connection2353
                        connect Junction9 ZSM.Dz_B as Connection2332
                        connect "dq to abc1.phase_a" Junction13 as Connection2352
                        connect Product1.in1 Junction8 as Connection2325
                        connect "dq to abc1.phase_b" Junction14 as Connection2355
                        connect Junction14 Db.in as Connection2354
                        connect Product1.out m_a as Connection2322
                        connect Product2.in1 Junction9 as Connection2333
                        connect Junction10 Dz_C.in as Connection2338
                        connect Product2.out m_b as Connection2330
                        connect Dc.in Junction15 as Connection2356
                        connect "dq to abc1.phase_c" Junction15 as Connection2358
                        connect Product3.in1 Junction10 as Connection2339
                        connect Junction15 ZSM.Dc as Connection2357
                        connect Product3.out m_c as Connection2336
                        connect ZSM.Dz_C Junction10 as Connection2337
                        connect Limit3.out Junction12 as Connection2329
                        connect Dz_A.in Junction8 as Connection2323
                        connect md Limit2.in as Connection2359
                        connect o_ref.out "dq to abc1.zero_input" as Connection2345
                        connect Dz_B.in Junction9 as Connection2331
                        connect mq Limit3.in as Connection2360
                        connect "dq to abc1.q_input" Junction12 as Connection2346
                        connect From37 Product1.in as Connection2327
                        connect wt "dq to abc1.wt" as Connection2361
                        connect "dq to abc1.d_input" Junction11 as Connection2347
                        connect From38 Product2.in as Connection2328
                        connect Junction12 m_q.in as Connection2348
                        connect From39 Product3.in as Connection2335
                        connect m_d.in Junction11 as Connection2326
                        connect Gain1.in VDC as Connection2341
                        connect Junction11 Limit2.out as Connection2349
                        connect Goto1 Gain1.out as Connection2340
                    }
                    [
                        position = 8168, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7368
                        rotation = right
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7464
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7576
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7688
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    junction Junction2 sp
                    [
                        position = 8024, 7408
                    ]

                    connect VDC Junction2 as Connection550
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect duty_cycle.VDC Junction2 as Connection552
                    connect ma duty_cycle.m_a as Connection547
                    connect Enable Grid_follow.Enable as Connection532
                    connect mb duty_cycle.m_b as Connection548
                    connect From14 Grid_follow.V_d as Connection480
                    connect mc duty_cycle.m_c as Connection549
                    connect From15 Grid_follow.V_q as Connection481
                    connect PLL.A Va as Connection553
                    connect From16 Grid_follow.Vt as Connection482
                    connect PLL.B Vb as Connection554
                    connect From17 Grid_follow.w as Connection502
                    connect PLL.C Vc as Connection555
                    connect From18 Grid_follow.wt_in as Connection485
                    connect PLL.Vd Goto12 as Connection556
                    connect Goto16 Junction1 as Connection541
                    connect Goto13 PLL.Vq as Connection557
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect PLL.Vt Goto10 as Connection558
                    connect Ia Grid_follow.Ia as Connection495
                    connect Goto14 PLL.f as Connection559
                    connect Ib Grid_follow.Ib as Connection496
                    connect PLL.wt Goto15 as Connection560
                    connect Ic Grid_follow.Ic as Connection497
                    connect PLL.Connected From19 as Connection561
                    connect Junction1 Connected as Connection542
                    connect Junction2 Grid_follow.VDC as Connection551
                }
                [
                    position = 8184, 7880
                    size = 128, 208
                ]

                component "core/Voltage Measurement" Vbc1 {
                }
                [
                    position = 8632, 8296
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vb0 {
                }
                [
                    position = 7768, 8472
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Enabled {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8296
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect Enabled "Bus Join1.in1" as Connection20
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From32 "Bus Join1.in13" as Connection15
                    connect From33 "Bus Join1.in12" as Connection14
                    connect From34 "Bus Join1.in9" as Connection11
                    connect "Bus Join1.in" Connected as Connection19
                    connect "Bus Join1.in6" Ia as Connection2
                }
                [
                    position = 8680, 7744
                    rotation = left
                    size = 96, 152
                ]

                component "core/Signal Controlled Voltage Source" VspC {
                }
                [
                    position = 7656, 8400
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 8944, 8248
                    size = 64, 256
                ]

                component "core/Signal Controlled Voltage Source" VspB {
                }
                [
                    position = 7608, 8296
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7880, 7672
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8680, 7648
                    rotation = left
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9040, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9040, 8344
                    rotation = down
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9040, 8152
                    rotation = down
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7824
                    hide_name = True
                    size = 60, 20
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8224, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7864
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8144, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8344, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7800
                    hide_name = True
                    size = 60, 20
                ]

                tag From39 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7848
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7312, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7896
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8400
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7448, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8552, 7944
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8184, 7680
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From41 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8856, 8064
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction65 pe
                [
                    position = 8632, 8248
                ]

                junction Junction70 pe
                [
                    position = 8328, 8584
                ]

                junction Junction78 pe
                [
                    position = 8536, 8584
                ]

                junction Junction115 pe
                [
                    position = 8416, 8584
                ]

                junction Junction116 pe
                [
                    position = 8480, 8584
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction137 pe
                [
                    position = 8632, 8152
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction139 pe
                [
                    position = 8632, 8248
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction141 pe
                [
                    position = 8632, 8344
                ]

                junction Junction477 pe
                [
                    position = 7656, 8584
                ]

                junction Junction478 pe
                [
                    position = 7720, 8584
                ]

                junction Junction480 pe
                [
                    position = 7768, 8584
                ]

                junction Junction502 pe
                [
                    position = 7720, 8152
                ]

                junction Junction503 pe
                [
                    position = 7768, 8248
                ]

                junction Junction505 pe
                [
                    position = 7816, 8344
                ]

                junction Junction506 pe
                [
                    position = 7848, 8248
                ]

                junction Junction507 pe
                [
                    position = 7848, 8152
                ]

                junction Junction508 pe
                [
                    position = 7608, 8584
                ]

                junction Junction509 sp
                [
                    position = 7248, 8296
                ]

                junction Junction510 sp
                [
                    position = 8144, 7744
                ]

                connect A S1.a_out as Connection694
                connect B S1.b_out as Connection698
                connect C S1.c_out as Connection696
                connect C1.n_node Junction70 as Connection142
                connect C1.p_node R7.n_node as Connection139
                connect C2.p_node R8.n_node as Connection144
                connect C3.n_node Junction115 as Connection618
                connect Control.Ic From21 as Connection493
                connect Enable.in Junction510 as Connection2449
                connect From10 Control.Vc as Connection487
                connect From18 Control.VDC as Connection489
                connect From19 Control.Ia as Connection491
                connect From20 Control.Ib as Connection492
                connect From25 Junction510 as Connection2447
                connect From30 Output.Vc as Connection2440
                connect From32 Output.Vb as Connection2439
                connect From33 Output.Ic as Connection2443
                connect From34 Output.Ib as Connection2442
                connect From35 Output.Ia as Connection2441
                connect From36 VspA.in as Connection2429
                connect From37 VspB.in as Connection2430
                connect From38 VspC.in as Connection2431
                connect From39 Output.Enabled as Connection2437
                connect From8 Control.Va as Connection485
                connect From9 Control.Vb as Connection486
                connect Goto1 Va.out as Connection367
                connect Goto12 Ia.out as Connection668
                connect Goto13 Ib.out as Connection669
                connect Goto14 Ic.out as Connection670
                connect Goto17 Control.mb as Connection2433
                connect Goto18 Control.mc as Connection2432
                connect Goto3 Control.ma as Connection2434
                connect Goto4 Vb.out as Connection368
                connect Goto5 Vc.out as Connection369
                connect Ia.n_node Junction121 as Connection671
                connect Ib.n_node Junction123 as Connection676
                connect Ic.p_node R0c.n_node as Connection667
                connect Inputs Input.Inputs as Connection755
                connect Junction115 Junction116 as Connection622
                connect Junction115 Junction70 as Connection619
                connect Junction116 Va.n_node as Connection621
                connect Junction121 R7.p_node as Connection672
                connect Junction123 R8.p_node as Connection677
                connect Junction125 Ic.n_node as Connection682
                connect Junction136 Junction121 as Connection775
                connect Junction136 Junction137 as Connection778
                connect Junction137 R0a1.p_node as Connection777
                connect Junction138 Junction123 as Connection780
                connect Junction138 Junction139 as Connection783
                connect Junction139 R0b1.p_node as Connection782
                connect Junction140 Junction125 as Connection785
                connect Junction140 Junction141 as Connection788
                connect Junction141 Vbc1.n_node as Connection787
                connect Junction477 Junction508 as Connection2426
                connect Junction478 Junction477 as Connection2249
                connect Junction480 Junction478 as Connection2255
                connect Junction502 Junction507 as Connection2423
                connect Junction503 Junction506 as Connection2420
                connect Junction503 Vb0.p_node as Connection2394
                connect Junction505 VspC.p_node as Connection2424
                connect Junction506 Vab.n_node as Connection2419
                connect Junction507 Vab.p_node as Connection2422
                connect Junction508 VspB.n_node as Connection2427
                connect Junction509 Goto19 as Connection2445
                connect Junction510 Control.Enable as Connection2448
                connect Junction65 Junction139 as Connection781
                connect Junction70 C2.n_node as Connection143
                connect Junction78 Junction116 as Connection620
                connect L1.p_node Junction507 as Connection2421
                connect L2.p_node Junction506 as Connection2418
                connect L3.p_node Junction505 as Connection2417
                connect L3.n_node R0c.p_node as Connection614
                connect L5.p_node R0a1.n_node as Connection652
                connect L6.p_node R0b1.n_node as Connection650
                connect Output.Connected From29 as Connection2436
                connect Output.Va From31 as Connection2438
                connect Outputs Output.Outputs as Connection2435
                connect R0a.n_node Ia.p_node as Connection664
                connect R0a.p_node L1.n_node as Connection611
                connect R0b.n_node Ib.p_node as Connection662
                connect R0b.p_node L2.n_node as Connection613
                connect R0c1.p_node Junction141 as Connection786
                connect R0c1.n_node L4.p_node as Connection655
                connect R9.n_node C3.p_node as Connection145
                connect R9.p_node Junction125 as Connection681
                connect S1.c_in L4.n_node as Connection697
                connect S1.a_in L5.n_node as Connection695
                connect S1.b_in L6.n_node as Connection699
                connect VDC.in Junction509 as Connection2446
                connect Va.p_node Junction136 as Connection774
                connect Va0.n_node Junction478 as Connection2248
                connect Va0.p_node Junction502 as Connection2390
                connect Vab1.p_node Junction137 as Connection776
                connect Vab1.n_node Junction65 as Connection119
                connect Vb.p_node Junction138 as Connection779
                connect Vb.n_node Junction78 as Connection363
                connect Vb0.n_node Junction480 as Connection2254
                connect Vbc1.p_node Junction65 as Connection117
                connect Vc.p_node Junction140 as Connection784
                connect Vc.n_node Junction78 as Connection617
                connect Vc0.n_node Junction480 as Connection2256
                connect Vc0.p_node Junction505 as Connection2415
                connect Vdc.out Junction509 as Connection2444
                connect VspA.p_node Junction502 as Connection2392
                connect VspA.n_node Junction508 as Connection2428
                connect VspB.p_node Junction503 as Connection2395
                connect VspC.n_node Junction477 as Connection2245
                connect From27 Control.Connected as Connection754
                connect From41 S1.ctrl_in as Connection2450

                C = "500e-6"
                L0 = "200e-6"
                Sn = "2e6"
                Ts = "Ts"
                Vn = "690"
                WT_eff = "80"
                eff_A = "7854"
                fn = "50"

                mask {
                    icon = "image(\'wind_power_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Wind power plant average model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Active power output is based on wind speed input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of inputs is 6 and of outputs is 14 and they are configured in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - Connect; 1 - Enable; 2 - wind_speed; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "wind_power_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "1.5e6"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    eff_A {
                        label = "Effective disk area"
                        widget = edit
                        type = generic
                        default_value = "1345.0"
                        unit = "m"
                        group = "1 - General"
                    }

                    WT_eff {
                        label = "Wind turbine efficiency"
                        widget = edit
                        type = generic
                        default_value = "75.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    air_dens {
                        label = "Air density"
                        widget = edit
                        type = generic
                        default_value = "1.225"
                        unit = "kg/m"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "79.8e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "48e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "0.0784"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "541.7e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "wind_power_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7952, 8192
                size = 353, 239
            ]

            port P1 {
                position = right:1
                kind = pe
            }
            [
                position = 8544, 8096
                rotation = down
            ]

            port P2 {
                position = right:2
                kind = pe
            }
            [
                position = 8544, 8192
                rotation = down
            ]

            port P3 {
                position = right:3
                kind = pe
            }
            [
                position = 8544, 8288
                rotation = down
            ]

            port In4 {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7800, 8024
                rotation = right
            ]

            port Out5 {
                position = top:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8104, 8024
                rotation = left
            ]

            connect Tr7.prm_3 P3 as Connection11
            connect "Wind Power Plant (Average).Inputs" In4 as Connection8
            connect Tr7.prm_1 P1 as Connection7
            connect "Wind Power Plant (Average).Outputs" Out5 as Connection10
            connect Tr7.prm_2 P2 as Connection9
            connect "Wind Power Plant (Average).A" Tr7.sec_1 as Connection14
            connect Tr7.sec_2 "Wind Power Plant (Average).B" as Connection15
            connect Tr7.sec_3 "Wind Power Plant (Average).C" as Connection16
        }
        [
            position = 7528, 8104
            size = 352, 192
        ]

        component src_ground gnd17 {
        }
        [
            position = 7840, 8216
            hide_name = True
        ]

        component src_ground gnd18 {
        }
        [
            position = 7848, 8672
            hide_name = True
        ]

        component src_ground gnd19 {
        }
        [
            position = 7856, 9120
            hide_name = True
        ]

        tag From1 {
            value = "Switch"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 9496, 7912
            size = 60, 20
        ]

        tag From2 {
            value = "Switch"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7464, 7512
            hide_name = True
            size = 60, 20
        ]

        tag Goto3 {
            value = "BatteryOff"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7816, 7688
            hide_name = True
            size = 60, 20
        ]

        tag Goto2 {
            value = "PlantOff"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7816, 7512
            hide_name = True
            size = 60, 20
        ]

        tag From3 {
            value = "SOC"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7464, 7688
            hide_name = True
            size = 60, 20
        ]

        tag Goto4 {
            value = "SOC"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7872, 7752
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From9 {
            value = "BatteryOff"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8008, 7504
            hide_name = True
            size = 60, 20
        ]

        tag From6 {
            value = "PlantOff"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7296, 7848
            hide_name = True
            size = 60, 20
        ]

        tag From11 {
            value = "PlantOff"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7312, 8736
            hide_name = True
            size = 60, 20
        ]

        tag From12 {
            value = "PlantOff"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7304, 8288
            hide_name = True
            size = 60, 20
        ]

        junction Junction30 pe
        [
            position = 8968, 8008
        ]

        junction Junction31 pe
        [
            position = 8856, 8008
        ]

        junction Junction32 pe
        [
            position = 8760, 8200
        ]

        junction Junction33 pe
        [
            position = 9048, 8200
        ]

        junction Junction34 pe
        [
            position = 8808, 8104
        ]

        junction Junction35 pe
        [
            position = 9008, 8104
        ]

        junction Junction36 sp
        [
            position = 9736, 7936
        ]

        junction Junction37 pe
        [
            position = 9344, 8256
        ]

        junction Junction38 pe
        [
            position = 7976, 8088
        ]

        junction Junction39 pe
        [
            position = 7992, 8104
        ]

        junction Junction40 pe
        [
            position = 8008, 8120
        ]

        junction Junction41 pe
        [
            position = 7976, 8504
        ]

        junction Junction42 pe
        [
            position = 7992, 8544
        ]

        junction Junction43 pe
        [
            position = 8008, 8584
        ]

        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - true  - open</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - false - close </p></body></html> ENDCOMMENT 
        [
            position = 9376, 7800
        ]

        connect "Wind Turbine 3.P1" "Wind Turbine 3 measurement.A+" as Connection203
        [
            breakpoints = 7752, 8920; 7752, 8952
        ]
        connect "Wind Turbine 3 measurement.B+" "Wind Turbine 3.P2" as Connection206
        connect Wind_out2.Outputs "Wind Turbine 3.Out5" as Connection209
        connect "Underground Cable3.P2" "Wind Turbine 3 measurement.A-" as Connection210
        connect "Wind Turbine 3 measurement.B-" "Underground Cable3.P4" as Connection211
        connect "Wind Turbine 3 measurement.C-" "Underground Cable3.P6" as Connection212
        connect gnd7.node Vs1.n_node as Connection253
        connect "Core Coupling.a_out" "Wind Power Plant.A-" as Connection278
        [
            breakpoints = 8608, 8008; 8608, 8064
        ]
        connect "Wind Power Plant.C-" "Core Coupling.c_out" as Connection281
        [
            breakpoints = 8608, 8144; 8608, 8200
        ]
        connect "Wind Power Plant.B-" "Core Coupling.b_out" as Connection282
        connect "Transformer 0,48-10 kV.sec_2" "Battery measurement.B+" as Connection320
        connect "Transformer 0,48-10 kV.sec_3" "Battery measurement.C+" as Connection321
        [
            breakpoints = 8608, 7856; 8608, 7800
        ]
        connect gnd9.node "Battery measurement.GND" as Connection331
        connect Batt_out.outputs "Battery inverter (Average).Outputs" as Connection155
        connect "Battery inverter (Average).A" "Transformer 0,48-10 kV.prm_1" as Connection333
        connect "Battery inverter (Average).B" "Transformer 0,48-10 kV.prm_2" as Connection334
        connect "Battery inverter (Average).C" "Transformer 0,48-10 kV.prm_3" as Connection335
        connect "Battery inverter (Average).DCneg" Battery1.n_node as Connection336
        connect Battery1.p_node "Battery inverter (Average).DCpos" as Connection337
        connect S1.a_in "Transformer 10-110 kV.sec_1" as Connection338
        connect "Transformer 10-110 kV.sec_2" S1.b_in as Connection339
        connect "Transformer 10-110 kV.sec_3" S1.c_in as Connection340
        connect "Grid measurement.A+" S1.a_out as Connection341
        [
            breakpoints = 9664, 8064; 9664, 8008
        ]
        connect S1.b_out "Grid measurement.B+" as Connection342
        connect S1.c_out "Grid measurement.C+" as Connection343
        [
            breakpoints = 9664, 8200; 9664, 8144
        ]
        connect "Grid measurement.C-" Vs1.c_node as Connection344
        connect "Grid measurement.B-" Vs1.b_node as Connection345
        connect "Grid measurement.A-" Vs1.a_node as Connection346
        connect gnd10.node "Grid measurement.GND" as Connection352
        connect "Underground Cable1.P1" "Wind Power Plant.A+" as Connection409
        [
            breakpoints = 8352, 8088; 8352, 8064; 8496, 8064
        ]
        connect "Wind Power Plant.B+" "Underground Cable1.P3" as Connection411
        connect "Wind Power Plant.C+" "Underground Cable1.P5" as Connection412
        connect gnd6.node "Core Coupling.d_in" as Connection280
        connect gnd11.node Consumption.N as Connection456
        connect "Consumption measurement.A-" Consumption.A as Connection481
        [
            breakpoints = 8968, 8448; 8936, 8448
        ]
        connect "Consumption measurement.B-" Consumption.B as Connection482
        connect "Consumption measurement.C-" Consumption.C as Connection483
        [
            breakpoints = 9048, 8424; 9048, 8448; 9080, 8448
        ]
        connect gnd12.node "Consumption measurement.GND" as Connection484
        connect S1.ctrl_in From1 as Connection505
        [
            breakpoints = 9568, 7944; 9568, 7944; 9568, 7912
        ]
        connect "Wind Turbine 3.P3" "Wind Turbine 3 measurement.C+" as Connection517
        [
            breakpoints = 7752, 9064; 7752, 9032
        ]
        connect "Transformer 0,48-10 kV.sec_1" "Battery measurement.A+" as Connection518
        [
            breakpoints = 8608, 7664; 8608, 7720
        ]
        connect Junction30 "Transformer 10-110 kV.prm_1" as Connection522
        connect "Consumption measurement.A+" Junction30 as Connection523
        connect "Core Coupling.a_in" Junction31 as Connection524
        connect Junction31 Junction30 as Connection525
        connect "Battery measurement.A-" Junction31 as Connection526
        [
            breakpoints = 8856, 7720; 8856, 8008
        ]
        connect "Core Coupling.c_in" Junction32 as Connection528
        connect "Battery measurement.C-" Junction32 as Connection530
        [
            breakpoints = 8760, 7800; 8760, 8200
        ]
        connect Junction32 Junction33 as Connection531
        connect Junction33 "Transformer 10-110 kV.prm_3" as Connection532
        connect "Consumption measurement.C+" Junction33 as Connection533
        connect "Core Coupling.b_in" Junction34 as Connection535
        connect "Battery measurement.B-" Junction34 as Connection537
        [
            breakpoints = 8808, 7760; 8808, 8104
        ]
        connect Junction34 Junction35 as Connection538
        connect Junction35 "Transformer 10-110 kV.prm_2" as Connection539
        connect "Consumption measurement.B+" Junction35 as Connection540
        connect "Money Gain.In1" Junction36 as Connection542
        connect Junction36 "Grid measurement.Out" as Connection543
        connect Relay.In1 Junction36 as Connection544
        connect Termination1.in "Wind Turbine 2 measurement.Out" as Connection545
        connect Termination2.in "Wind Turbine 3 measurement.Out" as Connection546
        connect Termination3.in "Wind Turbine 1 measurement.Out" as Connection547
        connect Termination4.in "Battery measurement.Out" as Connection548
        connect Termination5.in "Wind Power Plant.Out" as Connection549
        connect Termination6.in "Consumption measurement.Out" as Connection550
        connect gnd13.node Junction37 as Connection552
        connect Junction37 "Transformer 10-110 kV.n1" as Connection553
        connect "Transformer 10-110 kV.n2" Junction37 as Connection554
        connect gnd14.node "Transformer 0,48-10 kV.n1" as Connection555
        [
            breakpoints = 8496, 7928; 8464, 7928
        ]
        connect "Transformer 0,48-10 kV.n2" gnd14.node as Connection556
        connect gnd15.node "Core Coupling.d_out" as Connection569
        connect "Wind Power Plant.GND" gnd16.node as Connection573
        [
            breakpoints = 8536, 8192
        ]
        connect From2 "Microgrid controller.Grid Switch" as Connection559
        connect Goto3 "Microgrid controller.Battery control" as Connection577
        connect Goto2 "Microgrid controller.Plant control" as Connection578
        connect From3 "Microgrid controller.SOC1" as Connection650
        connect Goto4 Battery1.out as Connection651
        connect From9 Batt_in.uCtrl as Connection583
        connect Batt_in.inputs "Battery inverter (Average).Inputs" as Connection652
        connect Wind_in.uCtrl From6 as Connection653
        connect Wind_in2.uCtrl From11 as Connection657
        connect Wind_in2.Inputs "Wind Turbine 3.In4" as Connection658
        [
            breakpoints = 7384, 8888
        ]
        connect Wind_out1.Outputs "Wind Turbine 2.Out5" as Connection659
        connect Wind_in1.uCtrl From12 as Connection660
        connect Wind_in1.Inputs "Wind Turbine 2.In4" as Connection661
        connect "Wind Turbine 2.P1" "Wind Turbine 2 measurement.A+" as Connection662
        [
            breakpoints = 7736, 8472; 7736, 8504
        ]
        connect "Wind Turbine 2 measurement.B+" "Wind Turbine 2.P2" as Connection663
        connect "Wind Turbine 2.P3" "Wind Turbine 2 measurement.C+" as Connection664
        [
            breakpoints = 7736, 8616; 7736, 8584
        ]
        connect "Underground Cable1.P2" Junction38 as Connection683
        connect Junction38 "Wind Turbine 1 measurement.A-" as Connection684
        [
            breakpoints = 7976, 8088; 7880, 8088
        ]
        connect "Underground Cable2.P1" Junction38 as Connection685
        connect "Wind Turbine 1 measurement.B-" Junction39 as Connection686
        connect Junction39 "Underground Cable1.P4" as Connection687
        connect "Underground Cable2.P3" Junction39 as Connection688
        connect "Underground Cable1.P6" Junction40 as Connection689
        connect Junction40 "Wind Turbine 1 measurement.C-" as Connection690
        connect "Underground Cable2.P5" Junction40 as Connection691
        connect "Wind Turbine 1.In4" Wind_in.Inputs as Connection692
        connect "Wind Turbine 1.Out5" Wind_out.Outputs as Connection693
        connect "Wind Turbine 1.P1" "Wind Turbine 1 measurement.A+" as Connection694
        [
            breakpoints = 7736, 8032; 7736, 8064
        ]
        connect "Wind Turbine 1 measurement.B+" "Wind Turbine 1.P2" as Connection695
        connect "Wind Turbine 1.P3" "Wind Turbine 1 measurement.C+" as Connection696
        [
            breakpoints = 7736, 8176; 7736, 8144
        ]
        connect "Underground Cable2.P2" Junction41 as Connection697
        connect Junction41 "Wind Turbine 2 measurement.A-" as Connection698
        [
            breakpoints = 7976, 8504
        ]
        connect "Underground Cable3.P1" Junction41 as Connection699
        connect "Underground Cable2.P4" Junction42 as Connection700
        connect Junction42 "Wind Turbine 2 measurement.B-" as Connection701
        [
            breakpoints = 7992, 8544; 7992, 8544
        ]
        connect "Underground Cable3.P3" Junction42 as Connection702
        connect "Underground Cable2.P6" Junction43 as Connection703
        connect Junction43 "Wind Turbine 2 measurement.C-" as Connection704
        [
            breakpoints = 8008, 8584; 8008, 8584
        ]
        connect "Underground Cable3.P5" Junction43 as Connection705
        connect gnd17.node "Wind Turbine 1 measurement.GND" as Connection706
        connect gnd18.node "Wind Turbine 2 measurement.GND" as Connection707
        connect gnd19.node "Wind Turbine 3 measurement.GND" as Connection708
    }

    default {
        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_math_fnc {
            mathematical_fn = "exponential"
            execution_rate = "inherit"
        }

        gen_minmax {
            operation = "min"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1,1]"
            a_coeff = "[1,1]"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
            param_set = ""
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/(27) Undervoltage" {
            Vn = "480"
            UV_thresh = "0.9"
            UV_delay = "0.16667"
            execution_rate = "100e-6"
        }

        "core/Battery" {
            sig_output = "False"
            lut = "False"
            battery_type = "Lead-Acid"
            nominal_voltage = "12.0"
            capacity = "1.2"
            initial_soc = "100.0"
            execution_rate = "100e-6"
            Ke_full = "108.0"
            Kdisc_I = "5.0"
            R_series = "0.25"
            Kq_nom = "50.0"
            Kq_exp = "0.9"
            Ke_exp = "102.5"
            preview = "Preview SOC Curve"
        }

        "core/Battery inverter (Average)" {
            Sn = "1.6e6"
            Vn = "480.0"
            Vn_dc = "1000.0"
            fn = "60.0"
            fsw = "2500.0"
            Ts = "Ts"
            L = "100.0e-6"
            R = "1e-5"
            OutputFilterFc = "500.0"
            Resr = "15e-3"
            blowpass = "[  9.82591682e-06,   1.96518336e-05,   9.82591682e-06]"
            alowpass = "[ -1.99111429,  0.9911536 ]"
            V_diff = "5"
            Vmatch_Kp = "0.1"
            Vmatch_Ki = "5.0"
            f_diff = "0.2"
            fmatch_Kp = "0.01"
            fmatch_Ki = "3.0"
            Phase_diff = "1.0"
            Phase_Kp = "0.005"
            Phase_Ki = "0.5"
            ImodeId_Kp = "0.347"
            ImodeId_Ki = "347.22"
            ImodeIq_Kp = "0.347"
            ImodeIq_Ki = "347.22"
            Imode_damp = "-0.272"
            powerRate = "1e5"
            VmodeIdRef_Kp = "10.0"
            VmodeIdRef_Ki = "10.0"
            VmodeId_Kp = "0.8328"
            VmodeId_Ki = "833.33"
            Vmode_ovMod = "1.2"
            Vmode_damp = "-0.0001"
            V_rise = "10e3"
            V_fall = "-10e3"
            f_rise = "10.0"
            f_fall = "-10.0"
            mod_upLim = "1.1546"
            mod_lowLim = "-1.1546"
            k = "0.05"
        }

        "core/Constant Impedance Load" {
            fn = "60"
            conn_type = "Y"
            enable_neutral = "False"
            set_balanced = "True"
            Vn_3ph = "480"
            Sn_3ph = "1.0e6"
            pf_mode_3ph = "Unit"
            pf_3ph = "0.9"
            VAn = "480/(3**0.5)"
            VAB = "480"
            SAn = "1.0e6/3"
            SAB = "1.0e6/3"
            pf_modeA = "Unit"
            pfA = "0.9"
            VBn = "480/(3**0.5)"
            VBC = "480"
            SBn = "1.0e6/3"
            SBC = "1.0e6/3"
            pf_modeB = "Unit"
            pfB = "0.9"
            VCn = "480/(3**0.5)"
            VCA = "480"
            SCn = "1.0e6/3"
            SCA = "1.0e6/3"
            pf_modeC = "Unit"
            pfC = "0.9"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Edge Detection" {
            edge = "both"
            execution_rate = "inherit"
        }

        "core/Four Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Meter Split" {
            van = "True"
            vbn = "True"
            vcn = "True"
            van_rms = "False"
            vbn_rms = "False"
            vcn_rms = "False"
            vln_rms = "False"
            vab = "False"
            vbc = "False"
            vca = "False"
            vab_rms = "False"
            vbc_rms = "False"
            vca_rms = "False"
            vll_rms = "False"
            ia = "False"
            ib = "False"
            ic = "False"
            ia_rms = "False"
            ib_rms = "False"
            ic_rms = "False"
            i_rms = "False"
            freq = "False"
            power_p = "False"
            power_q = "False"
            power_s = "False"
            power_pf = "False"
            enable_extra_in = "No"
            power_pa = "False"
            power_pb = "False"
            power_pc = "False"
            power_qa = "False"
            power_qb = "False"
            power_qc = "False"
            power_sa = "False"
            power_sb = "False"
            power_sc = "False"
            power_pfa = "False"
            power_pfb = "False"
            power_pfc = "False"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            core_model = "Linear"
            ioc1 = "0.7"
            Poc1 = "460.0"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "None"
            coupling_type = "core"
            ratio_type = "Automatic"
            ratio = "0.1"
            Rshunt = "inf"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Three-phase Meter" {
            R = "1e5"
            n_cycles = "1"
            Ts = "100e-6"
            enable_probes = "True"
            enable_out = "True"
            remove_snubber = "False"
            VAn = "True"
            VBn = "True"
            VCn = "True"
            VAB = "False"
            VBC = "False"
            VCA = "False"
            IA = "True"
            IB = "True"
            IC = "True"
            freq = "False"
            VLn_rms = "False"
            VLL_rms = "False"
            VLn_avg_rms = "False"
            VLL_avg_rms = "False"
            I_rms = "False"
            I_avg_rms = "False"
            P_method = "alpha-beta"
            enable_extra_out = "False"
            P_meas = "False"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Underground Cable" {
            model = "RL coupled"
            num_of_phases = "3"
            model_def = "Geometry"
            unit_sys = "imperial"
            Length = "100.0"
            Length_miles = "1.0"
            Frequency = "60.0"
            Earth_resistivity = "100"
            Distance_between_cables_miles = "0.5"
            Distance_between_cables_m = "15.24"
            Number_of_neutral_strands = "13"
            Phase_conductor_GMR_miles = "0.0171"
            Phase_conductor_diam_miles = "0.567"
            Phase_conductor_resistance_miles = "0.41"
            Cable_diam_miles = "1.29"
            Phase_conductor_GMR_m = "5.212"
            Phase_conductor_diam_m = "14.4018"
            Phase_conductor_resistance_m = "0.2547"
            Cable_diam_m = "32.766"
            Screen_conductor_GMR_miles = "0.00208"
            Screen_conductor_diam_miles = "0.0641"
            Screen_conductor_resistance_miles = "14.8722"
            Screen_conductor_GMR_m = "0.6339"
            Screen_conductor_diam_m = "1.62814"
            Screen_conductor_resistance_m = "9.2411"
            Phase_screen_insulator_permitivity = "2.3"
            R_metric = "[[0.4736, 0.1889, 0.1690], [0.1919, 0.4737, 0.188], [0.1757, 0.1919, 0.4736]]"
            R_imperial = "[[0.7623, 0.3040, 0.2719], [0.3089, 0.7624, 0.3040], [0.2828, 0.3089, 0.7623]]"
            L_metric = "[[0.00233, 0.00140, 0.00140], [0.00140, 0.00233, 0.00140], [0.00140, 0.00140, 0.00233]]"
            L_imperial = "[[0.00374, 0.0022, 0.0022], [0.0022, 0.00374, 0.0022], [0.0022, 0.0022, 0.00374]]"
            C_metric = "[[3.18e-7, 0, 0], [0, 3.18e-7, 0], [0, 0, 3.18e-7]]"
            C_imperial = "[[2.562e-7, 0.0, 0.0], [0.0, 2.562e-7, 0.0], [0.0, 0.0, 2.562e-7]]"
            R_sequence_metric = "[[0.3864, 0, 0],[0, 0.01273, 0], [0, 0, 0.01273]]"
            L_sequence_metric = "[[4.1264e-3, 0, 0],[0, 0.9337e-3, 0], [0, 0, 0.9337e-3]]"
            C_sequence_metric = "[[7.751e-9, 0, 0],[0, 12.74e-9, 0], [0, 0, 12.74e-9]]"
            R_sequence_imperial = "[[0.6218, 0, 0],[0, 0.0204, 0], [0, 0, 0.0204]]"
            L_sequence_imperial = "[[0.00664, 0, 0],[0, 0.00150, 0], [0, 0, 0.00150]]"
            C_sequence_imperial = "[[1.247e-8, 0, 0],[0, 2.0503e-8, 0], [0, 0, 2.0503e-8]]"
            import_from_geometry = "Import from Geometry"
            import_from_RLC = "Import from RLC"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
            _tunable = "False"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 400e-6
        
        L0=79.8e-6
        R0=1e-5
        Rres=0.0784
        C=541.7e-6
        L=48e-6
        Rshunt_msr = 1e4
    ENDCODE
}
